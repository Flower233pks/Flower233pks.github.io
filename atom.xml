<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>𝓞𝓻𝓬𝓱𝓲𝓭𝓪𝓷𝔂&#39;𝔀 𝓫𝓵𝓸𝓰</title>
  
  <subtitle>A Soul Tune against Fate Should Be Played, now.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.orchidany.cn/"/>
  <updated>2020-02-08T03:43:10.984Z</updated>
  <id>https://www.orchidany.cn/</id>
  
  <author>
    <name>Orchidany</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>随想 · 目次表</title>
    <link href="https://www.orchidany.cn/2050/12/31/%E9%9A%8F%E6%83%B3%C2%B7%E7%9B%AE%E6%AC%A1%E8%A1%A8/"/>
    <id>https://www.orchidany.cn/2050/12/31/随想·目次表/</id>
    <published>2050-12-31T14:24:26.000Z</published>
    <updated>2020-02-08T03:43:10.984Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>终于又开始了。</p><a id="more"></a><p>我是花，一个不理智的$\rm{Oier}$。我也想每天24小时拼出48小时的效率一心做题，但是我做不到，我血液中凝结着的，在催促我写下来，必须要写下来。</p><p>在这些文章里，你会看到一个迷茫的青年如何满怀热血与绝望，眼里闪烁着沧桑与希望，怀里揣着坏掉的粮食和崭新的论文，脚下踏着崎岖不平的路，向明天走去。</p><p>是的，我是花，来自山东，你直接叫我花这个ID或许我会很高兴，但是如果你认识我也可以不这么拘束。</p>        <div id="aplayer-CZEmuCOW" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-CZEmuCOW"),            narrow: false,            autoplay: false,            showlrc: false,            music: {              title: "花",              author: "Hello Nico",              url: "Hello Nico-花.flac",              pic: "/2050/12/31/随想·目次表/qwq.png",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><p>以下是目录：</p><div class="table-container"><table><thead><tr><th style="text-align:center">篇目</th><th style="text-align:center">链接（点击即可）</th></tr></thead><tbody><tr><td style="text-align:center">随想一 · 山丘</td><td style="text-align:center"><a href="https://www.orchidany.cn/2018/08/02/%E9%9A%8F%E6%83%B3%E4%B8%80/">$Link$</a></td></tr><tr><td style="text-align:center">随想二 · 丘吉尔</td><td style="text-align:center"><a href="https://www.orchidany.cn/2018/08/08/%E9%9A%8F%E6%83%B3%E4%BA%8C/">$Link$</a></td></tr><tr><td style="text-align:center">随想三 · 本赛季最后的随想/启示录</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/02/14/%E9%9A%8F%E6%83%B3%E4%B8%89%C2%B7NOIP/">$Link$</a></td></tr><tr><td style="text-align:center">随想四 · 故人</td><td style="text-align:center"><a href="[https://www.orchidany.cn/2019/03/01/%E9%9A%8F%E6%83%B3%E5%9B%9B%C2%B7%E6%95%85%E4%BA%BA/](https://www.orchidany.cn/2019/03/01/随想四·故人/">$Link$</a>)</td></tr><tr><td style="text-align:center">随想五 · 手中没有红玫瑰</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/02/14/%E9%9A%8F%E6%83%B3%E4%BA%94%C2%B7%E6%83%85%E4%BA%BA%E8%8A%82/">$Link$</a></td></tr><tr><td style="text-align:center">随想六 · 难</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/03/10/%E9%9A%8F%E6%83%B3%E5%85%AD%C2%B7Hard/">$Link$</a></td></tr><tr><td style="text-align:center">随想七 · 言叶之庭</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/03/28/%E9%9A%8F%E6%83%B3%E4%B8%83%C2%B7%E8%A8%80%E5%8F%B6%E4%B9%8B%E5%BA%AD/">$Link$</a></td></tr><tr><td style="text-align:center">随想八 · 逃吧</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/06/11/8/">$Link$</a></td></tr><tr><td style="text-align:center">随想九 · 意义</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/07/18/Nine/">$Link$</a></td></tr><tr><td style="text-align:center">随想十 · 繁星</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/08/20/10/">$Link$</a></td></tr></tbody></table></div><p>第一篇大概是开始？</p><p>第二篇大概是在老校机房写的。当时自己和周围人的关系并不好。</p><p>第三篇就是2018考完NOIP写的啦。</p><p>第四篇由于个人十分喜爱回忆往事，所以是比较重要的一篇，但现在还没有更完。（因为要说的太多了</p><p>第五篇是谈感情的啦，似乎是比较出名的一篇(?)</p><p>第六篇大概是瞎写的。如果每次觉得很难都要写一篇，那估计只有专职作家才能写完。</p><p>第七篇大概是看完《言叶之庭》就立即在机房写的，代表的大概是我理想中爱情的模样吧。</p><p>第八篇也很重要，我的全部压抑情绪都会写进去。当然，和第四篇一样，要说的话太多了，所以写不完/kk</p><p>第九篇大概是「奇异人生」的读/观后感？</p><p>最后一篇…是秘密！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;终于又开始了。&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="随想/下下笔" scheme="https://www.orchidany.cn/tags/%E9%9A%8F%E6%83%B3-%E4%B8%8B%E4%B8%8B%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>【公告】关于这个blog</title>
    <link href="https://www.orchidany.cn/2050/02/05/%E3%80%90%E5%85%AC%E5%91%8A%E3%80%91%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://www.orchidany.cn/2050/02/05/【公告】博客使用指南/</id>
    <published>2050-02-05T09:51:27.000Z</published>
    <updated>2020-04-29T12:34:46.897Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><a id="more"></a><p><del>恭喜你来到了没有知识的荒原.</del></p><p>这篇文章已经移步到侧边栏的「<code>Navigation</code>」里啦！还不去看看？</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="笔尖生花" scheme="https://www.orchidany.cn/tags/%E7%AC%94%E5%B0%96%E7%94%9F%E8%8A%B1/"/>
    
  </entry>
  
  <entry>
    <title>【又置顶】新开始</title>
    <link href="https://www.orchidany.cn/2020/09/30/New-Start/"/>
    <id>https://www.orchidany.cn/2020/09/30/New-Start/</id>
    <published>2020-09-30T13:38:32.000Z</published>
    <updated>2020-09-30T14:13:49.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>嗯，似乎我是咕了好久之后打算重新开始写博客？</p><p>然而其实并没有，只是想记录一下这三个月的见闻或者心得。</p><p>我只是一粒沙而已，唯一不同的可能就是我想和二氧化碳一样自在穿梭于大气、卡尔文循环，从血浆到组织液到淋巴液再回到血浆，自由且充盈——可惜我是硅基，不是碳基。</p><p>(上面其实是一个冷笑话)</p><p>略略略，还有，我又把评论区开起来了。</p><a id="more"></a><p><code>mark down</code> 和 <code>hexo</code> 都快不会用了 233.</p><h1 id="文化课生活"><a href="#文化课生活" class="headerlink" title="文化课生活"></a>文化课生活</h1><p>还可以？高一高二都摸得很，所以导致我现在处境比较艰难。</p><p>但是，只要思想不滑坡，方法总比困难多。</p><p>我还有许多要学的，所以加油啦。</p><h1 id="关于信息学奥赛为何失败"><a href="#关于信息学奥赛为何失败" class="headerlink" title="关于信息学奥赛为何失败"></a>关于信息学奥赛为何失败</h1><p>不努力。就是这样。</p><p>以下是自己的模拟 Q&amp;A：</p><p>Q：「不努力」不就是「太颓了」?</p><p>A：嗯，表面上看是这样，但其实不努力的表现不只是太颓了。<del>并且说实话，个人感觉自己也不是很颓。</del></p><p>Q：但我觉得你挺努力的。</p><p>A：哦，不努力确实不是唯一原因，但确实是主要原因。其余原因包括自己比较懒、不会及时整理没明白透的题；自己学习方法不好，基础也不牢…</p><p>Q：你后悔吗？</p><p>A：不后悔。你让我消除一切记忆回到那天，我还是会再这么做一遍。很遗憾，我败了，因为我对这个世界、对我自己都一点也不了解——比如我的努力一点也配不上我的志向。</p><p>Q：对后来人有什么建议？</p><p>A：别水群…不是天才，就要慎独。</p><p>Q：你觉得 OI 方面智商很重要吗？</p><p>A：放心，能问出这个问题来的——说的就是你——120%以上都没有努力到有资格问这个问题。</p><p>所以，安心努力吧！我的唯一经验就是，你付出多少，就会收获多少！天道酬勤！</p><h1 id="朋友们"><a href="#朋友们" class="headerlink" title="朋友们"></a>朋友们</h1><p>大多数要好的人最后都以 Ag 华丽地结束了自己的生涯，我佩服他们。</p><p>但，也不算全无收获。</p><p>这样看来，我学 OI，其实就是跟做了一场大梦一样。在梦里，我自己经常孤身一人，但也偶尔有人与我同行；我郁郁不得志，但也偶尔会为自己做了有意思的题、写了质量高的题解而高兴一下；我遇到了许多有意思、没意思的人，有意思、没意思的事情，这一切都会，且，只会活在我的记忆里面。</p><p>待以后，某个夕阳下的午后，我对别人缓缓谈起这些，他们信，或者不信：但我是信的——只是这些东西，都曾经确确实实在另一个维度里倔强地活着、静静地生长着。在当下这个我能感到自己体温的维度里面，我没有证据证明他们存在过，我只能说：</p><p>「我全身每一个细胞、每一处经脉，他们或许寿命只有七天，或许有的可以存活两年，但他们都会彼此口耳相传这个美丽的传说——“这个身体的主人曾经经历过一段不平凡的经历，并且失败了。但这不重要。”」</p><p>我或许只是四叠一间里的堂吉诃德，战胜了风车，就是我最骄人的战绩了。</p><p>好啦好啦，以上太浪漫主义了。总之，再见了——这次稍微正式一点。</p><h1 id="班主任"><a href="#班主任" class="headerlink" title="班主任"></a>班主任</h1><p>我对他的感情，这一年半大概是「讨厌 -&gt; 厌恶 -&gt; 理解 -&gt; 懂得 -&gt; 佩服」的过程。</p><p>为啥呢？他是个要求十分严格的人，也是我们级部的副级部主任，导致他经常忙得很。</p><p>他在级部里面主要负责唱白脸，批评教育学生、管纪律…这些吃力不讨好的事情，都是他做。当然他也确实要求的十分严格，并且十分易怒，并且根本不会夸奖别人，而是督促和训诫——这往往会引起学生不爽。</p><p>Anyway，经过一系列事情之后，我开始慢慢理解他了——这世界似乎也没有这么奇怪。</p><p>总之呢，只需要知道，他是唯一一个每天都跟着我们跑操把三圈完完整整跑下来的、会在跑操之前把皮鞋换成跑鞋的男人。</p><p>这种人，很难让人不去打心底佩服+信任他。</p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>高三啦，以后慢慢假期就不存在休闲时光了。</p><p>祝大家什么呢？这次先从笑口常开开始吧(x</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嗯，似乎我是咕了好久之后打算重新开始写博客？&lt;/p&gt;
&lt;p&gt;然而其实并没有，只是想记录一下这三个月的见闻或者心得。&lt;/p&gt;
&lt;p&gt;我只是一粒沙而已，唯一不同的可能就是我想和二氧化碳一样自在穿梭于大气、卡尔文循环，从血浆到组织液到淋巴液再回到血浆，自由且充盈——可惜我是硅基，不是碳基。&lt;/p&gt;
&lt;p&gt;(上面其实是一个冷笑话)&lt;/p&gt;
&lt;p&gt;略略略，还有，我又把评论区开起来了。&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="笔尖生花" scheme="https://www.orchidany.cn/tags/%E7%AC%94%E5%B0%96%E7%94%9F%E8%8A%B1/"/>
    
  </entry>
  
  <entry>
    <title>Gone with the wind</title>
    <link href="https://www.orchidany.cn/2020/07/10/Gone-with-thw-wind/"/>
    <id>https://www.orchidany.cn/2020/07/10/Gone-with-thw-wind/</id>
    <published>2020-07-10T12:38:16.000Z</published>
    <updated>2020-07-10T13:18:41.643Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>大概是一点随感吧…</p><p>主题大概是，发现自己许许多多的过往都飘走了。Just like … Gone with the wind.</p><a id="more"></a><h1 id="零"><a href="#零" class="headerlink" title="零"></a>零</h1><p>上一次在键盘里敲下 <code>hexo new xxxx</code> ，是什么时候呢？似乎是好久之前了。</p><p>本来觉得，六天的高考假期会很长。结果突然就结束了。可能这就是人只会在时间轴的最开始和最末尾，才会产生比较澎湃的心理波动吧；中间，能记住的，都是麻木。</p><p>如今，我又站在了历史和未来的交汇处。我感到不知所措了。</p><p>马上就要搬到高三楼上了。刚从漆黑的奥赛生涯中逃脱出来的我，又要面对另一片漆黑…</p><p>实在是太难了。</p><p>我在奥赛里毫无成就，文化课也毫无成就。高中这两年仿佛就是白给出去了。这让我十分慌张。仿佛我已经听见了为我谱好的哀乐。我一直不如别人有天分，但更重要的是我一直没有别人努力——我甚至没有资格和别人比天分。</p><p>广袤的天地间，我算什么呢…？</p><h1 id="壹"><a href="#壹" class="headerlink" title="壹"></a>壹</h1><p>花觉得，这次他的青春是真的结束了。</p><p>花盯着桌上只写了两三个字的化学小卷，桌角放着的是一个朴素美丽的记事本，胶套上别着一根新买的笔，在凌乱的桌子上，这一个组合显得格外别致有序。</p><p>花静静地想着。</p><p>花一直认识一个学姐。从初二就已经认识了——花一直在记人脸这方面能力很强，他可以记住自己什么时候第一次见过这张脸、第一次见时这张脸当时在做些什么，凡此种种。所以花会认识好多人，但是别人并不认识花。</p><p>不知为何，花从初二就完完整整地记住了那张脸：是瘦的合适的一张脸，带着长方形的黑丝框眼镜，眼睛不算小，至少在眼镜的陪衬下是这样。其实并没有什么更明显的记忆点了，放在人群中讲，满分十分，是 5.5～6.5 分的颜值，不算十分卓越。但花不知为何，就是清楚地记住了。她当时的校服领子上只有一条线，是初三。</p><p>上了高中之后，花又在人海中发现了那个学姐。这也是正常，毕竟作为历二附属初中的稼轩，多数稼轩的学生最后都会升到历二来。但有趣的是，学长学姐那么多，有花更熟的，也有花不熟的——花却总是能从人海中分辨出那张脸。无论是早餐结束后看到她提了一小袋三明治回班当做早餐，还是吃完中饭下楼时正好迎面碰见她——现在的她扎了一个短短的马尾辫，显得更好看了；她一直和一个闺蜜走在一起，那个闺蜜是短发，比她矮一头。她还是一如初中那样，比其他女生都要高，且一如既往瘦的匀称。</p><p>花为什么看的这么清楚？明明是普通一张脸，冥冥中却总有一种力量驱使着他记住。这不同于记住一张俊俏的脸，不同于记住一张丑陋的脸。那只是一副平常的面孔罢了。花也不知道为什么，这种奇妙的缘分一直蔓延到学姐要去高考了。</p><p>花有个小愿望，如果高考后自己没退役，拍毕业照的时候就一定会去找那个学姐要 QQ。一定。</p><p>但是很无奈的，毕业照是提前拍，并且花也提前退役了。但花依然想去要 QQ。于是决定在放高考假那天，也就是 7 月 5日的早上，在餐厅里找到那个学姐，并要 QQ。于是花那天早上五点就醒了，一直到吃完早饭，脑海里一直在预演着自己的说辞，到底是「我想和你交个朋友」更好，还是「能给一下您的联系方式」更好，凡此种种。花还决定，要完 QQ 后一定会对那个学姐说一句「高考加油」。</p><p>终于吃完饭了，花意识到自己没带笔和纸，就火速跑到了餐厅的小卖部里买了一个好看的本子和一支笔。之后花在一楼逛了一圈，没找到，出了餐厅，站在餐厅对面的人行道上，守望着餐厅的每一个门。人开始多了起来，但花相信自己的眼神是锐利的。</p><p>从餐厅出来的人们奇怪地打量着花。花没管这些。只是在找，人群里的她。一定能找到，花相信。</p><p>1min，2min，3min…</p><p>终于，十分钟过去了。</p><p>花离开了了。是跑着离开的。他怕早读迟到。</p><p>回去之后，仔细一想，自己十分难过吗？也没有。十分遗憾吗？也不是。花不知道这种似是而非的感觉究竟是什么，如果硬要说的话，肯定有不解糅在里面：他不解为什么今天这种奇妙的缘分，不再管用了。</p><p>就算要到 QQ 了呢？说实话，花自认为是社交鬼才，跟同一个考场的妹子要 QQ、向检查的学生会妹子要 QQ，都是得心应手的。但是要到了 QQ 又会怎样？ 花的「鬼才」就鬼才在，认识了之后根本不知道要跟人家说什么，所以总是和妹子「起于要QQ，止于要QQ」。所以其实花知道，就算要到了 QQ，也不会发生什么奇妙的事情。</p><p>接着，花开始回忆自己脑海里关于这个学姐的一切，发现其实也没什么可说的，花甚至不知道学姐的声线是怎样的。只不过这个学姐的身影，一点一点的，似乎就串起了花的整个青春。从初中的春风得意、无知无畏，到高一的自闭、自负和自卑，再到高二的坦然、豁达、冷静，一页一页里，都有她的倩影经过留下印痕。这不是友情，不是爱情，是一种比世俗情谊更单纯、比图腾象征更有温度的情感，偷偷地贯穿了花的整个初高青春。花的心一下一下地跳着，他能感到里面似乎空了一块，每跳一下都会发出低沉的回音。</p><p>今年经历了很多。从杀死伊芙第三季以奇妙的方式结束，到自己唯一追的两部国产漫画也以奇妙的方式结束，到花翻出来自己小学的时候最爱看的《终极米迷》系列，发现变得无聊起来，再到自己悄悄地退役了，再到最后和学姐再也不能见面了。花的青春，突然就结束了。</p><p>窗外吹送进来一阵清凉的风。又要下雨了吧。</p><p>那个本子以后就用来记英语吧，花心想。</p><p>虽然我不认识你，但我想说，祝你高考顺利、万事胜意。祝你前途似锦，收获到自己想要的未来。</p><blockquote><p>长路奉献给远方<br>玫瑰奉献给爱情<br>我拿什么奉献给你<br>我的爱人<br>白云奉献给草场<br>江河奉献给海洋<br>我拿什么奉献给你<br>我的朋友<br>我拿什么奉献给你<br>我不停的问<br>我不停的找<br>不停的想<br>不停的想 </p></blockquote><p>为什么会选择韩寒唱过的这版《奉献》作为结尾呢？花在想啊，他究竟奉献了什么？又是什么会奉献给他？花不停的想，但他看不透。</p><p>终于，结束了。本来花的小伙伴们还帮花转发，但很遗憾这份热度没有延伸到最终高考结束。</p><p>所以花这几天其实是在期待着什么东西的…</p><p>算了，故事，就这么结束了吧。</p><h1 id="贰"><a href="#贰" class="headerlink" title="贰"></a>贰</h1><p>喜欢了很久的妹子，就叫她雨吧，突然就没有感觉了。原因呢？可能是我发现，她也就是这样罢了吧。</p><p>大概我脑海里是会有这么另一半的轮廓。在我看来最重要的可能就是心意相通吧。这个心意不是代表「爱意」，只是代表理解能力、思维层次这种东西。也就是说，能互相理解。但是最终我才发现，我和雨之间，没有心意相通的可能性。或者说，我发现雨，其实就是最普通的那种女生。平时没什么追求，考试尽力考好，成绩不算差，但也没有十分优秀。平时只会和自己的朋友走在一起，喜欢看甜宠的那种网文，喜欢追腐。</p><p>这可能就是现在中国社会里最标准的高中女生了吧？也就是和她在 QQ 上聊天的某一瞬间，我突然发现：She is not the Miss Right. 以前她周身的光，突然黯淡了，化作一片片，跌进了尘埃里。</p><p>哦，是这样吗。那光…可能就真的只是我高一军训的某天下午，她收军训日记的时候，从窗户外面照进来的光吧。</p><p>青春，原来就是这么结束的吗…</p><h1 id="叁"><a href="#叁" class="headerlink" title="叁"></a>叁</h1><p>那就这样吧。</p><p>我可能是第一次体会到某些东西的终结。小学升初中的时候，自己根本没啥感觉，脑袋里只有对未来生活的好奇和向往；初中升高中的时候，也因为本身初中高中就是一体的，并且初三下学期就直接去了高中部，所以其实对「结束」这种东西没什么感觉。</p><p>现在…算是被逼无奈吧。必须要结束掉一切，必须要紧握住新生活，必须要学会抵抗未来可能要经历的一切。</p><p>人生本就是充满苦楚和荆棘。我所能做的，只有不断前行。</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>乱七八糟地写了一堆…主要原因是时间不太够了。</p><p>自己还没有能够悟道。</p><p>加油吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;大概是一点随感吧…&lt;/p&gt;
&lt;p&gt;主题大概是，发现自己许许多多的过往都飘走了。Just like … Gone with the wind.&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="随想/下下笔" scheme="https://www.orchidany.cn/tags/%E9%9A%8F%E6%83%B3-%E4%B8%8B%E4%B8%8B%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>【告别】SDOI2020 游记</title>
    <link href="https://www.orchidany.cn/2020/06/19/SDOI2020-%E9%80%80%E5%BD%B9%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/19/SDOI2020-退役记/</id>
    <published>2020-06-19T13:33:33.000Z</published>
    <updated>2020-07-07T04:00:10.188Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><del>先鸽了</del>。</p><p>更了一点。</p><a id="more"></a><h1 id="Goodbye-OI"><a href="#Goodbye-OI" class="headerlink" title="Goodbye OI"></a>Goodbye OI</h1><p>考场表现不想说太多。就是会的少、码力差。Day1T1 挂到了 60，Day1T2 写挂了，Day1T3 完全没想；一整个 Day2 人都没掉了。</p><p>于是大概结果就是退役了。放弃买 D。因为感觉实力确实是不行，买 D 的话也至多能上 Ag 线，在现在形势下没啥用了。</p><p>感觉还是很为自己惋惜的。但是其他人似乎也有很惨的，比如鳖鳖和蛤特楠，很好的朋友还没来得及面基就都退役了。</p><p>祖老师和慎老师成为了没有靠女队名额进队的妹子，足以看出实力雄劲，是山东的红太阳。希望她俩能冲冲冲！</p><p>其实关于 OI，其实没啥想说的。感觉自己一路上很多事情都是顺理成章、自然而然地就发生了。所以这可能就是我OI路的浸尽头了。上大学也不会从事跟这方面有关的事情了。</p><p>自己一直不是一个很有实力的选手。我可能是个例外，从来没有过别的 OIer 曾经或多或少有过的「高光时刻」。每场比赛排名都很差。所以从 6 月初开始，我就已经可以看到这模糊的未来了，只是还没想好到底该怎么去接受。不过如今对 OI 算是没什么牵挂了。</p><p>我一直不喜欢学 OI，学 OI 也不是因为兴趣，而是因为某种神秘的渴望。对 OI 兴趣最浓厚的时候，可能就是今年 5 月、6 月的时候了吧。很庆幸自己能有这样的机会，能够在退役之前发现对 OI 的热爱。</p><p>学 OI 的每个日夜，自己的内心都是那么煎熬。用不安、失望、嫉恨和无力交织成网，努力保护那一抹淡淡的、名为希望的烛光，是在是太累了。</p><p>OI…就这样吧。</p><h1 id="Hello-World！"><a href="#Hello-World！" class="headerlink" title="Hello World！"></a>Hello World！</h1><p>上了几天文化课，除了觉得会有间歇性走神之外，感觉可能还是文化课比较适合我。</p><p>刚回来考月考，化学喜提了 55 分，因为必修三的知识和有机合成那一块确实生疏了很多。然后语文和英语都是班里第二，语文 121，英语 140。虽然数学低了一点，但是感觉下次再分考场应该会分到稍微靠前一点的场子里面了吧…这次考试，由于上学期一场试都没考，按综合排名被分到了最后的考场…不得不说最后一个考场真是什么神仙都有，甚至有考到最后一场发现自己走错考场的集美 (x</p><p>我校一直是每年最多有 $\leqslant 1$ 个可以上 T/P 的。所以不稳定在年级第一就压根没啥希望…加油吧，小小花。</p><p>以后这个 blog 就用来写文章了？反正本来没多少人看。</p><p>大家再见，我们有缘再会。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;del&gt;先鸽了&lt;/del&gt;。&lt;/p&gt;
&lt;p&gt;更了一点。&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="随想/下下笔" scheme="https://www.orchidany.cn/tags/%E9%9A%8F%E6%83%B3-%E4%B8%8B%E4%B8%8B%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>【题解】前两年省选题选做</title>
    <link href="https://www.orchidany.cn/2020/06/19/%E5%89%8D%E4%B8%A4%E5%B9%B4%E7%9C%81%E9%80%89%E9%A2%98%E7%9E%8E%E5%81%9A/"/>
    <id>https://www.orchidany.cn/2020/06/19/前两年省选题瞎做/</id>
    <published>2020-06-19T12:22:42.000Z</published>
    <updated>2020-06-19T13:30:50.649Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>来自一条咸鱼最后的挣扎。</p><p>大概是补完了一下「九省联考 Day1」 的全部，「十二省联考 Day1T3 骗分过样例」的 $75$ 分和「十二省联考 Day2」 的 $70+100+36$ 分。</p><p>感觉自己打得稳一点，分数也还可以。</p><p>剩下的题可能是要等到很久很久以后才能做了。</p><a id="more"></a><h1 id="九省联考-Day1"><a href="#九省联考-Day1" class="headerlink" title="九省联考 Day1"></a>九省联考 Day1</h1><h2 id="A-一双木棋"><a href="#A-一双木棋" class="headerlink" title="A 一双木棋"></a>A 一双木棋</h2><p>去年写过一个 alpha-beta 剪枝的版本，喜提了 70。现在选择重新再做。</p><p>一开始的时候完全没有任何思路，只知道 $2^{n\times m}$ 大概是可以最多 $50pts$。然后思考了一下一定是状态数过多，但是想了半天也不知道怎么压成一维的。之后突然想到可能合法的状态数并不多，然而自己并不太会算这个状态数，于是就打了个表发现确实不多，极限数据只有不到 $2\times 10^5$ 。于是就把所有状态都存到了 <code>vector</code> 里。</p><p>之后就喜提了 30 = =。原因可能是我这方面比较薄弱。大概是说虽然初始状态和终止状态，也就是第一步和最后一步的状态(包括位置和先后手)都是固定的，但是不能顺推，这样出来的是错的结果。原因也比较简单，顺推是假的「绝顶聪明」，真正的「绝顶聪明」都会是通过观察将来局面的可能结果再去判断如何行动。所以应该逆推。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">11</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Base = <span class="number">233</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1000010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> cnt[N] ;</span><br><span class="line"><span class="keyword">int</span> A[N][N] ;</span><br><span class="line"><span class="keyword">int</span> B[N][N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="built_in">map</span> &lt;ll, <span class="keyword">int</span>&gt; h ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; s[M] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">get_s</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ret = (ret * Base + cnt[i]) % P ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> mn ;</span><br><span class="line"><span class="keyword">int</span> dep ;</span><br><span class="line"><span class="keyword">int</span> Id[M] ;</span><br><span class="line"><span class="keyword">int</span> rev[M] ;</span><br><span class="line"><span class="keyword">int</span> val[M] ;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">2</span>][M] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ++ dep ;</span><br><span class="line">    <span class="keyword">if</span> (!h[get_s()])&#123;</span><br><span class="line">        ++ tot ;</span><br><span class="line">        mn = m + <span class="number">1</span> ;</span><br><span class="line">        h[get_s()] = tot ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            s[tot].push_back(cnt[i]) ;</span><br><span class="line">            mn = min(mn, cnt[i]) ;</span><br><span class="line">            val[tot] += cnt[i] ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mn == m) <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (cnt[i] &gt;= m || cnt[i] &gt;= cnt[i - <span class="number">1</span>])</span><br><span class="line">            <span class="keyword">continue</span> ; cnt[i] ++ ; dfs() ; cnt[i] -- ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out_put</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; &amp; p, <span class="keyword">bool</span> q = <span class="number">0</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : p)&#123;</span><br><span class="line">        <span class="keyword">if</span> (q) <span class="built_in">putchar</span>(<span class="string">'#'</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= t ; ++ j) <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = t + <span class="number">1</span> ; j &lt;= m ; ++ j) <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    puts("- - - - - - - - - - - - -") ;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; cnt[<span class="number">0</span>] = m + <span class="number">1</span> ; dfs() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++ i) Id[i] = i ;</span><br><span class="line">    sort(Id + <span class="number">1</span>, Id + tot + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> val[x] &gt; val[y] ; &#125;) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++ i) rev[Id[i]] = i ;</span><br><span class="line"><span class="comment">//  for (int i = 1 ; i &lt;= tot ; ++ i) out_put(s[i]) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;A[i][j]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;B[i][j]) ;</span><br><span class="line">    <span class="built_in">memset</span>(f[<span class="number">1</span>], <span class="number">63</span>, <span class="keyword">sizeof</span>(f[<span class="number">1</span>])) ;</span><br><span class="line">    <span class="built_in">memset</span>(f[<span class="number">0</span>], <span class="number">-63</span>, <span class="keyword">sizeof</span>(f[<span class="number">0</span>])) ;</span><br><span class="line">    <span class="keyword">if</span> ((n * m) &amp; <span class="number">1</span>)</span><br><span class="line">         f[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">else</span> f[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">0</span> ; <span class="comment">//f[1][1] = 0 ; // 0是先手，1是后手</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; tot ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">int</span> x = Id[i], y = <span class="number">0</span>, z, t = <span class="number">0</span>, o ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> p = s[x].begin() ; p != s[x].end() ; ++ p)&#123;</span><br><span class="line">            ++ t ; y = <span class="number">0</span> ; <span class="keyword">int</span> mv = m ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> q = s[x].begin() ; q != s[x].end() ; ++ q)&#123;</span><br><span class="line">                <span class="keyword">int</span> x = *q ; cnt[++ y] = x ;</span><br><span class="line">                <span class="keyword">if</span> (p == q) -- cnt[y], o = cnt[y] ;</span><br><span class="line">                <span class="keyword">if</span> (mv &lt; cnt[y]) <span class="keyword">goto</span> cccc ; mv = min(cnt[y], mv) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( !( z = h[get_s()] ) ) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (f[<span class="number">0</span>][i] &lt; P) f[<span class="number">1</span>][rev[z]] = min(f[<span class="number">1</span>][rev[z]], f[<span class="number">0</span>][i] - B[t][o + <span class="number">1</span>]) ;</span><br><span class="line">            <span class="keyword">if</span> (f[<span class="number">1</span>][i] &lt; P) f[<span class="number">0</span>][rev[z]] = max(f[<span class="number">0</span>][rev[z]], f[<span class="number">1</span>][i] + A[t][o + <span class="number">1</span>]) ;</span><br><span class="line">            cccc : <span class="keyword">continue</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; tot &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[<span class="number">0</span>][tot]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正解似乎是轮廓线什么的= =。</p><h2 id="B-IIIDX"><a href="#B-IIIDX" class="headerlink" title="B IIIDX"></a>B IIIDX</h2><p>大概是先打了 $30pts$ 的暴力。之后莫名其妙地把这个图建成了一个 DAG 导致不可做。然后我就觉得似乎是只有另外 $15pts$ 的二叉树和树有关，推了一下，大概是最大化这棵树的 BFS 序的 $val$ 序列的字典序…感觉并不是很可做。然后就跑路了。</p><p>然后发现是个十分神奇的贪心+找性质…</p><p>大概是说先考虑 $d_i$ 都不相同的情况。此时由于这棵树满足堆性质，所以会有一个贪心，就是一棵子树内的权值必然在原序列里面是连续的，这一点不难证明，因为如果要在满足堆性质的前提下使得 BFS 序最大，连续是最好的方案。于是就可以以 $0$ 为根建个树，然后把所有的数从小到大排序来做。</p><p>然后考虑如果存在 $d_i$ 相同，那么这么贪心就会有问题。考虑此时的父子关系可以存在 $d_x=d_{fa_x}$ ，所以有时候可以把一个更大的数移到另一个和 $x$ 深度相同但编号靠后的位置上。但考虑贪心的本质还是不变的。即考虑提前计算贡献，考虑对于一个 $x$ ，如果他想选的话，至少要留出 $size_x-1$ 个位置来给它的子树。</p><p>考虑用线段树维护这个过程。先对所有数排个序，考虑用每个数去填满 $1\sim n$ 这些位置。线段树上维护 $seg_x$ 表示区间内 $v_i$ 的最小值，其中 $v_i$ 是位置 $i$ 左边还可以放的位置个数。那么每次可以线段树上二分出最靠左的合法位置。然后就是一个后缀加操作。</p><p>注意有两个细节：</p><p>1、二分时候的边界问题。二分完了需要判一下是否合法。</p><p>2、如果多个数相同，那么为了保证顺序固定，考虑每次选在原序列里面最靠右的那个位置就好了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">double</span> k ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> h, t ;</span><br><span class="line"><span class="keyword">int</span> q[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> cnt[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check_ans</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (ans[i] &gt; base[tmp[i]]) <span class="keyword">return</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ans[i] &lt; base[tmp[i]]) <span class="keyword">goto</span> ccc ;</span><br><span class="line">    ccc :</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans[i] = base[tmp[i]] ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base[a] &lt; base[b] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    sz[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        sz[x] += dfs(y) ;</span><br><span class="line">    <span class="keyword">return</span> sz[x] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line">    sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> x &gt; y ; &#125;) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="keyword">if</span> (base[i] == base[i - <span class="number">1</span>]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    ans[x] = base[r --] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        solve(l, l + sz[y] - <span class="number">1</span>, y), l += sz[y] ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tag[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _up(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    seg[rt] = seg[lc] &gt; seg[rc] ? seg[rc] : seg[lc] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> _down(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag[rt])&#123;</span><br><span class="line">        seg[lc] += tag[rt] ;</span><br><span class="line">        seg[rc] += tag[rt] ;</span><br><span class="line">        tag[lc] += tag[rt] ;</span><br><span class="line">        tag[rc] += tag[rt] ;</span><br><span class="line">        tag[rt] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(seg[rt] = r) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    build (lc, l, mid) ;</span><br><span class="line">    build (rc, mid + <span class="number">1</span>, r) ; _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ul, <span class="keyword">int</span> ur, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ul &lt;= l &amp;&amp; r &lt;= ur)</span><br><span class="line">        <span class="keyword">return</span> seg[rt] += v, <span class="keyword">void</span>(tag[rt] += v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; _down(rt) ;</span><br><span class="line">    <span class="keyword">if</span> (ul &lt;= mid) upd(lc, l, mid, ul, ur, v) ;</span><br><span class="line">    <span class="keyword">if</span> (ur &gt; mid) upd(rc, mid + <span class="number">1</span>, r, ul, ur, v) ;</span><br><span class="line">    _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> l + (seg[rt] &lt; v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; _down(rt) ; </span><br><span class="line">    <span class="keyword">if</span> (seg[rc] &gt;= v)</span><br><span class="line">         <span class="keyword">return</span> qry(lc, l, mid, v) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> qry(rc, mid + <span class="number">1</span>, r, v) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) tmp[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]), fa[i] = <span class="built_in">floor</span>(<span class="number">1.0</span> * i / k) ;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= n ; ++ i) printf("%d\n", fa[i]) ;</span></span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line"><span class="comment">//            for (int i = 1 ; i &lt;= n ; ++ i)</span></span><br><span class="line"><span class="comment">//                cout &lt;&lt; base[tmp[i]] &lt;&lt; ' ' ; //puts("") ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (base[tmp[fa[i]]] &gt; base[tmp[i]]) <span class="keyword">goto</span> cccc ;</span><br><span class="line">            check_ans() ; <span class="comment">//cout &lt;&lt; 233 &lt;&lt; '\n' ;</span></span><br><span class="line">            cccc : <span class="keyword">continue</span> ;</span><br><span class="line">        &#125;<span class="keyword">while</span> (next_permutation(tmp + <span class="number">1</span>, tmp + n + <span class="number">1</span>)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (check())&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[fa[i]].push_back(i) ;</span><br><span class="line">        dfs(<span class="number">0</span>) ; solve(<span class="number">1</span>, n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//cout &lt;&lt; 233 &lt;&lt; '\n' ;         </span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[fa[i]].push_back(i) ;</span><br><span class="line">       dfs(<span class="number">0</span>) ; build(<span class="number">1</span>, <span class="number">1</span>, n) ; <span class="keyword">int</span> x, y, z ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (base[i] == base[i + <span class="number">1</span>])</span><br><span class="line">                cnt[i] = cnt[i + <span class="number">1</span>] + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            j = fa[i] ;</span><br><span class="line">            <span class="keyword">if</span> (j &amp;&amp; !vis[j])</span><br><span class="line">                vis[j] = <span class="number">1</span>, upd(<span class="number">1</span>, <span class="number">1</span>, n, ans[j], n, sz[j] - <span class="number">1</span>) ;</span><br><span class="line">            y = x = qry(<span class="number">1</span>, <span class="number">1</span>, n, sz[i]) ;</span><br><span class="line">            x += cnt[y] ; z = x ;</span><br><span class="line">            z -= cnt[x] ++ ;</span><br><span class="line">            ans[i] = z ;</span><br><span class="line">            upd(<span class="number">1</span>, <span class="number">1</span>, n, z, n, - sz[i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) ans[i] = base[ans[i]] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans[i] &lt;&lt; <span class="string">" "</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-秘密袭击"><a href="#C-秘密袭击" class="headerlink" title="C 秘密袭击"></a>C 秘密袭击</h2><p>毒瘤 DP…</p><p>一开始想的是要枚举每个点计算贡献，后来写了半天一直挂…也不民白为啥。</p><p>不过学了一波，觉得可能还是枚举每个权值来 DP 更有道理。考虑对于一个权值 $w$ ，问题变成了有多少种选择的方式使得连通块内大于等于 $w$ 的权值有 $k$ 个。设 $f_{x,v}$ 表示在点 $x$ 的子树内选择一个连通块，大于等于 $w$ 的权值有 $v$ 个的方案数。转移就是比较平常的背包转移。然后用一点上下界优化可以把复杂度优化到 $O(n^2w)$ 。</p><p>然后大概是需要一些技巧才能通过此题。都在代码里了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> ui ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">64123</span> ;</span><br><span class="line"></span><br><span class="line">ui ans ;</span><br><span class="line"><span class="keyword">int</span> num ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> cnt[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> n, k, m ;</span><br><span class="line"></span><br><span class="line">ui g[N] ;</span><br><span class="line">ui f[N][M] ; <span class="comment">// i is root, \leq j is k</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void do_up(int x, int fa)&#123;</span></span><br><span class="line"><span class="comment">    sz[x] = 1 ;</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">        f[x][i][1] = (i &lt;= base[x]), f[x][i][0] = 1 ;</span></span><br><span class="line"><span class="comment">    for (auto y : E[x])&#123;</span></span><br><span class="line"><span class="comment">        if (y == fa) continue ;</span></span><br><span class="line"><span class="comment">        do_up(y, x) ; sz[x] += sz[y] ;</span></span><br><span class="line"><span class="comment">        memset(g, 0, sizeof(g)) ;</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= base[x] ; ++ i)</span></span><br><span class="line"><span class="comment">            for (int j = 1 ; j &lt;= sz[x] ; ++ j)</span></span><br><span class="line"><span class="comment">                for (int k = 0 ; k &lt;= sz[y] ; ++ k)</span></span><br><span class="line"><span class="comment">                    (g[i][j + k + 1] += f[x][i][j] * f[y][i][k] % P) %= P ;</span></span><br><span class="line"><span class="comment">        for (int i = base[x] + 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">            for (int j = 1 ; j &lt;= sz[x] ; ++ j)</span></span><br><span class="line"><span class="comment">                for (int k = 0 ; k &lt;= sz[y] ; ++ k)</span></span><br><span class="line"><span class="comment">                    (g[i][j + k] += f[x][i][j] * f[y][i][k] % P) %= P ;</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">            for (int j = 1 ; j &lt;= sz[x] ; ++ j)</span></span><br><span class="line"><span class="comment">                f[x][i][j] = g[i][j], g[i][j] = 0 ;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        printf("###%d###\n", y) ;</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">            for (int j = 0 ; j &lt;= sz[x] ; ++ j)</span></span><br><span class="line"><span class="comment">                printf("%d %d %d %u\n", x, i, j, f[x][i][j]) ;</span></span><br><span class="line"><span class="comment">        puts("o o o o o o o o o o o o") ;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    puts("- - - - - - - - - - - - - - -") ;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    sz[x] = cnt[x] ; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i) </span><br><span class="line">f[x][i] = <span class="number">0</span> ; f[x][cnt[x]] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa)</span><br><span class="line">            <span class="keyword">continue</span> ; solve(y, x) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= sz[x] ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= sz[y] ; ++ j)</span><br><span class="line">                (g[min(i + j, k)] += f[x][i] * f[y][j] % P) %= P ;</span><br><span class="line">        sz[x] += sz[y] ; sz[x] = min(sz[x], k) ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= sz[x] ; ++ i) </span><br><span class="line">(f[x][i] += g[i]) %= P, g[i] = <span class="number">0</span> ; </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    printf("%d- - - - - - - - - - - - - -\n", x) ;</span></span><br><span class="line"><span class="comment">//    for (int i = 0 ; i &lt;= k ; ++ i)</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; f[x][i] &lt;&lt; " " ; puts("") ;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y ; <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k &gt;&gt; m ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (int root = 1 ; root &lt;= n ; ++ root)&#123;</span></span><br><span class="line"><span class="comment">        memset(f, 0, sizeof(f)) ; do_up(root, 0) ;</span></span><br><span class="line"><span class="comment">        cout &lt;&lt; root &lt;&lt; " " &lt;&lt; f[root][base[root]][k] &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="comment">        (ans += base[root] * f[root][base[root]][k] % P) %= P ;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span> ; v &lt;= m ; ++ v)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (base[i] &gt;= v) ++ num, cnt[i] = <span class="number">1</span> ; <span class="keyword">else</span> cnt[i] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">if</span> (num &lt; k) <span class="keyword">break</span> ; solve(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) (ans += f[i][k]) %= P ; num = <span class="number">0</span> ; </span><br><span class="line"><span class="comment">//        puts("") ; puts("") ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="十二省联考-Day2"><a href="#十二省联考-Day2" class="headerlink" title="十二省联考 Day2"></a>十二省联考 Day2</h1><h2 id="A-皮配-70-分"><a href="#A-皮配-70-分" class="headerlink" title="A 皮配(70 分)"></a>A 皮配(70 分)</h2><p>$50$ 分大概是 $O(nM^2)$ 的 DP。然而一开始自己想的是 $O(nM^3)$ 的，写着写着突然发现 $c_0,c_1$ 只用记一个，$d_0,d_1$ 只用记一个，然后相同颜色的放在一起做背包就好了。</p><p>$70$ 分比较神仙，$k=0$ 。学习了一波。发现此时相当于给每个城市分配一个阵营，给每个学校分配一个派系，且<strong>两者无关</strong>。于是就可以分别 dp。设 $f_{i,j}$ 表示前 $i$ 个学校，有 $j$ 个选手选了鸭派系的方案数；同理设 $g_{i,j}$ 表示前 $i$ 个城市，有 $j$ 个城市选了红阵营的方案数。这就是一个比较普通的背包转移。最后答案就是</p><script type="math/tex; mode=display">\left(\sum_{i=s-c_{1}}^{c_{0}} f_{n,i}\right) \times \left(\sum_{j=s-d_{1}}^{d_{0}}  g_{m,j}\right)</script><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2505</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(T x, <span class="keyword">char</span> c = <span class="string">'\n'</span>)</span></span>&#123; <span class="built_in">cerr</span> &lt;&lt; x &lt;&lt; c ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(T *<span class="keyword">const</span> tp, <span class="keyword">int</span> minn, <span class="keyword">int</span> maxn, <span class="keyword">char</span> v = <span class="string">' '</span>, <span class="keyword">char</span> c = <span class="string">'\n'</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = minn ; i &lt;= maxn ; ++ i) debug(tp[i], v) ;  <span class="built_in">cerr</span> &lt;&lt; c ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> T, d ;</span><br><span class="line"><span class="keyword">int</span> id[N] ;</span><br><span class="line"><span class="keyword">int</span> nl[N] ;</span><br><span class="line"><span class="keyword">int</span> sum[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, k ;</span><br><span class="line"><span class="keyword">int</span> c_0, c_1 ; <span class="comment">//0,1 2,3</span></span><br><span class="line"><span class="keyword">int</span> d_0, d_1 ; <span class="comment">//0,2 1,3</span></span><br><span class="line"><span class="comment">//d_1 = c_0 - d_0 + c_1 = sum - d_0</span></span><br><span class="line"><span class="keyword">int</span> f[<span class="number">2</span>][M][M] ;</span><br><span class="line"><span class="keyword">int</span> g[<span class="number">2</span>][M][M] ;</span><br><span class="line"><span class="built_in">map</span> &lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; ncol[N] ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">person</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id ;</span><br><span class="line">    <span class="keyword">int</span> col ;</span><br><span class="line">    <span class="keyword">int</span> val ;</span><br><span class="line">&#125; ;</span><br><span class="line">person tmp[N] ;</span><br><span class="line">person base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> person &amp; a, <span class="keyword">const</span> person &amp; b)</span></span>&#123; <span class="keyword">return</span> a.col &lt; b.col ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> t[<span class="number">2</span>][M][M])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= c_0 ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= d_0 ; ++ j)</span><br><span class="line">t[d][i][j] = <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_dp</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s, v, k, np, nq ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l ; i &lt;= r ; ++ i, d ^= <span class="number">1</span>)&#123;</span><br><span class="line">        s = sum[i] ;</span><br><span class="line">        k = base[i].id ;</span><br><span class="line">        v = base[i].val ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; i &lt;&lt; " " &lt;&lt; d &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="keyword">if</span> (!c) clear(f) ; <span class="keyword">else</span> clear(g) ; </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = c_0 ; p &gt;= <span class="number">0</span> ; -- p)&#123;</span><br><span class="line">            np = s - p ; <span class="keyword">if</span> (np &gt; c_1) <span class="keyword">break</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> q = d_0 ; q &gt;= <span class="number">0</span> ; -- q)&#123;</span><br><span class="line">                nq = s - q ; <span class="keyword">if</span> (nq &gt; d_1) <span class="keyword">break</span> ;</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (nl[k] != <span class="number">0</span> &amp;&amp; p &gt;= v &amp;&amp; q &gt;= v)</span><br><span class="line">                        add(f[d][p][q], f[d ^ <span class="number">1</span>][p - v][q - v]) ;</span><br><span class="line">                    <span class="keyword">if</span> (nl[k] != <span class="number">1</span> &amp;&amp; nq &gt;= v &amp;&amp; p &gt;= v)</span><br><span class="line">                        add(f[d][p][q], f[d ^ <span class="number">1</span>][p - v][q]) ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (nl[k] != <span class="number">2</span> &amp;&amp; np &gt;= v &amp;&amp; q &gt;= v)</span><br><span class="line">                        add(g[d][p][q], g[d ^ <span class="number">1</span>][p][q - v]) ;</span><br><span class="line">                    <span class="keyword">if</span> (nl[k] != <span class="number">3</span> &amp;&amp; np &gt;= v &amp;&amp; nq &gt;= v)</span><br><span class="line">                        add(g[d][p][q], g[d ^ <span class="number">1</span>][p][q]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fs[M] ;</span><br><span class="line"><span class="keyword">int</span> gs[M] ;</span><br><span class="line"><span class="keyword">int</span> scol[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve0</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> oo)</span></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(fs, <span class="number">0</span>, <span class="keyword">sizeof</span>(fs)) ;</span><br><span class="line"><span class="built_in">memset</span>(gs, <span class="number">0</span>, <span class="keyword">sizeof</span>(gs)) ;</span><br><span class="line">    fs[<span class="number">0</span>] = gs[<span class="number">0</span>] = <span class="number">1</span> ; ans = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= oo ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = c_0 ; j &gt;= scol[i] ; -- j)</span><br><span class="line">            <span class="keyword">if</span> (scol[i]) add(fs[j], fs[j - scol[i]]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= o ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = d_0 ; j &gt;= base[i].val ; -- j)</span><br><span class="line">            add(gs[j], gs[j - base[i].val]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = max(sum[o] - c_1, <span class="number">0</span>) ; i &lt;= c_0 ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = max(sum[o] - d_1, <span class="number">0</span>) ; j &lt;= d_0 ; ++ j)</span><br><span class="line">            add(ans, <span class="number">1l</span>l * fs[i] * gs[j] % P) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">        <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span>(g)) ;</span><br><span class="line">        <span class="built_in">memset</span>(nl, <span class="number">-1</span>, <span class="keyword">sizeof</span>(nl)) ;</span><br><span class="line">        <span class="built_in">memset</span>(scol, <span class="number">0</span>, <span class="keyword">sizeof</span>(scol)) ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) ; <span class="keyword">int</span> x, z ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;c_0, &amp;c_1, &amp;d_0, &amp;d_1) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            ncol[i].clear(), base[i].id = i ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;base[i].col, &amp;base[i].val) ;</span><br><span class="line">        <span class="built_in">memcpy</span>(tmp, base, <span class="keyword">sizeof</span>(base)) ;</span><br><span class="line">        sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, comp) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            scol[base[i].col] += base[i].val ;</span><br><span class="line">            sum[i] = sum[i - <span class="number">1</span>] + base[i].val ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; k ; d = <span class="number">1</span> ; <span class="keyword">int</span> td ;</span><br><span class="line">        g[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>)&#123; solve0(n, m) ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x, <span class="built_in">cin</span> &gt;&gt; nl[x], ncol[tmp[x].col][nl[x]] ++ ;</span><br><span class="line"><span class="comment">//        debug(nl, 1, n) ; debug(sum, 1, n) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span>, r, c ; l &lt;= n ; l = r + <span class="number">1</span>)&#123;</span><br><span class="line">            r = l ; c = base[l].col ;</span><br><span class="line">            <span class="keyword">while</span> (base[r + <span class="number">1</span>].col == c) ++ r ;</span><br><span class="line">            td = d ; do_dp(l, r, <span class="number">1</span>) ;</span><br><span class="line">            d = td ; do_dp(l, r, <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= c_0 ; ++ i)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= d_0 ; ++ j)&#123;</span><br><span class="line">                    add(f[r &amp; <span class="number">1</span>][i][j], g[r &amp; <span class="number">1</span>][i][j]) ;</span><br><span class="line">                    g[r &amp; <span class="number">1</span>][i][j] = f[r &amp; <span class="number">1</span>][i][j] ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= c_0 ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= d_0 ; ++ j)</span><br><span class="line">                add(ans, f[n &amp; <span class="number">1</span>][i][j]) ; <span class="comment">//, cout &lt;&lt; f[n &amp; 1][i][j] &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-春节十二响"><a href="#B-春节十二响" class="headerlink" title="B 春节十二响"></a>B 春节十二响</h2><p>暴力比较好想。大家都说不是很容易证明…我还真没发现(x</p><p>大概通过链的部分分，很容易发现合并两条链的时候应该大找大，小找小。然后我是直接把所有链都找了出来，排了个序然后拿了个 <code>set</code> 维护。然后试图在树上用神必的方式忽略相同的信息发现失败…</p><p>之后知道了正确做法觉得挺 rz。大概就是把我那个过程换成对 <code>set</code> 的启发式合并就好了。想了想感觉十分有道理。</p><div><div class="fold_hider"><div class="close hider_title">「My-75pts-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//75分</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> mxd ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> val[N] ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> stk[N], tp ;</span><br><span class="line"><span class="built_in">multiset</span> &lt;<span class="keyword">int</span>&gt; s ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; L[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; zscv ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> _tree&#123;</span><br><span class="line">    <span class="keyword">int</span> sum ;</span><br><span class="line">    <span class="keyword">int</span> sz[N] ;</span><br><span class="line">    <span class="keyword">int</span> dep[N] ;</span><br><span class="line">    <span class="keyword">int</span> dfn[N] ;</span><br><span class="line">    <span class="keyword">int</span> son[N] ;</span><br><span class="line">    <span class="keyword">int</span> top[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> da)</span></span>&#123;</span><br><span class="line">        dep[x] = dep[da] + <span class="number">1</span>, sz[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span> (y == da) <span class="keyword">continue</span> ;</span><br><span class="line">            dfs1(y, x) ; sz[x] += sz[y] ;</span><br><span class="line">            <span class="keyword">if</span> (sz[y] &gt; sz[son[x]]) son[x] = y ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tp)</span></span>&#123;</span><br><span class="line">        top[x] = tp ;</span><br><span class="line">        dfn[x] = ++ cnt ;</span><br><span class="line">        <span class="keyword">if</span> (son[x])</span><br><span class="line">            dfs2(son[x], tp) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">            <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) dfs2(y, y) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (top[x] != top[y])&#123;</span><br><span class="line">            <span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])</span><br><span class="line">                <span class="built_in">std</span> :: swap(x, y) ; x = fa[top[x]] ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (dep[x] &gt; dep[y])</span><br><span class="line">            <span class="built_in">std</span> :: swap(x, y) ; <span class="keyword">return</span> x ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> _tree ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs_l</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    tmp[++ cnt] = base[x] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x]) dfs_l(y) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    stk[++ tp] = x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x]) solve(y) ;</span><br><span class="line">    <span class="keyword">if</span> (deg[x] &lt;= <span class="number">1</span> &amp;&amp; x &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">int</span> t = tp ;</span><br><span class="line">        <span class="keyword">while</span> (stk[t]) L[x].push_back(stk[t --]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    stk[tp --] = <span class="number">0</span> ; mxd = max(mxd, dep[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123; <span class="keyword">return</span> a &gt; b ; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;fa[i]), E[fa[i]].push_back(i) ;</span><br><span class="line"><span class="comment">//        printf("%d %d\n", fa[i], i) ;</span></span><br><span class="line">        deg[i] ++, deg[fa[i]] ++, mxd = max(mxd, max(deg[fa[i]], deg[i])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs1(<span class="number">1</span>, <span class="number">0</span>) ; dfs2(<span class="number">1</span>, <span class="number">1</span>) ; cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (mxd &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        dfs_l(E[<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">        <span class="built_in">memcpy</span>(val, tmp, <span class="keyword">sizeof</span>(tmp)) ;</span><br><span class="line">        <span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="keyword">sizeof</span>(tmp)) ;</span><br><span class="line">        <span class="keyword">if</span> (E[<span class="number">1</span>].size() &lt;= <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                ans += val[i] ; <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            mxd = cnt ;</span><br><span class="line">            cnt = <span class="number">0</span> ; dfs_l(E[<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">            sort(tmp + <span class="number">1</span>, tmp + cnt + <span class="number">1</span>, comp) ;</span><br><span class="line">            sort(val + <span class="number">1</span>, val + mxd + <span class="number">1</span>, comp) ;</span><br><span class="line">            <span class="keyword">if</span> (mxd &gt; cnt) swap(val, tmp), swap(mxd, cnt) ;</span><br><span class="line"><span class="comment">//            for (int i = 1 ; i &lt;= n ; ++ i)</span></span><br><span class="line"><span class="comment">//                printf("%d %d\n", tmp[i], val[i]) ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mxd ; ++ i)</span><br><span class="line">                ans += max(tmp[i], val[i]) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mxd + <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">                ans += tmp[i] ;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans + base[<span class="number">1</span>]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt;= <span class="number">300000</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (deg[i] &lt;= <span class="number">1</span>) val[++ cnt] = i ;</span><br><span class="line">        sort(val + <span class="number">1</span>, val + cnt + <span class="number">1</span>, [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> dfn[x] &lt; dfn[y] ; &#125;) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            tmp[val[i]] = lca(val[i], val[i - <span class="number">1</span>]) ;</span><br><span class="line">        solve(mxd = <span class="number">1</span>) ;</span><br><span class="line"><span class="comment">//        for (int i = 1 ; i &lt;= n ; ++ i) cout &lt;&lt; dep[i] &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mxd ; ++ i) s.insert(<span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            sort(L[val[i]].begin(), L[val[i]].end(), [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> base[x] &gt; base[y] ; &#125;) ;</span><br><span class="line"><span class="comment">//        for (int i = 1 ; i &lt;= cnt ; ++ i)&#123;</span></span><br><span class="line"><span class="comment">//            cout &lt;&lt; val[i] &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="comment">//            for (auto t : L[val[i]]) cout &lt;&lt; t &lt;&lt; " " ; puts("") ;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; i &lt;&lt; '\n';</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> j : L[val[i]])&#123;</span><br><span class="line">                <span class="keyword">auto</span> p = s.lower_bound(base[j]) ;</span><br><span class="line">                <span class="keyword">if</span> (p == s.end())</span><br><span class="line">                    s.erase(-- p), zscv.push_back(base[j]) ;</span><br><span class="line">                <span class="keyword">else</span> s.erase(p), zscv.push_back(*p) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> j : zscv) s.insert(j) ; zscv.clear() ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> p : s) ans += p ; <span class="comment">//, cout &lt;&lt; p &lt;&lt; " " ;</span></span><br><span class="line">         <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> n, base[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N], mg ;</span><br><span class="line">priority_queue &lt;<span class="keyword">int</span>&gt; h[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        solve(y) ;</span><br><span class="line">        <span class="keyword">if</span> (h[y].size() &gt; h[x].size()) swap(h[x], h[y]) ;</span><br><span class="line">        <span class="keyword">while</span> (h[y].size())</span><br><span class="line">            mg.push_back(max(h[y].top(), h[x].top())), h[y].pop(), h[x].pop() ;</span><br><span class="line">        <span class="keyword">while</span> (mg.size()) h[x].push(mg.back()), mg.pop_back() ;</span><br><span class="line">    &#125;</span><br><span class="line">    h[x].push(base[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), E[x].push_back(i) ;</span><br><span class="line">    solve(<span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">while</span> (h[<span class="number">1</span>].size())</span><br><span class="line">        ans += h[<span class="number">1</span>].top(), h[<span class="number">1</span>].pop() ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="C-希望-36-分"><a href="#C-希望-36-分" class="headerlink" title="C 希望(36 分)"></a>C 希望(36 分)</h1><p>鸽了。</p><h1 id="十二省联考-骗分过样例"><a href="#十二省联考-骗分过样例" class="headerlink" title="十二省联考 骗分过样例"></a>十二省联考 骗分过样例</h1><p>过程比较曲折，没啥时间写了。就先放一下代码吧。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> us unsigned</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NR = <span class="number">1000010</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX = <span class="number">150000010</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXP = <span class="number">10000100</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX2 = <span class="number">50000010</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> phm = <span class="number">998244352</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N ;</span><br><span class="line"><span class="keyword">char</span> In[<span class="number">10000</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Sub1&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">expow</span><span class="params">(ll a, ll b)</span></span>&#123;</span><br><span class="line">        ll res = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (b)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) res = res * a % mod ;</span><br><span class="line">            a = a * a % mod, b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//    const char *Muban = "1_998244353" ;</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check1</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">11</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ll ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">            ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt; mod) ret = ret % phm + phm ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; <span class="keyword">int</span> i ; ll q ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) q = qr(), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, expow(<span class="number">19</span>, q)) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Sub2&#123;</span><br><span class="line">    <span class="keyword">int</span> mod = <span class="number">1145141</span>, phm = <span class="number">1145140</span> ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">expow</span><span class="params">(ll a, ll b)</span></span>&#123;</span><br><span class="line">        ll res = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (b)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) res = res * a % mod ;</span><br><span class="line">            a = a * a % mod, b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">get_phi</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">        ll rt = <span class="built_in">sqrt</span>(x) + <span class="number">1</span>, ret = x ;</span><br><span class="line">        <span class="keyword">for</span> (ll p = <span class="number">2</span> ; p &lt;= rt ; ++ p)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(x % p)) &#123; ret = ret * (p - <span class="number">1</span>) / p ; <span class="keyword">while</span> (!(x % p)) x /= p ;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">1</span>) ret = ret * (x - <span class="number">1</span>) / x ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check2</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">2</span> &amp;&amp; In[<span class="number">1</span>] == <span class="string">'?'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ll ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c))&#123;</span><br><span class="line">            ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">            <span class="keyword">if</span> (ret &gt; mod) ret = ret % phm + phm ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; <span class="keyword">int</span> i ; ll q ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) q = qr(), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, expow(<span class="number">19</span>, q)) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Sub3&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ull unsigned long long</span></span><br><span class="line">    ull mod = <span class="number">5211600617818708273L</span>L, phm = mod - <span class="number">1</span> ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ull <span class="title">mul</span><span class="params">(ull a, ull b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">register</span> ull res = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (b)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) res = (res + a) % mod ;</span><br><span class="line">            a = (a + a) % mod, b &gt;&gt;= <span class="number">1u</span>ll ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ull <span class="title">expow</span><span class="params">(ull a, ull b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">register</span> ull res = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (b)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) res = mul(res, a) % mod ;</span><br><span class="line">            a = mul(a, a) % mod, b &gt;&gt;= <span class="number">1u</span>ll ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ull <span class="title">get_phi</span><span class="params">(ull x)</span></span>&#123;</span><br><span class="line">        ull rt = <span class="built_in">sqrt</span>(x) + <span class="number">1</span>, ret = x ;</span><br><span class="line">        <span class="keyword">for</span> (ull p = <span class="number">2</span> ; p &lt;= rt ; ++ p)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(x % p)) &#123; ret = ret * (p - <span class="number">1</span>) / p ; <span class="keyword">while</span> (!(x % p)) x /= p ;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">1</span>) ret = ret * (x - <span class="number">1</span>) / x ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check3</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">3</span> &amp;&amp; In[<span class="number">1</span>] == <span class="string">'?'</span> &amp;&amp; In[<span class="number">2</span>] == <span class="string">'+'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ull <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ull ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; <span class="keyword">int</span> i ; ull q ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) q = qr(), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, expow(<span class="number">19</span>, q)) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">这里是一张表，防止博客卡顿于是塞到了 paste bin 里面，链接： https:<span class="comment">//paste.ubuntu.com/p/WS9Vm2J3BR/</span></span><br><span class="line"><span class="keyword">namespace</span> Sub4&#123;</span><br><span class="line">    <span class="keyword">const</span> ll mod = <span class="number">998244353</span> ;</span><br><span class="line">    <span class="keyword">const</span> ll phm = mod - <span class="number">1</span> ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (b)&#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) res = (<span class="keyword">int</span>)((<span class="keyword">unsigned</span>)res * (<span class="keyword">unsigned</span>)a)  % mod;</span><br><span class="line">            a = (<span class="keyword">int</span>)(((<span class="keyword">unsigned</span>)a * (<span class="keyword">unsigned</span>)a) )% mod ; b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res % mod ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check4</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">13</span> &amp;&amp; In[<span class="number">1</span>] == <span class="string">'w'</span> &amp;&amp; In[<span class="number">2</span>] == <span class="string">'a'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ll ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> pwp[NR] ;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> t ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve4</span><span class="params">()</span></span>&#123;<span class="comment">//55245 45699</span></span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; pwp[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; NR ; ++ i)</span><br><span class="line">            pwp[i] = pwp[i - <span class="number">1</span>] * <span class="number">19</span> % mod ;</span><br><span class="line">        <span class="keyword">while</span> (N --)&#123;</span><br><span class="line">            t = qr() ;</span><br><span class="line">            <span class="keyword">if</span> (t &lt;= <span class="number">55245</span>)</span><br><span class="line">                 <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pwp[t]) ;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pwp[(t - <span class="number">55245</span>) % <span class="number">45699</span> + <span class="number">55245</span>]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> pr[MAXP + <span class="number">10</span>] ;</span><br><span class="line"><span class="keyword">int</span> phi[MAXP &lt;&lt; <span class="number">1</span>] ;</span><br><span class="line"><span class="keyword">bool</span> vis[MAX + <span class="number">10</span>] ;</span><br><span class="line"><span class="keyword">bool</span> vis2[NR + <span class="number">10</span>] ;</span><br><span class="line"><span class="keyword">bool</span> chk[MAXP &lt;&lt; <span class="number">1</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Sub5&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check5</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">2</span> &amp;&amp; A[<span class="number">0</span>] == <span class="string">'2'</span> &amp;&amp; A[<span class="number">1</span>] == <span class="string">'p'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Euler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        vis[<span class="number">0</span>] = vis[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= MAX ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis[i]) pr[++ cnt] = i ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i * pr[j] &gt; MAX) <span class="keyword">break</span> ;</span><br><span class="line">                vis[i * pr[j]] = <span class="number">1</span> ; <span class="keyword">if</span> (i % pr[j] == <span class="number">0</span>) <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Jie</span><span class="params">(us ll L, us ll R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L &gt;= <span class="number">99999999999900000L</span>L)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= <span class="number">4370</span> ; ++ i) vis2[wa[i]] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">for</span> (us ll j = L / pr[i] - <span class="number">1</span> ; j &lt;= R / pr[i] + <span class="number">1</span> ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (j * pr[i] &gt; R || j * pr[i] &lt; L) <span class="keyword">continue</span> ;</span><br><span class="line">                vis2[j * pr[i]- L] = <span class="number">1</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ll ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Euler() ;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; us ll L, R ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line">            L = qr() ;</span><br><span class="line">            R = qr() ;</span><br><span class="line">            <span class="keyword">if</span> (R &lt;= MAX)</span><br><span class="line">                <span class="keyword">for</span> (us ll j = L ; j &lt;= R ; ++ j)</span><br><span class="line">                    <span class="keyword">if</span> (vis[j]) <span class="built_in">putchar</span>(<span class="string">'.'</span>) ; <span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">'p'</span>) ;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                Jie(L, R) ;</span><br><span class="line">                <span class="keyword">for</span> (us ll j = L ; j &lt;= R ; ++ j)</span><br><span class="line">                    <span class="keyword">if</span> (vis2[j - L]) <span class="built_in">putchar</span>(<span class="string">'.'</span>) ; <span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">'p'</span>) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Sub6&#123;</span><br><span class="line"><span class="keyword">short</span> mu[MAX + <span class="number">10</span>] ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check6</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">2</span> &amp;&amp; A[<span class="number">0</span>] == <span class="string">'2'</span> &amp;&amp; A[<span class="number">1</span>] == <span class="string">'u'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Euler</span><span class="params">()</span></span>&#123;</span><br><span class="line">        vis[<span class="number">0</span>] = vis[<span class="number">1</span>] = <span class="number">1</span> ; mu[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= MAX2 ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis[i]) pr[++ cnt] = i, mu[i] = <span class="number">-1</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i * pr[j] &gt; MAX2) <span class="keyword">break</span> ;</span><br><span class="line">                vis[i * pr[j]] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">if</span> (i % pr[j] == <span class="number">0</span>) <span class="keyword">break</span> ;</span><br><span class="line">            mu[i * pr[j]] = - mu[i] ;</span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> trv[NR] ;</span><br><span class="line">    <span class="keyword">short</span> mu2[MAX + <span class="number">10</span>] ;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Jie</span><span class="params">(us ll L, us ll R)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (ll i = L ; i &lt;= R ; ++ i) trv[i - L] = i ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line"><span class="keyword">for</span> (us ll j = L / pr[i] - <span class="number">1</span> ; j &lt;= R / pr[i] + <span class="number">1</span> ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (j * pr[i] &gt; R) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (j * pr[i] &lt; L) <span class="keyword">continue</span> ;</span><br><span class="line">vis2[j * pr[i]- L] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">if</span> (j % pr[i] == <span class="number">0</span>)</span><br><span class="line"> mu2[j * pr[i] - L] = <span class="number">-10000</span> ;</span><br><span class="line"><span class="keyword">else</span> mu2[j * pr[i] - L] ++ ;</span><br><span class="line">            trv[j * pr[i] - L] /= pr[i] ;</span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= (<span class="keyword">int</span>)(R - L + <span class="number">1</span>) ; ++ i)</span><br><span class="line"><span class="keyword">if</span> (!vis2[i]) mu2[i] = <span class="number">1</span>, trv[i] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c = getchar() ; ll ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = getchar() ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) ret = (ret &lt;&lt; <span class="number">1</span>) + (ret &lt;&lt; <span class="number">3</span>) + c - <span class="number">48</span>, c = getchar() ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Euler() ;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; N ; us ll L, R ; <span class="comment">//return void() ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line">            L = qr(), R = qr() ;</span><br><span class="line">            <span class="comment">//cerr &lt;&lt; i &lt;&lt; " " &lt;&lt; L &lt;&lt; " " &lt;&lt; R &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">if</span> (R &lt;= MAX2)&#123;</span><br><span class="line">                <span class="keyword">for</span> (us ll j = L ; j &lt;= R ; ++ j)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (mu[j]) <span class="built_in">putchar</span>(~mu[j] ? <span class="string">'+'</span> : <span class="string">'-'</span>) ;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                Jie(L, R) ;</span><br><span class="line">                <span class="keyword">for</span> (us ll j = L ; j &lt;= R ; ++ j)&#123;</span><br><span class="line"><span class="comment">//                cerr &lt;&lt; trv[j - L] &lt;&lt; '\n' ;</span></span><br><span class="line">                    <span class="keyword">if</span> (mu2[j - L] &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="built_in">putchar</span>(( ( mu2[j - L] + (trv[j - L] &gt; <span class="number">1</span>) ) &amp; <span class="number">1</span>) ? <span class="string">'-'</span> : <span class="string">'+'</span>) ;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Sub7&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check7</span><span class="params">(<span class="keyword">char</span> *A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> Len = <span class="built_in">strlen</span>(A) ;</span><br><span class="line">        <span class="keyword">if</span> (Len == <span class="number">2</span> &amp;&amp; A[<span class="number">0</span>] == <span class="string">'2'</span> &amp;&amp; A[<span class="number">1</span>] == <span class="string">'g'</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sieve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">   phi[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= x ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">            pr[++ cnt] = i, phi[i] = i - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (i * pr[j] &gt; x) <span class="keyword">break</span> ;</span><br><span class="line">vis[i * pr[j]] = <span class="number">1</span> ;</span><br><span class="line">           <span class="keyword">if</span> (i % pr[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                phi[i * pr[j]] = phi[i] * pr[j] ; <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> phi[i * pr[j]] = phi[i] * (pr[j] - <span class="number">1</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ctz __builtin_ctz</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(a * b)) <span class="keyword">return</span> a + b ;</span><br><span class="line">    <span class="keyword">int</span> t = ctz(a | b) ; a &gt;&gt;= ctz(a) ;</span><br><span class="line">    <span class="keyword">do</span> &#123; b &gt;&gt;= ctz(b) ; <span class="keyword">if</span> (a &gt; b) swap(a, b) ;  b -= a ; &#125; <span class="keyword">while</span>(b) ;</span><br><span class="line">    <span class="keyword">return</span> a &lt;&lt; t ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (b)&#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            res = <span class="number">1l</span>l * res * a % p ;</span><br><span class="line">        a = <span class="number">1l</span>l * a * a % p ; b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> L, R, P ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ctn, tot ;</span><br><span class="line"><span class="keyword">int</span> fac[NR], rt, po ;</span><br><span class="line"><span class="keyword">int</span> dmod[<span class="number">3</span>] = &#123;<span class="number">2</span>, <span class="number">7</span>, <span class="number">17</span>&#125; ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Solve7</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N ;</span><br><span class="line">sieve((MAXP &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">while</span> (N --)&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; L &gt;&gt; R &gt;&gt; P ;</span><br><span class="line"><span class="keyword">if</span> (P == mod)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = L ; i &lt;= R ; ++ i)&#123;</span><br><span class="line"><span class="keyword">bool</span> rr = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; ++ j)</span><br><span class="line">rr |= (<span class="keyword">bool</span>)(expow(i, phm / dmod[j], mod) == <span class="number">1</span>) ;</span><br><span class="line"><span class="built_in">putchar</span>(rr ? <span class="string">'.'</span> : <span class="string">'g'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (P &lt; MAXP &lt;&lt; <span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">int</span> p = phi[P] ; ctn = tot = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">2</span> ; i * i &lt;= p ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (p % i == <span class="number">0</span>)&#123;</span><br><span class="line">                fac[++ tot] = i ;</span><br><span class="line">                <span class="keyword">while</span> (p % i == <span class="number">0</span>) p /= i ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">if</span> (p &gt; <span class="number">1</span>) fac[++ tot] = p ; po = phi[P] ;</span><br><span class="line"><span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= P ; ++ i)&#123;</span><br><span class="line">         rg <span class="keyword">bool</span> ans = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= tot ; ++ j)</span><br><span class="line">                <span class="keyword">if</span> (expow(i, po / fac[j], P) == <span class="number">1</span>)&#123; ans = <span class="number">1</span> ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">            <span class="keyword">if</span> (!ans &amp;&amp; expow(i, po, P) == <span class="number">1</span>) &#123; rt = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> j = <span class="number">1</span>, i = <span class="number">1</span> ; i &lt;= po ; ++ i)&#123;</span><br><span class="line">            j = <span class="number">1l</span>l * j * rt % P ;</span><br><span class="line">            <span class="keyword">if</span> (gcd(i, po) == <span class="number">1</span>) chk[j] = <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = L ; i &lt;= R ; ++ i)</span><br><span class="line">        <span class="built_in">putchar</span>(!chk[i] ? <span class="string">'.'</span> : <span class="string">'g'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, In) ;</span><br><span class="line">    <span class="keyword">if</span> (Sub1 :: check1(In)) Sub1 :: Solve1() ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Sub2 :: check2(In)) Sub2 :: Solve2() ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Sub3 :: check3(In)) Sub3 :: Solve3() ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Sub4 :: check4(In)) Sub4 :: Solve4() ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Sub5 :: check5(In)) Sub5 :: Solve5() ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (Sub6 :: check6(In)) Sub6 :: Solve6() ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (Sub7 :: check7(In)) Sub7 :: Solve7() ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;来自一条咸鱼最后的挣扎。&lt;/p&gt;
&lt;p&gt;大概是补完了一下「九省联考 Day1」 的全部，「十二省联考 Day1T3 骗分过样例」的 $75$ 分和「十二省联考 Day2」 的 $70+100+36$ 分。&lt;/p&gt;
&lt;p&gt;感觉自己打得稳一点，分数也还可以。&lt;/p&gt;
&lt;p&gt;剩下的题可能是要等到很久很久以后才能做了。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="loj" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/loj/"/>
    
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="动态规划/状压DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="贪心" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="数据结构/线段树" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="暴力,brute-force" scheme="https://www.orchidany.cn/tags/%E6%9A%B4%E5%8A%9B-brute-force/"/>
    
      <category term="博弈论/对称博弈" scheme="https://www.orchidany.cn/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA-%E5%AF%B9%E7%A7%B0%E5%8D%9A%E5%BC%88/"/>
    
  </entry>
  
  <entry>
    <title>【赛题整理】[Codeforces Round#584(Combined) A~G2] 题解</title>
    <link href="https://www.orchidany.cn/2020/06/14/CF-Round-584/"/>
    <id>https://www.orchidany.cn/2020/06/14/CF-Round-584/</id>
    <published>2020-06-14T10:50:28.000Z</published>
    <updated>2020-06-19T12:13:44.280Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>不得不说，这场是真的真的良心！首先知识点覆盖全面，各种题目也都比较富有思维含量，大概是我打过的 Combined 场里面质量最高的一场。</p><p>然后就 vp 了一整场，最后的战绩大概还不错？</p><p>一共有 $9$ 道题目。</p><a id="more"></a><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>上面那个是托神。最后 rush 了一个 $\rm G1$ ，结果把 $y$ 写成 $x$ 就挂了。结束之后 $3\sim 5\min$ 左右就过掉了吧。</p><h1 id="A-Paint-the-Numbers"><a href="#A-Paint-the-Numbers" class="headerlink" title="[A] Paint the Numbers"></a>[A] Paint the Numbers</h1><blockquote><p>给出一个长度为 $n$ 的序列 $a_1,a_2,a_3,… ,a_n$，要求你使用最少的颜色对每个染色。对于任何颜色，满足：染成该颜色的数都能被染成该颜色的最小数整除。</p><p>$1\leq n\leq 100$ 。</p></blockquote><p>不难知道要排个序之后，对每个数扫一下它的倍数打上标记。最后没有被标记的就是最少的色数。</p><p>不过想了一下，如果 $a_i$ 在 $10^6\sim 10^7$ 左右，那么是可以 $O(nd(n))$ 做的。</p><h1 id="B-Koala-and-Lights"><a href="#B-Koala-and-Lights" class="headerlink" title="[B] Koala and Lights"></a>[B] Koala and Lights</h1><blockquote><p>有 $n$ 盏灯，给定初始状态 。<br>第 $i$盏灯 $a_i,a_i+b_i,a_i+2\times b_i,a_i+3\times b_i\cdots$ 时刻被切换状态 。<br>求 同一时刻亮的灯数 的最大值。<br>$n\leq 100,a_i,b_i\leq 5$ 。</p></blockquote><p>一开始觉得又是什么奇怪的 exgcd 题。然后发现 $a_i,b_i\leq 5$ 。于是就可以暴力上 $100$ 万天去找最大值。</p><p>一开始因为调试，把天数设置为了 $20$ 导致挂了一发= =。</p><h1 id="C-Paint-the-Digits"><a href="#C-Paint-the-Digits" class="headerlink" title="[C] Paint the Digits"></a>[C] Paint the Digits</h1><blockquote><p>给定一个数字字符串 $s$。把它分割为两个子序列(可以不连续)。满足把第二个子序列接在第一个子序列之后形成的数字串不降</p><p>$1\leq n\leq 10^6$ .</p></blockquote><p>一开始猜了一个把 LIS 找出来就完了。然后发现假的离谱。然后就考虑观察性质，发现如果存在合法答案，那么对于一个 $i$ 如果位置不变，会有 $1\sim i-1$ 都 $\leqslant i$ 。不难发现这是个十分强的必要条件。于是可以这么把答案取出来，然后去 check 一下充分性就好了。复杂度线性。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">301000</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> n, T ;</span><br><span class="line"><span class="keyword">int</span> maxc ;</span><br><span class="line"><span class="keyword">int</span> maxv ;</span><br><span class="line"><span class="keyword">int</span> res[N] ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; ans1, ans2 ;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T) ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ;</span><br><span class="line">        maxv = maxc = <span class="number">0</span> ;</span><br><span class="line">        ans2.clear() ; ans1.clear() ;</span><br><span class="line">        <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis)) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%1d"</span>, &amp;base[i]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (maxv &gt; base[i])</span><br><span class="line">                 vis[i] = <span class="number">1</span>, maxc = max(base[i], maxc) ;</span><br><span class="line">            <span class="keyword">else</span> maxv = <span class="built_in">std</span> :: max(maxv, base[i]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[i] || base[i] &lt; maxc)</span><br><span class="line">                 ans1.push_back(i) ;</span><br><span class="line">            <span class="keyword">else</span> ans2.push_back(i) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> k : ans1) ans[k] = <span class="number">1</span>, res[++ cnt] = base[k] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> k : ans2) ans[k] = <span class="number">2</span>, res[++ cnt] = base[k] ;</span><br><span class="line">       <span class="comment">// for (int i = 1 ; i &lt;= n ; ++ i) printf("%d ", res[i]) ; puts("") ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (res[i] &lt; res[i - <span class="number">1</span>]) <span class="keyword">goto</span> cc ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d"</span>, ans[i]) ; <span class="built_in">puts</span>(<span class="string">""</span>) ; <span class="keyword">continue</span> ;</span><br><span class="line">        cc : <span class="built_in">puts</span>(<span class="string">"-"</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="D-Cow-and-Snacks"><a href="#D-Cow-and-Snacks" class="headerlink" title="[D] Cow and Snacks"></a>[D] Cow and Snacks</h1><blockquote><p>$n$ 种花，$k$ 个客人，每个人喜欢两种编号不同的花。但是每种花在花店里只有一束。</p><p>客人按顺序进入花店，会买走所有她喜欢且仍在店铺里的花。如果一个客人买不到任何一束花，那么她就会十分沮丧导致变成肥宅。现在你可以自己安排这 $n$ 个人的顺序，使得肥宅的数量最小。</p><p>$1\leq n,k\leq 3\times 10^5$ 。</p></blockquote><p>我就是传说中的图论黑洞吗，这题捣鼓了好久好久 = =</p><p>大概就是说，考虑每一次客人可能会买走 $1$ 或者 $2$ 种花。考略用图论模型去刻画买花这件事情。考虑可以把花当做点，客人每次就是要删去 $(x_i,y_i)$ 这条边的两个端点，而一条边 $(x,y)$ 可以被删当且仅当存在一个端点没有被删掉。于是可以发现，如果一个连通块大小为 $B$，那么至多只会有 $B-1$ 个客人可以不沮丧。</p><p>考虑用并查集实现这个过程。那么并查集中的边数即为 $\sum (B-1)$ 。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> n, k, ans ;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fa[x] == x) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f1 = find(x) ;</span><br><span class="line">    <span class="keyword">int</span> f2 = find(y) ;</span><br><span class="line">    <span class="keyword">if</span> (f1 != f2)&#123;</span><br><span class="line">        ++ cnt ;</span><br><span class="line">        fa[f1] = f2 ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) fa[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y, merge(x, y) ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, k - cnt) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="E1-Rotate-Columns-easy-version"><a href="#E1-Rotate-Columns-easy-version" class="headerlink" title="[E1] Rotate Columns (easy version)"></a>[E1] Rotate Columns (easy version)</h1><blockquote><p>给定一个 $n×m$ 的矩阵，你可以对每一列进行若干次循环移位。</p><p>求操作完成后每一行的最大值之和最大是多少。</p><p>$1\leq n\leq 4,1\leq m\leq 100$ 。</p></blockquote><p>大概是需要先起手找一波性质。</p><p>发现「每行取最大值」可以转化成每行取一个数，因为根据 max 的结合律这个最大值的限制属实没用。然后就可以设 $f_{i,s}$ 表示考虑了前 $i$ 列，每一行的取数状态为 $s$ 时答案的 max。转移就可以直接枚举子集转移。需要注意的是列是允许循环移位的，所以在预处理 <code>sum[s]</code> 时要考虑到这一点。</p><p>于是最后的复杂度就是 $O(T\cdot m\cdot 3^n)$ 。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T, s ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> Id[S] ;</span><br><span class="line"><span class="keyword">int</span> sum[S] ;</span><br><span class="line"><span class="keyword">int</span> f[N][S] ;</span><br><span class="line"><span class="keyword">int</span> row[N][M] ;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> I = <span class="number">1000000007</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out_p</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x)&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &amp; <span class="number">1</span>)</span><br><span class="line">             <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">        x &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">' '</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= <span class="number">12</span> ; ++ i)</span><br><span class="line">        Id[<span class="number">1</span> &lt;&lt; i] = i + <span class="number">1</span> ; <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">        s = (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">-63</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">                <span class="built_in">cin</span> &gt;&gt; row[j][i] ; f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">1</span> ; p &lt;= s ; ++ p)&#123;</span><br><span class="line">                sum[p] = sum[p - (p &amp; -p)] + row[i][Id[(p &amp; -p)]] ;</span><br><span class="line"><span class="comment">//                printf("%d %d\n", p, sum[p]) ;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">1</span> ; p &lt;= s ; ++ p)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">0</span> ; o &lt; n ; ++ o)&#123;</span><br><span class="line">                    <span class="keyword">int</span> q = ((p &gt;&gt; o) | (p &lt;&lt; (n - o))) &amp; s ;</span><br><span class="line"><span class="comment">//                    out_p(p), out_p(q), puts("") ;</span></span><br><span class="line">                    sum[p] = max(sum[p], sum[q]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            f[i][<span class="number">0</span>] = f[i - <span class="number">1</span>][<span class="number">0</span>] ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">1</span> ; p &lt;= s ; ++ p)&#123;</span><br><span class="line">            f[i][p] = f[i - <span class="number">1</span>][p] ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> q = p ; q ; q = (q - <span class="number">1</span>) &amp; p)</span><br><span class="line">f[i][p] = max(f[i][p], f[i - <span class="number">1</span>][p ^ q] + sum[q]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//            printf("%d %d\n", s, f[i][s]) ;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[m][s]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="E2-Rotate-Columns-hard-version"><a href="#E2-Rotate-Columns-hard-version" class="headerlink" title="[E2] Rotate Columns (hard version)"></a>[E2] Rotate Columns (hard version)</h1><blockquote><p>$n\leq 12,m\leq 2000$ 。</p></blockquote><p>发现上面那个复杂度要通过有点困难，算了一波大概是 $40\times 531441\times 2000&gt;10^{10}$ …</p><p>然后考虑需要猜一个结论。就是一定会存在某些列是根本不会对答案有贡献的，且这些列的数量是 $m-n$ 。那么考虑如果存在某一列，该列的最大值 $c$ 在所有列中排名 $&gt;n$ ，那么由于可以循环移位，可以知道答案一定不在这一列。于是就可以排个序，复杂度就变成了 $O(T\times n\times 3^n)$，大概是 $40\times 531441\times 12&lt;2.5e8$ ，可以通过本题。</p><h1 id="F-Koala-and-Notebook"><a href="#F-Koala-and-Notebook" class="headerlink" title="[F] Koala and Notebook"></a>[F] Koala and Notebook</h1><blockquote><p>定义一条路径的权值为路径上所有边的编号直接相连所得到的十进制数字的大小 。</p><p>求 $1$ 到每个点的最短路 $\pmod{10^9+7}$ 。</p><p>$1\leq n,m\leq 100000$。</p></blockquote><p>这题是真的有趣。虽然场上并没有去写（感觉写了也是不可能过的）。</p><p>一开始觉得「难道不是把出边 xjb 排个序就做完了嘛」。然后发现被叉了，心情郁闷(x</p><p>考虑如何比较「编号相连得到的十进制数」的大小，那必然是先比较位数，再从头开始比较权值。于是就有个特别强的建图技巧：拆边。考虑把一条编号为 $(\overline{a_1a_2\cdots a_k})_{10}$ 的边拆成两条有向链，链上的边的边权分别为 $a_1,a_2\cdots a_k$。</p><p>然后考虑进行类似分层图的 BFS。这个分层图的细节很丰富：</p><p>0、分层的目的是，控制遍历顺序，使得 BFS 的最优性也在当前问题中体现。即使得对于每个点，最先被遍历时一定是最短路。</p><p>1、首先要先忽略边权进行分层。</p><p>2、其次考虑如果存在多条出边，必然是走权最小的那条边。</p><p>3、只符合上面两条还是不对的。因为考虑如果某个点 $t$ 有两条入边 $e_1,e_2$ 满足 $val(e_1)&lt;val(e_2)$，他们在 BFS 树上的深度相同，那么如果单纯按点来转移，可能会出现先走 $e_2$ 再走 $e_1$ 的情况，而此时 $t$ 已经被更新完毕就会导致出错。所以还要按照边权从 $0$ 到 $9$ 进行再分层。</p><p>可以知道这样做最后复杂度一定不会超过 $O(10\times m)$ 。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">int ob ;</span><br><span class="line">int cnt ;</span><br><span class="line">int n, m ;</span><br><span class="line">int arr[M] ;</span><br><span class="line">int f[N] ;</span><br><span class="line">int g[N] ;</span><br><span class="line">int T ;</span><br><span class="line"> </span><br><span class="line">vector &lt;int&gt; q[N] ;</span><br><span class="line">vector &lt;int&gt; E[N][10] ;</span><br><span class="line"> </span><br><span class="line">int main()&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    int x, y, z ; cnt &#x3D; n ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; m ; ++ i)&#123;</span><br><span class="line">        x &#x3D; qr(), y &#x3D; qr() ; ob &#x3D; 0 ; z &#x3D; i ;</span><br><span class="line">        while (z) arr[++ ob] &#x3D; z % 10, z &#x2F;&#x3D; 10 ; z &#x3D; x ;</span><br><span class="line">        for (int j &#x3D; ob ; j &gt; 1 ; -- j)</span><br><span class="line">            E[x][arr[j]].push_back(++ cnt), x &#x3D; cnt ;</span><br><span class="line">        E[x][arr[1]].push_back(y) ;</span><br><span class="line">        for (int j &#x3D; ob ; j &gt; 1 ; -- j)</span><br><span class="line">            E[y][arr[j]].push_back(++ cnt), y &#x3D; cnt ;</span><br><span class="line">        E[y][arr[1]].push_back(z) ;</span><br><span class="line">    &#125;</span><br><span class="line">    g[1] &#x3D; T &#x3D; 1 ;</span><br><span class="line">    q[1].push_back(1) ;</span><br><span class="line">    for (int d &#x3D; 1 ; d &lt;&#x3D; T ; ++ d)&#123;</span><br><span class="line">&#x2F;&#x2F;        if (!q[d].size()) break ;</span><br><span class="line">        for (z &#x3D; 0 ; z &lt; 10 ; ++ z)&#123;</span><br><span class="line">            auto t &#x3D; q[d].begin() ;</span><br><span class="line">            while (t !&#x3D; q[d].end())&#123;</span><br><span class="line">                x &#x3D; *t ;</span><br><span class="line">                for (auto y : E[x][z])&#123;</span><br><span class="line">                    if (g[y]) continue ;</span><br><span class="line">                    f[y] &#x3D; (f[x] * 10ll + z) % P ;</span><br><span class="line">                    g[y] &#x3D; 1, q[T + 1].push_back(y) ;</span><br><span class="line">                &#125;</span><br><span class="line">                ++ t ;</span><br><span class="line">            &#125;</span><br><span class="line">            if (q[T + 1].size()) ++ T ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    for (int i &#x3D; 2 ; i &lt;&#x3D; n ; ++ i)</span><br><span class="line">        printf(&quot;%d\n&quot;, f[i]) ; return 0 ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="G1-Into-Blocks-easy-version"><a href="#G1-Into-Blocks-easy-version" class="headerlink" title="[G1] Into Blocks (easy version)"></a>[G1] Into Blocks (easy version)</h1><p>感觉这个 G1 还是比较 naive 的？</p><blockquote><p>给你 $n~q$，$n$表示序列长度，$q$表示操作次数，在该题中 $q$ 等于 0 。</p><p>我们需要达成这么一个目标状态：</p><blockquote><p>如果存在 $x$ 这个元素，那么必须满足所有 $x$ 元素都必须在序列中连续。</p></blockquote><p>可以进行这么一种操作：</p><p>将所有的 $x$ 元素的变为任意你指定的 $y$ 元素，并且花费 $cnt_x$ 的花费，$cnt_x$代表 $x$ 元素的个数。</p><p>求最小花费使得序列满足目标状态。</p></blockquote><p>大概做题时有这么几个 Observation，当时拿笔写了下来，感觉应该是比较正常思路：</p><p>1、答案上界一定是 $n-\max \{col{\rm num}\}$ .</p><p>2、如果一个颜色存在不相邻，那么要么会被全部涂成别的颜色，要么会被保留。</p><p>3、根据 $2$ 不难发现，一段交错排布的元素最后必然只会保留一种颜色。</p><p>4、根据 $3$ 可以得到一个贪心：将所有颜色按照出现次数从大到小排序。一开始预处理出所有颜色第一次出现的位置 $s_i$ 和最后一次出现的位置 $t_i$，那么不难看出要把 $[s_i,t_i]$ 之间的元素都涂成当前颜色。不难知道这样是最优的。</p><p>然后实现上遇上了一点小阻碍。大概就是说随着不停地染色，可能会有一些别的颜色被染成当前颜色，这样就要动态更新当前颜色的 $s_i$ 和 $t_i$ 。然后就因为觉得这个不好维护就摸了一会儿…结果发现其实是很好维护的。具体来说，从大到小做一定可以让每个点至多被染一次色，复杂度可以保证；同时发现 $[s_i,t_i]$ 分别满足单调性，就可以暴力 <code>while</code> 做了。</p><p>最后复杂度显然排序外线性。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> buc[N] ;</span><br><span class="line"><span class="keyword">int</span> fst[N] ;</span><br><span class="line"><span class="keyword">int</span> lst[N] ;</span><br><span class="line"><span class="keyword">int</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line">pint ord[N] ;</span><br><span class="line">vint pos[N] ;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> m_k make_pair</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(pint a, pint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fr == b.fr ? a.sc &lt; b.sc : a.fr &gt; b.fr ;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; q ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i] = qr(), buc[base[i]] ++ ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        pos[base[i]].push_back(i) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (!fst[base[i]]) fst[base[i]] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        <span class="keyword">if</span> (!lst[base[i]]) lst[base[i]] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">200000</span> ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (buc[i]) ord[++ cnt] = m_k(buc[i], i) ;</span><br><span class="line">    sort(ord + <span class="number">1</span>, ord + cnt + <span class="number">1</span>, comp) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">        x = ord[i].fr ; y = ord[i].sc ;</span><br><span class="line">        <span class="keyword">if</span> (vis[y]) <span class="keyword">continue</span> ; vis[y] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (x == lst[y] - fst[y] + <span class="number">1</span>) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">int</span> l = fst[y], r = lst[y] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> p = fst[y] ; p &lt;= lst[y] ; ++ p)&#123;</span><br><span class="line"><span class="comment">//            printf("%d ", p) ;</span></span><br><span class="line">            <span class="keyword">if</span> (base[p] != y &amp;&amp; !vis[base[p]])&#123;</span><br><span class="line">                vis[base[p]] = <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//                printf("%d ", base[p]) ;</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> k : pos[base[p]])&#123;</span><br><span class="line">                    chkmin(l, k) ;</span><br><span class="line">                    chkmax(r, k) ;</span><br><span class="line">                    base[k] = y, ++ ans ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            puts("") ;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        printf("%d %d\n", l, r) ;</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> tl, tr ;</span><br><span class="line"><span class="comment">//            printf("%d %d\n", l, r) ;</span></span><br><span class="line">            tl = fst[y], tr = lst[y] ;</span><br><span class="line">            <span class="keyword">if</span> (l == fst[y] &amp;&amp; r == lst[y]) <span class="keyword">break</span> ;</span><br><span class="line">            fst[y] = l, lst[y] = r ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = tl - <span class="number">1</span> ; p &gt;= l ; -- p)&#123;</span><br><span class="line"><span class="comment">//                printf("(%d %d %d)", p, base[p], vis[base[p]]) ;</span></span><br><span class="line">                <span class="keyword">if</span> (base[p] != y &amp;&amp; !vis[base[p]])&#123;</span><br><span class="line">                    vis[base[p]] = <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//                    printf("%d ", base[p]) ;</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">auto</span> k : pos[base[p]])&#123;</span><br><span class="line">                        chkmin(l, k) ;</span><br><span class="line">                        chkmax(r, k) ;</span><br><span class="line">                        base[k] = y, ++ ans ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                puts("") ;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = tr + <span class="number">1</span> ; p &lt;= r ; ++ p)&#123;</span><br><span class="line">                <span class="keyword">if</span> (base[p] != y &amp;&amp; !vis[base[p]])&#123;</span><br><span class="line">                    vis[base[p]] = <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">auto</span> k : pos[base[p]])&#123;</span><br><span class="line">                        chkmin(l, k) ;</span><br><span class="line">                        chkmax(r, k) ;</span><br><span class="line">                        base[k] = y, ++ ans ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(base, 1, n) ;</span></span><br><span class="line"><span class="comment">//        printf("%d %d %d %d %d\n", x, y, fst[y], lst[y], ans) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把最后一个 for 里 if 的 <code>y</code> 写成了 <code>x</code> 导致 <code>Wa On 7</code> 呜呜呜。</p><h1 id="G2-Into-Blocks-hard-version"><a href="#G2-Into-Blocks-hard-version" class="headerlink" title="[G2] Into Blocks (hard version)"></a>[G2] Into Blocks (hard version)</h1><blockquote><p>$q=3\times 10^5$ 。</p></blockquote><p>这题是真的🐂🍺！是十分有趣、十分强的题目！</p><p>但是类似套路并不是没有见过。曾经写过一篇博客总结了一下「兔队线段树」，这题大概是需要用到那里面 T1 的类似 trick。</p><p>大概首先是要对上面那个 easy version 的一些结论进行形式化的提炼和总结。考虑答案的本质。考虑把一个颜色 $c$ 的出现区间化成左开右闭的形式 $[s_c,t_c)$，意思是对于区间中的每个 $i$ ，要把 $i,i+1$ 涂成一个颜色。那么可以发现如果对所有 $c$ 的该区间进行区间 $+1$ ，那么最后可以保留的颜色数就是相邻两个 $0$ 之间出现最多的颜色的数量和。正确性显然。…但这个转化确实十分神奇。</p><p>考虑用线段树快速维护这个东西。考虑需要维护什么信息：</p><p>1、需要维护分界点。即区间中被覆盖次数为 $0$ 的点。</p><p>2、需要维护颜色数。即区间中出现次数最多的颜色。</p><p>3、但是 $2$ 中有要求，要求必须是连续段中出现次数最多的颜色。而这个连续段的「连续」对应于一段连续的、覆盖次数 $&gt;0$ 的段。</p><p>4、注意到要维护区间中出现次数的最大值，还要求连续且只有全局询问的话，有个小技巧。考虑让颜色 $c$ 的出现次数 $e(c)$ 放到 $s_c$ 处维护，记作 $w_{s_c}$，这样就只需要维护一个 $\max \{w_i,w_{i+1}\}$ 状物。</p><p>发现难以维护分界点？但是考虑到<strong>只有全局询问</strong>，于是可以借鉴兔队线段树里那个类似的思想。具体来说，发现对于线段树的根节点，有效信息是区间 $[1,n]$ ，而 $n$ 这个点必然不会被任何一个线段覆盖，也就是说如果统计全局信息，那么必然会存在 $n$ 为 $0$。那么就好办了，考虑用维护「区间最小值」来代替维护「区间分界点」。</p><p>具体细节方面，考虑维护区间中每段里颜色出现次数最大值 ${\rm seg}_x$，左/右端点所在连续区间的最大值 $\mathrm{lmax}_x,\mathrm{rmax}_x$ 。转移时考虑两个区间的 $\min v$ 的关系，其中 $v$ 是覆盖次数。</p><p>然后考虑修改操作，发现就是一个区间加再加一个单点维护。注意当 $l=r$ 时，有些量不是良定义，当作不知道就好了（赋值为 $0$） 。</p><p>注意到颜色的修改可以再单独拿一个 set 来维护。最终复杂度 $O(n\log n)$ 。</p><p>然后具体为什么能比 xyx 的做法少掉一个 log，个人认为是充分利用了『只有全局询问』这个性质。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200005</span> ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _be begin</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _en rbegin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> era erase</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ins insert</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> &lt;<span class="keyword">int</span>&gt; col[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> mnv[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> mxt[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> tag[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> lcon[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> rcon[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _down(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    <span class="keyword">if</span> (tag[rt])&#123;</span><br><span class="line">        mnv[lc] += tag[rt] ;</span><br><span class="line">        mnv[rc] += tag[rt] ;</span><br><span class="line">        tag[lc] += tag[rt] ;</span><br><span class="line">        tag[rc] += tag[rt] ;</span><br><span class="line">        tag[rt] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">void</span> _up(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    <span class="keyword">int</span> ls = rt &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">int</span> rs = rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span> ;</span><br><span class="line">    mxt[rt] = max(mxt[ls], mxt[rs]) ;</span><br><span class="line">    mnv[rt] = min(mnv[ls], mnv[rs]) ;</span><br><span class="line">    <span class="keyword">if</span> (mnv[ls] &lt; mnv[rs])&#123;</span><br><span class="line">        seg[rt] = seg[ls] ;</span><br><span class="line">        lcon[rt] = lcon[ls] ;</span><br><span class="line">        rcon[rt] = max(mxt[rs], rcon[ls]) ;</span><br><span class="line">        <span class="comment">//此处由于最后要覆盖，所以 max_Time(rc) 本质上就是包含右端点的值。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (mnv[ls] &gt; mnv[rs])&#123;</span><br><span class="line">        seg[rt] = seg[rs] ;</span><br><span class="line">        rcon[rt] = rcon[rs] ;</span><br><span class="line">        lcon[rt] = max(mxt[ls], lcon[rs]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        lcon[rt] = lcon[ls] ; rcon[rt] = rcon[rs] ;</span><br><span class="line">        seg[rt] = seg[ls] + seg[rs] + max(lcon[rs], rcon[ls]) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ul, <span class="keyword">int</span> ur, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ul &gt; ur) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span> (ul &lt;= l &amp;&amp; r &lt;= ur)</span><br><span class="line">        <span class="keyword">return</span> mnv[rt] += v, <span class="keyword">void</span>(tag[rt] += v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; _down(rt) ;</span><br><span class="line">    <span class="keyword">if</span> (ul &lt;= mid) upd(lc, l, mid, ul, ur, v) ;</span><br><span class="line">    <span class="keyword">if</span> (ur &gt; mid)  upd(rc, mid + <span class="number">1</span>, r, ul, ur, v) ;</span><br><span class="line">    _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cov</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(mxt[rt] = lcon[rt] = v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; _down(rt) ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) cov(lc, l, mid, p, v) ;</span><br><span class="line">    <span class="keyword">else</span> cov(rc, mid + <span class="number">1</span>, r, p, v) ; _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> mk)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> w ;</span><br><span class="line">    <span class="keyword">if</span> (!(w = col[c].size())) <span class="keyword">return</span> ;</span><br><span class="line"><span class="comment">//printf("%d %d %d %d %d\n", c, mk, *col[c]._be(), *-- col[c]._en(), (int)col[c].size()) ;</span></span><br><span class="line">    cov(<span class="number">1</span>, <span class="number">1</span>, n, *col[c]._be(), mk &gt; <span class="number">0</span> ? w : <span class="number">0</span>) ;</span><br><span class="line">    upd(<span class="number">1</span>, <span class="number">1</span>, n, *col[c]._be(), *col[c]._en() - <span class="number">1</span>, mk) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">val_it</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> n - seg[<span class="number">1</span>] - lcon[<span class="number">1</span>] - rcon[<span class="number">1</span>] ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;q) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]), col[base[i]].ins(i) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; N ; ++ i)</span><br><span class="line">        mdf(i, <span class="number">1</span>) ; <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, val_it()) ;</span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y) ; z = base[x] ;</span><br><span class="line">        mdf(z, <span class="number">-1</span>) ; col[z].era(x) ; mdf(z, <span class="number">1</span>) ;</span><br><span class="line">        mdf(y, <span class="number">-1</span>) ; col[y].ins(x) ; mdf(y, <span class="number">1</span>) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, val_it()) ; base[x] = y ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不得不说，这场是真的真的良心！首先知识点覆盖全面，各种题目也都比较富有思维含量，大概是我打过的 Combined 场里面质量最高的一场。&lt;/p&gt;
&lt;p&gt;然后就 vp 了一整场，最后的战绩大概还不错？&lt;/p&gt;
&lt;p&gt;一共有 $9$ 道题目。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="动态规划/状压DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="数据结构/线段树" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="图论/普通建图技巧" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E6%99%AE%E9%80%9A%E5%BB%BA%E5%9B%BE%E6%8A%80%E5%B7%A7/"/>
    
      <category term="暴力,brute-force" scheme="https://www.orchidany.cn/tags/%E6%9A%B4%E5%8A%9B-brute-force/"/>
    
      <category term="图论/并查集" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>【题解】[洛谷 P5654] 基础函数练习题</title>
    <link href="https://www.orchidany.cn/2020/06/14/%E6%B4%9B%E8%B0%B7P5654%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0%E7%BB%83%E4%B9%A0%E9%A2%98/"/>
    <id>https://www.orchidany.cn/2020/06/14/洛谷P5654基础函数练习题/</id>
    <published>2020-06-14T10:50:03.000Z</published>
    <updated>2020-06-16T13:13:20.089Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>比较有趣的题目。学到许多。</p><blockquote><p>YSGH 有一个 $1 \sim n$ 的排列 $p$ 和一个长度为 $n$ 的整数序列 $w$。<br>定义：</p><script type="math/tex; mode=display">F(l, r) = \begin{cases} \max(F(l, m - 1), F(m + 1, r)) + w_m & , l \le r \\ 0 & , l > r \end{cases}</script><p>其中 $m$ 为 $p$ 的区间 $[l, r]$ 的最大值的下标。</p><p>$q$ 次询问 $F(l, r)$ 的值。</p><p>$1\leq n,q \leq 5\times 10^5$ 。 </p></blockquote><a id="more"></a><p>大概是比较神的题？首先如果考虑是 $F(1,n)$，那么转移就是一个笛卡尔树的形式。然后如果放到区间里来，可以发现可能会存在从 $l$、$r$ 到根的链被修改，中间的链不会被改变。</p><p>而这个被修改成的模样大概是要稍微找一下性质。可以发现对于 $l$ 而言，首先他的左子树会被砍掉，其次考虑对笛卡尔树的父子关系分类，称 ${\rm Lson}(x)=y$ 的父子关系 $(y,x)$ ，其中 $x$ 是 $y$ 的右行父亲，${\rm Rson}(x)=y$ 的则为左行父亲。那么不难看出，对于 $l\to root$ 这条链上，任何一个键值(下标)比 $l$ 小的都需要被删掉，也就是所有右行父亲都要被删掉；同理对于 $r\to root$ 这条脸上，所有左行父亲需要被删掉。</p><p>发现询问可以离线，于是考虑拆成两半做。这个地方需要一个神奇的 Observation。观察 $F$ 在笛卡尔树上的展开式：</p><script type="math/tex; mode=display">\begin{aligned}F(l, r)& = \max\{F(l, m - 1), F(m + 1, r)\} + w_m \\\\&= \max\{\max \{~F(l, m_1), F(m_1+1,m - 1)~\} + w_{m_1}, \max \{~F(m+1, m_2), F(m_2+1,r)~\} +w_{m_2} \} + w_m\\& \cdots\end{aligned}</script><p>不难发现 $m_k$ 只会与对应节点有关，同时 $\max$ 有结合律，整个式子都被 $\max$ 包住了，于是就可以直接倍增。</p><p>具体的，考虑设 $g_{x,k}$ 表示 $x$ 的 $2^{k-1}$ 祖先的<strong>内向子树</strong>的贡献和，$f_{x,k}$ 表示从 $x$ 到 $x$ 的 $2^{k-1}$ 祖先的点权和，$fa_{x,k}$ 表示对一个固定的方向，即不考虑「左行」或者「右行」父亲时的父亲。那么预处理时 $f_{x,k}$ 较容易维护，考虑 $g_{x,k}$ ，发现倍增是需要考虑分成两个 $2^{k-1}$ 规模的子问题去计算，也就是此时需要分别计算 $2^{k-1}$ 级祖先上面的和下面的贡献，拼一下的话比较直观。</p><p>然后就可以考虑如何计算答案。发现由于上文提到过的结合律，可以发现只需要比较链上的答案和子树内的答案的 $\max$ 就好了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500005</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll I = <span class="number">1l</span>l &lt;&lt; <span class="number">50</span> ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> r = <span class="number">0</span>, f = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">char</span> c = getchar() ;</span><br><span class="line">    <span class="keyword">while</span> (c &gt; <span class="string">'9'</span> || c &lt; <span class="string">'0'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">'-'</span>) f = <span class="number">-1</span> ; c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span>)&#123;</span><br><span class="line">        r = (r &lt;&lt; <span class="number">1</span>) + (r &lt;&lt; <span class="number">3</span>) + c - <span class="string">'0'</span>, c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r * f ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> q ;</span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line"><span class="keyword">int</span> tp ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p[N] ;</span><br><span class="line"><span class="keyword">int</span> w[N] ;</span><br><span class="line"><span class="keyword">int</span> ql[N] ;</span><br><span class="line"><span class="keyword">int</span> qr[N] ;</span><br><span class="line"><span class="keyword">int</span> qlca[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> lc[N] ;</span><br><span class="line"><span class="keyword">int</span> rc[N] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> stk[N] ;</span><br><span class="line"></span><br><span class="line">ll ans[N] ;</span><br><span class="line">ll sum[N] ;</span><br><span class="line">ll f[N][<span class="number">19</span>] ;</span><br><span class="line">ll g[N][<span class="number">19</span>] ;</span><br><span class="line"><span class="keyword">int</span> fa[N][<span class="number">19</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa[x][<span class="number">0</span>]] + <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; <span class="number">19</span> ; ++ i)&#123;</span><br><span class="line"><span class="keyword">if</span> (!fa[x][i - <span class="number">1</span>]) <span class="keyword">break</span> ;</span><br><span class="line">fa[x][i] = fa[fa[x][i - <span class="number">1</span>]][i - <span class="number">1</span>] ;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">if</span> (lc[x]) dfs(lc[x]) ;</span><br><span class="line">    <span class="keyword">if</span> (rc[x]) dfs(rc[x]) ;</span><br><span class="line">    sum[x] = max(sum[lc[x]], sum[rc[x]]) + w[x] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d = dep[x] - dep[y] ;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &lt; dep[y])</span><br><span class="line">        swap(x, y), d = -d ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; d ; ++ i, d &gt;&gt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (d &amp; <span class="number">1</span>) x = fa[x][i] ;</span><br><span class="line">    <span class="keyword">if</span> (x == y) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">18</span> ; ~ i ; -- i)</span><br><span class="line">        <span class="keyword">if</span> (fa[x][i] != fa[y][i])</span><br><span class="line">            x = fa[x][i], y = fa[y][i] ;</span><br><span class="line">    <span class="keyword">return</span> fa[x][<span class="number">0</span>] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_do</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> o ;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> p = lc[x] ;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> q = rc[x] ;</span><br><span class="line">    f[x][<span class="number">0</span>] = g[x][<span class="number">0</span>] = w[x] ;</span><br><span class="line">    g[x][<span class="number">0</span>] += v ? sum[p] : sum[q] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j ; i &lt; <span class="number">19</span> ; ++ i)&#123;</span><br><span class="line">        j = i - <span class="number">1</span> ;</span><br><span class="line">        o = fa[x][j] ;</span><br><span class="line">        fa[x][i] = fa[o][j] ;</span><br><span class="line">        <span class="keyword">if</span> (!fa[x][i]) <span class="keyword">break</span> ;</span><br><span class="line">        f[x][i] = f[x][j] + f[o][j] ;</span><br><span class="line">        g[x][i] = max(g[o][j], g[x][j] + f[o][j]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lc[x]) fa[lc[x]][<span class="number">0</span>] = v ? fa[x][<span class="number">0</span>] : x ;</span><br><span class="line">    <span class="keyword">if</span> (rc[x]) fa[rc[x]][<span class="number">0</span>] = v ? x : fa[x][<span class="number">0</span>] ;</span><br><span class="line">    <span class="keyword">if</span> (lc[x]) do_do(lc[x], v) ;</span><br><span class="line">    <span class="keyword">if</span> (rc[x]) do_do(rc[x], v) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> ll ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">18</span> ; ~ i ; -- i)</span><br><span class="line">        <span class="keyword">if</span> (dep[fa[x][i]] &gt;= dep[y])</span><br><span class="line">            ret = max(ret + f[x][i], g[x][i]), x = fa[x][i] ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n = rd() ; q = rd() ;</span><br><span class="line">    p[stk[tp = <span class="number">1</span>] = <span class="number">0</span>] = n + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) p[i] = rd() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) w[i] = rd() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">while</span> (tp &amp;&amp; p[stk[tp]] &lt; p[i]) -- tp ;</span><br><span class="line">        fa[i][<span class="number">0</span>] = stk[tp] ; <span class="keyword">int</span> z = rc[stk[tp]] ;</span><br><span class="line">        fa[z][<span class="number">0</span>] = i ; lc[i] = z ; rc[fa[i][<span class="number">0</span>]] = i ;</span><br><span class="line">        stk[++ tp] = i ;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(rt = lc[<span class="number">0</span>] + rc[<span class="number">0</span>]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        ql[i] = rd() ; qr[i] = rd() ;</span><br><span class="line">        qlca[i] = lca(ql[i], qr[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(fa, <span class="number">0</span>, <span class="keyword">sizeof</span> fa) ; do_do(rt, <span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)</span><br><span class="line">        ans[i] = w[qlca[i]] + solve(ql[i], qlca[i]) ;</span><br><span class="line">    <span class="built_in">memset</span>(fa, <span class="number">0</span>, <span class="keyword">sizeof</span> fa) ; do_do(rt, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)</span><br><span class="line">        ans[i] = max(ans[i], w[qlca[i]] + solve(qr[i], qlca[i])) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans[i]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;比较有趣的题目。学到许多。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;YSGH 有一个 $1 \sim n$ 的排列 $p$ 和一个长度为 $n$ 的整数序列 $w$。&lt;br&gt;定义：&lt;/p&gt;
&lt;script type=&quot;math/tex; mode=display&quot;&gt;
F(l, r) = \begin{cases} \max(F(l, m - 1), F(m + 1, r)) + w_m &amp; , l \le r \\ 0 &amp; , l &gt; r \end{cases}&lt;/script&gt;&lt;p&gt;其中 $m$ 为 $p$ 的区间 $[l, r]$ 的最大值的下标。&lt;/p&gt;
&lt;p&gt;$q$ 次询问 $F(l, r)$ 的值。&lt;/p&gt;
&lt;p&gt;$1\leq n,q \leq 5\times 10^5$ 。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Luogu" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Luogu/"/>
    
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="技巧/倍增" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%80%8D%E5%A2%9E/"/>
    
      <category term="数据结构/笛卡尔树" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>【学习笔记&amp;题解】从笛卡尔树到[SPOJ 3734] Periodni</title>
    <link href="https://www.orchidany.cn/2020/06/14/%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-and-SPOJ-Periodni/"/>
    <id>https://www.orchidany.cn/2020/06/14/笛卡尔树学习笔记-and-SPOJ-Periodni/</id>
    <published>2020-06-14T10:49:37.000Z</published>
    <updated>2020-06-19T12:18:16.359Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>笛卡尔树的性质比较单一，但是应用起来也是很有趣的。</p><a id="more"></a><h1 id="笛卡尔树学习笔记"><a href="#笛卡尔树学习笔记" class="headerlink" title="笛卡尔树学习笔记"></a>笛卡尔树学习笔记</h1><p>大概就是类似 treap 的一个东西。首先笛卡尔树是二叉搜索树，即 $lc,root,rc$ 的键值满足单调的偏序关系。其次笛卡尔树每个节点也有一个权值，这个权值满足堆性质。</p><p>然后在保证了键值单调时，可以 $O(n)$ 建树，方式是维护最右链。假设键值单调递增，那么考虑每次加入一个新节点 $x$，要把栈里面所有 $val_y&gt;val_x$ 的点都弹出，然后把当前栈顶元素 $z$ 的右儿子设置为 $x$ ，$x$ 的左儿子设置为原来 $z$ 的右儿子。</p><p>以下是洛谷 P5854 笛卡尔树。不知道为什么，我写笛卡尔树很容易忘了最后入栈233</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ;</span><br><span class="line">    stk[tp = <span class="number">1</span>] = <span class="number">0</span> ; base[<span class="number">0</span>] = -I ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">while</span> (tp &amp;&amp; base[stk[tp]] &gt; base[i]) -- tp ;</span><br><span class="line">        fa[i] = stk[tp] ; <span class="keyword">int</span> x = rc[fa[i]] ;</span><br><span class="line">        fa[x] = i, lc[i] = x, rc[fa[i]] = i ;</span><br><span class="line"><span class="comment">//        for (int j = 1 ; j &lt;= n ; ++ j)</span></span><br><span class="line"><span class="comment">//            printf("%d %d\n", lc[j], rc[j]) ;</span></span><br><span class="line"><span class="comment">//        printf("%d\n", x) ;</span></span><br><span class="line"><span class="comment">//        puts("- - - - - - - - - - - - - -") ;</span></span><br><span class="line">        stk[++ tp] = i ;<span class="comment">//!</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans1 ^= (<span class="number">1l</span>l * (lc[i] + <span class="number">1</span>) * i) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans2 ^= (<span class="number">1l</span>l * (rc[i] + <span class="number">1</span>) * i) ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld %lld\n"</span>, ans1, ans2) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="SPOJ-3734-Periodni"><a href="#SPOJ-3734-Periodni" class="headerlink" title="[SPOJ 3734] Periodni"></a>[SPOJ 3734] Periodni</h1><blockquote><p>给定一个 $n$ 列的表格，每列的高度各不相同，但底部对齐，然后向表格中填入 $k$ 个相同的数，填写时要求不能有两个数在同一列，或同一行。</p><p>注意，如果两个同一行的点之间有空白，那么我们不认为他们在同一行。</p><p>$1\le n,k\le 500$ 。</p></blockquote><p>感觉这题是不是如果看不出来要建笛卡尔树，人就直接没了啊…</p><p>大概就是说按照高度为权值，序号为键值建笛卡尔树。发现这样的树有着良好的性质，就是对于一个点 $x$ 不包含自己的子树，他们在 $h_x$ 以上的那部分高度互相不影响，且如果保证不自选的话一定不会出现在同一列的情况。</p><p>然后就转化成了从子树内选择 $k$ 个无序点的方案数了。考虑树上背包。 $f_{i,v}$ 表示以 $i$ 为根，合法地选了 $v$ 个点的方案数。那么先考虑子树内的转移，就比较朴素。这部分可以随便做，因为并不关心是 $O(nk)$ 还是 $O(nk^2)$ 。然后考虑选定 $i$ 时的方案数，也就是算上 $\leq h_x$ 那一块小矩形的方案数。这个地方大概就是要考察一点<del>我没有的</del>组合能力了。考虑从一个 $n$ 行 $m$ 列的矩形里选出 $k$ 个不同行、不同列的点的方案数，本质上就是选 $k$ 个行号、$k$ 个列号，然后对行号和列号做个匹配，可以知道方案数是</p><script type="math/tex; mode=display">c(n,m,k)=\binom{m}{k}\times \binom{n}{k}\times k!</script><p>那么同理，如果要算考虑 $x$ 的矩形的方案数，就是在算一个有 $h_x$ 行，$sz_x-(i-j)$ 列的矩形的方案数，就是 $c(h_x,sz_x-(i-j),k)$ 。</p><p>实现上有一点下传高度的小细节。</p><p>其实这题本质上是分类讨论了一下放的情况，即在 $h_x$ 的高度上面放和在 $h_x$ 的高度下面(含)放。是一道不错的计数题。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1000050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1000000007</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line"><span class="keyword">int</span> tp ;</span><br><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> lc[N] ;</span><br><span class="line"><span class="keyword">int</span> rc[N] ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> fac[M] ;</span><br><span class="line"><span class="keyword">int</span> inv[M] ;</span><br><span class="line"><span class="keyword">int</span> stk[N] ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">0</span>, f = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">char</span> c = getchar() ;</span><br><span class="line">    <span class="keyword">while</span> (c &gt; <span class="string">'9'</span> || c &lt; <span class="string">'0'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">'-'</span>) f = <span class="number">-1</span> ; c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span>)&#123;</span><br><span class="line">        r = (r &lt;&lt; <span class="number">1</span>) + (r &lt;&lt; <span class="number">3</span>) + c - <span class="string">'0'</span>, c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r * f ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> T <span class="title">addn</span><span class="params">(T x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; <span class="keyword">return</span> (x = x &gt; mod ? x - mod : x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">expow</span><span class="params">(ll x, ll y)</span></span>&#123;</span><br><span class="line">    ll ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = ret * x % P ;</span><br><span class="line">        x = x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">comb</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1l</span>l * fac[a] * inv[a - b] % P * inv[b] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1l</span>l * comb(x, z) * comb(y, z) % P * fac[z] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_do</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> h)</span></span>&#123;</span><br><span class="line">    sz[x] = <span class="number">1</span> ;</span><br><span class="line">    f[x][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//    printf("%d %d %d\n", k, x, h) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        do_do(y, base[x]), sz[x] += sz[y] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)</span><br><span class="line">                add(tmp[i], <span class="number">1l</span>l * f[x][i - j] * f[y][j] % P) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">            f[x][i] = tmp[i], tmp[i] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> nh = base[x] - h ;</span><br><span class="line"><span class="comment">//    printf("%d %d %d %d\n", k, x, h, nh) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= min(sz[x], k) ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= min(nh, i) ; ++ j)</span><br><span class="line">            add(tmp[i], <span class="number">1l</span>l * f[x][i - j] * calc(sz[x] - i + j, nh, j) % P) ;</span><br><span class="line"><span class="comment">//    printf("%d %d %d\n", k, x, h) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        f[x][i] = tmp[i], tmp[i] = <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//    freopen("1.in", "r", stdin) ;</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k ; fac[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    stk[tp = <span class="number">1</span>] = <span class="number">0</span> ; base[<span class="number">0</span>] = <span class="number">-1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; M ; ++ i)</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[M - <span class="number">1</span>] = expow(fac[M - <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = M - <span class="number">2</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">        inv[i] = <span class="number">1l</span>l * inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">while</span> (tp &amp;&amp; base[stk[tp]] &gt; base[i]) -- tp ;</span><br><span class="line">        fa[i] = stk[tp] ; <span class="keyword">int</span> j = rc[stk[tp]] ; stk[++ tp] = i ;</span><br><span class="line">        fa[j] = i ; lc[i] = j ; rc[fa[i]] = i ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        E[fa[i]].push_back(i) ;</span><br><span class="line">        <span class="keyword">if</span> (!fa[i]) rt = i ;</span><br><span class="line">    &#125;</span><br><span class="line">    do_do(rt, <span class="number">0</span>) ; <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[rt][k]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;笛卡尔树的性质比较单一，但是应用起来也是很有趣的。&lt;/p&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="笛卡尔树" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="组合计数/有技巧的计数" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/对应与转化" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
      <category term="动态规划/树形DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="数据结构/笛卡尔树" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91/"/>
    
      <category term="动态规划/背包模型" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E8%83%8C%E5%8C%85%E6%A8%A1%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.12 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/14/6-12-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/14/6-12-训练笔记/</id>
    <published>2020-06-14T10:48:54.000Z</published>
    <updated>2020-06-19T12:15:10.534Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>日常营业.png</p><p>今天心血来潮打了两场。这些东西总算是告一段落了233 </p><a id="more"></a><h1 id="A-M"><a href="#A-M" class="headerlink" title="A.M."></a>A.M.</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><blockquote><p>设 $f_i$ 为斐波那切数列第 $i$ 项。已知</p><script type="math/tex; mode=display">g_{n}=\sum_{i=0}^{n} f_{i} f_{n-i}</script><p>求 $\sum g_i$ .</p><p>$1\leq n\leq 10^{18}$ 。 </p></blockquote><p>$O(n)$ 的暴力是比较简单的，只需要考虑对每个 $f_i$ ，会有 $f_1,f_2\cdots f_{n-i}$ 这些数与之相乘产生贡献。这样就可以用一个前缀和来线性算。</p><p>然后满分做法当然就是要推式子。考虑用 $f_i=f_{i-1}+f_{i-2}$ 进行展开可得：</p><script type="math/tex; mode=display">\begin{aligned} g_{n} &=\sum_{i=0}^{n} f_{i} f_{n-i} \\ &=\sum_{i=2}^{n}\left(f_{i-1}+f_{i-2}\right) f_{n-i}+f_{1} f_{n-1}+f_{0} f_{n} \\ &=\sum_{i=0}^{n-1} f_{i} f_{n-i-1}-f_{0} f_{n-1}+\sum_{i=0}^{n-2} f_{i} f_{n-i-2}+f_{1} f_{n-1}+f_{0} f_{n} \\ &=g_{n-1}+g_{n-2}+f_{1} f_{n-1}-f_{0} f_{n-1}+f_{0} f_{n} \\ &=g_{n-1}+g_{n-2}+f_{n} \end{aligned}</script><p>于是就可以直接矩阵快速幂了。</p><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="3.png" alt=""><br>$1 \leq n \leq 10^{5}, 0 \leq l_{i} \leq r_{i}&lt;2^{31}$。</p></blockquote><p>学 FWT 的时候记住的一个推论：</p><script type="math/tex; mode=display">{\rm odd}({\rm count}(x\oplus y))={\rm odd}({\rm count}(x)+{\rm count}(y))</script><p>${\rm count}$ 是二进制下 $1$ 的个数。这个不难证。那么问题就可以转化成快速维护区间中 ${\rm count}$ 为奇数和偶数的个数。关于这个有两种不同的做法：</p><h3 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h3><p>考虑直接用 set 维护区间，每次新加进来对非交集部分进行数位 DP。复杂度 $O(n\log V)$ 。</p><h3 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h3><p>是别人比较神奇的做法。考虑直接维护一棵动态开点线段树来维护区间信息。然后考虑一个性质，大概是说发现线段树在拆区间的时候是二进制拆法，对于 $len=1$ 的区间可以直接算，$len&gt;1$ 的区间必然是长度为 $2^p$ 的连续段，而这个连续段中可以知道 ${\rm count}$ 为奇数和偶数的分别占一半一半。于是就就可以比较简单地维护出来。</p><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="9.png" alt=""></p><p>$2 \leq n \leq 10^{5}, 1 \leq q \leq 10^{5},\sum k\leq 2\times 10^5$ .</p></blockquote><p>比较考察基本功的题目。首先可以知道，设一个字符串里 $0$ 最后出现的位置为 $A$，$1$ 最后出现的位置为 $B$，那么这个字符串出现的概率就是 $2^{-\min(A,B)}$ 。之后考虑对每组询问，通过枚举+分类讨论 $s=\min(A,B)$  来解决。以下默认当作 $a_1,a_2\cdots a_k$ 这些位置都变成 $0$ ：</p><p>1、$s=a_k,s\neq n$ 。这样相当于计算剩下的位置在什么地方出现，所以答案为 $\dbinom{s-k}{n-k}\times 2^{-s}$ 。</p><p>2、$s=B,a_i\lt s\lt a_{i+1}$ 。这样相当于拿掉了一个 $1$ ，于是方案数为 $\dbinom{s-1-i}{n-i}$ 。这部分可以考虑对所有这样的 $s$  做一个前缀和，询问的时候就可以 $O(k)$ 计算了。</p><p>3、$s&gt;a_k,s=A$ 。这样相当于拿掉了一个 $0$ ，方案数就是 $\dbinom{s-k-1}{n-k-1}$ 。注意到这是对不同的 $k$ 都需要预处理处一个前缀和，看上去复杂度很爆炸。但是考虑 $\sum k\leq 2\times 10^5$ ，也就是本质不同的 $k$ 只会有至多 $O(\sqrt {2e5})$ 的样子。于是可以离线下来做。</p><p>于是最后复杂度 $O\left(\sum k+n\sqrt n\right)$ ，可以通过本题。</p> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">400050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll I2 = <span class="number">499122177</span> ;</span><br><span class="line"></span><br><span class="line">ll ans[N] ;</span><br><span class="line">ll fac[N] = &#123;<span class="number">1</span>&#125; ;</span><br><span class="line">ll inv[N] = &#123;<span class="number">1</span>&#125; ;</span><br><span class="line">ll pwi2[N] = &#123;<span class="number">1</span>&#125; ;</span><br><span class="line">ll s[N] ; <span class="comment">// \sum \binom&#123;n-1&#125;&#123;i&#125;\times \dfrac&#123;1&#125;&#123;2^&#123;j&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; qs[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(T x, <span class="keyword">char</span> c = <span class="string">'\n'</span>)</span></span>&#123; <span class="built_in">cerr</span> &lt;&lt; x &lt;&lt; c ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(T *<span class="keyword">const</span> tp, <span class="keyword">int</span> minn, <span class="keyword">int</span> maxn, <span class="keyword">char</span> v = <span class="string">' '</span>, <span class="keyword">char</span> c = <span class="string">'\n'</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = minn ; i &lt;= maxn ; ++ i) debug(tp[i], v) ;  <span class="built_in">cerr</span> &lt;&lt; c ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> arr[N] ;</span><br><span class="line"><span class="keyword">int</span> n, bin ;</span><br><span class="line"><span class="keyword">int</span> q, k, m ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">dec</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x -= y ; x = x &lt; <span class="number">0</span> ? x + mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il T <span class="title">addn</span><span class="params">(T x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; <span class="keyword">return</span> (x = x &gt; mod ? x - mod : x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il T <span class="title">decn</span><span class="params">(T x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x -= y ; <span class="keyword">return</span> (x = x &lt; <span class="number">0</span> ? x + mod : x) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">il ll <span class="title">expow</span><span class="params">(ll x, ll y, ll mod = P)</span></span>&#123;</span><br><span class="line">    ll res = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            res = res * x % mod ;</span><br><span class="line">        x = x * x % mod ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">il ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> t)</span></span>&#123; <span class="keyword">return</span> t &lt; m ? <span class="number">0</span> : s[t] ; &#125;</span><br><span class="line"><span class="function">il ll <span class="title">comb</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> fac[x] * inv[y] % P * inv[x - y] % P ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre_do</span><span class="params">()</span></span>&#123;</span><br><span class="line">    bin = n &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= bin ; ++ i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[bin] = expow(fac[bin], P - <span class="number">2</span>, P) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = bin ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i - <span class="number">1</span>] = inv[i] * i % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= bin ; ++ i)</span><br><span class="line">        pwi2[i] = pwi2[i - <span class="number">1</span>] * I2 % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    m = x ; s[x] = pwi2[x] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = x + <span class="number">1</span> ; i &lt;= bin ; ++ i)</span><br><span class="line">        s[i] = (s[i - <span class="number">1</span>] + pwi2[i] * comb(i, x) % P) % P ;</span><br><span class="line"><span class="comment">//    debug(s, 1, n &lt;&lt; 1) ;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; q ;</span><br><span class="line">    pre_do() ; solve(n - <span class="number">1</span>) ;</span><br><span class="line"><span class="comment">//    debug(fac, 1, n &lt;&lt; 1) ;</span></span><br><span class="line"><span class="comment">//    debug(inv, 1, n &lt;&lt; 1) ;</span></span><br><span class="line"><span class="comment">//    debug(pwi2, 1, n &lt;&lt; 1) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">1</span> ; o &lt;= q ; ++ o)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k) ; arr[k + <span class="number">1</span>] = bin ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;arr[i]) ;</span><br><span class="line">        qs[k].push_back(make_pair(o, arr[k])) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = k ; i &gt;= <span class="number">0</span> ; -- i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] != bin)&#123;</span><br><span class="line"><span class="comment">//                cout &lt;&lt; arr[i + 1] - (i + 1) - 1 &lt;&lt; " " &lt;&lt; arr[i] - i - 1 &lt;&lt; '\n' ;</span></span><br><span class="line">                add(ans[o], pwi2[i + <span class="number">1</span>] * decn(sum(arr[i + <span class="number">1</span>] - (i + <span class="number">1</span>) - <span class="number">1</span>), sum(arr[i] - i - <span class="number">1</span>)) % P) ;</span><br><span class="line">                <span class="keyword">if</span> (arr[i + <span class="number">1</span>] - (i + <span class="number">1</span>) - <span class="number">1</span> &lt; n - <span class="number">1</span>) <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (arr[k] &lt; bin)</span><br><span class="line">            add(ans[o], pwi2[arr[k]] * comb(arr[k] - k, n - k) % P) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; ans[1] &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!qs[i].size()) <span class="keyword">continue</span> ; <span class="keyword">else</span> solve(n - i - <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : qs[i])&#123;</span><br><span class="line">            <span class="keyword">int</span> x = t.fr, y = t.sc ; <span class="keyword">if</span> (x == bin) <span class="keyword">continue</span> ;</span><br><span class="line">            add(ans[x], pwi2[i + <span class="number">1</span>] * decn(sum(bin - (i + <span class="number">1</span>) - <span class="number">1</span>), sum(y - i - <span class="number">1</span>))) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, (ans[i] &lt;&lt; <span class="number">1</span>) % P) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">15 1</span></span><br><span class="line"><span class="comment">15 1 4 6 10 13 14 15 19 20 21 22 25 26 29 30</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h1 id="P-M"><a href="#P-M" class="headerlink" title="P.M."></a>P.M.</h1><h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="7.png" alt=""></p><p>$n \leq 1000000 \leq|x_1|,|y_1|,|x_2|,|y_2| \leq 10^{9}$ 。</p></blockquote><p>比较有趣的结论题？那么就是有个结论：答案绝对不会超过 $3$ 。</p><p>大概是考虑由于没有三直线共点，所以每个点 $o$ 必然只被两条直线经过，相邻点的个数不会超过 $4$。 可以将交点按x、y坐标排序。不难发现在考虑到 $o$ 时，它有恰好两个位于不同直线上的相邻的点被赋了颜色，这时使用没用过的颜色即可。</p><p>然后考虑如果只有一个交点，那么色数为 $1$ 。否则考虑如果全部的直线只有两种斜率，那么色数为 $2$ ，因为此时必然不会形成三角形。</p><h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="6.png" alt=""></p><p>$1\leq n\leq 1000,a_i,b_i\leq 10^5$ 。</p></blockquote><p>暴力是可以拼一下的。大概就是说可以用 $2^n$ 做前 $25$ 分，然后暴力 dp，即设 $f_{i,p,q}$ 表示那两个式子的值分别为 $p,q$ 时的最小值，就可以拿到 $50$ pts。</p><p>然后考虑还有一档 $c_i=0$ 的部分分。发现这一档部分分本质上就是判断是否可以找出一种合法的方案使得满足那两个式子。那么就可以直接设 $f_{i,v}$ 表示考虑了前 $i$ 个 $x$ ，第一个式子的值为 $v$ 时第二个式子的最大值。不难知道这样是 $O(nP)$ 的。</p><p>然后考虑满分，又到了喜闻乐见的合并状态环节。考虑设 $f_{i,t}$ 表示确定了前 $i$ 个 $x_i$，$\sum_{j&lt;i} a_{j} x_{j} \leq t \leq \sum_{j&lt;i} b_{j} x_{j}$ 时的最小值。这个转移本质是和暴力相同的，但是有比较好的性质：</p><script type="math/tex; mode=display">f_{i,t}=\min \left\{f_{i-1,x}, \min _{x-b_{i} \leq j \leq x-a_{i}}\{f_{i-1,j}\}+c_{i}\right\}</script><p>不难发现后面那一维是可以单调队列优化掉的。于是复杂度降为 $O(nP)$ 。</p><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="5.png" alt=""></p><p>$1 \leq n \leq 10^{9}, 1 \leq m \leq 3 \times 10^{5}$ 。</p></blockquote><p>这道题十分强 and 十分有趣！</p><p>自己一开始的想法还是挺可以的，虽然到一半就不会了。大概是说考虑计算当一个序列的 gcd 是 $x$ 的时候，它的 lcm 可以有多少种方案。然后…然后就不会了 (x。</p><p>考虑设 $f(d)$ 表示有 $\gcd=d$ 的时候，所有可能的 $\rm lcm$ 之积。但这个并不好求，于是这个地方需要做一步容斥的转化。设 $g(d)$ 表示序列中的全部数字都是 $d$ 的倍数时、所有序列的 $\rm lcm$ 之积。那么不难发现他俩之间有这样的关系：</p><script type="math/tex; mode=display">\prod_{k=1}^{\lfloor\frac{m}{d}\rfloor} f(d\times k)=g(d)</script><p>考虑如果知道了 $\{g\}$ ，那么 $f$ 是很容易在 $O(m\times \tau(m))$ 的时间复杂度里算出来的，即考虑从大到小扫，每次对所有 $d|x$ 的 $g(d)$ 除以当前的 $f(x)$ 。是个比较经典的技巧。</p><p>然后考虑如何计算 $g$ 。发现此时每个序列可以被完全映射到一个值域为 $[1,V=\left\lfloor\frac{m}{d}\right\rfloor]$ 的区间上。于是可以计算出全部位于 $[1,V]$ 之间的序列的 $\rm lcm$ 之积 $h(V)$ 后，会有</p><script type="math/tex; mode=display">g(d)=h(V)\times d^{V^n}</script><p>然后考虑 $h$ 的求法。发现由于答案是乘积形式，所以可以对所有在 $1\sim V$ 之间的素数分别计算贡献。考虑对于一个质数 $p$ 的某一个幂 $p^e$，如果 $\rm lcm$ 至少包含 $p_e$ 的方案数为 $q$ ，那么可以用一个差分、或者是贡献平摊的技巧，使之对答案产生 $p^q$ 的贡献。然后这部分可以用总方案数减去那些所有 $p$ 的幂次都 $<e$ 的情况，再减去 $p$ 的幂次 $>e$ 的情况得到。</p><p>考虑这么做的复杂度。首先有个毛估估等式</p><script type="math/tex; mode=display">\sum_{i=1}^{V} \omega(i) \leq V \log V</script><p>而算上枚举质因数幂就要再多一个 $\log $ ，再算上枚举本质不同的 $V$ 的时间，发现大概是</p><script type="math/tex; mode=display">O(\sqrt m\times \sqrt m\log \sqrt m\times \log m)\leq O(m\log ^2 m)</script><p>可以通过本题。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> g[N] ;</span><br><span class="line"><span class="keyword">int</span> pr[N] ;</span><br><span class="line"><span class="keyword">int</span> pval[N] ;</span><br><span class="line"><span class="keyword">bool</span> chk[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; d_[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">expow</span><span class="params">(ll x, ll y, ll mod = P)</span></span>&#123;</span><br><span class="line">    ll res = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            res = res * x % mod ;</span><br><span class="line">        x = x * x % mod ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sieve</span><span class="params">(<span class="keyword">int</span> T)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= T ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!chk[i]) pr[++ cnt] = i ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (pr[j] * i &gt;= N) <span class="keyword">break</span> ;</span><br><span class="line">            chk[i * pr[j]] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span> (i % pr[j] == <span class="number">0</span>) <span class="keyword">break</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= T ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; i * j &lt;= T ; ++ j)</span><br><span class="line">            d_[i * j].push_back(i) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    x -= y ; <span class="keyword">return</span> x &lt; <span class="number">0</span> ? x + P - <span class="number">1</span> : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> q ;</span><br><span class="line">    <span class="keyword">int</span> p, o, z, rr, po ;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; sieve(m) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        pval[i] = expow(i, n, P - <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> t = m, d = <span class="number">1</span> ; d &lt;= m ; ++ d, t = m / d)&#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[t]) <span class="keyword">continue</span> ;</span><br><span class="line">        vis[t] = <span class="number">1</span> ; g[t] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">            q = p = pr[i] ;</span><br><span class="line">            po = t - t / p ;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; t) <span class="keyword">break</span> ;</span><br><span class="line">            o = pval[po], z = pval[t], rr = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> e = <span class="number">1</span> ; e &lt;= <span class="number">30</span> ; ++ e)&#123;</span><br><span class="line">                <span class="keyword">if</span> (q &gt; t) <span class="keyword">break</span> ;</span><br><span class="line">                rr = (rr + sub(z, o)) % (P - <span class="number">1</span>) ;</span><br><span class="line">                o = pval[po += t / q] ; q *= p ;</span><br><span class="line">                o = pval[po -= t / q] ;</span><br><span class="line">            &#125;</span><br><span class="line">            g[t] = g[t] * expow(p, rr) % P ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        f[i] = g[m / i] * expow(i, pval[m / i]) % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        <span class="keyword">int</span> rv = expow(f[i], P - <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> j : d_[i])</span><br><span class="line">            <span class="keyword">if</span> (i != j)</span><br><span class="line">                f[j] = <span class="number">1l</span>l * f[j] * rv % P ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        ans = <span class="number">1l</span>l * ans * expow(f[i], i) % P ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;日常营业.png&lt;/p&gt;
&lt;p&gt;今天心血来潮打了两场。这些东西总算是告一段落了233 &lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="数学/概率,期望" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="组合计数/有技巧的计数" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="数学/观察性质,结论与构造" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="思维题/容斥" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AE%B9%E6%96%A5/"/>
    
      <category term="数学/线性代数/矩阵" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0-%E7%9F%A9%E9%98%B5/"/>
    
      <category term="动态规划/背包模型" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E8%83%8C%E5%8C%85%E6%A8%A1%E5%9E%8B/"/>
    
      <category term="技巧/状态合并" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E7%8A%B6%E6%80%81%E5%90%88%E5%B9%B6/"/>
    
      <category term="单调队列/单调栈" scheme="https://www.orchidany.cn/tags/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97-%E5%8D%95%E8%B0%83%E6%A0%88/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.11 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/14/6-11-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/14/6-11-训练笔记/</id>
    <published>2020-06-14T10:48:48.000Z</published>
    <updated>2020-06-19T12:15:04.868Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>又是营业的时候了.</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>$|T|\leq 10^6$ .</p></blockquote><p>大概就是个简单找性质题。首先不难发现答案上界为 $|T|-1$ 且最初生成的 $k$ 个字符一定会是最终的串的前缀，同时发现这个过程至多会进行 $O(\log_{k}|T| )$ 次。于是就可以直接枚举前缀模拟这个过程，复杂度 $|T|\log |T|$ 。写的时候有点细节啥的。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: min ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll base = <span class="number">233</span> ;</span><br><span class="line"><span class="keyword">const</span> ll P = <span class="number">1000000009</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"></span><br><span class="line">ll L, B ;</span><br><span class="line">ll h[N] ;</span><br><span class="line">ll p[N] ;</span><br><span class="line"><span class="keyword">char</span> s[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(ll a, ll b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((a - b) % P + P) % P ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">chk</span><span class="params">(<span class="keyword">int</span> l1, <span class="keyword">int</span> r1, <span class="keyword">int</span> l2, <span class="keyword">int</span> r2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r2 - l2 != r1 - l1) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> len = r1 - l1 + <span class="number">1</span> ; l1 --, l2 -- ;</span><br><span class="line">    <span class="keyword">return</span> (sub(h[r1], p[len] * h[l1]) == sub(h[r2], p[len] * h[l2])) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d\n"</span>, &amp;T) ; p[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; N ; ++ i)</span><br><span class="line">        p[i] = p[i - <span class="number">1</span>] * base % P ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s + <span class="number">1</span>) ;</span><br><span class="line">        n = <span class="built_in">strlen</span>(s + <span class="number">1</span>), ans = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            h[i] = h[i - <span class="number">1</span>] * base % P + s[i] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> ( ; ans &lt; n ; ++ ans)&#123;</span><br><span class="line">            L = ans, B = L + <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (L &lt; n - <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">long</span> <span class="keyword">long</span> o = L * B + B ;</span><br><span class="line">                <span class="keyword">int</span> l = <span class="number">1</span>, r = L, rr ; -- o ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; B ; ++ i)&#123;</span><br><span class="line">                    l = r + <span class="number">2</span>, r = l + L - <span class="number">1</span> ;</span><br><span class="line">                    rr = min(<span class="number">1l</span>l * n, min(<span class="number">1l</span>l * r, o)) ;</span><br><span class="line">                    <span class="keyword">if</span> (!chk(<span class="number">1</span>, L - (r - rr), l, rr))</span><br><span class="line">                        <span class="keyword">goto</span> not_ok ; <span class="keyword">if</span> (r &gt;= o - <span class="number">1</span> || r &gt;= n - <span class="number">1</span>) <span class="keyword">break</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                L = o ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span> ;</span><br><span class="line">            not_ok : <span class="keyword">continue</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans + <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="4.png" alt=""></p><p>$1\leq n\leq 1000$ 。</p></blockquote><p>有欧拉回路 $\Longleftrightarrow$ 全部的点度数均为偶数。然后就不会了【害怕</p><p>正解大概是比较麻烦的构造题。考虑这么一种比较自然的构造思路：尝试构造用的边尽量少的方案。由于题目里没有限制最少，所以这个「尽量少」就只是尽量少。大概是瞎画画可以发现，如果一个奇度点连成了偶度点，那么它可能会影响另外一个奇度点，那么另外的奇度点可能之前变成了偶度点但是现在又变回了奇度点。于是就可以想到建出<strong>补图的一棵生成森林</strong>来，从叶子开始不断和父亲连边+删点，直到不合法为止。不难知道这样做是对的。</p><p>那么在保证都是偶度点之后，问题就变成了如何连边使得这个图连通。发现如果有 $\geqslant 3$ 个连通块，那么就可以每个连通块随便选个点连一个环出来。如果只有 $2$ 个连通块，大概是要比较麻烦地讨论一波，但也不难。</p><p>嗯，感觉是个挺需要熟练掌握构造技巧的题目。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="8.png" alt=""></p><p>$0 \leq x+y \leq \sum a_{i} \leq 100,x, y, z \geq 0, n, a_{i} \geq 1$ 。</p></blockquote><p>下文默认把题目里的 $x,y,z$ 替换为 $X,Y,Z$ 。</p><p>具体思路大概是分两部分做。首先算出拿到每个花色的概率，然后再算每个花色获胜的概率。</p><p>先考虑对于一个固定的花色 $x$  如何计算其获胜的概率。令 $s=\sum a_i$，小 E 拿了$p_x$ 个，不难知道应该是</p><script type="math/tex; mode=display">\Pr(c=x,p_x)=\frac{\sum_i \binom{a_x-p_x}{i}\times \binom{s-(a_x-p_x)-X}{Y-i}\times [p_x\geq i+z]}{\binom{s-X}{Y}}</script><p>然后考虑计算发生的概率。发现如果想要计算一个情况的发生概率，需要确定所有除 $x$ 以外的 $p_y$ 。于是可以用一个背包 $f_{i,v}$ 表示考虑了前 $i$ 个花色、当前花色 $x$ 不计算时，一共选了 $v$ 张卡牌的方案数。转移一波之后就可以知道答案应该为</p><script type="math/tex; mode=display">\sum \Pr (c=x,p_x)\times \binom{a_x}{p_x}\times f_{n,X-p_x}</script><p>然后问题就在如何保证 $dp$ 的正确性。考虑如果某种类别的牌拥有的越多，这个颜色的胜率就越大。所以可以先把所有可能出现的概率从小到大排个序——不难知道本质不同的概率是 $O(s)$ 的——那么这样就可以保证所有颜色可以取到的范围单调递增的。是个挺妙的离散化技巧。</p><p>然后考虑本质不同的概率，最大不会超过分母，也就是 $\dbinom{100}{50}$ 。所以可以拿 <code>__int128</code> 来存。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">__int128_t</span> bill ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt; bill, pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; pbii ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> mxu[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, X, Y, Z ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;pbii&gt; All_pr ;</span><br><span class="line"></span><br><span class="line">ll fac[N] = &#123;<span class="number">1</span>&#125; ;</span><br><span class="line">ll inv[N] = &#123;<span class="number">1</span>&#125; ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">il ll <span class="title">expow</span><span class="params">(ll x, ll y, ll mod = P)</span></span>&#123;</span><br><span class="line">    ll res = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            res = res * x % mod ;</span><br><span class="line">        x = x * x % mod ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il ll <span class="title">comb</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il ll <span class="title">Pr</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line"><span class="comment">//总共有 s 个，小 a 拿了 t 个.要满足 i+Z&lt;=t i&lt;=t-Z</span></span><br><span class="line">    ll ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= t - Z &amp;&amp; i &lt;= Y ; ++ i)</span><br><span class="line">        add(ret, comb(s - t, i) * comb(n - X - (s - t), Y - i) % P) ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il bill <span class="title">bicomb</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    bill ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (bill i = x - y + <span class="number">1</span> ; i &lt;= x ; ++ i) ret *= i ;</span><br><span class="line">    <span class="keyword">for</span> (bill i = <span class="number">1</span> ; i &lt;= y ; ++ i) ret /= i ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il pbii <span class="title">Pr</span><span class="params">(<span class="keyword">int</span> col, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">    bill ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= t - Z &amp;&amp; i &lt;= Y ; ++ i)</span><br><span class="line">        ret += bicomb(s - t, i) * bicomb(n - X - (s - t), Y - i) ;</span><br><span class="line">    <span class="keyword">return</span> make_pair(ret, make_pair(col, t)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">solve</span><span class="params">(<span class="keyword">int</span> col, <span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ; f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i == col)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= s ; ++ j) f[i][j] = f[i - <span class="number">1</span>][j] ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= s ; ++ j)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= min(j, mxu[i]) ; ++ k)</span><br><span class="line">                    add(f[i][j], f[i - <span class="number">1</span>][j - k] * comb(base[i], k) % P) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f[m][s] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m &gt;&gt; X &gt;&gt; Y &gt;&gt; Z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; base[i], n += base[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[n] = expow(fac[n], P - <span class="number">2</span>, P) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i ; -- i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        k = min(X, base[i]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = Z ; j &lt;= k ; ++ j)</span><br><span class="line">            All_pr.push_back(Pr(i, base[i], j)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(All_pr.begin(), All_pr.end()) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        mxu[i] = min(Z - <span class="number">1</span>, base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : All_pr)&#123;</span><br><span class="line">        <span class="keyword">int</span> c = t.sc.fr ;</span><br><span class="line">        <span class="keyword">int</span> o = base[c] ;</span><br><span class="line">        <span class="keyword">int</span> u = t.sc.sc ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; (ll)t.fr &lt;&lt; " " &lt;&lt; c &lt;&lt; " " &lt;&lt; u &lt;&lt; '\n' ;</span></span><br><span class="line">        add(ans, comb(o, u) * Pr(o, u) % P * solve(c, X - u) % P) ;</span><br><span class="line">        mxu[c] = u ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    printf("%lld\n", ans) ;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans * expow(comb(n, X) * comb(n - X, Y) % P, P - <span class="number">2</span>) % P) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;又是营业的时候了.&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="字符串/哈希" scheme="https://www.orchidany.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2-%E5%93%88%E5%B8%8C/"/>
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/构造" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="数学/概率,期望" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="组合计数/有技巧的计数" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>【赛题整理】[Codeforces Round#502(Combined) A~G] 题解</title>
    <link href="https://www.orchidany.cn/2020/06/14/CF-Round-502/"/>
    <id>https://www.orchidany.cn/2020/06/14/CF-Round-502/</id>
    <published>2020-06-14T10:47:01.000Z</published>
    <updated>2020-06-15T07:50:41.969Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这一场是 SD 的陈醉前辈和 lxl 一起合办的。感觉质量还是可以的？虽然感觉这场比赛唯一的亮点就在于 G…</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>就知道让中国人出这种A就会出奇怪的模拟题 233</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><p>需要点思考的题。大概就是考虑只有 $a$ 中形如 $0…1$ 对应 $b$ 中的一个 $0…0$ 或者 $0…1$ 才会产生贡献。然后就扫一下 $a$ 的每一位计个数就好了。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><p>感觉这题就是十分的牛。</p><blockquote><p>给定一个数 $n$ 。求构造一个长度为 $n$ 的排列，使之 $\rm LIS+LDS$ 最小。</p></blockquote><p>一开始读题读成了最大值。然后随便画了画发现答案就是 $n+1$ emmm</p><p>然后读完了随便写了个奇怪的东西被轻松叉了，之后发现原来是个比较强的题。大概就是考虑 dilworth 定理，最长上升/下降子序列长度等于其反链的最多序列数。那么考虑如果是要算 LIS+LDS 之和的话，对于一个 LIS 的定长 $L$ ，根据 dilworth 定理必然会存在 $L$ 个反链，也就是 $L$ 个 DS 。于是可以知道最后有</p><script type="math/tex; mode=display">{\rm LIS+LDS}=\left\lceil \frac{n}{L}\right\rceil+L</script><p>即为了使 $L$ 个 DS 的最大长度最小，所以要尽量分的平均一点。那么可以知道这个 $L$ 应该取 $\sqrt n$ 。</p><p>那么之后就变成了如何构造一个 LIS 为 $\sqrt n$，LDS 为 $\left\lceil\dfrac{n}{\sqrt n}\right\rceil$ 的串。不难知道可以分段构造。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ;</span><br><span class="line">    m = <span class="built_in">std</span> :: <span class="built_in">ceil</span>(<span class="built_in">std</span> :: <span class="built_in">sqrt</span>(n)) ;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    if (n &amp; 1)&#123;</span></span><br><span class="line"><span class="comment">        ans[(n &gt;&gt; 1) + 1] = n ;</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= n &gt;&gt; 1 ; ++ i) ans[i] = i ;</span></span><br><span class="line"><span class="comment">        for (int i = (n &gt;&gt; 1) + 2 ; i &lt;= n ; ++ i) ans[i] = n - i + ((n &gt;&gt; 1) + 1) ;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    else &#123;</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= (n &gt;&gt; 1) ; ++ i) ans[i] = i ;</span></span><br><span class="line"><span class="comment">        for (int i = (n &gt;&gt; 1) + 1 ; i &lt;= n ; ++ i) ans[i] = n - i + ((n &gt;&gt; 1) + 1) ;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= n &gt;&gt; 1 ; ++ i) res[i] = ans[i + (n &gt;&gt; 1)] ;</span></span><br><span class="line"><span class="comment">    for (int i = (n &gt;&gt; 1) + 1 ; i &lt;= n ; ++ i) res[i] = ans[i - (n &gt;&gt; 1)] ;*/</span></span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>, q, k = n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= <span class="built_in">std</span> :: <span class="built_in">ceil</span>(<span class="number">1.0</span> * n / m) ; ++ i)&#123;</span><br><span class="line">        q = p ; <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m &amp;&amp; p &lt; n ; ++ j) ans[++ p] = k -- ;</span><br><span class="line">        <span class="built_in">std</span> :: reverse(ans + q + <span class="number">1</span>, ans + p + <span class="number">1</span>) ; <span class="comment">// printf("%d %d %d\n", i, q + 1, p) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, ans[i]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p>简单题。发现可以 $(2^n)^2$ 预处理之后，询问就可以 $\log $ 了。</p><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><p>计算几何题，跳了。</p><h1 id="F"><a href="#F" class="headerlink" title="F"></a>F</h1><blockquote><p>定义 $\text{exlog} _ f(p _ 1^{a _ 1}p _ 2^{a _ 2}…p _ k^{a _ 2}) = a _ 1 f(p _ 1) + a _ 2 f(p _ 2) + … + a _ k f(p _ k)$，其中 $f(x)=Ax^3+Bx^2+Cx+D$ ，求 $\sum _ {i=1} ^ n \text{exlog} _ f(i)$</p><p>$1 \le n \le 3 \times 10 ^ 8,0 \le A,B,C,D \le 10 ^ 6$ 。</p><p>时限 $5s$，空间限制 $16\rm Mib$ 。</p></blockquote><p>首先要有个 Observation，大概就是说可以发现对于每个质数的幂次 $a_i$，作为乘法系数是独立的。所以会有 $\text{exlog}_f(a\cdot b)=\text{exlog}_f(a)+\text{exlog}_f(b)$ 。但是这样直接筛的复杂度并不能过，空间会爆。然后考虑如何优化这一过程。</p><p>大概是说可以考虑每个质因数产生的贡献，彼此之间是<strong>线性无关</strong>的 ，所以可以分别考虑每个质数幂的贡献。具体的，我们只需要求出所有的质数以及质数的幂对答案的贡献就好了，这部分为了卡空间可以用埃氏筛。</p><p>但是发现还是过不去。因为埃氏筛的复杂度太高了。不过仔细分析一波，发现慢在诸如 $2,3,5,7$ 这种比较小的质因子 $p$，会进行 $\left\lfloor\dfrac{n}{p}\right\rfloor$ 次筛除操作。于是可以先暴力跑出 $2,3,5,7$ 的贡献，然后算其他的时就可以不考虑这些数了。</p><p>但是发现这样空间还是会有点问题。于是可以用 <code>bitset</code> + 合并状态来压缩。合并状态的原理是刨除了所有 $2,3$ 的倍数之后，空间就可以只开 $\dfrac{1}{3}$ 。</p><p>个人觉得这题能放到 F，唯一的原因就是因为需要十分优秀的卡常 and 卡空间技术。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100000005</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: <span class="built_in">bitset</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> lint ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; vis ;</span><br><span class="line"><span class="keyword">int</span> A, B, C, D ;</span><br><span class="line"></span><br><span class="line">lint ans ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">chk</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> ((!(x &amp; <span class="number">1</span>)) || (x % <span class="number">3</span> == <span class="number">0</span>) || (x % <span class="number">5</span> == <span class="number">0</span>)) ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function">lint <span class="title">calc</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1u</span> * A * p * p * p + <span class="number">1u</span> * B * p * p + <span class="number">1u</span> * C * p + D ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">lint <span class="title">solve</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    lint ret = <span class="number">0</span>, v = calc(p) ;</span><br><span class="line">    <span class="keyword">for</span> (ll x = p ; x &lt;= n ; x *= p)</span><br><span class="line">        ret += <span class="number">1u</span> * (n / x) * v ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; ans = <span class="number">0</span> ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;A, &amp;B, &amp;C, &amp;D) ;</span><br><span class="line"><span class="keyword">if</span> (n &gt;= <span class="number">2</span>) ans += solve(<span class="number">2</span>) ; </span><br><span class="line"><span class="keyword">if</span> (n &gt;= <span class="number">3</span>) ans += solve(<span class="number">3</span>) ;</span><br><span class="line"><span class="keyword">if</span> (n &gt;= <span class="number">5</span>) ans += solve(<span class="number">5</span>) ; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">7</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="keyword">if</span> (chk(i)) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (vis[i / <span class="number">3</span>]) <span class="keyword">continue</span> ; ans += solve(i) ; <span class="comment">//printf("%u\n", ans) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + i ; j &lt;= n ; j += i) </span><br><span class="line"><span class="keyword">if</span> (!chk(j)) vis[j / <span class="number">3</span>] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><p>这是真神题。</p><blockquote><p>给定一棵树，维护以下 $3$ 个操作：</p><p>（1）<code>1 x</code> 表示如果节点 $x$ 为白色，则将其染黑。否则对这个节点的所有儿子递归进行相同操作。</p><p>（2）<code>2 x</code>表示将以节点 $x$ 为 $root$ 的子树染白。</p><p>（3）<code>3 x</code>表示查询节点 $x$ 的颜色</p><p>$1\leq n\leq 10^5$ 。</p></blockquote><p>首先观察发现，操作的复杂度向修改倾斜，即询问复杂度比较低，可以考虑询问的时候搞点事情。</p><p>考虑 $(1)$ 操作的本质。因为要向询问倾斜，所以考虑如果某个点 $z$ 会被 <code>1 x</code> 影响到 ，那么必然有 $x\sim z$ 这条路径上除了 $x$ 之外的所有点都已经被染黑了。</p><p>考虑忽略 $(2)$ 操作时，如何通过维护权值实现这个事情。一开始将全部的点权设为 $0$，每次 $(1)$ 操作就是对该点进行单点 $+1$ 。这样询问就可以考虑询问 $root\to x$ 这条路径上，是否存在一个后缀 $(s,x)$ 的权和等于 $(s,x)$ 的长度。这样直接做本质上是一个树链上的线段树二分，但其实可以用一个比较传统的技巧优化这个过程，即差分。考虑把每个点的初始点权设为 $-1$ ，这样就是询问是否存在一个后缀，其和 $\geqslant 0$ 。这个可以通过维护链上的最大后缀和来做，写起来简单一些。</p><p>然后考虑加上 $(2)$ 操作后如何快速维护。发现 $(2)$ 操作的本质是让整棵子树的点权均变为 $-1$ 。但这还不够，因为 $(2)$ 本质上是强制让某个点 $x$ 变成白色，而上面那个做法本质上是对修改离线，最后再分别确定每个修改对答案的贡献。不过也有比较简单的解决方式，即让 <code>2 x</code> 中的 $x$ 单点减一个权值 $v$ ，使得 $root\to x$ 上的最大后缀和也为 $-1$ 。不难发现 $v=qry(x)+1$ 。</p><p>于是最后就可以用 $n\log ^2n $ 的复杂度解决这个问题了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: max ;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: min ;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: <span class="built_in">vector</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> _id[N] ;</span><br><span class="line"><span class="keyword">int</span> dfn[N] ;</span><br><span class="line"><span class="keyword">int</span> son[N] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> top[N] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> da)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[da] + <span class="number">1</span> ;</span><br><span class="line">    sz[x] = <span class="number">1</span>, fa[x] = da ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == da) <span class="keyword">continue</span> ;</span><br><span class="line">        dfs1(y, x) ; sz[x] += sz[y] ;</span><br><span class="line">        <span class="keyword">if</span> (sz[y] &gt; sz[son[x]]) son[x] = y ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tp)</span></span>&#123;</span><br><span class="line">    top[x] = tp ; ++ cnt ;</span><br><span class="line">    _id[dfn[x] = cnt] = x ;</span><br><span class="line">    <span class="keyword">if</span> (son[x])</span><br><span class="line">        dfs2(son[x], tp) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) dfs2(y, y) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> val[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> tag[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _up(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    seg[rt] = seg[lc] + seg[rc] ;</span><br><span class="line">    val[rt] = max(val[rc], val[lc] + seg[rc]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> _down(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!tag[rt]) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    seg[rc] =  - (r - mid) ;</span><br><span class="line">    seg[lc] =  - (mid - l + <span class="number">1</span>) ;</span><br><span class="line">    val[lc] = <span class="number">-1</span>, val[rc] = <span class="number">-1</span> ;</span><br><span class="line">    tag[rc] = tag[lc] = <span class="number">1</span>, tag[rt] = <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(seg[rt] = val[rt] = <span class="number">-1</span>) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    build(rc, mid + <span class="number">1</span>, r) ;</span><br><span class="line">    build(lc, l, mid) ; _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">        seg[rt] += v ;</span><br><span class="line">        val[rt] += v ;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>() ;</span><br><span class="line">    &#125;</span><br><span class="line">    _down(rt, l, r) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) upd(lc, l, mid, p, v) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rc, mid + <span class="number">1</span>, r, p, v) ;</span><br><span class="line">    _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cov</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> cl, <span class="keyword">int</span> cr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cl &lt;= l &amp;&amp; r &lt;= cr)&#123;</span><br><span class="line">        seg[rt] = - (r - l + <span class="number">1</span>) ;</span><br><span class="line">        val[rt] = <span class="number">-1</span> ; <span class="keyword">return</span> <span class="keyword">void</span>(tag[rt] = <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; _down(rt, l, r) ;</span><br><span class="line">    <span class="keyword">if</span> (cr &gt; mid) cov(rc, mid + <span class="number">1</span>, r, cl, cr) ;</span><br><span class="line">    <span class="keyword">if</span> (cl &lt;= mid) cov(lc, l, mid, cl, cr) ; _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) <span class="keyword">return</span> seg[rt] ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = <span class="number">0</span> ; _down(rt, l, r) ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) ret += sum(lc, l, mid, ql, qr) ;</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) ret += sum(rc, mid + <span class="number">1</span>, r, ql, qr) ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span></span>&#123;</span><br><span class="line">     _down(rt, l, r) ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) <span class="keyword">return</span> val[rt] ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = - n ; _down(rt, l, r) ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) ret = max(ret, qry(lc, l, mid, ql, qr)) ;</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) ret = max(ret + sum(rc, mid + <span class="number">1</span>, r, ql, qr), qry(rc, mid + <span class="number">1</span>, r, ql, qr)) ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Q</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret, v = <span class="number">0</span> ;</span><br><span class="line">    ret = -(n + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">while</span> (top[x] &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        ret = max(ret, v + qry(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x])) ;</span><br><span class="line">        v += sum(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x]) ; x = fa[top[x]] ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    printf("%d\n", qry(1, 1, n, dfn[top[x]], dfn[x])) ;</span></span><br><span class="line">    ret = max(ret, v + qry(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">1</span>, dfn[x])) ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;q) ; <span class="keyword">int</span> x, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">2</span> ; y &lt;= n ; ++ y)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    dfs1(<span class="number">1</span>, <span class="number">0</span>) ; dfs2(<span class="number">1</span>, <span class="number">1</span>) ; build(<span class="number">1</span>, <span class="number">1</span>, n) ;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= n ; ++ i) printf("%d%c", top[i], " \n"[i == n]) ;</span></span><br><span class="line"><span class="comment">//        printf("%d %d\n", i, sz[i]) ;</span></span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;z, &amp;x) ;</span><br><span class="line">        <span class="keyword">if</span> (z == <span class="number">1</span>) upd(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (z == <span class="number">2</span>)&#123;</span><br><span class="line">            cov(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], dfn[x] + sz[x] - <span class="number">1</span>) ;</span><br><span class="line">            upd(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], - Q(x) - <span class="number">1</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (z == <span class="number">3</span>)&#123;</span><br><span class="line"><span class="comment">//            printf("%d\n", Q(x)) ;</span></span><br><span class="line">            ans = (<span class="keyword">bool</span>)(Q(x) &gt;= <span class="number">0</span>) ;</span><br><span class="line">            <span class="built_in">puts</span>(ans ? <span class="string">"black"</span> : <span class="string">"white"</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//for(int p=1;p&lt;=3 * n;++p)printf("%d%c", val[p], " \n"[p == 3 * n]);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这一场是 SD 的陈醉前辈和 lxl 一起合办的。感觉质量还是可以的？虽然感觉这场比赛唯一的亮点就在于 G…&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="技巧/分治" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="数学/数论" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%95%B0%E8%AE%BA/"/>
    
      <category term="贪心" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="有技巧的差分" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E5%B7%AE%E5%88%86/"/>
    
      <category term="数据结构/数据结构方法/轻重链剖分" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%96%B9%E6%B3%95-%E8%BD%BB%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86/"/>
    
      <category term="图论/Dilworth定理" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-Dilworth%E5%AE%9A%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.10 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/14/6-10-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/14/6-10-训练笔记/</id>
    <published>2020-06-14T10:41:28.000Z</published>
    <updated>2020-06-19T12:07:46.059Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>lxl 的题，不可做。</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><blockquote><p>有一天，你得到了一个 $n$ 个点的树。</p><p>你感到很开心，于是记了下来和每一个点相邻的所有点中，编号最小的那个点和编号最大的那个点是什么。</p><p>然而一段时间后，你把那棵树弄丢了，但是你记录的信息还保存着。</p><p>你想得到原来的那棵树，于是尝试构造一个满足条件的解。</p><p>$1\leq n\leq 1000$ 。</p></blockquote><p>写了个乱搞搞了 $50$ 分，赛后稍微魔改了一下就 $60$ 了。思路大概是跟 spfa 的松弛一样，每次用只含一个未盖信息的点增广。但很显然这种做法并不对。因为可能会存在一些点压根没在给出的信息表里出现过。于是就可以先连必要的信息，然后直接直接暴力连剩下的边。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> h, t ;</span><br><span class="line"><span class="keyword">int</span> q[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> qnow[N] ;</span><br><span class="line"><span class="keyword">int</span> A[N][N] ;</span><br><span class="line"><span class="keyword">int</span> v[N][<span class="number">2</span>] ;</span><br><span class="line"><span class="keyword">int</span> base[N][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">no_sol</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"-1"</span>), <span class="number">0</span> ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == fa[x]) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f1 = find(x) ;</span><br><span class="line">    <span class="keyword">int</span> f2 = find(y) ;</span><br><span class="line">    <span class="keyword">if</span> (f1 != f2)</span><br><span class="line">        fa[f2] = f1 ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> r1 = (base[a][<span class="number">1</span>] &gt; b &amp;&amp; base[a][<span class="number">0</span>] &lt; b) ;</span><br><span class="line">    <span class="keyword">bool</span> r2 = (base[b][<span class="number">1</span>] &gt; a &amp;&amp; base[b][<span class="number">0</span>] &lt; a) ;</span><br><span class="line">    <span class="keyword">return</span> (r1 &amp;&amp; r2) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; h = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;v[i][<span class="number">0</span>], &amp;v[i][<span class="number">1</span>]) ;</span><br><span class="line">        <span class="keyword">if</span> (v[i][<span class="number">0</span>] == v[i][<span class="number">1</span>]) q[++ t] = i ;</span><br><span class="line">        base[i][<span class="number">0</span>] = v[i][<span class="number">0</span>], base[i][<span class="number">1</span>] = v[i][<span class="number">1</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">        ++ cnt ;</span><br><span class="line">        x = q[h ++] ;</span><br><span class="line">        y = v[x][<span class="number">0</span>] ;</span><br><span class="line">        <span class="keyword">int</span> &amp;ya = v[y][<span class="number">0</span>] ;</span><br><span class="line">        <span class="keyword">int</span> &amp;yb = v[y][<span class="number">1</span>] ;</span><br><span class="line">        A[y][x] = A[x][y] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (ya == yb) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (ya == x) ya = yb, q[++ t] = y ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (yb == x) yb = ya, q[++ t] = y ;</span><br><span class="line">        <span class="keyword">if</span> (cnt &gt;= <span class="number">50000000</span>) <span class="keyword">return</span> no_sol() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) fa[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (A[i][j]) ++ ans, merge(i, j) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) &#123;</span><br><span class="line"><span class="keyword">if</span> (find(i) != find(base[i][<span class="number">0</span>]))&#123;</span><br><span class="line">merge(i, base[i][<span class="number">0</span>]), ++ ans ; <span class="comment">//printf("%d %d\n", i, base[i][0]) ;</span></span><br><span class="line">A[i][base[i][<span class="number">0</span>]] = A[base[i][<span class="number">0</span>]][i] = <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (find(i) != find(base[i][<span class="number">1</span>]))&#123;</span><br><span class="line">merge(i, base[i][<span class="number">1</span>]), ++ ans ; <span class="comment">//printf("%d %d\n", i, base[i][1]) ;</span></span><br><span class="line">A[i][base[i][<span class="number">1</span>]] = A[base[i][<span class="number">1</span>]][i] = <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!A[i][base[i][<span class="number">0</span>]]) <span class="keyword">return</span> no_sol() ;</span><br><span class="line">        <span class="keyword">if</span> (!A[i][base[i][<span class="number">1</span>]]) <span class="keyword">return</span> no_sol() ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span> (ans == n - <span class="number">1</span>)&#123;</span><br><span class="line">        sol : ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                <span class="keyword">if</span> (A[i][j]) <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, i, j) ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = n - <span class="number">1</span> - ans ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (chk(i, j) &amp;&amp; find(i) != find(j))</span><br><span class="line">                -- ans, A[i][j] = A[j][i] = <span class="number">1</span>, merge(i, j) ;</span><br><span class="line">            <span class="keyword">if</span> (!ans) <span class="keyword">break</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!A[i][base[i][<span class="number">0</span>]]) <span class="keyword">return</span> no_sol() ;</span><br><span class="line">        <span class="keyword">if</span> (!A[i][base[i][<span class="number">1</span>]]) <span class="keyword">return</span> no_sol() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ans) <span class="keyword">return</span> no_sol() ; <span class="keyword">else</span> <span class="keyword">goto</span> sol ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="2.png" alt=""></p><p>$2 \leq n \leq 10^{5}, 1 \leq m \leq 10^{5}$ 。</p></blockquote><p>暴力比较好写，不难发现可以树上差分，之后肯定选经过的最多的那条边，这个过程可以枚举根然后 dfs。</p><p>但是不难发现这东西是可以简单 up and down 的，额外记录一个次大值就好了。写的时候有点小细节。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">using</span> IPT::qr ;</span><br><span class="line"><span class="keyword">using</span> IPT::qra ;</span><br><span class="line"><span class="keyword">using</span> IPT::qrs ;</span><br><span class="line"><span class="keyword">using</span> IPT::qrdb ;</span><br><span class="line"><span class="keyword">using</span> OPT::qw ;</span><br><span class="line"><span class="keyword">using</span> OPT::qwa ;</span><br><span class="line"><span class="keyword">using</span> OPT::qws ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span> :: <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; vint ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> son[N] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> top[N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll f[N] ;</span><br><span class="line">ll g[N] ;</span><br><span class="line"><span class="keyword">int</span> h[N] ;</span><br><span class="line"><span class="keyword">int</span> ch[N] ;</span><br><span class="line"><span class="keyword">int</span> tag[N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> da)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[da] + <span class="number">1</span> ;</span><br><span class="line">    sz[x] = <span class="number">1</span>, fa[x] = da ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == da) <span class="keyword">continue</span> ;</span><br><span class="line">        dfs1(y, x) ; sz[x] += sz[y] ;</span><br><span class="line">        <span class="keyword">if</span> (sz[y] &gt; sz[son[x]]) son[x] = y ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tp)</span></span>&#123;</span><br><span class="line">    top[x] = tp ;</span><br><span class="line">    <span class="keyword">if</span> (son[x])</span><br><span class="line">        dfs2(son[x], tp) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) dfs2(y, y) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (top[x] != top[y])&#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) swap(x, y) ;</span><br><span class="line">        x = fa[top[x]] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &gt; dep[y])</span><br><span class="line">        swap(x, y) ; <span class="keyword">return</span> x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve1</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y != fa[x])&#123;</span><br><span class="line">            solve1(y) ;</span><br><span class="line">            tag[x] += tag[y] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    ll sv = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> mv = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">int</span> cmv = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa[x])</span><br><span class="line">            <span class="keyword">continue</span> ; solve2(y) ;</span><br><span class="line">        f[x] += f[y], sv += tag[y] ;</span><br><span class="line">        <span class="keyword">if</span> (tag[y] &gt; tag[mv]) cmv = mv, mv = y ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (tag[y] &gt; tag[cmv]) cmv = y ;</span><br><span class="line">    &#125;</span><br><span class="line">    ch[x] = cmv, h[x] = mv ;</span><br><span class="line">    g[x] = sv, f[x] += sv - tag[mv] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve3</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    ans = min(ans, f[x]) ; ll t ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (y == h[x])</span><br><span class="line">             t = -tag[ch[x]] ;</span><br><span class="line">        <span class="keyword">else</span> t = -tag[y] ;</span><br><span class="line">        t += f[x] - f[y] ;</span><br><span class="line">        <span class="keyword">if</span> (tag[y] &gt; tag[h[y]])</span><br><span class="line">            f[y] += tag[h[y]], ch[y] = h[y], h[y] = y ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            f[y] += tag[y] ;</span><br><span class="line">            <span class="keyword">if</span> (tag[y] &gt; tag[ch[y]]) ch[y] = y ;</span><br><span class="line">        &#125;</span><br><span class="line">        f[y] += t ;</span><br><span class="line">        solve3(y) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n), qr(m) ;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ; tag[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        qr(x), qr(y), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    dfs1(<span class="number">1</span>, <span class="number">0</span>), dfs2(<span class="number">1</span>, <span class="number">1</span>) ; ans = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        qr(x), qr(y) ; z = lca(x, y) ;</span><br><span class="line">        tag[z] --, tag[z] --, tag[x] ++, tag[y] ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    solve1(<span class="number">1</span>) ;</span><br><span class="line">    solve2(<span class="number">1</span>) ;</span><br><span class="line">    solve3(<span class="number">1</span>) ;</span><br><span class="line">    qw(ans) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>对于这个数列的一段连续子序列 $a_l,a_{l+1},⋯,a_r$ ，如果存在一组整数 $x&lt;y$ 使得 $x$ 和 $y$ 没有出现在 $a_l$ 到 $a_r$ 中，并且 $x+1,x+2,⋯,y−1x+1,x+2,⋯,y−1$ 都出现在了 $a_l$ 到 $a_r$ 中，那么我们称 $(x,y)$ 是一个合法的数对。</p><p>你需要处理 $m$ 次询问，每次询问 $l,r,c$ ，你需要回答对于 $a_l,a_{l+1},⋯,a_r$ 满足 $y=x+c$ 的合法的数对数量。</p><p>$1 \leq n, m, a_{i} \leq 1000000,2 \leq c \leq 10$ 。</p></blockquote><p>毒瘤题…据说是 lxl 出给 SD 省队集训 2019 的题。</p><p>大概是有 $50$ 分左右是可以莫队的？然而正解是十分强大的线段树/BIT维护扫描线。</p><p>$9$ 个树状数组，分别维护对于每个左端点 $c-1=1,2,3\cdots9$ 时的答案，这样就可以直接用 BIT 计算出右端点。考虑左端点从右边到左边移动过程中，新加入一个数 $v$ 的时候，必然是原来的某些长度为 $t$ 的连续段变成了长度为 $t+k$ 的连续段。于是就考虑维护每个数随着左端点从右往左扫、上一次出现的位置。这样每次就可以把 $v-10\sim v+10$ 都扫一遍，记一下数字的出现情况，然后每次暴力找一下新产生的连续段，维护一下就好了。</p><p>写的时候大概有点细节，比如说按照 <code>last[c]</code> 排序后如果区间里存在两个 $v$ ，那么之后的贡献一定算过了。</p><p>于是最后的复杂度就是 $O(n\times c\log n)$ ，可以通过本题。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IPT &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> L = <span class="number">1</span> &lt;&lt; <span class="number">21</span>;</span><br><span class="line"><span class="keyword">char</span> buf[L], *front=buf, *end=buf;</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">GetChar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (front == end) end = buf + fread(front = buf, <span class="number">1</span>, L, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">return</span> (front == end) ? <span class="number">-1</span> : *(front++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">qr</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> ch = GetChar(), lst = <span class="number">0</span>; x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) lst = ch, ch = GetChar();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + (ch ^ <span class="number">48</span>), ch = GetChar();</span><br><span class="line">  <span class="keyword">if</span> (lst == <span class="string">'-'</span>) x = -x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qra</span><span class="params">(T *<span class="keyword">const</span> __ary, <span class="keyword">int</span> __n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; __n; ++i) qr(__ary[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qrs</span><span class="params">(T *p)</span> </span>&#123;</span><br><span class="line">  T *beg = p;</span><br><span class="line">  <span class="keyword">do</span> *p = GetChar(); <span class="keyword">while</span> (!<span class="built_in">isalnum</span>(*p));</span><br><span class="line">  <span class="keyword">do</span> *(++p) = GetChar(); <span class="keyword">while</span> (<span class="built_in">isalnum</span>(*p));</span><br><span class="line">  *p = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> p - beg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qrdb</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> ch = GetChar(), lst = <span class="number">0</span>; x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) lst = ch, ch = GetChar();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123; x = x * <span class="number">10</span> + (ch - <span class="string">'0'</span>); ch = GetChar(); &#125;</span><br><span class="line">  <span class="keyword">if</span> (ch == <span class="string">'.'</span>) &#123;</span><br><span class="line">    ch = GetChar();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">double</span> t = <span class="number">0.1</span>; <span class="built_in">isdigit</span>(ch); t *= <span class="number">0.1</span>) &#123;</span><br><span class="line">      x += (t * (ch - <span class="string">'0'</span>));</span><br><span class="line">      ch = GetChar();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (lst == <span class="string">'-'</span>) x = -x;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125; <span class="comment">// namespace IPT</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> OPT &#123;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> L = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">char</span> buf[L];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">qw</span><span class="params">(T x, <span class="keyword">const</span> <span class="keyword">char</span> aft = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123; x = -x, <span class="built_in">putchar</span>(<span class="string">'-'</span>); &#125;</span><br><span class="line">  <span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123; buf[++top] = <span class="keyword">static_cast</span>&lt;<span class="keyword">char</span>&gt;(x % <span class="number">10</span> + <span class="string">'0'</span>); &#125; <span class="keyword">while</span> (x /= <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">while</span> (top) <span class="built_in">putchar</span>(buf[top--]);</span><br><span class="line">  <span class="keyword">if</span> (aft) <span class="built_in">putchar</span>(aft);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qwa</span><span class="params">(T *<span class="keyword">const</span> __ary, <span class="keyword">int</span> __n, <span class="keyword">const</span> <span class="keyword">char</span> e1, <span class="keyword">const</span> <span class="keyword">char</span> e2)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> __dn = __n - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; __dn; ++i) qw(__ary[i], e1);</span><br><span class="line">  qw(__ary[__dn], e2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qws</span><span class="params">(T *p, <span class="keyword">const</span> <span class="keyword">int</span> __n, <span class="keyword">const</span> <span class="keyword">char</span> ed)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; __n; ++i) <span class="built_in">putchar</span>(p[i]);</span><br><span class="line">  <span class="keyword">if</span> (ed) <span class="built_in">putchar</span>(ed);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qws</span><span class="params">(T *p, <span class="keyword">const</span> <span class="keyword">char</span> ed)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (*p) <span class="built_in">putchar</span>(*p++);</span><br><span class="line">  <span class="keyword">if</span>(ed) <span class="built_in">putchar</span>(ed);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125; <span class="comment">// namespace OPT</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> IPT::qr;</span><br><span class="line"><span class="keyword">using</span> IPT::qra;</span><br><span class="line"><span class="keyword">using</span> IPT::qrs;</span><br><span class="line"><span class="keyword">using</span> IPT::qrdb;</span><br><span class="line"><span class="keyword">using</span> OPT::qw;</span><br><span class="line"><span class="keyword">using</span> OPT::qwa;</span><br><span class="line"><span class="keyword">using</span> OPT::qws;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">qs</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id ;</span><br><span class="line">    <span class="keyword">int</span> val ;</span><br><span class="line">    <span class="keyword">int</span> l, r ;</span><br><span class="line">&#125;q[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> last[N] ;</span><br><span class="line"><span class="keyword">int</span> _less[<span class="number">11</span>] ;</span><br><span class="line"><span class="keyword">int</span> _more[<span class="number">11</span>] ;</span><br><span class="line"><span class="keyword">int</span> _b[<span class="number">11</span>][N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; buc ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> m_k make_pair</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> qs &amp;a, <span class="keyword">const</span> qs &amp;b)</span></span>&#123; <span class="keyword">return</span> a.l &gt; b.l ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (c &gt; <span class="number">10</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x &lt;= n ; x += (x &amp; -x)) _b[c][x] += v ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> c, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x ; x -= (x &amp; -x)) ret += _b[c][x] ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> x, y, z, l, r ;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n) ; qr(m) ;</span><br><span class="line">    fill(last, last + N, n + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) qr(base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        q[i].id = i, qr(q[i].l), qr(q[i].r), qr(q[i].val), q[i].val -- ;</span><br><span class="line">    sort(q + <span class="number">1</span>, q + m + <span class="number">1</span>, comp) ; <span class="keyword">int</span> p = <span class="number">1</span> ; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        fill(_less, _less + <span class="number">11</span>, <span class="number">0</span>) ;</span><br><span class="line">        fill(_more, _more + <span class="number">11</span>, <span class="number">0</span>) ; buc.clear() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = max(<span class="number">0</span>, base[i] - <span class="number">10</span>) ; j &lt;= base[i] + <span class="number">10</span> ; ++ j)</span><br><span class="line">            buc.push_back(m_k(last[j], j)) ; buc.push_back(m_k(n + <span class="number">1</span>, <span class="number">0</span>)) ;</span><br><span class="line">        sort(buc.begin(), buc.end()) ; l = r = <span class="number">0</span> ; add(<span class="number">1</span>, i, <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> j : buc)&#123;</span><br><span class="line">            z = l + r + <span class="number">1</span> ;</span><br><span class="line">            x = j.fr, y = j.sc ;</span><br><span class="line">            <span class="keyword">if</span> (y == base[i] || x &gt; n)&#123;</span><br><span class="line">                add(l, x, <span class="number">1</span>), add(r, x, <span class="number">1</span>) ;</span><br><span class="line">                add(l + r + <span class="number">1</span>, x, <span class="number">-1</span>) ;</span><br><span class="line">                <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (y &lt; base[i])</span><br><span class="line">                 _less[base[i] - y] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> _more[y - base[i]] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span> (_less[l + <span class="number">1</span>])&#123;</span><br><span class="line">                add(l, x, <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">while</span> (_less[l + <span class="number">1</span>]) ++ l ;</span><br><span class="line">                add(l, x, <span class="number">-1</span>) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (_more[r + <span class="number">1</span>])&#123;</span><br><span class="line">                add(r, x, <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">while</span> (_more[r + <span class="number">1</span>]) ++ r ;</span><br><span class="line">                add(r, x, <span class="number">-1</span>) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (z != l + r + <span class="number">1</span>)</span><br><span class="line">                add(z, x, <span class="number">-1</span>), add(l + r + <span class="number">1</span>, x, <span class="number">1</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (q[p].l == i &amp;&amp; p &lt;= m)</span><br><span class="line">            ans[q[p].id] = qry(q[p].val, q[p].r), ++ p ;</span><br><span class="line">        last[base[i]] = i ;</span><br><span class="line">    &#125;</span><br><span class="line">    qwa(ans + <span class="number">1</span>, m, <span class="string">'\n'</span>, <span class="string">'\n'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;lxl 的题，不可做。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/构造" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="数据结构/树状数组" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="动态规划/树形DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="技巧/up and down" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-up-and-down/"/>
    
      <category term="数据结构方法/扫描线" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%96%B9%E6%B3%95-%E6%89%AB%E6%8F%8F%E7%BA%BF/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.9 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/14/6-9-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/14/6-9-训练笔记/</id>
    <published>2020-06-14T10:41:23.000Z</published>
    <updated>2020-06-19T12:13:53.346Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>营业，营业！</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><blockquote><p>有一天，主力手里有一个长度为 $n$ 的序列 ${a1,a2,…,an}$ 与 一个长度为 $m$ 的数列 ${b1,b2,…,bm}$, 他想知道有多少对 $(a_i,b_j){1≤i≤n,1≤j≤m}$ 满足两个数 <code>XOR</code> (异或) 以后，在二进制表示下恰好有两个 $1$。</p><p>输出这个对数。</p><p>$1\leq n\leq 10^5,1\leq a_i\leq 2^{30}$ 。</p></blockquote><p>比较简单的套路题。考虑恰好有两个 $1$ 也就是说二进制下恰好有两位不同。于是可以开一个 <code>map</code> 扫一下 $\{a_n\}$，然后对于 $\{b_n\}$ 的每个数，$\log ^2$ 的复杂度去枚举一下 $p,q$ 。但这样 $\log ^3$ 并不可过。于是可以用一点 meet in middle 的思想，预处理 $n\log n$ 个值，分别是 $a_i$ 异或 $1,2,4,8\cdots$。这样就可以消掉一个 log。</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p>有从 1 到 n 共 n个数，你需要将它们排成一列，使得任意两个相邻的数互质。</p><p>求一共有多少种排列方式。</p><p>共 $28$ 个测试点，对第 $n$ 个测试点有 $n=i$ 。</p></blockquote><p>首先大概是 $30\sim 40$ 左右的分数可以直接暴力全排列出来。然后如果考虑更高一点的话，就可以设 $f_{s,i}$ 表示考虑了集合 $s$ 内的数，最后一个数是 $i$ 的方案数。这样复杂度就是 $O(2^n\times n^2)$ 的，空间复杂度是 $O(2^n\times n)$ 。可以获得大概 $80$ 左右的成绩。不过似乎是可以多插几个内存条来 A 掉这题，听上去很猛男。</p><p>正解考虑合并一些状态，大概是说发现诸如 $3,9,27$ 这样的数字，本质上是等价的。所以 $1\sim 28$ 就可以划分成 $14$ 个左右的等价类，对这些等价类 dp 就好了，状态数大概在 $2e7$ 左右。实现的时候稍有细节。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>初始有 n 个小球，小球有 4 种颜色，初始的等级为 1  </p><p>你每一次可以选择一个小球删除，删除后后面的小球会向前移动一位 。如果有至少 3 个相同颜色和等级的小球连续，那么左侧的 3 个会合并成一个颜色相同等级+1的小球（可能有连锁反应） 。</p><p>问有多少种能到达的局面 。两个局面是不同当且仅当长度不同或存在一个位置小球不同。</p><p>$n \leq 1000000$ 。</p></blockquote><p>一个很重要的 Observation：合成一个 $p$ 级球，需要 $3^p$ 个 $1$ 级球。所以可以知道至多有 $\log $ 种不同的等级。然后可以对此进行 dp。设 $f_{i,(c,L),1/2}$ 表示考虑了原序列的前 $i$ 位，最后一个颜色球是 $c$，等级为 $L$ 时，末尾有 $1/2$ 个相同的球有多少种合法的序列。</p><p>那么首先不难发现 $c=col_i$ 。其次考虑转移，考虑一个 $(c,L_1)$ 后面可以转移到一个怎样的 $(d,L_2)$。这个地方需要分类讨论：</p><p>1、$c\neq d$ 。那么就可以直接转移 </p><script type="math/tex; mode=display">f_{i,(c,L_1),1}+f_{i,(c,L_1),2}\to f_{j,(c=d,L_2),1}</script><p>2、$c=d$ 。考虑这一部分由于题目中限制了「从最左端开始合成」，所以对于类似 <code>aabaa</code> 这种序列，<code>(1,2,3)(4)</code> 是合法的，而 <code>(1)(2,3,4)</code> 是不合法的。所以需要分类讨论一波长度关系：</p><p>（1）$L_1=L_2$ 。此时可以直接转移，但是注意到由于一个稳定的结束状态不会出现连续三个相同的球，所以转移应该为</p><script type="math/tex; mode=display">f_{i,(c,L_1),1}\to f_{j,(c,L_2),2}</script><p>（2）$L_1\gt L_2$ 。此时一定有一种合法的方式是先合完左边再合右边。所以可以正常转移</p><script type="math/tex; mode=display">f_{i,(c,L_1),1}+f_{i,(c,L_1),2}\to f_{j,(c=d,L_2),1}</script><p>（3）$L_1\lt L_2$ 。注意到此时不能再这么合成了，因为必然会有一次合并使得右边超过左边，于是此时就需要调整分界线。考虑找到 $i$ 后面第一个颜色不等于 $c$ 的位置 $k$ ，然后从 $k$ 开始找 $3^j$ 个 $c$ 。这样就可以直接转移了，因为此时不存在左右部分互相影响的问题。</p><p>于是可以先预处理出来每个位置后面第一个和它颜色不同的位置、以及从每个位置开始第 $3^j$ 个 $0/1/2/3$ 分别在哪。最后这样做的复杂度是 $O(nC\log^2n)$ 的。通过一点小优化可以优化到 $O(nC\log n)$，不过我这里偷了一下懒，优化到了 $O(nC\log n+\dfrac{1}{4}nC\log ^2n)$ ，也是可以过的。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> C = <span class="number">4</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">13</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">chkmin</span><span class="params">(T &amp;x, T y)</span></span>&#123; x = x &gt; y ? y : x ; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">chkmax</span><span class="params">(T &amp;x, T y)</span></span>&#123; x = x &lt; y ? y : x ; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">char</span> cc[N] ;</span><br><span class="line"><span class="keyword">int</span> buc[C] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> go_d[N] ;</span><br><span class="line"><span class="keyword">int</span> go_s[N][C][M] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> g[M] ;</span><br><span class="line"><span class="keyword">int</span> f[N][M][<span class="number">2</span>] ;</span><br><span class="line"><span class="comment">//think about the first i_th numbers, the last level is j, ths suffix sum is 1/2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, cc + <span class="number">1</span>) ;</span><br><span class="line">    fill(buc, buc + C, n + <span class="number">1</span>) ;</span><br><span class="line">    fill(go_d, go_d + n + <span class="number">1</span>, n + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i] = (<span class="keyword">int</span>)cc[i] - <span class="string">'A'</span> ;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= n ; ++ i)</span></span><br><span class="line"><span class="comment">//        base[i] = i &amp; 1 ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">0</span> ; -- i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span> ; c &lt; C ; ++ c)&#123;</span><br><span class="line">            go_s[i][c][<span class="number">0</span>] = buc[c] ;</span><br><span class="line">            <span class="keyword">if</span> (c != base[i])</span><br><span class="line">                 chkmin(go_d[i], buc[c]) ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; go_d[i] &lt;&lt; '\n' ;</span></span><br><span class="line">        buc[base[i]] = i ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; C ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; M ; ++ j)</span><br><span class="line">go_s[n][i][j] = go_s[n + <span class="number">1</span>][i][j] = n + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt; C ; ++ k)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; M ; ++ j)</span><br><span class="line">                go_s[i][k][j] = go_s[go_s[ go_s[i][k][j - <span class="number">1</span>] ][k][j - <span class="number">1</span>] ][k][j - <span class="number">1</span>] ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; C ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; M ; ++ j)</span><br><span class="line">f[go_s[<span class="number">0</span>][i][j]][j][<span class="number">0</span>] = (go_s[<span class="number">0</span>][i][j] != n + <span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="keyword">int</span> s = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">int</span> o = base[i], u = go_d[i], v, z ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt; M ; ++ k)</span><br><span class="line">add(s, (f[i][k][<span class="number">1</span>] + f[i][k][<span class="number">0</span>]) % P) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">4</span> ; ++ j) &#123;</span><br><span class="line"><span class="keyword">if</span> (j != o)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span> ; q &lt; M ; ++ q)</span><br><span class="line">v = go_s[i][j][q], add(f[v][q][<span class="number">0</span>], s) ;</span><br><span class="line"><span class="keyword">continue</span> ;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span> ; p &lt; M ; ++ p)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> q = <span class="number">0</span> ; q &lt; M ; ++ q)&#123;</span><br><span class="line">                    v = go_s[i][j][q] ;</span><br><span class="line">z = go_s[u][j][q] ;</span><br><span class="line">                    <span class="keyword">if</span> (q &lt; p)</span><br><span class="line">                         add(f[v][q][<span class="number">0</span>], (f[i][p][<span class="number">1</span>] + f[i][p][<span class="number">0</span>]) % P) ;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (q &gt; p)</span><br><span class="line">                         add(f[z][q][<span class="number">0</span>], (f[i][p][<span class="number">0</span>] + f[i][p][<span class="number">1</span>]) % P) ;</span><br><span class="line">                 <span class="function">a   <span class="keyword">else</span> <span class="title">add</span><span class="params">(f[v][q][<span class="number">1</span>], f[i][p][<span class="number">0</span>])</span> </span>;</span><br><span class="line"><span class="comment">//                    if (v &lt;= n)&#123;</span></span><br><span class="line"><span class="comment">//                        cout &lt;&lt; i &lt;&lt; " " &lt;&lt; v &lt;&lt; " " &lt;&lt; p &lt;&lt; " " &lt;&lt; q &lt;&lt; '\n';</span></span><br><span class="line"><span class="comment">//                        cout &lt;&lt; f[v][q][0] &lt;&lt; " " &lt;&lt; f[v][q][1] &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; M ; ++ j)</span><br><span class="line">            add(ans, (f[i][j][<span class="number">0</span>] + f[i][j][<span class="number">1</span>]) % P) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">"\n"</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;营业，营业！&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="技巧/meet in middle" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-meet-in-middle/"/>
    
      <category term="动态规划/有技巧的DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="思维题/对应与转化" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>【题解】LOJ#2206 [HNOI2014]世界树</title>
    <link href="https://www.orchidany.cn/2020/06/14/%E4%B8%96%E7%95%8C%E6%A0%91/"/>
    <id>https://www.orchidany.cn/2020/06/14/世界树/</id>
    <published>2020-06-14T10:40:54.000Z</published>
    <updated>2020-06-19T12:18:39.820Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>感觉是比较有难度的虚树题了。</p><p>倍增是用不会了，这辈子都用不会了。</p><a id="more"></a><blockquote><p>世界树是一棵无比巨大的树，它伸出的枝干构成了整个世界。在这里，生存着各种各样的种族和生灵，他们共同信奉着绝对公正公平的女神艾莉森，在他们的信条里，公平是使世界树能够生生不息、持续运转的根本基石。</p><p>世界树的形态可以用一个数学模型来描述：世界树中有 $n$ 个种族，种族的编号分别从 $1$ 到 $n$，分别生活在编号为 $1$ 到 $n$ 的聚居地上，种族的编号与其聚居地的编号相同。有的聚居地之间有双向的道路相连，道路的长度为 $1$。保证连接的方式会形成一棵树结构，即所有的聚居地之间可以互相到达，并且不会出现环。定义两个聚居地之间的距离为连接他们的道路的长度；例如，若聚居地 $a$ 和 $b$ 之间有道路，$b$ 和 $c$ 之间有道路，因为每条道路长度为 $1$ 而且又不可能出现环，所以 $a$ 与 $c$ 之间的距离为 $2$。</p><p>出于对公平的考虑，第 $i$ 年，世界树的国王需要授权 $m_i$ 个种族的聚居地为临时议事处。对于某个种族 $x$（$x$ 为种族的编号），如果距离该种族最近的临时议事处为 $y$（$y$ 为议事处所在聚居地的编号），则种族 $x$ 将接受 $y$ 议事处的管辖（如果有多个临时议事处到该聚居地的距离一样，则 $y$ 为其中编号最小的临时议事处）。</p><p>现在国王想知道，在 $q$ 年的时间里，每一年完成授权后，当年每个临时议事处将会管理多少个种族（议事处所在的聚居地也将接受该议事处管理）。 现在这个任务交给了以智慧著称的灵长类的你：程序猿。请帮国王完成这个任务吧。</p><p>对于所有的数据 $N\leq 300000, q\leq 300000, m_1+m_2+\ldots+m_q \leq 300000$。</p></blockquote><p>这题大概就是难在不能很好地维护非关键点与关键点之间的关系。但是思路还是比较直观清晰的。考虑先求出虚树上所有点对纯虚点的贡献，然后考虑不在虚树上的点必然是以两个虚树上点之间的链的形式存在。那么就可以倍增出这个分界线来，之所以选用倍增而不是二分的原因显然：不用重复累加信息。</p><p>然后具体过程就是先 up_down 出虚树上点之间的信息，然后再 solve 一遍，对于虚树上每条边去倍增出分界线。然后这个地方存在细节：</p><p>0、倍增的时候可以考虑去倍增从两个点延伸出的范围。</p><p>1、不要忘了编号的约束，最后判一下就好了。</p><p>2、大概就是说如果用 size 去算链之间的点的分配势必会算多，但是也有个好处就是可以直接拿子树 size 去容斥，这样就可以一并算出那些 $x$ 到叶子上没有其他关键点的链的信息了。</p><p>唉，越来越菜了。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: max ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: min ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: pair ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: swap ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: <span class="built_in">vector</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: make_pair ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fr first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sc second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> m_k make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300005</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> I = <span class="number">1000000000</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qr</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">0</span>, f = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">char</span> c = getchar() ;</span><br><span class="line">    <span class="keyword">while</span> (c &gt; <span class="string">'9'</span> || c &lt; <span class="string">'0'</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">'-'</span>) f = <span class="number">-1</span> ; c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c &lt;= <span class="string">'9'</span> &amp;&amp; c &gt;= <span class="string">'0'</span>)&#123;</span><br><span class="line">        r = (r &lt;&lt; <span class="number">1</span>) + (r &lt;&lt; <span class="number">3</span>) + c - <span class="string">'0'</span>, c = getchar() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r * f ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line"><span class="keyword">int</span> n, q, k ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> virtual_tree&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt ;</span><br><span class="line">    <span class="keyword">int</span> sum ;</span><br><span class="line">    <span class="keyword">int</span> sz[N] ;</span><br><span class="line">    <span class="keyword">int</span> fa[N] ;</span><br><span class="line">    <span class="keyword">int</span> nfa[N] ;</span><br><span class="line">    <span class="keyword">int</span> dep[N] ;</span><br><span class="line">    <span class="keyword">int</span> dfn[N] ;</span><br><span class="line">    <span class="keyword">int</span> son[N] ;</span><br><span class="line">    <span class="keyword">int</span> top[N] ;</span><br><span class="line">    <span class="keyword">int</span> anc[N][<span class="number">19</span>] ;</span><br><span class="line">    <span class="keyword">int</span> stk[N], tp ;</span><br><span class="line">    <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; a ;</span><br><span class="line">    <span class="built_in">vector</span> &lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; T[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> da)</span></span>&#123;</span><br><span class="line">        anc[x][<span class="number">0</span>] = da ;</span><br><span class="line">        dep[x] = dep[da] + <span class="number">1</span> ;</span><br><span class="line">        sz[x] = <span class="number">1</span>, fa[x] = da ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">18</span> ; ++ i)</span><br><span class="line">            anc[x][i] = anc[anc[x][i - <span class="number">1</span>]][i - <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span> (y == da) <span class="keyword">continue</span> ;</span><br><span class="line">            dfs1(y, x) ; sz[x] += sz[y] ;</span><br><span class="line">            <span class="keyword">if</span> (sz[y] &gt; sz[son[x]]) son[x] = y ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tp)</span></span>&#123;</span><br><span class="line">        top[x] = tp ;</span><br><span class="line">        dfn[x] = ++ cnt ;</span><br><span class="line">        <span class="keyword">if</span> (son[x])</span><br><span class="line">            dfs2(son[x], tp) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">            <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) dfs2(y, y) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (top[x] != top[y])&#123;</span><br><span class="line">            <span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])</span><br><span class="line">                <span class="built_in">std</span> :: swap(x, y) ; x = fa[top[x]] ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (dep[x] &gt; dep[y])</span><br><span class="line">            <span class="built_in">std</span> :: swap(x, y) ; <span class="keyword">return</span> x ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dis</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!b) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">return</span> dep[a] + dep[b] - (dep[lca(a, b)] &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">//    printf("%d %d\n", x, y) ;</span></span><br><span class="line">        <span class="keyword">if</span> (x == y) <span class="keyword">return</span> ; nfa[x] = y ;</span><br><span class="line">T[y].p_b(m_k(x, dis(x, y))) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">()</span></span>&#123;</span><br><span class="line">        stk[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        sort(a.begin(), a.end(), [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> dfn[x] &lt; dfn[y] ; &#125;) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : a)&#123;</span><br><span class="line">            <span class="keyword">int</span> z = lca(x, stk[tp]) ;</span><br><span class="line">            <span class="keyword">if</span> (z != stk[tp])&#123;</span><br><span class="line">                <span class="keyword">while</span> (tp &amp;&amp; dep[stk[tp - <span class="number">1</span>]] &gt;= dep[z])</span><br><span class="line">                    add_e(stk[tp], stk[tp - <span class="number">1</span>]), -- tp ;</span><br><span class="line">                <span class="keyword">if</span> (stk[tp] != z) add_e(stk[tp], z), stk[tp] = z ;</span><br><span class="line">            &#125;</span><br><span class="line">            stk[++ tp] = x ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (tp)</span><br><span class="line">            add_e(stk[tp], stk[tp - <span class="number">1</span>]), -- tp ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> minf[N] ;</span><br><span class="line"><span class="keyword">int</span> mind[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> virtual_tree ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x]) clear(y.fr) ;</span><br><span class="line">    T[x].clear(), ans[x] = vis[x] = mind[x] = <span class="number">0</span>, minf[x] = I ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_up</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">//    printf("%d\n", x) ;</span></span><br><span class="line">    <span class="keyword">if</span> (vis[x])&#123;</span><br><span class="line">        minf[x] = <span class="number">0</span> ;</span><br><span class="line">        mind[x] = x ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> y, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : T[x])&#123;</span><br><span class="line">        y = t.fr ;</span><br><span class="line">        do_up(y) ;</span><br><span class="line">        z = minf[y] + dis(x, y) ;</span><br><span class="line">        <span class="keyword">if</span> (z &lt; minf[x])</span><br><span class="line">            minf[x] = z, mind[x] = mind[y] ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (z == minf[x] &amp;&amp; mind[x] &gt; mind[y])</span><br><span class="line">            mind[x] = mind[y] ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_down</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> y, z ;</span><br><span class="line">    <span class="keyword">if</span> (nfa[x])&#123;</span><br><span class="line">        y = nfa[x] ;</span><br><span class="line">        z = minf[y] + v ;</span><br><span class="line">        <span class="keyword">if</span> (z &lt; minf[x])</span><br><span class="line">            minf[x] = z, mind[x] = mind[y] ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (z == minf[x] &amp;&amp; mind[x] &gt; mind[y])</span><br><span class="line">            mind[x] = mind[y] ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//printf("%d %d %d\n", x, mind[x], minf[x]) ;</span></span><br><span class="line">    ans[mind[x]] ++ ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : T[x])</span><br><span class="line">        do_down(t.fr, t.sc) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ancdis</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dep[x] - dep[y] ;</span><br><span class="line">&#125;</span><br><span class="line">pair &lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; do_find(<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123;</span><br><span class="line">    <span class="keyword">bool</span> ct = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &lt; dep[y])</span><br><span class="line">        swap(x, y), ct = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">int</span> dist = minf[x], z = x, nd = mind[x] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">18</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">        <span class="keyword">if</span> (dist + (<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>)) &lt; minf[y] + ancdis(x, y))</span><br><span class="line">            mind[x = anc[x][i]] = nd, dist += (<span class="number">1</span> &lt;&lt; i) ;</span><br><span class="line">    <span class="keyword">if</span> (dist + <span class="number">2</span> == minf[y] + ancdis(x, y) &amp;&amp; nd &lt; mind[y]) x = fa[x] ;</span><br><span class="line"><span class="comment">//printf("$ %d %d %d %d %d %d\n", y, x, z, sz[y], sz[x], sz[z]) ;</span></span><br><span class="line">    <span class="keyword">if</span> (ct)</span><br><span class="line">         <span class="keyword">return</span> m_k(sz[y] - sz[x], sz[x] - sz[z]) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> m_k(sz[x] - sz[z], sz[y] - sz[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> y, z = sz[x] ;</span><br><span class="line"><span class="comment">//printf("#%d %d\n", x, z) ;</span></span><br><span class="line">    pair &lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; res ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : T[x])&#123;</span><br><span class="line">        y = t.fr ;</span><br><span class="line">        res = do_find(x, y) ;</span><br><span class="line"><span class="comment">//if (!x) goto cccccc ;</span></span><br><span class="line">        ans[mind[x]] += res.fr ;</span><br><span class="line">        ans[mind[y]] += res.sc ;</span><br><span class="line"><span class="comment">//printf("* %d %d\n", res.fr, res.sc) ;</span></span><br><span class="line">        z -= (res.fr + res.sc + sz[y]) ;</span><br><span class="line">        solve(y) ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[mind[x]] += z - <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//printf("#%d %d\n", x, z) ;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="built_in">memset</span>(minf, <span class="number">63</span>, <span class="keyword">sizeof</span>(minf)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        x = qr(), y = qr(), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    dfs1(rt = <span class="number">1</span>, <span class="number">0</span>), dfs2(rt, rt) ; q = qr() ;</span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        k = qr() ; a.clear() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">            vis[base[i] = qr()] = <span class="number">1</span>, a.p_b(base[i]) ;</span><br><span class="line">        ins() ; do_up(<span class="number">1</span>) ; do_down(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">solve(<span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, ans[base[i]], <span class="string">" \n"</span>[i == k]) ; clear(<span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;感觉是比较有难度的虚树题了。&lt;/p&gt;
&lt;p&gt;倍增是用不会了，这辈子都用不会了。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="loj" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/loj/"/>
    
    
      <category term="动态规划/有技巧的DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="技巧/倍增" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%80%8D%E5%A2%9E/"/>
    
      <category term="虚树" scheme="https://www.orchidany.cn/tags/%E8%99%9A%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>【学习笔记】虚树学习&amp;做题笔记</title>
    <link href="https://www.orchidany.cn/2020/06/14/%E8%99%9A%E6%A0%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/14/虚树学习笔记/</id>
    <published>2020-06-14T10:39:17.000Z</published>
    <updated>2020-06-14T12:36:38.533Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>捣鼓了捣鼓虚树，发现原来难点在DP <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://cdn.jsdelivr.net/gh/xaoxuu/volantis@1.0.6/img/qq/抓狂.gif" alt=""></p><p>发现了网上一个 QQ 表情的 CDN，感觉很可爱w。</p><a id="more"></a><h1 id="虚树学习笔记"><a href="#虚树学习笔记" class="headerlink" title="虚树学习笔记"></a>虚树学习笔记</h1><p>大概就是一种快速维护关键点信息的方式。具体思想可以看做缩点(链)，对于 $k$ 个关键点，虚树可以将问题规模缩小至 $O(k)$ 而不是 $O(n)$ 。</p><p>建树方式比较直观，跟笛卡尔树一样是维护右链，但是由于孩子可能很多所以建树方式比笛卡尔树要复杂。值得一提的是，虚树都是在退栈的时候才会连边，并且虚树建立时需要考虑的主要矛盾就是 LCA 的取舍，因为维护关键点仍然需要保持其树形结构。</p><p>考虑整棵虚树把 $0$ 号点作为虚根 $root$，将关键点按照 <code>dfn</code> 从小到大排序。每次插入一个点，会首先判断两个 case:</p><p>0、如果此时不是新的一条链，直接将当前点入栈。</p><p>1、如果此时是新的一条链，那么把所有深度比当前点大的点都出栈，类似一个 <code>lower_bound</code> 的过程，保留到「左链中第一个深度比当前点更深的点 $t$」为止。之后考虑如果当前元素与原来的栈顶元素 $s$ 的 LCA，设为 $o$， 不是 $t$，那么就连边(o,t)$ 和该把 $t$ 出栈、 $o$ 入栈。</p><p>过程的充分性和合法性是显然的。最后不要忘记栈中剩下的最右链。这个地方 xls 在洛谷上放了个板子，但是数据可能不是很强，但我觉得这似乎也没必要很强：<a href="https://www.luogu.com.cn/problem/U108028" target="_blank" rel="noopener">戳我</a> 。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> virtual_tree&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt ;</span><br><span class="line">    <span class="keyword">int</span> sz[N] ;</span><br><span class="line">    <span class="keyword">int</span> fa[N] </span><br><span class="line">    <span class="keyword">int</span> nfa[N] ;</span><br><span class="line">    <span class="keyword">int</span> dep[N] ;</span><br><span class="line">    <span class="keyword">int</span> dfn[N] ;</span><br><span class="line">    <span class="keyword">int</span> son[N] ;</span><br><span class="line">    <span class="keyword">int</span> top[N] ;</span><br><span class="line">    <span class="keyword">int</span> stk[N], tp ;</span><br><span class="line">    <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; a, T ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> da)</span></span>&#123;</span><br><span class="line">        dep[x] = dep[da] + <span class="number">1</span> ;</span><br><span class="line">        sz[x] = <span class="number">1</span>, fa[x] = da ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span> (y == da) <span class="keyword">continue</span> ;</span><br><span class="line">            dfs1(y, x) ; sz[x] += sz[y] ;</span><br><span class="line">            <span class="keyword">if</span> (sz[y] &gt; sz[son[x]]) son[x] = y ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tp)</span></span>&#123;</span><br><span class="line">        top[x] = tp ;</span><br><span class="line">        dfn[x] = ++ cnt ;</span><br><span class="line">        <span class="keyword">if</span> (son[x])</span><br><span class="line">            dfs2(son[x], tp) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">            <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) dfs2(y, y) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (top[x] != top[y])&#123;</span><br><span class="line">            <span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])</span><br><span class="line">                <span class="built_in">std</span> :: swap(x, y) ; x = fa[top[x]] ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (dep[x] &gt; dep[y])</span><br><span class="line">            <span class="built_in">std</span> :: swap(x, y) ; <span class="keyword">return</span> x ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sort(a.begin(), a.end(), [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> dfn[x] &lt; dfn[y] ; &#125;) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : a)&#123;</span><br><span class="line">            <span class="keyword">int</span> z = lca(x, stk[tp]) ;</span><br><span class="line">            <span class="keyword">if</span> (z != stk[tp])&#123;</span><br><span class="line">                <span class="keyword">while</span> (tp &amp;&amp; dep[stk[tp - <span class="number">1</span>]] &gt;= dep[z])</span><br><span class="line">                    nfa[stk[tp]] = stk[tp - <span class="number">1</span>], -- tp ; <span class="comment">//类似 lower_bound</span></span><br><span class="line">                <span class="keyword">if</span> (stk[tp] != z) nfa[stk[tp]] = z, stk[tp] = z ;</span><br><span class="line">            &#125;</span><br><span class="line">            stk[++ tp] = x ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (tp) nfa[stk[tp]] = stk[tp - <span class="number">1</span>], -- tp ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后以后就管虚树上的关键点叫做「纯虚点」，那些 LCA 叫做「半虚点」好了。</p><h1 id="虚树练习笔记"><a href="#虚树练习笔记" class="headerlink" title="虚树练习笔记"></a>虚树练习笔记</h1><h2 id="SDOI2011-消耗战"><a href="#SDOI2011-消耗战" class="headerlink" title="[SDOI2011] 消耗战"></a>[SDOI2011] 消耗战</h2><blockquote><p>多组询问。每次给出一些树上关键点，边带权，求使这些点均不与根节点连通的最小代价。</p></blockquote><p>考虑建出虚树之后变成了裸 DP。设 $f_i$ 为搞完 $i$ 子树内的所有关键点的最小代价，那么有转移</p><script type="math/tex; mode=display">f_i=\begin{cases} val(root\to i)&\mathrm{if~c}_i=1\\ \min\{\sum f_j, val(root\to i)\}&{\rm otherwith}\end{cases}</script><p>其中 $val(root\to i)$ 是根节点到 $i$ 的边权最大值，$c_i$ 表示 $i$ 是否为关键点，转移就好了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123; T[y].p_b(x) ; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x]) clear(y) ;</span><br><span class="line">        T[x].clear() ; vis[x] = <span class="number">0</span> ; f[x] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">()</span></span>&#123;</span><br><span class="line">        sort(a.begin(), a.end(), [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> dfn[x] &lt; dfn[y] ; &#125;) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : a)&#123;</span><br><span class="line">            <span class="keyword">int</span> z = lca(x, stk[tp]) ;</span><br><span class="line">            <span class="keyword">if</span> (z != stk[tp])&#123;</span><br><span class="line">                <span class="keyword">while</span> (tp &amp;&amp; dep[stk[tp - <span class="number">1</span>]] &gt;= dep[z])</span><br><span class="line">                    add_e(stk[tp], stk[tp - <span class="number">1</span>]),  -- tp ;</span><br><span class="line">                <span class="keyword">if</span> (stk[tp] != z) add_e(stk[tp], z), stk[tp] = z ;</span><br><span class="line">            &#125;</span><br><span class="line">            stk[++ tp] = x ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (tp)</span><br><span class="line">            add_e(stk[tp], stk[tp - <span class="number">1</span>]), -- tp ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        ll tmp = <span class="number">0</span> ;</span><br><span class="line"><span class="comment">//        printf("%d\n", x) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x])&#123;</span><br><span class="line">            solve(y) ;</span><br><span class="line">            tmp += f[y] ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!T[x].size() || vis[x])</span><br><span class="line">            tmp = I ; f[x] = min(val[x], tmp) ;</span><br><span class="line"><span class="comment">//        printf("%d %lld\n", x, f[x]) ;</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="GZOI2017-共享单车"><a href="#GZOI2017-共享单车" class="headerlink" title="[GZOI2017]共享单车"></a>[GZOI2017]共享单车</h2><blockquote><p>求出这个图的最短路径生成树后，树上每个点初始颜色为 $0$ 。有两种操作：</p><p>1、将部分点颜色取反</p><p>2、给出一些点，建出虚树（边权为两点树上距离），求最小割边代价使得虚树上没有颜色为 $1$ 的点与根联通。</p></blockquote><p>这题是个十分没意思的读题题+二合一题。感觉非要求出最短路树来就是多此一举。然后他这题十分有意思的一点就是明确告诉你了这是棵虚树，也就是默认树上全部的点都是纯虚点。然后 DP 过程就是消耗战。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line"><span class="keyword">int</span> col[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, Q, k ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dis[N] ;</span><br><span class="line"><span class="keyword">int</span> pre[N] ;</span><br><span class="line"><span class="keyword">int</span> prev[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; q ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">63</span>, <span class="keyword">sizeof</span>(dis)) ;</span><br><span class="line">    q.push(rt) ; vis[rt] = <span class="number">1</span> ; dis[rt] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span> (!q.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front() ;</span><br><span class="line">        q.pop() ; vis[x] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span> (dis[t.fr] &gt; dis[x] + t.sc)&#123;</span><br><span class="line">                dis[t.fr] = dis[x] + t.sc ;</span><br><span class="line">                pre[t.fr] = x, prev[t.fr] = t.sc ;</span><br><span class="line">                <span class="keyword">if</span> (!vis[t.fr])</span><br><span class="line">                    q.push(t.fr), vis[t.fr] = <span class="number">1</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[i].clear() ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span> ;</span><br><span class="line"><span class="comment">//printf("%d\n", x) ;</span></span><br><span class="line"><span class="keyword">if</span> (x == rt) val[x] = I ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x])&#123;</span><br><span class="line">        val[y.fr] = min(val[x], y.sc) ;</span><br><span class="line">        solve(y.fr) ; res += f[y.fr] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (col[x]) res = I ;</span><br><span class="line">    f[x] = min(res, val[x]) ;</span><br><span class="line"><span class="comment">//printf("#%d %d %d\n", x, val[x], f[x]) ;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    n = qr(), m = qr() ;</span><br><span class="line">rt = qr(), Q = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        x = qr(), y = qr(), z = qr(),</span><br><span class="line">        E[x].p_b(m_k(y, z)), E[y].p_b(m_k(x, z)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    spfa() ; val[rt] = val[<span class="number">0</span>] = I ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (pre[i]) E[pre[i]].p_b(m_k(i, prev[i])) ;</span><br><span class="line">    dep[rt] = <span class="number">1</span>, dfs1(rt), dfs2(rt, rt) ;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= n ; ++ i) printf("%d %d\n", i, prev[i]) ;</span></span><br><span class="line">    <span class="keyword">while</span> (Q --)&#123;</span><br><span class="line">        z = qr() ; k = qr() ;</span><br><span class="line">        <span class="keyword">if</span> (!z)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i) col[qr()] ^= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            a.clear() ; col[rt] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i) a.p_b(y = qr()), g[y] = <span class="number">1</span> ;</span><br><span class="line">            ins() ; solve(<span class="number">0</span>) ; <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f[<span class="number">0</span>] ? f[<span class="number">0</span>] : <span class="number">-1</span>) ; clear(<span class="number">0</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="BOI-2017-Railway"><a href="#BOI-2017-Railway" class="headerlink" title="[BOI 2017] Railway"></a>[BOI 2017] Railway</h2><blockquote><p>给出一棵 $n$ 个节点的树。有 $m$ 次染色操作，每次操作给出一些点，把覆盖他们的最小连通块内的边染上颜色。求被染色次数不小于 $k$ 的边数。</p></blockquote><p>大概是考察了虚树的一个性质，就是虚树一定可以使得关键点之间的路径长度以最短的方式连边(这似乎应该是树的性质)。然后就是求一遍虚树然后差分一下就好了。</p><p>一个小彩蛋，一开始尝试对 dfn 排序直接对临点取 LCA 打 tag 发现并不对 x，我可能是智障了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">do_tag</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">//  printf("%d %d\n", x, y) ;</span></span><br><span class="line">    tag[x] ++, tag[y] -- ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dfn[x] &lt; dfn[y] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">//  printf("%d\n", x) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (x) </span><br><span class="line">do_tag(y, x) ;</span><br><span class="line">        dfs(y) ;</span><br><span class="line">    &#125;</span><br><span class="line">    T[x].clear() ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y.fr == fa[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        solve(y.fr) ; tag[x] += tag[y.fr] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag[x] &gt;= k) ans[++ tot] = x ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="SDOI-2015-寻宝游戏"><a href="#SDOI-2015-寻宝游戏" class="headerlink" title="[SDOI 2015] 寻宝游戏"></a>[SDOI 2015] 寻宝游戏</h2><blockquote><p>没找到简化题面，咕了咕了。</p></blockquote><p>这似乎跟虚树没啥关系，又似乎有啥关系。本质上是要求在关键点变化时维护虚树的权和，那么发现可以直接拿个 set 维护 dfn。有点小小的细节。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> &lt;<span class="keyword">int</span>&gt; s ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> virtual_tree ;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">calc</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!y) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    x = Id[x] ; y = Id[y] ;</span><br><span class="line">    <span class="keyword">return</span> val[x] + val[y] - (val[lca(x, y)] &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z, p, q ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">        x = qr(), y = qr(), z = qr() ;</span><br><span class="line">        E[y].p_b(mk(x, z)), E[x].p_b(mk(y, z)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs1(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">    dfs2(<span class="number">1</span>, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">while</span> (m --)&#123;</span><br><span class="line">        x = qr() ; </span><br><span class="line">y = dfn[x] ;</span><br><span class="line">        <span class="keyword">if</span> (vis[x])</span><br><span class="line">             s.erase(y) ;</span><br><span class="line">        <span class="keyword">else</span> s.insert(y) ;</span><br><span class="line">        <span class="keyword">auto</span> f = s.lower_bound(y) ;</span><br><span class="line">        <span class="keyword">auto</span> g = s.upper_bound(y) ;</span><br><span class="line">        q = *(g == s.end() ? s.begin() : g) ;</span><br><span class="line">        p = *(f == s.begin() ? -- s.end() : -- f) ;</span><br><span class="line"><span class="comment">//        printf("%d %d\n", p, q) ;</span></span><br><span class="line">        <span class="keyword">if</span> (vis[x])&#123;</span><br><span class="line">            vis[x] = <span class="number">0</span> ;</span><br><span class="line">            ans -= calc(y, p) + calc(y, q) - calc(p, q) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            vis[x] = <span class="number">1</span> ;</span><br><span class="line">            ans += calc(y, p) + calc(y, q) - calc(p, q) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="HEOI2014-大工程"><a href="#HEOI2014-大工程" class="headerlink" title="[HEOI2014] 大工程"></a>[HEOI2014] 大工程</h2><blockquote><p>国家有一个大工程，要给一个非常大的交通网络里建一些新的通道。</p><p>我们这个国家位置非常特殊，可以看成是一个单位边权的树，城市位于顶点上。</p><p>在 2 个国家 a,b 之间建一条新通道需要的代价为树上 a,b 的最短路径。</p><p>现在国家有很多个计划，每个计划都是这样，我们选中了 k 个点，然后在它们两两之间 新建 C(k,2)条 新通道。现在对于每个计划，我们想知道： 1.这些新通道的代价和  2.这些新通道中代价最小的是多少 3.这些新通道中代价最大的是多少。</p></blockquote><p>不难发现只要预处理了虚树上点之间的边权和就比较简单了。考虑第一问就只需要算每条边的贡献，第三问就只需要维护一个最大值一个次大值就好了。然后第二问挂了好几次，因为一开始觉得这个只要取 dfs 序相邻的点就一定最优…然后就人没了。大概最小值就需要维护一个最近的纯虚点到自己的距离，然后根据纯虚和半虚分类讨论一波就好了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dis</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!b) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">       <span class="keyword">return</span> dep[a] + dep[b] - (dep[lca(a, b)] &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">       T[y].p_b(m_k(x, dis(x, y))) ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x]) clear(y.fr) ;</span><br><span class="line">       T[x].clear() ; f[x] = g[x] = h[x] = <span class="number">0</span> ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">()</span></span>&#123;</span><br><span class="line">       sort(a.begin(), a.end(), [](<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123; <span class="keyword">return</span> dfn[x] &lt; dfn[y] ; &#125;) ;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> x : a)&#123;</span><br><span class="line">           <span class="keyword">int</span> z = lca(x, stk[tp]) ;</span><br><span class="line">           <span class="keyword">if</span> (z != stk[tp])&#123;</span><br><span class="line">               <span class="keyword">while</span> (tp &amp;&amp; dep[stk[tp - <span class="number">1</span>]] &gt;= dep[z])</span><br><span class="line">                   add_e(stk[tp], stk[tp - <span class="number">1</span>]), -- tp ;</span><br><span class="line">               <span class="keyword">if</span> (stk[tp] != z) add_e(stk[tp], z), stk[tp] = z ;</span><br><span class="line">           &#125;</span><br><span class="line">           stk[++ tp] = x ;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span> (tp)</span><br><span class="line">           add_e(stk[tp], stk[tp - <span class="number">1</span>]), -- tp ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">dopre</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> mk = g[x], z ; </span><br><span class="line">       <span class="keyword">int</span> y, v = I, res = <span class="number">0</span> ;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> t : T[x])&#123;</span><br><span class="line">           y = t.fr ; </span><br><span class="line">dopre(y) ; </span><br><span class="line">g[x] += g[y] ;</span><br><span class="line">z = dis(x, h[y]) ;</span><br><span class="line">ans3 = min(ans3, v + z) ; </span><br><span class="line"><span class="keyword">if</span> (z &lt; v) </span><br><span class="line">v = z, h[x] = h[y] ; </span><br><span class="line">           ans2 = max(ans2, f[y] + t.sc + res) ;</span><br><span class="line">           res = max(res, f[y] + t.sc) ;</span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">if</span> (mk)</span><br><span class="line">ans3 = min(ans3, v), h[x] = x ; </span><br><span class="line">       f[x] = res ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> y ;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> t : T[x])&#123;</span><br><span class="line">           y = t.fr ; solve(y) ;</span><br><span class="line">           ans1 += <span class="number">1l</span>l * t.sc * (sum - g[y]) * g[y] ;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="CF613D-Kingdom-and-its-Cities"><a href="#CF613D-Kingdom-and-its-Cities" class="headerlink" title="CF613D Kingdom and its Cities"></a>CF613D Kingdom and its Cities</h2><blockquote><p>一个王国有 n 座城市，城市之间由 n-1条道路相连，形成一个树结构，国王决定将一些城市设为重要城市。</p><p>这个国家有的时候会遭受外敌入侵，重要城市由于加强了防护，一定不会被占领。而非重要城市一旦被占领，这座城市就不能通行。</p><p>国王定了若干选择重要城市的计划，他想知道，对于每个计划，外敌至少要占领多少个非重要城市，才会导致重要城市之间两两不连通。如果外敌无论如何都不可能导致这种局面，输出 -1。</p></blockquote><p>惨遭降智.png</p><p>感觉这题细节推起来有点烦人，主要考察了细心讨论的能力。直接放代码吧。唯一需要注意的地方就是如果子树内只有一个关键点，可以选择暂时不割，留到以后。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> re = <span class="number">0</span> ;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> y : T[x])&#123;</span><br><span class="line">           solve(y) ;</span><br><span class="line">           re += g[y], f[x] += f[y] ;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (vis[x])</span><br><span class="line">           f[x] += re, g[x] = <span class="number">1</span> ;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (re &gt; <span class="number">1</span>) f[x] ++ ;</span><br><span class="line">       <span class="keyword">else</span> <span class="keyword">if</span> (re == <span class="number">1</span>) g[x] = <span class="number">1</span> ;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;捣鼓了捣鼓虚树，发现原来难点在DP &lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==&quot; data-original=&quot;https://cdn.jsdelivr.net/gh/xaoxuu/volantis@1.0.6/img/qq/抓狂.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;发现了网上一个 QQ 表情的 CDN，感觉很可爱w。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="动态规划/有技巧的DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="动态规划/树形DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="虚树" scheme="https://www.orchidany.cn/tags/%E8%99%9A%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.8 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/09/6-8-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/09/6-8-训练笔记/</id>
    <published>2020-06-09T00:19:27.000Z</published>
    <updated>2020-06-09T03:50:26.108Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>今天因为补 CF 就又只打了一场。咕咕咕。</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>比较传统的一道简单题。但是俩 log 被卡了= =</p><p>大概就是说考虑最大值最小，可能可以想到要去二分答案。然后考虑判定，考虑一个权值 $v$ 合法，当且仅当可以选出一个长度 $\geqslant k$ 的子序列使之和 $\leq v$ 。这个可以用 ds 维护，也可以直接贪。</p><p>感觉个人比较看不透这个贪心，换句话说你要让我写我肯定写不出来，有点反直觉。具体来说就是考虑每次将一个元素 <code>push</code> 到一个栈里，然后如果当前元素与栈顶元素之和 $\gt v$ 就不把当前元素入栈，否则如果当前元素 $\lt$ 栈顶元素就先弹栈再入栈。最后判一下头尾就好了。</p><p>感觉这么贪心的道理在于， 最后一个元素要么是序列末尾的元素，要么就是后缀中最小的那个。所以判头尾才不会锅。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: max ;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: min ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2000000001</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> mxv, mnv ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    tmp[cnt = <span class="number">1</span>] = base[<span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1l</span>l * tmp[cnt] + base[i] &lt;= x) tmp[++ cnt] = base[i] ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (tmp[cnt] &gt; base[i]) tmp[cnt] = base[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cnt &gt; k) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (cnt == k &amp;&amp; <span class="number">1l</span>l * tmp[<span class="number">1</span>] + tmp[cnt] &lt;= x) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;k) ;</span><br><span class="line">    <span class="keyword">int</span> l, r, mid ; mnv = M ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">        mnv = min(mnv, base[i]) ;</span><br><span class="line">        mxv = max(mxv, base[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    l = mnv &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">r = mxv &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line"><span class="comment">//        printf("%d %d\n", l, r) ;</span></span><br><span class="line">        mid = (<span class="number">1l</span>l * l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (check(mid))</span><br><span class="line">             ans = mid, r = mid - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p></blockquote><p>挺有意思的一道结论题…主要是(标算的)思考过程挺妙<del>，不过猜完就走人了谁还证啊。</del></p><p>大概是考虑从二分答案出发。把 $\geqslant v$ 的所有位置置为 $1$，其余位置置为 $0$ 。那么答案 $v$ 合法<strong>当且仅当存在一行的所有数都为 $1$</strong>。首先充分性不难知道，小 D 只要忽略这一行，每次删其他的，这样小 Y 由于每次只能删一列，所以最后必然是小 D 获胜。</p><p>必要性考虑归纳。$n=1$ 不难知道，然后考虑 $n=k\to n=k+1$ 。发现此时剩下了 $k$ 行 $k+1$ 列，轮到小 Y 操作，那么考虑每一行从左往右第一个 $0$，由鸽笼原理可知，必定存在一列不包含这些 $0$ 中的任意一个。所以剩下的局面就可以归纳到 $n=k$ 里面。证毕。</p><p>观察这个过程，发现其实不需要二分，每一行中最小的数，所有行中的最大值即为答案。扫一遍就完了。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><p>这题对我这种数位 DP 萌新很不友好…</p><p>一开始想了个暴力求 <code>count_of_1</code> 的东西，发现并不是这么算的…即发现改变的位置是 $r$ 二进制下 $1$ 的位数和 $l-1$ 二进制下 $1$ 的和，但是要减去那些改了两遍的，经过冷静找性质可以发现，这部分就是两者从高位到低位的最长公共前缀里面 $1$ 的数量乘二。</p><p>然后就考虑分别对这两个进行数位 $dp$ 。发现对于 $r\geq l$ 的限制完全可以去掉，因为容斥的时候会被直接容斥掉。那么总方案数就可以直接乘一个系数 $n$，就只需要计算「$1\sim n$ 之间所有数的二进制下 $1$ 的个数」 和 「$1\sim n$ 内所有的数对 $(l,r)$ 的 <code>count_of_1(</code>LCP<code>)</code> 」。</p><p>设  $g_{i,j,0/1}$ 表示从高到低考虑了前 $i$ 位，有 $j$ 个 $1$ ， $r$ 是否等于 $n$ 的方案数。转移时需要考虑分类讨论 $n$ 的当前位是否为 $1$ ，具体转移大概就是判断一下转移前后 $r$ 是否依旧 $=n$ 之类的。同时设 $f_{i,j,0/1,0/1}$ 表示考虑前 $i$ 位，最大公共前缀中 $1$ 的个数为 $j$，$l=r?,r=n?$ 的方案数。然后转移依旧是根据边界分类讨论当前位放 $1$ 还是 $0$，注意到由于加上了 $l,r$ 的限制，所以要分类讨论 $l,r$ 分别放不放，所以会有个系数。</p><p>然后最后答案就是</p><script type="math/tex; mode=display">ans=\left(n\times \sum g\right)-\sum f</script><p>复杂度 $O(T\log n^2)$。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line">ll n, m ;</span><br><span class="line">ll ans1 ;</span><br><span class="line">ll ans2 ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> g[N][N][<span class="number">2</span>] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N][<span class="number">2</span>][<span class="number">2</span>] ; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        ans1 = ans2 = <span class="number">0</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span>(g)) ;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n ; m = n ; cnt = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (m) base[++ cnt] = m &amp; <span class="number">1</span>, m &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        reverse(base + <span class="number">1</span>, base + cnt + <span class="number">1</span>) ;</span><br><span class="line">        g[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>, f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i + <span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">1</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i + <span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">4l</span>l * f[i][j][<span class="number">0</span>][<span class="number">0</span>] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">4l</span>l * f[i][j][<span class="number">0</span>][<span class="number">0</span>] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            add(ans1, <span class="number">1l</span>l * i * addn(g[cnt][i][<span class="number">1</span>], g[cnt][i][<span class="number">0</span>]) % P) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            add(ans2, <span class="number">1l</span>l * i * addn(f[cnt][i][<span class="number">0</span>][<span class="number">1</span>], f[cnt][i][<span class="number">0</span>][<span class="number">0</span>]) % P) ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; decn(<span class="number">1l</span>l * ans1 * (n % P) % P, <span class="number">2l</span>l * ans2 % P) &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="2.png" alt=""></p><p>$1\leq n\leq 100$ 。</p><p>$1\leq X\leq 10^6$ 。</p></blockquote><p>发现变量有俩，楼的高度和楼之间的距离。发现限制之间是有关系的，于是考虑定住一个，比如楼的高度。考虑设两栋楼之间的距离是 $x_i$ ，那么要满足 $x_i\geqslant \max\{h_i,h_{i-1}\}$ 。设 </p><script type="math/tex; mode=display">s=\sum _{i=2}^n\max\{h_i,h_{i-1}\}</script><p>那么可知方案数就是</p><script type="math/tex; mode=display">\binom{X-1-s+n}{n}</script><p>这就是一个 $n+1$ 元一次不定方程组的问题。这个地方涉及到一个技巧。就是考虑首先值域是 $[1,X]$ ，所以取值有 $X-1$ 个。其次由于要求总和 $\leqslant X$，那么可以考虑多设出一个变量用来保存余出去的 $X-s$，所以就是 $n+1$ 个元素。</p><p>然后就是考虑对 $s$ 进行 dp。具体的，设 $f_{i,j,k}$ 表示现在考虑了 $1\sim i$ 的排列，还有 $j$ 个位置没有闭合，即还有 $j$ 个位置可能还会插入更大的数，当前 $s$ 值为 $k$ 的方案数。然后考虑每次相当于选一个位置插入一个 $i$ ，此时会产生两个新的空位，然后分类讨论一波闭合不闭合就好了。注意到如果插入开头或者结尾，那么就只会产生 $1$ 个空位，特判一下这个边界就好了。最后复杂度 $O(n^4+X)$ 。 </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> inv[N] ;</span><br><span class="line"><span class="keyword">int</span> fac[N] ;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">2</span>][M][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (b)&#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ret = (ll)ret * a % P ;</span><br><span class="line">        a = (ll)a * a % P ; b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="comment">//\binom&#123;x&#125;&#123;y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> (ll)fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prework</span><span class="params">(<span class="keyword">int</span> mx)</span></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">0</span>] = <span class="number">1</span> ; ans = res = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mx + <span class="number">1</span> ; ++ i)</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[mx + <span class="number">1</span>] = expow(fac[mx + <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mx ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i] = <span class="number">1l</span>l * inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; P ; <span class="keyword">int</span> t ;</span><br><span class="line">    prework(m) ; f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, d = <span class="number">0</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">t = i * i ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k) f[d ^ <span class="number">1</span>][j][k] = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line"><span class="keyword">if</span> (j)&#123;</span><br><span class="line"><span class="keyword">int</span> p = j + <span class="number">1</span>, q = j + <span class="number">2</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k)&#123;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j - <span class="number">1</span>][k + (i + <span class="number">1</span>) * <span class="number">2</span>], <span class="number">1l</span>l * j * f[d][j][k] % P) ;</span><br><span class="line">               add(f[d ^ <span class="number">1</span>][j][k + i + <span class="number">1</span>], <span class="number">2l</span>l * p * f[d][j][k] % P) ;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j + <span class="number">1</span>][k], <span class="number">1l</span>l * q * f[d][j][k] % P) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> p = j + <span class="number">1</span>, q = j + <span class="number">2</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k)&#123;</span><br><span class="line">               add(f[d ^ <span class="number">1</span>][j][k + i + <span class="number">1</span>], <span class="number">2l</span>l * p * f[d][j][k] % P) ;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j + <span class="number">1</span>][k], <span class="number">1l</span>l * q * f[d][j][k] % P) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">        d ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        add(ans, <span class="number">1l</span>l * f[!(n &amp; <span class="number">1</span>)][<span class="number">0</span>][i] * binom(m - i + n - <span class="number">1</span>, n) % P) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天因为补 CF 就又只打了一场。咕咕咕。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="组合计数/有技巧的计数" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="动态规划/有技巧的DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="数学/观察性质,结论与构造" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="贪心" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="有趣的二分答案" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="动态规划/数位DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%95%B0%E4%BD%8DDP/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.5 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/09/6-5-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/09/6-5-训练笔记/</id>
    <published>2020-06-09T00:19:13.000Z</published>
    <updated>2020-06-14T12:28:48.653Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>啦啦啦啦</p><a id="more"></a><h1 id="A-M"><a href="#A-M" class="headerlink" title="A.M."></a>A.M.</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><p>简单题。</p><p>大概是说如果连上了两条边，那么这条边连接的两个点就可以直接合并起来。考虑为了保证复杂度，需要进行启发式合并。于是就可以拿一个 <code>set</code> 维护，但这样会多一个 log。考虑直接拿 <code>vector</code> 维护，对每个点设一个 <code>vis</code> 就不需要删除了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, q ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; s[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fa[x] == x) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void merge(int x, int y)&#123;</span></span><br><span class="line"><span class="comment">    int f1 = find(x) ;</span></span><br><span class="line"><span class="comment">    int f2 = find(y) ;</span></span><br><span class="line"><span class="comment">    if (f1 != f2)</span></span><br><span class="line"><span class="comment">        fa[f1] = f2 ;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; q ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) fa[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        x = qr(), y = qr(), s[x].p_b(y), s[y].p_b(x) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        x = find(qr()) ;</span><br><span class="line">y = find(qr()) ;</span><br><span class="line">        <span class="keyword">if</span> (x == y)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">            <span class="keyword">continue</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> z : s[x])</span><br><span class="line"><span class="keyword">if</span> (z == y) <span class="keyword">goto</span> fuck ;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (s[x].size() &gt; s[y].size())</span><br><span class="line">            swap(x, y) ; fa[x] = y ; vis[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> z : s[x])</span><br><span class="line">            <span class="keyword">if</span> (!vis[z]) s[z].p_b(y), s[y].p_b(z) ;</span><br><span class="line">      <span class="keyword">continue</span> ;</span><br><span class="line">        fuck : <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><p>简单题。</p><p>考虑一个性质，大概就是说剩下没有连起来的弦，不相交一定是最优的。于是就可以直接 dp 了。设 $f_{i,j}$ 表示考虑 $[i,j]$ 之间还没连的点，最小代价是多少。转移就考虑枚举一个 $[i,j]$ 之间和 $i$ 相连的点即可。注意到这样就需要 $[i,j]$ 里没有配对的点为偶数。</p><p>然后考虑方案数 $g_{i,j}$，就只需要在维护 $f_{i,j}$ 时顺便计数一下就好了。复杂度 $O(n^3)$ 。</p><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>比较神奇的题目…</p><blockquote><p>给定一个插入序列。编号为 $i$ 的元素有一个颜色 $col_i$ 和一个阈值 $a_i$。插入 $i$ 的时候，$i$ 应当放到满足以下条件的最靠前的位置 $p$：</p><p>1、当前位于 $p$ 或者 $p+1$ 的元素颜色与 $col_i$ 相同。</p><p>2、不能有超过 $a_i$ 个元素因此而后移。</p><p>求最终插入全部元素后每个位置的元素编号。$1\leq n\leq 3\times 10^5$ 。</p></blockquote><p>那必然是先莽一个 $50pts$ 的 <code>vector</code> 暴力<del>然后就 250 滚粗了</del> 。</p><p>大概是考虑如果知道了每个元素在当时插入完毕后在第几位，即 $rank_i$ ，就可以直接线段树二分出最后实际的 rank。具体的，考虑把数从后往前插入线段树，这样每次就需要从线段树中二分出第一个位置 $p$ 使得 $p-sum_p=rank_i$ ，其中 $sum_p$ 是前缀和。不难知道这样做是对的。</p><p>之后考虑怎么求出 $rank_i$ 。这个地方有个十分深刻的性质，大概是说考虑如果有多个相邻颜色的元素放在相邻的位置，那么我们并不关心靠后的那些元素，可以直接合并，因为边界比较好处理，并且这样转化之后就只会出现在后面插入新的元素，可以直接 <code>push_back</code>。那么现在如果要插入一个元素，那么可以先找到这个元素不考虑颜色时最少应该放在的位置 $p$，然后去对应颜色的 <code>vector</code> 里二分即可。这样每次插入就可以换成在线段树上进行单点加。注意可能存在一个颜色的连续段跨过 $p$ 的情况，判一下边界就好了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chkmax</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span></span>&#123; x = y &gt; x ? y : x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line">vint col[N] ;</span><br><span class="line"><span class="keyword">int</span> org_rk[N] ;</span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _ed end</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _bg begin</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(seg[rt] += v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) upd(lc, l, mid, p, v) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rc, mid + <span class="number">1</span>, r, p, v) ;</span><br><span class="line">    seg[rt] = seg[lc] + seg[rc] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> l ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (seg[lc] &gt;= p) <span class="keyword">return</span> fd(lc, l, mid, p) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> fd(rc, mid + <span class="number">1</span>, r, p - seg[lc]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> seg[rt] ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) <span class="keyword">return</span> qry(lc, l, mid, p) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> seg[lc] + qry(rc, mid + <span class="number">1</span>, r, p) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n) ;</span><br><span class="line">    <span class="keyword">int</span> x, y, z, o, p, q ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        qr(x), qr(y) ; </span><br><span class="line">z = fd(<span class="number">1</span>, <span class="number">0</span>, n, i - y - <span class="number">1</span>) ;</span><br><span class="line">        o = lower_bound(col[x]._bg(), col[x]._ed(), z) - col[x]._bg() ;</span><br><span class="line">        <span class="keyword">if</span> (o == col[x].size()) col[x].p_b(++ m) ; o = col[x][o] ;</span><br><span class="line">        org_rk[i] = qry(<span class="number">1</span>, <span class="number">0</span>, n, o - <span class="number">1</span>) + <span class="number">1</span> ;</span><br><span class="line">        chkmax(org_rk[i], i - y) ;</span><br><span class="line">        upd(<span class="number">1</span>, <span class="number">0</span>, n, o, <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n * <span class="number">3</span> ; ++ i) seg[i] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) upd(<span class="number">1</span>, <span class="number">1</span>, n, i, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        p = fd(<span class="number">1</span>, <span class="number">1</span>, n, org_rk[i]) ;</span><br><span class="line">        ans[p] = i ; upd(<span class="number">1</span>, <span class="number">1</span>, n, p, <span class="number">-1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">qwa(ans + <span class="number">1</span>, n, <span class="string">' '</span>, <span class="string">'\n'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>233</p><h1 id="P-M"><a href="#P-M" class="headerlink" title="P.M."></a>P.M.</h1><p>下午的题比较水…</p><h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p></blockquote><p>简单题。</p><p>一开始的想法就是把棋盘转个 $45°$ 可能会比较好做。后来发现完全可以直接记一下对角线的编号。之后就考虑先算副对角线，然后算主对角线。这样的话，算主对角线时就需要对与所有副对角线的交点的贡献进行容斥，但是发现和一条主对角线的副对角线编号是连续的，就比较好算。</p><p>细节在于，要考虑编号奇偶性，因为经过 $(1,2),(2,1)$ 的对角线和经过 $(1,1),(2,2)$ 的对角线虽然相交，但是交点不是整点。然后对奇偶编号分别拿个桶维护就好了。复杂度 $O(n+m)$ 。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &gt; <span class="number">0</span> ? x : -x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n), qr(m) ; <span class="keyword">int</span> z = <span class="number">3</span> * n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        qr(base[i].fr), qr(base[i].sc) ;</span><br><span class="line">        vis0[base[i].fr + base[i].sc - <span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        vis1[n - base[i].sc + base[i].fr] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">        ans += vis0[i] * (n - <span class="built_in">abs</span>(n - i)) ;</span><br><span class="line">        buc1[i] = buc1[i - <span class="number">1</span>] + (i &amp; <span class="number">1</span>) * vis0[i] ;</span><br><span class="line">        buc0[i] = buc0[i - <span class="number">1</span>] + (!(i &amp; <span class="number">1</span>)) * vis0[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">            ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">             ans -= buc1[i + n - <span class="number">1</span>] - buc1[n - i] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[i + n - <span class="number">1</span>] - buc0[n - i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">             ans -= buc1[z - i - <span class="number">1</span>] - buc1[i - n] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[z - i - <span class="number">1</span>] - buc0[i - n] ;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (!(i &amp; <span class="number">1</span>))</span><br><span class="line">             ans -= buc1[i + n - <span class="number">1</span>] - buc1[n - i] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[i + n - <span class="number">1</span>] - buc0[n - i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (!(i &amp; <span class="number">1</span>))</span><br><span class="line">             ans -= buc1[z - i - <span class="number">1</span>] - buc1[i - n] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[z - i - <span class="number">1</span>] - buc0[i - n] ;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    qw(ans, <span class="string">'\n'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><p>比较简单的分类讨论题。</p><p>一开始读错题了，以为每个点的编号都必须是 $1\sim n$ …后来发现只要 $\lt 10^6$ 就好了。然后如果是 $\lt n$ 也不是没有办法，只是只能做小一点，大概就是考虑显然只需要管那些 $\deg_x$ 是奇数的 $x$ ，然后相当于从这些里面选择恰好 $k$ 个可以改变编号的元素使之异或和等于一个定值 $c$ 。这显然是可以 $n^3$ dp 的。</p><p>然后考虑正常版本，$\lt 10^6$ 的。考虑这样的话权值一定程度上就可以 xjb 找。具体的，把可以修改权值并且度数不为偶数的节点称作 pks 点，那么分类讨论一下 pks 点的数量(0/1/2/2+)，特判一些不合法的情况就好了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> col[N] ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> able[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">out_put</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Yes"</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        qw(ans[i], <span class="string">' '</span>) ; <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    qr(n) ; res = n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        qr(col[i]), ans[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">        qr(x), qr(y), res ^= x ^ y ;</span><br><span class="line">        deg[x] ^= <span class="number">1</span>, deg[y] ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!res) <span class="keyword">return</span> out_put() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (col[i] &amp;&amp; deg[i]) able[++ cnt] = i ;</span><br><span class="line">    <span class="keyword">if</span> (!cnt) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (cnt &lt;= <span class="number">1</span>)&#123;</span><br><span class="line">        x = able[<span class="number">1</span>] ;</span><br><span class="line">        y = res ^ x ; ans[x] = y ;</span><br><span class="line">        <span class="keyword">if</span> (y &lt;= n)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!col[y])</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">            ans[y] = MAXV ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out_put() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        z = <span class="number">0</span> ;</span><br><span class="line">        x = able[++ z] ;</span><br><span class="line">        y = able[++ z] ;</span><br><span class="line">        <span class="keyword">if</span> (res == (x ^ y))&#123;</span><br><span class="line">            <span class="keyword">if</span> (z == cnt)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">else</span> y = able[++ z] ;</span><br><span class="line">        &#125;</span><br><span class="line">        z = x ^ y ^ res ;</span><br><span class="line">        ans[x] = MAXV ; ans[y] = MAXV ^ z ;</span><br><span class="line">        <span class="keyword">return</span> out_put() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><blockquote><p>给定一个序列，支持如下两个操作：</p><p>1、单点修改。</p><p>2、给出一个 $x_i$ 。全局查询有多少个极长的连续段，满足连续段内的数都 $\geqslant x_i$ </p><p>$5\times 10^5$  。</p></blockquote><p>感觉是比较经典的思路。考虑连续段可以看做连通块，更进一步是一棵树，那么就会有 $s$ 个点和 $s-1$ 条边。于是考虑所有连通块里点的数量之和减去边的数量之和就是连通块个数，接下来就可以分别维护「有多少个 $a_i\geqslant x$ 」和有多少个「 $\min\{a_i,a_{i-1}\}\geqslant x$」。树状数组维护一波就好了。需要离散化。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lwb lower_bound</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> _b[N], v_max ;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> low(x) (x &amp; -x)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( ; p &lt;= v_max ; p += low(p)) _b[p] += v ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> ( ; p ; p -= low(p)) ret += _b[p] ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;_b1, _b2 ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> v[N] ;</span><br><span class="line"><span class="keyword">int</span> qm[N] ;</span><br><span class="line"><span class="keyword">int</span> qp[N] ;</span><br><span class="line"><span class="keyword">int</span> qv[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; q ; <span class="keyword">int</span> p ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        v[++ cnt] = base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        qm[i] = qr() ;</span><br><span class="line">        <span class="keyword">if</span> (qm[i] == <span class="number">1</span>) v[++ cnt] = qv[i] = qr() ;</span><br><span class="line">        <span class="keyword">else</span> qp[i] = qr(), v[++ cnt] = qv[i] = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>) ;</span><br><span class="line">    cnt = unique(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>) - (v + <span class="number">1</span>) ;</span><br><span class="line">    _b1.v_max = _b2.v_max = cnt ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        base[i] = lwb(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>, base[i]) - v ;</span><br><span class="line">        _b1.ins(base[i], <span class="number">1</span>) ; <span class="keyword">if</span> (i &gt; <span class="number">1</span>) _b2.ins(min(base[i], base[i - <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(base, 1, n) ;</span></span><br><span class="line"><span class="comment">//    debug(_b1.qry(_b1.v_max)) ;</span></span><br><span class="line"><span class="comment">//    debug(_b2.qry(_b1.v_max)) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        qv[i] = lwb(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>, qv[i]) - v ;</span><br><span class="line"><span class="comment">//        debug(qv[i]) ;</span></span><br><span class="line">        <span class="keyword">if</span> (qm[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (n - _b1.qry(qv[i] - <span class="number">1</span>)) - (n - <span class="number">1</span> - _b2.qry(qv[i] - <span class="number">1</span>))) ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p = qp[i] ;</span><br><span class="line">            _b1.ins(qv[i], <span class="number">1</span>) ;</span><br><span class="line">            _b1.ins(base[p], <span class="number">-1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &lt; n) _b2.ins(min(qv[i], base[p + <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; <span class="number">1</span>) _b2.ins(min(qv[i], base[p - <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &lt; n) _b2.ins(min(base[p], base[p + <span class="number">1</span>]), <span class="number">-1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; <span class="number">1</span>) _b2.ins(min(base[p], base[p - <span class="number">1</span>]), <span class="number">-1</span>) ;</span><br><span class="line">            base[p] = qv[i] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下午完完全全就是在划水啊！？</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;啦啦啦啦&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="思维题/对应与转化" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
      <category term="动态规划/普通DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="数据结构/线段树" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>【题解】[CF Round#474(Combined) A~G] 题解</title>
    <link href="https://www.orchidany.cn/2020/06/08/CF-474-Combined/"/>
    <id>https://www.orchidany.cn/2020/06/08/CF-474-Combined/</id>
    <published>2020-06-08T12:59:49.000Z</published>
    <updated>2020-06-09T00:08:55.923Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>感觉这场的题目质量还是不错的？确实比以前 vp 过的几场 (Div1+Div2) 要好很多。</p><p>大概是把除了 H 之外一整场的题目都做掉了。有些不是十分必要写的题目当然就是口胡啦。</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>秒了。</p><p>人口普查题。</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p>有两个长度均为 $n$ 的序列 $a,b$，定义 ${\rm cost}(a,b)$ ：</p><script type="math/tex; mode=display">{\rm cost}(a,b)=\sum_{i=1}^{n}\left(a_{i}-b_{i}\right)^{2}</script><p>现在必须<strong>恰好</strong>对 $a$ 进行 $k_1$ 次操作，对 $b$ 进行 $k_2$ 次操作。操作内容是将某一项加一或者减一。求操作后的最小 $\rm cost$。</p><p>$1\leq n\leq 2000$。</p></blockquote><p>秒了。</p><p>降智贪心？不知道为什么就想了一会儿，发现 $n=2000$ 之后就秒掉了= = </p><p>大概是考虑分类讨论现在操作是让两个数列尽量靠近还是尽量远离。第一种情况每次操作前找到可以使 $\Delta$ 变小最多的，第二种找到让 $\Delta$ 变大最小的就可以了。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>皮卡丘和他排成一列。他在纸上写下了数组的所有非空子序列。同时他删除了所有的「子序列的最大元素-子序列的最小元素 $\geq d$」的子序列，最终剩下 $X$ 个子序列。现在给出 $X,d$ ，构造一个合法的原序列。</p><p>输出数组中的元素数不应大于 $10^4$，数值大小不应超过 $10^{18}$ 。保证 $1\leq X,d\leq 10^9$ 。</p></blockquote><p>秒了。</p><p>比较 naive 的一道构造题。大概就是考虑长度为 $n$ 的序列会产生 $2^n-1$ 个子序列，那么考虑直接对 $X$ 进行二进制拆分，之后就是一段 $1$ 一个 $d+1$ 的形式构造就完了。</p><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><blockquote><p>给出一颗无限层的满二叉树。 如果 $x$ 是根，孩子的值是 $2\times x$，右孩子的值是 $2\times x+1$ 。</p><p>现在有三种操作：</p><p>$(1,x,k)$ ：将 $x$ 所在层的所有节点整体向右循环地移动 $k$ 个单位。</p><p>$(2,x,k)$ ：将 $x$ 所在的层的所有节点<strong>及其子树</strong>向右循环地移动 k 个单位。</p><p>$(3,x)$ ：输出从 $x$ 到根的路径。</p><p>$1\leq x,k,\leq 10^{18}$ 。 </p></blockquote><p>比较麻烦的找性质+模拟题，但还是秒了。<del>但是由于各种细节实现上花了好久</del></p><p>一开始的想法就是，对操作 $(1)$ 的每一层打反向的标记，然后向上跳的时候遇到这一层反向跳一下，第二个操作打另一种正向的标记就好了。写了半天才写出来，这里说几个小细节：</p><p>1、两个操作的标记都打在当前层而不是上一层。但是两个标记释放的时刻不同。第二个标记每次要在跳之前下传当前层的，而第一个标记要在跳之后下传下一层的。原因是第一个标记是整体有效的，第二个标记是暂时有效的。</p><p>2、第一个标记在输出之后要清除。</p><p>3、注意到操作 $(1)$ 标记反向是因为跳的时候要走相对位移。但是如果一开始起点时存在标记，这个标记的作用应该是正向的。判一下即可。</p><p>4、<code>&lt;cmath&gt; log2()</code> 贼慢，甚至比手写的还要慢…</p><p>于是最后就做到了 <code>log_2</code> 外线性。迄今为止是 Codeforces 全站最快的代码。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line">ll buc1[<span class="number">70</span>] ;</span><br><span class="line">ll buc2[<span class="number">70</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">i_lg2</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">32</span>) m |= <span class="number">32</span>, n &gt;&gt;= <span class="number">32</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">16</span>) m |= <span class="number">16</span>, n &gt;&gt;= <span class="number">16</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">8</span>) m |= <span class="number">8</span>, n &gt;&gt;= <span class="number">8</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">4</span>) m |= <span class="number">4</span>, n &gt;&gt;= <span class="number">4</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">2</span>) m |= <span class="number">2</span>, n &gt;&gt;= <span class="number">2</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">1</span>) m |= <span class="number">1</span>, n &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span> m ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(T) ; <span class="keyword">int</span> p ;</span><br><span class="line">    ll x, y, z, s, t, yf ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        qr(x), qr(y) ;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">1</span>)</span><br><span class="line">            y = i_lg2(y), qr(z), buc1[y] -= z ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">2</span>)</span><br><span class="line">            y = i_lg2(y), qr(z), buc2[y] += z ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            qw(y, <span class="string">' '</span>) ;</span><br><span class="line">            p = i_lg2(y) ;</span><br><span class="line">            z = <span class="number">1l</span>l &lt;&lt; p ;</span><br><span class="line">            s = (z &lt;&lt; <span class="number">1</span>) - <span class="number">1</span> ;</span><br><span class="line">            t = - buc1[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">            x = y + t ;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                x = (x &amp; s) + z ;</span><br><span class="line">            y = x ;</span><br><span class="line">            <span class="keyword">while</span> (p &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                s = (z &lt;&lt; <span class="number">1</span>) - <span class="number">1</span> ;</span><br><span class="line">t = buc2[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                    t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                x = y + t ;</span><br><span class="line">                <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                    x = (x &amp; s) + z ;</span><br><span class="line">                y = x ;</span><br><span class="line">                </span><br><span class="line">                -- p ;</span><br><span class="line">                s = z - <span class="number">1</span> ;</span><br><span class="line">                z = z &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                y = y &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                t = buc1[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                    t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                x = y + t ;</span><br><span class="line">                <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                    x = (x &amp; s) + z ;</span><br><span class="line">                yf = y ; y = x ;</span><br><span class="line">                qw(y, <span class="string">' '</span>), y = yf ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><blockquote><p>给定一棵带点权的树，求所有有向路径的权值和。</p><p>一条有向路径的权值如下定义： </p><p>设这条路径依次经过的点的权值分别为 $a_1, a_2, …, a_k$。</p><p>则路径的权值为 $a_1\times (-1)^2+a_2\times (-1)^3+…+a_n\times (-1)^{(n+1)}$。</p><p>答案对 $10^9+7$ 取模。</p></blockquote><p>秒了。<del>指想出来但写了一年</del></p><p>然后一眼就是点分…不过好像比较麻烦的样子。</p><p>或者考虑直接树形 $dp$ 。就只需要统计出每个点在多少条路径上是奇数位置，多少条路径上是偶数位置。这个可以用比较 trivial 的 up_and_down 技巧来做。具体的，考虑对于奇偶位置分别维护三个信息，$f,g,h$ 分别表示「起点在子树外、终点在子树内」、「起点在子树内，终点在子树外」、「起点在子树内，终点在子树内」三种信息，其中第三种依赖于第二种，第一种需要第二种进行 up_and_down 。这样就可以结合子树 $size$ 直接算出贡献来了。</p><p>有小细节需要注意。就是 $f_x,g_x$ 在处理奇数的时候需要判一下 $x$ 的边界。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span> :: <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; vint ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1000000007</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line">ll f[N][<span class="number">3</span>] ;</span><br><span class="line">ll g[N][<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> size[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">dec</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x -= y ; x = x &lt; <span class="number">0</span> ? x + mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    f[x][<span class="number">0</span>] = size[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        dfs(y, x) ; size[x] += size[y] ;</span><br><span class="line">        f[x][<span class="number">0</span>] += g[y][<span class="number">0</span>] ; g[x][<span class="number">0</span>] += f[y][<span class="number">0</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        add(f[x][<span class="number">2</span>], (size[x] - size[y] - <span class="number">1</span>) * g[y][<span class="number">0</span>] % P) ;</span><br><span class="line">        add(g[x][<span class="number">2</span>], (size[x] - size[y] - <span class="number">1</span>) * f[y][<span class="number">0</span>] % P) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        f[y][<span class="number">1</span>] = g[x][<span class="number">1</span>] ;</span><br><span class="line">        g[y][<span class="number">1</span>] = f[x][<span class="number">1</span>] ;</span><br><span class="line">        f[y][<span class="number">1</span>] += (g[x][<span class="number">0</span>] - f[y][<span class="number">0</span>]) ;</span><br><span class="line">        g[y][<span class="number">1</span>] += (f[x][<span class="number">0</span>] - g[y][<span class="number">0</span>]) ;</span><br><span class="line">        dfs2(y, x) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span> ; x &lt;= n ; ++ x)&#123;</span><br><span class="line">        add(ans, f[x][<span class="number">2</span>] * base[x] % P) ;</span><br><span class="line">        dec(ans, g[x][<span class="number">2</span>] * base[x] % P) ;</span><br><span class="line">        dec(ans, base[x]) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        add(ans, (f[x][<span class="number">1</span>] + <span class="number">1</span>) * size[x] % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        add(ans, f[x][<span class="number">0</span>] * (n - size[x] + <span class="number">1</span>) % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        dec(ans, g[x][<span class="number">1</span>] * size[x] % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        dec(ans, g[x][<span class="number">0</span>] * (n - size[x] + <span class="number">1</span>) % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ; puts("-----------") ;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>) ; dfs2(<span class="number">1</span>, <span class="number">0</span>) ; solve() ; <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans % P) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="F"><a href="#F" class="headerlink" title="F"></a>F</h1><blockquote><p>给定 $n$ 个点 $m$ 条边的有向图，可能不连通，可能有重边，也可能会有自环。求最长的路径(可以经过重复节点)，使得这条路径的编号和权值都<strong>严格</strong>单调递增，其中编号指输入的顺序。</p><p>$1\leq n,m\leq 10^5$ 。</p></blockquote><p>比较巧的一道题。考虑这题本质其实是一个有向图上边的 LIS。对每个 $x$ 维护一个 <code>map</code> （或者动态开点线段树），存入边权值为 $v$ 时的最长递增路径。考虑每次加进来一条边 $(u,v,w)$，答案就是从 $u$ 的 map 里找出最大的小于 $w$ 的值，根据单调性可知这一定是小于 $w$ 的那个最大值。然后暴力改就好了。不难知道这样做每条边至多被加一次、删一次，复杂度是 $O(m\log n)$ 。</p><p>思考了一下，这本质上就是一个 DP。设 $f_k$ 为最后一条边为第 $k$ 条边的最大值，那么转移就是从以边 $k$ 始点为终点的所有路径里选出一个来转移。其实如果考虑到 DP 的话，就变成一道中规中矩的题目了。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: <span class="built_in">map</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: lower_bound ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> en end</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> be begin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lbd lower_bound</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> &lt;<span class="keyword">int</span>, ll&gt; lis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">auto</span> p = lis[x].lbd(v) ;</span><br><span class="line">    ret = (p == lis[x].be()) ? <span class="number">0</span> : ((-- p) -&gt; second) ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) ; <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;z) ;</span><br><span class="line">        res = search(x, z) ; ++ res ;</span><br><span class="line">        <span class="keyword">if</span> (res &gt; search(y, z))&#123;</span><br><span class="line">            <span class="keyword">auto</span> p = lis[y].lbd(z) ; lis[y][z] = res ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> q = p ; q != lis[y].en() ; )&#123;</span><br><span class="line">                <span class="keyword">if</span> ((q -&gt; second) &gt; res) <span class="keyword">break</span> ; q = lis[y].erase(q) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="built_in">std</span> :: max(ans, res) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><blockquote><p>给你三个正整数 $n$，$a$，$b$，定义 $A$ 为一个排列中是前缀最大值的数的个数，定义 $B$ 为一个排列中是后缀最大值的数的个数，求长度为 $n$ 的排列中满足 $A = a$ 且 $B = b$ 的排列个数。</p><p>$1\le n \le 10^5$ 。答案对 $998,244,353$ 取模。</p></blockquote><p>感觉这题暴力的话本身也是一个比较有趣的计数题了。自己一开始设的状态是 $f_{i,j,k}$ 表示考虑了 $1\sim i$ 的排列，前缀最大值个数为 $j$，后缀最大值个数为 $k$ 时方案数，但是发现无论是插入最大值还是插入最小值都不是很容易转移。</p><p>但是发现如果确定了最大值在哪里，最后的答案就会比较容易计算。具体的，设 $f_{i,j}$ 表示考虑了 $1\sim i$ 的排列，前缀最大值个数为 $j$ 的方案数。那么最后答案就是</p><script type="math/tex; mode=display">\sum_{i=1}^{n-1} \dbinom{n-1}{i}\times f_{i,a-1}\times f_{n-i-1,b-1}\qquad(1)</script><p>然后考虑 $f$ 怎么算，因为最大值会直接影响前缀最大值的个数，所以转移考虑插入最小值。</p><script type="math/tex; mode=display">f_{i,j}=f_{i-1,j-1}+(i-1)\times f_{i-1,j}</script><p>分别对应了插在第一位和插在中间或者末尾。</p><p>不难看出 $\{f\}$ 就是 $\begin{bmatrix} n \ k \end{bmatrix} $ 。然后如果直接暴力的话是 $O(n^2)$ 的。</p><p>考虑直接从 $(1)$ 式的组合意义出发计算贡献。发现对于后面两项第一维的指标和是一定的，换句话说后面两项可以看做就是在 $n-1$ 里找出了 $a+b-2$ 个圈来。前面的那个二项式系数就可以看做是对选取的一个组合系数。那么可以知道最后答案就应该是</p><script type="math/tex; mode=display">\begin{bmatrix} n-1 \\ a+b-2 \end{bmatrix}\times \binom{a+b-2}{a-1}</script><p>于是就转化成如何快速求斯特林数某一项的问题了。但是这个并没有什么快速的做法…于是就只能求出一整行。</p><p>这还是我第一次写 $s_1$ 求一行。大概是说有恒等式</p><script type="math/tex; mode=display">\sum _{k=0}^{n-1} \begin{bmatrix} n \\ k \end{bmatrix} =x^{\bar{n}}=\prod_{i=0}^{n-1} (x-i)</script><p>后面那个单项式显然是可以分治做的。于是最后复杂度 $n\log ^2n$ 。</p><p>不过这东西是有单 $\log$ 的倍增做法的。不过感觉一般这种题也没有卡 $\log ^2$ 的意向。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly&#123;</span><br><span class="line">    <span class="keyword">int</span> k, d ;</span><br><span class="line">    <span class="keyword">int</span> rev[N] ;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">20</span>][N] ;</span><br><span class="line">    <span class="function">ll <span class="title">expow</span><span class="params">(ll x, ll y)</span></span>&#123;</span><br><span class="line">        ll ret = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (y)&#123;</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % P ;</span><br><span class="line">            x = x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre_rt</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">19</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">int</span>* r = g[i], ut ; r[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">            ut = r[<span class="number">1</span>] = expow(<span class="number">3</span>, <span class="number">998244352</span> / (<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>))) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> ; j &lt; (<span class="number">1</span> &lt;&lt; i) ; ++ j) r[j] = (ll)r[j - <span class="number">1</span>] * ut % P ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(T *f, <span class="keyword">int</span> L, <span class="keyword">bool</span> mk)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (rev[i] &lt; i) swap(f[i], f[rev[i]]) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; L ; i &lt;&lt;= <span class="number">1</span>, ++ l)&#123;</span><br><span class="line">            <span class="keyword">int</span> *r = g[l], o = i &lt;&lt; <span class="number">1</span>, rt, irt ;</span><br><span class="line">            <span class="keyword">for</span> (rg <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; L ; j += o)</span><br><span class="line">                <span class="keyword">for</span> (rg <span class="keyword">int</span> k = j ; k &lt; i + j ; ++ k)&#123;</span><br><span class="line">                    rt = f[k], irt = f[k + i] * r[k - j] % P ;</span><br><span class="line">                    f[k] = addn(rt, irt), f[k + i] = decn(rt, irt) ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!mk) <span class="keyword">return</span> ;</span><br><span class="line">        reverse(f + <span class="number">1</span>, f + L) ;</span><br><span class="line">        <span class="keyword">int</span> o = expow(L, P - <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i) (f[i] *= o) %= P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getlen</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        d = <span class="number">1</span>, k = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (d &lt;= x) d &lt;&lt;= <span class="number">1</span>, ++ k ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++ i)</span><br><span class="line">            rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (k - <span class="number">1</span>)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    ll tl[N] ;</span><br><span class="line">    ll tr[N] ;</span><br><span class="line">    <span class="keyword">int</span> len[N * <span class="number">3</span>] ;</span><br><span class="line">    vll poly[N * <span class="number">3</span>] ;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">            len[rt] = <span class="number">1</span> ;</span><br><span class="line">            poly[rt].p_b(<span class="number">1</span>) ;</span><br><span class="line">            poly[rt].p_b(l) ;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        cdq(lc, l, mid) ;</span><br><span class="line">        cdq(rc, mid + <span class="number">1</span>, r) ;</span><br><span class="line">        getlen(len[rt] = len[lc] + len[rc]) ;</span><br><span class="line"><span class="built_in">memset</span>(tl + len[lc] + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len[lc])) ;</span><br><span class="line"><span class="built_in">memset</span>(tr + len[rc] + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len[rc])) ;</span><br><span class="line"><span class="comment">//        for (int i = len[lc] + 1 ; i &lt;= d ; ++ i) tl[i] = 0 ;</span></span><br><span class="line"><span class="comment">//        for (int i = len[rc] + 1 ; i &lt;= d ; ++ i) tr[i] = 0 ;</span></span><br><span class="line">rg <span class="keyword">auto</span> lp = poly[lc].begin(), rp = poly[rc].begin() ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[lc] ; ++ i) tl[i] = *(lp ++) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[rc] ; ++ i) tr[i] = *(rp ++) ;</span><br><span class="line">        NTT(tl, d, <span class="number">0</span>) ; NTT(tr, d, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= d ; ++ i) (tl[i] *= tr[i]) %= P ;</span><br><span class="line">        NTT(tl, d, <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[rt] ; ++ i) poly[rt].p_b(tl[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> a, b ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll fac[N] ;</span><br><span class="line">ll inv[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="comment">//\binom&#123;x&#125;&#123;y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prework</span><span class="params">(<span class="keyword">int</span> mx)</span></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">0</span>] = <span class="number">1</span> ; ans = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mx + <span class="number">1</span> ; ++ i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[mx + <span class="number">1</span>] = Poly :: expow(fac[mx + <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mx ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    gi(n) ; gi(a) ; gi(b) ; prework(n &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (n == <span class="number">1</span>) &#123; print(a &amp; b) ; <span class="keyword">return</span> <span class="number">0</span> ; &#125;  </span><br><span class="line"><span class="keyword">if</span> (!a || !b || a + b - <span class="number">1</span> &gt; n) &#123; pc(<span class="string">'0'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ; &#125;</span><br><span class="line">    </span><br><span class="line">Poly :: pre_rt() ; Poly :: cdq(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">2</span>) ;</span><br><span class="line">    reverse(Poly :: poly[<span class="number">1</span>].begin(), Poly :: poly[<span class="number">1</span>].end()) ;</span><br><span class="line">    ans = Poly :: poly[<span class="number">1</span>][a + b - <span class="number">2</span>] * binom(a + b - <span class="number">2</span>, a - <span class="number">1</span>) % P ;</span><br><span class="line">    print(ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;感觉这场的题目质量还是不错的？确实比以前 vp 过的几场 (Div1+Div2) 要好很多。&lt;/p&gt;
&lt;p&gt;大概是把除了 H 之外一整场的题目都做掉了。有些不是十分必要写的题目当然就是口胡啦。&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/构造" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="动态规划/有技巧的DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="好多好多细节" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="贪心" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="多项式的应用/分治FFT" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8-%E5%88%86%E6%B2%BBFFT/"/>
    
      <category term="动态规划/树形DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="组合计数/斯特林数" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%96%AF%E7%89%B9%E6%9E%97%E6%95%B0/"/>
    
      <category term="数据结构/数据结构方法/轻重链剖分" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%96%B9%E6%B3%95-%E8%BD%BB%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>【训练记录】6.4 训练笔记</title>
    <link href="https://www.orchidany.cn/2020/06/05/6-4-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/05/6-4-训练笔记/</id>
    <published>2020-06-04T23:49:54.000Z</published>
    <updated>2020-06-05T06:07:14.916Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>由于奇奇怪怪的原因(其实是因为太困+vp CF)，于是就又摸了好久…</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>看上去就是一个组合游戏，于是考虑先分类出局面来。发现确定的必败态必然是只剩两个点，这时后手必胜。那么接着考虑中间的某些必败必胜态都是怎么互相转移的。</p><p>然后大概就是靠什么先验直觉来观察了。考虑只剩两个点的时候不存在偶度点，同时这个博弈长得就跟度数十分有关。那么就可以猜一波度数。具体的，将局面分成两类，「全都是奇度点 $P$」和「至少存在一个偶度点 $Q$」。发现局面 $Q$ 至少可以专用到一个 $P$ ，而局面 $P$ 转移到的一定都是局面 $Q$ ，再加上 $P$ 一定包含至少一个必败态(即终态)，所以不难知道这种分类这符合组合游戏对于必败态和必胜态的定义。</p><p>于是就瞎判一下就好了。</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p>给出一棵二叉树。问能否给所有点黑白染色，使得在将这棵树的所有叶子用空节点补全之后满足：</p><p>1、任意两个白点不相邻。</p><p>2、从根节点到任意一个空节点经过的黑点个数一样多。</p><p>$1\leq n\leq 5000$ 。</p></blockquote><p>一开时觉得为了使之尽量合法，所以应该让最长的那条链上黑点个数恰好是一半…反正就是推了几个类似的睿智结论，然后就当场去世了QAQ。</p><h2 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h2><p>考虑直接用 dp 确定合法性。设 $f_{i,j,0/1}$ 表示以 $i$ 为根的子树，每条根到空节点路径上的黑点个数为 $j$ ，当前点涂成黑/白是否可以。那么转移就是枚举一个左子树转移。</p><script type="math/tex; mode=display">f_{i,j,0}=\bigcap f_{k,j,1}\\f_{i,j,1}=\bigcap \left(f_{k,j-1,1}\cup f_{k,j-1,0}\right)</script><p>然后初值的话，考虑如果某个叶子没有兄弟的话就必须涂白色。</p><p>于是就可以直接对着 $\{f\}$ 构造了。复杂度 $O(n^2)$ 。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line">vint E[N] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">bool</span> foc[N] ;</span><br><span class="line"><span class="keyword">char</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N][<span class="number">2</span>] ;<span class="comment">//0r1b</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> r = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (E[x].size() == <span class="number">1</span>) foc[y] = <span class="number">1</span> ;</span><br><span class="line">        dep[y] = dep[x] + <span class="number">1</span> ;</span><br><span class="line">        dfs(y) ; r = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!r)&#123;</span><br><span class="line">        <span class="keyword">if</span> (foc[x])</span><br><span class="line">            f[x][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            f[x][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">            f[x][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (E[x].size())&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            f[x][j][<span class="number">0</span>] = f[x][j][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        solve(y) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">            f[x][j][<span class="number">0</span>] &amp;= f[y][j][<span class="number">1</span>] ;</span><br><span class="line">            f[x][j][<span class="number">1</span>] &amp;= f[y][j - <span class="number">1</span>][<span class="number">1</span>] | f[y][j - <span class="number">1</span>][<span class="number">0</span>] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out_p</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> cnt_b, <span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">    ans[x] = <span class="string">"RB"</span>[col] ;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; cnt_b &lt;&lt; " " &lt;&lt; col &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (!col || !f[y][cnt_b - <span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line">            out_p(y, cnt_b - col, <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">else</span> out_p(y, cnt_b - col, <span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; <span class="keyword">int</span> x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span> ; y &lt;= n ; ++ y)</span><br><span class="line">        x = qr(), E[x].push_back(y) ;</span><br><span class="line">    rt = E[<span class="number">0</span>][<span class="number">0</span>] ; dfs(rt) ; solve(rt) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; f[rt][i][0] &lt;&lt; " " &lt;&lt; f[rt][i][1] &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">if</span> (f[rt][i][<span class="number">0</span>]) <span class="keyword">return</span> out_p(rt, i, <span class="number">0</span>), !<span class="built_in">puts</span>(ans + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (f[rt][i][<span class="number">1</span>]) <span class="keyword">return</span> out_p(rt, i, <span class="number">1</span>), !<span class="built_in">puts</span>(ans + <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">puts</span>(<span class="string">"Impossible"</span>) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h2><p>上面那个做法是胃疼做法，胃疼在没有深刻发现性质。</p><p>首先设整棵树里所有叶子和只有一个孩子的点为关键点。那么如果关键点中深度极差 $\geqslant 2$ 可以知道必然不存在解，因为这样必然会多一个黑点。之后考虑这是一定可以黑白染色的，因为红黑树本质上比这个限制要多但依然可以红黑染色。具体的可以考虑让所有和最小深度关键点深度的奇偶性相同的点都染成黑色，否则染成红色。不难知道这是合法的。</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>对于任意 $1≤k≤n$， 求有多少个左右区分的恰有 $k$ 个叶子节点的二叉树， 满足对于每个节点要么没有叶子节点要么有两个节点， 同时不存在一个叶子节点， 使得根到它的路径上有不少于 $m$ 条向左的边。</p><p>你只需要求出答案对 $998244353$ 取模的结果。</p><p>$1\leq n\leq 5000$ 。</p></blockquote><p>比较考察基础的一道经典 DP？虽然不是很难。</p><h2 id="Sol-1-1"><a href="#Sol-1-1" class="headerlink" title="Sol 1"></a>Sol 1</h2><p>比较暴力的想法就是设计一个 $f_{i,j}$ 表示当前有了 $i$ 个叶子节点，到每个叶子左边个数最多为 $j$ 的方案数。转移的话考虑枚举叶子数，拆左子树</p><script type="math/tex; mode=display">f_{i,j}=\sum _{k}f_{k,j-1}\times f_{i - k,j}</script><p>即考虑拆出来的那条左边对答案的贡献。复杂度 $O(n^3)$ 。</p><p>然后发现这是个卷积的形式，可以信仰一波优化到 $O(n^2\log n)$ 通过此题。</p><h2 id="Sol-2-1"><a href="#Sol-2-1" class="headerlink" title="Sol 2"></a>Sol 2</h2><p>考虑上面那个做法属实胃疼。观察转移可以发现每次转移左子树和右子树的 $j$ 的差为 $1$ 且固定。于是可以把第二维换一下。设 $f_{i,k}$ 表示以 $i$ 为根，左右子树的左边个数之差为 $k$ 的方案数。那么考虑每次按照 $dfs$ 序的顺序，即先左后右，插入一个新的叶子，会得到</p><script type="math/tex; mode=display">\begin{aligned}f_{i,k}&\to f_{i,k+1}\\f_{i,k}&\to f_{i+1,k-1} \end{aligned}</script><p>即分类讨论插入的是左叶子还是右叶子。复杂度 $O(n^2)$ 。</p><h2 id="Sol-3-by-duye"><a href="#Sol-3-by-duye" class="headerlink" title="Sol 3 (by duye)"></a>Sol 3 (by duye)</h2><p>考虑一个跑得更快的做法。大概说设限制为 $m$ 时的这种树的 OGF 是 $F_m(x)$，其中 $[x^n]F_m(x)$ 表示有 $n$ 个叶子的结果。那么有转移</p><script type="math/tex; mode=display">F_m(x)=x\cdot F_{m-1}(x)\cdot F_m(x)+1</script><p>感觉还是挺显然的？本质上就是在拼插一棵二叉树。写成递推形式就是</p><script type="math/tex; mode=display">F_m(x)=\dfrac{1}{1-x\cdot F_{m-1}(x)}</script><p>发现可以分别维护分子分母，最后求逆一次就好了。复杂度 $O(n^2+n\log n)$ 。但因为前面维护分子分母只用 $\deg(F)$ 次运算，所以最后带一个 $\dfrac{1}{2}$ 的常数。实际效率优秀。</p><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p>比较简单的题目，但是感觉 trick 挺新颖。</p><p>考虑首先「最小」一定是对每一趟航班从大到小排序来做，同时不同的航班之间彼此没有影响。之后考虑如何算期望。由于算期望时终态固定，所以考虑倒着做。设 $\mathbb{E}_i$ 表示考虑 $i\sim n$ 的航班的期望最小步数，发现有转移</p><script type="math/tex; mode=display">\mathbb{E}_i=\zeta(i)+\sum _{j=1}^{k_i}\left(\prod_{k=1}^{j-1} (1-p_{i,k})\right)\cdot p_{i,j} \cdot (\mathbb{E}_{i+1}+j)</script><p>其中 $\zeta(i)$ 是这趟航班检查完了一个坏掉的都没有的期望，转移跟后面差不多但是边界比较奇怪就单列出来了。</p><p>那么考虑答案本质上就是在求这个东西的最小值。考虑这相当于是一系列一次函数的嵌套，于是考虑按照什么顺序去嵌套这 $n$ 个函数。考虑如下偏序关系：</p><script type="math/tex; mode=display">\tau_i(\tau_j+\epsilon_j)+\epsilon_i<\tau_j(\tau_i+\epsilon_i)+\epsilon_j</script><p>移项可以得到</p><script type="math/tex; mode=display">\frac{\tau_i-1}{\epsilon_i}<\frac{\tau_j-1}{\epsilon_j}</script><p>于是按照这个排序就好了。复杂度 $O(\sum k_i+n\log n)$ 。</p><div><div class="fold_hider"><div class="close hider_title">「My-Code」</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"></span><br><span class="line">db ans ;</span><br><span class="line">db base[N] ;</span><br><span class="line">pdb func[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; db res, t ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k) ; res = <span class="number">1.0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= k ; ++ j) <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;base[j]) ;</span><br><span class="line">        sort(base + <span class="number">1</span>, base + k + <span class="number">1</span>, [](db x, db y)&#123; <span class="keyword">return</span> x &gt; y ; &#125;) ;</span><br><span class="line">        <span class="keyword">while</span> (k &amp;&amp; base[k] &lt;= eps) k -- ;</span><br><span class="line">        <span class="keyword">if</span> (base[<span class="number">1</span>] &gt;= <span class="number">1.0</span> - eps) &#123; n --, i -- ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= k ; ++ j)&#123;</span><br><span class="line">            t = res * base[j], res *= (<span class="number">1.0</span> - base[j]) ;</span><br><span class="line">            func[i].fr += t , func[i].sc += t * j ;</span><br><span class="line">        &#125;</span><br><span class="line">        func[i].sc += res * k ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(func + <span class="number">1</span>, func + n + <span class="number">1</span>, [](pdb a, pdb b)&#123; <span class="keyword">return</span> a.fr * b.sc + a.sc &lt; b.sc + b.fr * a.sc ; &#125;) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        ans = func[i].fr * ans + func[i].sc ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.10lf"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>$1\leq m\leq 10^6,1\leq n\leq 30$ 。</p></blockquote><p>首先先看这个诡异操作，不难发现就是左移，如果 $2^{n-1}$ 位是 $1$，那么就把第一位或成 $1$，再 $\rm and$ 上 $2^{n}-1$ …结果发现这就是一个循环左移的操作。</p><p>然后不难看出初值有限。但是因为初值的选取和小 Y 的决策都是变量，所以考虑定住一边。发现让 $x$ 循环左移之后再异或，由于位运算的交换律，本质上可以等价于让第 $1\sim i$ 的前缀整体循环左移一位然后再异或上 $x &lt;&lt; 1$ ，即</p><script type="math/tex; mode=display">(a\operatorname{xor}b) \operatorname{<<}1=(a \operatorname{<<}1)\operatorname{xor}(b\operatorname{<<}1)</script><p>然后就可以预处理处一个 $\{b_n\}$ 表示</p><script type="math/tex; mode=display">(x<<1)\operatorname{xor} b_i=\left(x\operatorname{xor}{\left(\bigoplus_{j=1}^{i}a_i\right)}\right) <<1</script><p>然后考虑对于一个固定的 $x$ ，小 Y 的策略就会是找到对于一个固定的 $x$ 的最小的 $b_i$，而小 D 的策略则是选择最优的初值达到最大的结果。</p><p>于是考虑按位分治。先对 $\{b_n\}$ 排个序，这样对于每一位为 $1$ 或是为 $0$ 就是一个连续的区间。那么如果整个区间中的所有 $b_i$ 第 $p$ 位均为 $1$ ，那么这一位就必须要选 $1$ ，否则小 Y 可以在小 D 选 $0$ 的时候也选 $0$，选 $1$ 的时候也选 $1$ 使得答案最小。</p><p>注意，本质上是不需要体现出 $x$ 也要 $&lt;&lt;1$ 这一点来，因为每个 $x$ 对应着唯一的 $x&lt;&lt;1$ ，而我们只关心最后的最小答案和方案数，并不关心具体选了什么 $x$ 。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> a[N] ;</span><br><span class="line"><span class="keyword">int</span> b[N] ;</span><br><span class="line"><span class="keyword">int</span> pre[N] ;</span><br><span class="line"><span class="keyword">int</span> suf[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> res)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; p &lt;&lt; " " &lt;&lt; res &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (p &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (res &gt; ans)</span><br><span class="line">            ans = res, cnt = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (res == ans) ++ cnt ;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l, now = <span class="number">1</span> &lt;&lt; p ;</span><br><span class="line">    <span class="keyword">while</span> (mid &lt;= r &amp;&amp; !(b[mid] &amp; now)) ++ mid ;</span><br><span class="line">    <span class="keyword">if</span> (mid == l || mid &gt; r)</span><br><span class="line">        <span class="keyword">return</span> solve(l, r, p - <span class="number">1</span>, res | now) ;</span><br><span class="line">    solve(l, mid - <span class="number">1</span>, p - <span class="number">1</span>, res) ;</span><br><span class="line">    solve(mid, r, p - <span class="number">1</span>, res) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i) a[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i) pre[i] = pre[i - <span class="number">1</span>] ^ a[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m ; i &gt;= <span class="number">1</span> ; -- i) b[i - <span class="number">1</span>] = suf[i] = suf[i + <span class="number">1</span>] ^ a[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        b[i] ^= ((pre[i] &gt;&gt; (n - <span class="number">1</span>) | (pre[i] &lt;&lt; <span class="number">1</span>)) &amp; ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>)) ;</span><br><span class="line">    sort(b, b + m + <span class="number">1</span>) ; solve(<span class="number">0</span>, m, n - <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">"\n"</span> ; <span class="keyword">if</span> (T) <span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于奇奇怪怪的原因(其实是因为太困+vp CF)，于是就又摸了好久…&lt;/p&gt;
    
    </summary>
    
      <category term="题解" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="思维题/计数" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="思维题/构造" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="思维题/找性质" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="数学/概率,期望" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="思维题/对应与转化" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
      <category term="动态规划/普通DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="技巧/分治" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="贪心" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="多项式的应用" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    
      <category term="技巧/按位考虑" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E6%8C%89%E4%BD%8D%E8%80%83%E8%99%91/"/>
    
      <category term="技巧/状态合并" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E7%8A%B6%E6%80%81%E5%90%88%E5%B9%B6/"/>
    
      <category term="博弈论/组合游戏" scheme="https://www.orchidany.cn/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA-%E7%BB%84%E5%90%88%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
</feed>
