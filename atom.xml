<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğ“ğ“»ğ“¬ğ“±ğ“²ğ“­ğ“ªğ“·ğ”‚&#39;ğ”€ ğ“«ğ“µğ“¸ğ“°</title>
  
  <subtitle>A Soul Tune against Fate Should Be Played, now.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.orchidany.cn/"/>
  <updated>2020-02-08T03:43:10.984Z</updated>
  <id>https://www.orchidany.cn/</id>
  
  <author>
    <name>Orchidany</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>éšæƒ³ Â· ç›®æ¬¡è¡¨</title>
    <link href="https://www.orchidany.cn/2050/12/31/%E9%9A%8F%E6%83%B3%C2%B7%E7%9B%AE%E6%AC%A1%E8%A1%A8/"/>
    <id>https://www.orchidany.cn/2050/12/31/éšæƒ³Â·ç›®æ¬¡è¡¨/</id>
    <published>2050-12-31T14:24:26.000Z</published>
    <updated>2020-02-08T03:43:10.984Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç»ˆäºåˆå¼€å§‹äº†ã€‚</p><a id="more"></a><p>æˆ‘æ˜¯èŠ±ï¼Œä¸€ä¸ªä¸ç†æ™ºçš„$\rm{Oier}$ã€‚æˆ‘ä¹Ÿæƒ³æ¯å¤©24å°æ—¶æ‹¼å‡º48å°æ—¶çš„æ•ˆç‡ä¸€å¿ƒåšé¢˜ï¼Œä½†æ˜¯æˆ‘åšä¸åˆ°ï¼Œæˆ‘è¡€æ¶²ä¸­å‡ç»“ç€çš„ï¼Œåœ¨å‚¬ä¿ƒæˆ‘å†™ä¸‹æ¥ï¼Œå¿…é¡»è¦å†™ä¸‹æ¥ã€‚</p><p>åœ¨è¿™äº›æ–‡ç« é‡Œï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªè¿·èŒ«çš„é’å¹´å¦‚ä½•æ»¡æ€€çƒ­è¡€ä¸ç»æœ›ï¼Œçœ¼é‡Œé—ªçƒç€æ²§æ¡‘ä¸å¸Œæœ›ï¼Œæ€€é‡Œæ£ç€åæ‰çš„ç²®é£Ÿå’Œå´­æ–°çš„è®ºæ–‡ï¼Œè„šä¸‹è¸ç€å´å²–ä¸å¹³çš„è·¯ï¼Œå‘æ˜å¤©èµ°å»ã€‚</p><p>æ˜¯çš„ï¼Œæˆ‘æ˜¯èŠ±ï¼Œæ¥è‡ªå±±ä¸œï¼Œä½ ç›´æ¥å«æˆ‘èŠ±è¿™ä¸ªIDæˆ–è®¸æˆ‘ä¼šå¾ˆé«˜å…´ï¼Œä½†æ˜¯å¦‚æœä½ è®¤è¯†æˆ‘ä¹Ÿå¯ä»¥ä¸è¿™ä¹ˆæ‹˜æŸã€‚</p>        <div id="aplayer-obgUvYct" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">            <pre class="aplayer-lrc-content"></pre>        </div>        <script>          var ap = new APlayer({            element: document.getElementById("aplayer-obgUvYct"),            narrow: false,            autoplay: false,            showlrc: false,            music: {              title: "èŠ±",              author: "Hello Nico",              url: "Hello Nico-èŠ±.flac",              pic: "/2050/12/31/éšæƒ³Â·ç›®æ¬¡è¡¨/qwq.png",              lrc: ""            }          });          window.aplayers || (window.aplayers = []);          window.aplayers.push(ap);        </script><p>ä»¥ä¸‹æ˜¯ç›®å½•ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">ç¯‡ç›®</th><th style="text-align:center">é“¾æ¥ï¼ˆç‚¹å‡»å³å¯ï¼‰</th></tr></thead><tbody><tr><td style="text-align:center">éšæƒ³ä¸€ Â· å±±ä¸˜</td><td style="text-align:center"><a href="https://www.orchidany.cn/2018/08/02/%E9%9A%8F%E6%83%B3%E4%B8%80/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³äºŒ Â· ä¸˜å‰å°”</td><td style="text-align:center"><a href="https://www.orchidany.cn/2018/08/08/%E9%9A%8F%E6%83%B3%E4%BA%8C/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³ä¸‰ Â· æœ¬èµ›å­£æœ€åçš„éšæƒ³/å¯ç¤ºå½•</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/02/14/%E9%9A%8F%E6%83%B3%E4%B8%89%C2%B7NOIP/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³å›› Â· æ•…äºº</td><td style="text-align:center"><a href="[https://www.orchidany.cn/2019/03/01/%E9%9A%8F%E6%83%B3%E5%9B%9B%C2%B7%E6%95%85%E4%BA%BA/](https://www.orchidany.cn/2019/03/01/éšæƒ³å››Â·æ•…äºº/">$Link$</a>)</td></tr><tr><td style="text-align:center">éšæƒ³äº” Â· æ‰‹ä¸­æ²¡æœ‰çº¢ç«ç‘°</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/02/14/%E9%9A%8F%E6%83%B3%E4%BA%94%C2%B7%E6%83%85%E4%BA%BA%E8%8A%82/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³å…­ Â· éš¾</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/03/10/%E9%9A%8F%E6%83%B3%E5%85%AD%C2%B7Hard/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³ä¸ƒ Â· è¨€å¶ä¹‹åº­</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/03/28/%E9%9A%8F%E6%83%B3%E4%B8%83%C2%B7%E8%A8%80%E5%8F%B6%E4%B9%8B%E5%BA%AD/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³å…« Â· é€ƒå§</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/06/11/8/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³ä¹ Â· æ„ä¹‰</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/07/18/Nine/">$Link$</a></td></tr><tr><td style="text-align:center">éšæƒ³å Â· ç¹æ˜Ÿ</td><td style="text-align:center"><a href="https://www.orchidany.cn/2019/08/20/10/">$Link$</a></td></tr></tbody></table></div><p>ç¬¬ä¸€ç¯‡å¤§æ¦‚æ˜¯å¼€å§‹ï¼Ÿ</p><p>ç¬¬äºŒç¯‡å¤§æ¦‚æ˜¯åœ¨è€æ ¡æœºæˆ¿å†™çš„ã€‚å½“æ—¶è‡ªå·±å’Œå‘¨å›´äººçš„å…³ç³»å¹¶ä¸å¥½ã€‚</p><p>ç¬¬ä¸‰ç¯‡å°±æ˜¯2018è€ƒå®ŒNOIPå†™çš„å•¦ã€‚</p><p>ç¬¬å››ç¯‡ç”±äºä¸ªäººååˆ†å–œçˆ±å›å¿†å¾€äº‹ï¼Œæ‰€ä»¥æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ç¯‡ï¼Œä½†ç°åœ¨è¿˜æ²¡æœ‰æ›´å®Œã€‚ï¼ˆå› ä¸ºè¦è¯´çš„å¤ªå¤šäº†</p><p>ç¬¬äº”ç¯‡æ˜¯è°ˆæ„Ÿæƒ…çš„å•¦ï¼Œä¼¼ä¹æ˜¯æ¯”è¾ƒå‡ºåçš„ä¸€ç¯‡(?)</p><p>ç¬¬å…­ç¯‡å¤§æ¦‚æ˜¯çå†™çš„ã€‚å¦‚æœæ¯æ¬¡è§‰å¾—å¾ˆéš¾éƒ½è¦å†™ä¸€ç¯‡ï¼Œé‚£ä¼°è®¡åªæœ‰ä¸“èŒä½œå®¶æ‰èƒ½å†™å®Œã€‚</p><p>ç¬¬ä¸ƒç¯‡å¤§æ¦‚æ˜¯çœ‹å®Œã€Šè¨€å¶ä¹‹åº­ã€‹å°±ç«‹å³åœ¨æœºæˆ¿å†™çš„ï¼Œä»£è¡¨çš„å¤§æ¦‚æ˜¯æˆ‘ç†æƒ³ä¸­çˆ±æƒ…çš„æ¨¡æ ·å§ã€‚</p><p>ç¬¬å…«ç¯‡ä¹Ÿå¾ˆé‡è¦ï¼Œæˆ‘çš„å…¨éƒ¨å‹æŠ‘æƒ…ç»ªéƒ½ä¼šå†™è¿›å»ã€‚å½“ç„¶ï¼Œå’Œç¬¬å››ç¯‡ä¸€æ ·ï¼Œè¦è¯´çš„è¯å¤ªå¤šäº†ï¼Œæ‰€ä»¥å†™ä¸å®Œ/kk</p><p>ç¬¬ä¹ç¯‡å¤§æ¦‚æ˜¯ã€Œå¥‡å¼‚äººç”Ÿã€çš„è¯»/è§‚åæ„Ÿï¼Ÿ</p><p>æœ€åä¸€ç¯‡â€¦æ˜¯ç§˜å¯†ï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç»ˆäºåˆå¼€å§‹äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="éšæƒ³/ä¸‹ä¸‹ç¬”" scheme="https://www.orchidany.cn/tags/%E9%9A%8F%E6%83%B3-%E4%B8%8B%E4%B8%8B%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>ã€å…¬å‘Šã€‘å…³äºè¿™ä¸ªblog</title>
    <link href="https://www.orchidany.cn/2050/02/05/%E3%80%90%E5%85%AC%E5%91%8A%E3%80%91%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <id>https://www.orchidany.cn/2050/02/05/ã€å…¬å‘Šã€‘åšå®¢ä½¿ç”¨æŒ‡å—/</id>
    <published>2050-02-05T09:51:27.000Z</published>
    <updated>2020-04-29T12:34:46.897Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><a id="more"></a><p><del>æ­å–œä½ æ¥åˆ°äº†æ²¡æœ‰çŸ¥è¯†çš„è’åŸ.</del></p><p>è¿™ç¯‡æ–‡ç« å·²ç»ç§»æ­¥åˆ°ä¾§è¾¹æ çš„ã€Œ<code>Navigation</code>ã€é‡Œå•¦ï¼è¿˜ä¸å»çœ‹çœ‹ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
      <category term="Life" scheme="https://www.orchidany.cn/categories/Life/"/>
    
    
      <category term="ç¬”å°–ç”ŸèŠ±" scheme="https://www.orchidany.cn/tags/%E7%AC%94%E5%B0%96%E7%94%9F%E8%8A%B1/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒè®°å½•ã€‘6.8 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/09/6-8-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/09/6-8-è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-09T00:19:27.000Z</published>
    <updated>2020-06-09T03:50:26.108Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä»Šå¤©å› ä¸ºè¡¥ CF å°±åˆåªæ‰“äº†ä¸€åœºã€‚å’•å’•å’•ã€‚</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>æ¯”è¾ƒä¼ ç»Ÿçš„ä¸€é“ç®€å•é¢˜ã€‚ä½†æ˜¯ä¿© log è¢«å¡äº†= =</p><p>å¤§æ¦‚å°±æ˜¯è¯´è€ƒè™‘æœ€å¤§å€¼æœ€å°ï¼Œå¯èƒ½å¯ä»¥æƒ³åˆ°è¦å»äºŒåˆ†ç­”æ¡ˆã€‚ç„¶åè€ƒè™‘åˆ¤å®šï¼Œè€ƒè™‘ä¸€ä¸ªæƒå€¼ $v$ åˆæ³•ï¼Œå½“ä¸”ä»…å½“å¯ä»¥é€‰å‡ºä¸€ä¸ªé•¿åº¦ $\geqslant k$ çš„å­åºåˆ—ä½¿ä¹‹å’Œ $\leq v$ ã€‚è¿™ä¸ªå¯ä»¥ç”¨ ds ç»´æŠ¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è´ªã€‚</p><p>æ„Ÿè§‰ä¸ªäººæ¯”è¾ƒçœ‹ä¸é€è¿™ä¸ªè´ªå¿ƒï¼Œæ¢å¥è¯è¯´ä½ è¦è®©æˆ‘å†™æˆ‘è‚¯å®šå†™ä¸å‡ºæ¥ï¼Œæœ‰ç‚¹åç›´è§‰ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è€ƒè™‘æ¯æ¬¡å°†ä¸€ä¸ªå…ƒç´  <code>push</code> åˆ°ä¸€ä¸ªæ ˆé‡Œï¼Œç„¶åå¦‚æœå½“å‰å…ƒç´ ä¸æ ˆé¡¶å…ƒç´ ä¹‹å’Œ $\gt v$ å°±ä¸æŠŠå½“å‰å…ƒç´ å…¥æ ˆï¼Œå¦åˆ™å¦‚æœå½“å‰å…ƒç´  $\lt$ æ ˆé¡¶å…ƒç´ å°±å…ˆå¼¹æ ˆå†å…¥æ ˆã€‚æœ€ååˆ¤ä¸€ä¸‹å¤´å°¾å°±å¥½äº†ã€‚</p><p>æ„Ÿè§‰è¿™ä¹ˆè´ªå¿ƒçš„é“ç†åœ¨äºï¼Œ æœ€åä¸€ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯åºåˆ—æœ«å°¾çš„å…ƒç´ ï¼Œè¦ä¹ˆå°±æ˜¯åç¼€ä¸­æœ€å°çš„é‚£ä¸ªã€‚æ‰€ä»¥åˆ¤å¤´å°¾æ‰ä¸ä¼šé”…ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: max ;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: min ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">2000000001</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> mxv, mnv ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    tmp[cnt = <span class="number">1</span>] = base[<span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1l</span>l * tmp[cnt] + base[i] &lt;= x) tmp[++ cnt] = base[i] ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (tmp[cnt] &gt; base[i]) tmp[cnt] = base[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cnt &gt; k) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (cnt == k &amp;&amp; <span class="number">1l</span>l * tmp[<span class="number">1</span>] + tmp[cnt] &lt;= x) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;k) ;</span><br><span class="line">    <span class="keyword">int</span> l, r, mid ; mnv = M ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">        mnv = min(mnv, base[i]) ;</span><br><span class="line">        mxv = max(mxv, base[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    l = mnv &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">r = mxv &lt;&lt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line"><span class="comment">//        printf("%d %d\n", l, r) ;</span></span><br><span class="line">        mid = (<span class="number">1l</span>l * l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (check(mid))</span><br><span class="line">             ans = mid, r = mid - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p></blockquote><p>æŒºæœ‰æ„æ€çš„ä¸€é“ç»“è®ºé¢˜â€¦ä¸»è¦æ˜¯(æ ‡ç®—çš„)æ€è€ƒè¿‡ç¨‹æŒºå¦™<del>ï¼Œä¸è¿‡çŒœå®Œå°±èµ°äººäº†è°è¿˜è¯å•Šã€‚</del></p><p>å¤§æ¦‚æ˜¯è€ƒè™‘ä»äºŒåˆ†ç­”æ¡ˆå‡ºå‘ã€‚æŠŠ $\geqslant v$ çš„æ‰€æœ‰ä½ç½®ç½®ä¸º $1$ï¼Œå…¶ä½™ä½ç½®ç½®ä¸º $0$ ã€‚é‚£ä¹ˆç­”æ¡ˆ $v$ åˆæ³•<strong>å½“ä¸”ä»…å½“å­˜åœ¨ä¸€è¡Œçš„æ‰€æœ‰æ•°éƒ½ä¸º $1$</strong>ã€‚é¦–å…ˆå……åˆ†æ€§ä¸éš¾çŸ¥é“ï¼Œå° D åªè¦å¿½ç•¥è¿™ä¸€è¡Œï¼Œæ¯æ¬¡åˆ å…¶ä»–çš„ï¼Œè¿™æ ·å° Y ç”±äºæ¯æ¬¡åªèƒ½åˆ ä¸€åˆ—ï¼Œæ‰€ä»¥æœ€åå¿…ç„¶æ˜¯å° D è·èƒœã€‚</p><p>å¿…è¦æ€§è€ƒè™‘å½’çº³ã€‚$n=1$ ä¸éš¾çŸ¥é“ï¼Œç„¶åè€ƒè™‘ $n=k\to n=k+1$ ã€‚å‘ç°æ­¤æ—¶å‰©ä¸‹äº† $k$ è¡Œ $k+1$ åˆ—ï¼Œè½®åˆ°å° Y æ“ä½œï¼Œé‚£ä¹ˆè€ƒè™‘æ¯ä¸€è¡Œä»å·¦å¾€å³ç¬¬ä¸€ä¸ª $0$ï¼Œç”±é¸½ç¬¼åŸç†å¯çŸ¥ï¼Œå¿…å®šå­˜åœ¨ä¸€åˆ—ä¸åŒ…å«è¿™äº› $0$ ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚æ‰€ä»¥å‰©ä¸‹çš„å±€é¢å°±å¯ä»¥å½’çº³åˆ° $n=k$ é‡Œé¢ã€‚è¯æ¯•ã€‚</p><p>è§‚å¯Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œå‘ç°å…¶å®ä¸éœ€è¦äºŒåˆ†ï¼Œæ¯ä¸€è¡Œä¸­æœ€å°çš„æ•°ï¼Œæ‰€æœ‰è¡Œä¸­çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆã€‚æ‰«ä¸€éå°±å®Œäº†ã€‚</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><p>è¿™é¢˜å¯¹æˆ‘è¿™ç§æ•°ä½ DP èŒæ–°å¾ˆä¸å‹å¥½â€¦</p><p>ä¸€å¼€å§‹æƒ³äº†ä¸ªæš´åŠ›æ±‚ <code>count_of_1</code> çš„ä¸œè¥¿ï¼Œå‘ç°å¹¶ä¸æ˜¯è¿™ä¹ˆç®—çš„â€¦å³å‘ç°æ”¹å˜çš„ä½ç½®æ˜¯ $r$ äºŒè¿›åˆ¶ä¸‹ $1$ çš„ä½æ•°å’Œ $l-1$ äºŒè¿›åˆ¶ä¸‹ $1$ çš„å’Œï¼Œä½†æ˜¯è¦å‡å»é‚£äº›æ”¹äº†ä¸¤éçš„ï¼Œç»è¿‡å†·é™æ‰¾æ€§è´¨å¯ä»¥å‘ç°ï¼Œè¿™éƒ¨åˆ†å°±æ˜¯ä¸¤è€…ä»é«˜ä½åˆ°ä½ä½çš„æœ€é•¿å…¬å…±å‰ç¼€é‡Œé¢ $1$ çš„æ•°é‡ä¹˜äºŒã€‚</p><p>ç„¶åå°±è€ƒè™‘åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªè¿›è¡Œæ•°ä½ $dp$ ã€‚å‘ç°å¯¹äº $r\geq l$ çš„é™åˆ¶å®Œå…¨å¯ä»¥å»æ‰ï¼Œå› ä¸ºå®¹æ–¥çš„æ—¶å€™ä¼šè¢«ç›´æ¥å®¹æ–¥æ‰ã€‚é‚£ä¹ˆæ€»æ–¹æ¡ˆæ•°å°±å¯ä»¥ç›´æ¥ä¹˜ä¸€ä¸ªç³»æ•° $n$ï¼Œå°±åªéœ€è¦è®¡ç®—ã€Œ$1\sim n$ ä¹‹é—´æ‰€æœ‰æ•°çš„äºŒè¿›åˆ¶ä¸‹ $1$ çš„ä¸ªæ•°ã€ å’Œ ã€Œ$1\sim n$ å†…æ‰€æœ‰çš„æ•°å¯¹ $(l,r)$ çš„ <code>count_of_1(</code>LCP<code>)</code> ã€ã€‚</p><p>è®¾  $g_{i,j,0/1}$ è¡¨ç¤ºä»é«˜åˆ°ä½è€ƒè™‘äº†å‰ $i$ ä½ï¼Œæœ‰ $j$ ä¸ª $1$ ï¼Œ $r$ æ˜¯å¦ç­‰äº $n$ çš„æ–¹æ¡ˆæ•°ã€‚è½¬ç§»æ—¶éœ€è¦è€ƒè™‘åˆ†ç±»è®¨è®º $n$ çš„å½“å‰ä½æ˜¯å¦ä¸º $1$ ï¼Œå…·ä½“è½¬ç§»å¤§æ¦‚å°±æ˜¯åˆ¤æ–­ä¸€ä¸‹è½¬ç§»å‰å $r$ æ˜¯å¦ä¾æ—§ $=n$ ä¹‹ç±»çš„ã€‚åŒæ—¶è®¾ $f_{i,j,0/1,0/1}$ è¡¨ç¤ºè€ƒè™‘å‰ $i$ ä½ï¼Œæœ€å¤§å…¬å…±å‰ç¼€ä¸­ $1$ çš„ä¸ªæ•°ä¸º $j$ï¼Œ$l=r?,r=n?$ çš„æ–¹æ¡ˆæ•°ã€‚ç„¶åè½¬ç§»ä¾æ—§æ˜¯æ ¹æ®è¾¹ç•Œåˆ†ç±»è®¨è®ºå½“å‰ä½æ”¾ $1$ è¿˜æ˜¯ $0$ï¼Œæ³¨æ„åˆ°ç”±äºåŠ ä¸Šäº† $l,r$ çš„é™åˆ¶ï¼Œæ‰€ä»¥è¦åˆ†ç±»è®¨è®º $l,r$ åˆ†åˆ«æ”¾ä¸æ”¾ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸ªç³»æ•°ã€‚</p><p>ç„¶åæœ€åç­”æ¡ˆå°±æ˜¯</p><script type="math/tex; mode=display">ans=\left(n\times \sum g\right)-\sum f</script><p>å¤æ‚åº¦ $O(T\log n^2)$ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line">ll n, m ;</span><br><span class="line">ll ans1 ;</span><br><span class="line">ll ans2 ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> g[N][N][<span class="number">2</span>] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N][<span class="number">2</span>][<span class="number">2</span>] ; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        ans1 = ans2 = <span class="number">0</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(g, <span class="number">0</span>, <span class="keyword">sizeof</span>(g)) ;</span><br><span class="line">        <span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n ; m = n ; cnt = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (m) base[++ cnt] = m &amp; <span class="number">1</span>, m &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        reverse(base + <span class="number">1</span>, base + cnt + <span class="number">1</span>) ;</span><br><span class="line">        g[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>] = <span class="number">1</span>, f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i + <span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j][<span class="number">1</span>], g[i][j][<span class="number">1</span>]) ;</span><br><span class="line">                    add(g[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">0</span>], g[i][j][<span class="number">0</span>]) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (base[i + <span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">4l</span>l * f[i][j][<span class="number">0</span>][<span class="number">0</span>] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">1</span>], f[i][j][<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    add(f[i + <span class="number">1</span>][j + <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], f[i][j][<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">1</span>], <span class="number">2l</span>l * f[i][j][<span class="number">0</span>][<span class="number">1</span>] % P) ;</span><br><span class="line">                    </span><br><span class="line">                    add(f[i + <span class="number">1</span>][j][<span class="number">0</span>][<span class="number">0</span>], <span class="number">4l</span>l * f[i][j][<span class="number">0</span>][<span class="number">0</span>] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            add(ans1, <span class="number">1l</span>l * i * addn(g[cnt][i][<span class="number">1</span>], g[cnt][i][<span class="number">0</span>]) % P) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            add(ans2, <span class="number">1l</span>l * i * addn(f[cnt][i][<span class="number">0</span>][<span class="number">1</span>], f[cnt][i][<span class="number">0</span>][<span class="number">0</span>]) % P) ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; decn(<span class="number">1l</span>l * ans1 * (n % P) % P, <span class="number">2l</span>l * ans2 % P) &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="2.png" alt=""></p><p>$1\leq n\leq 100$ ã€‚</p><p>$1\leq X\leq 10^6$ ã€‚</p></blockquote><p>å‘ç°å˜é‡æœ‰ä¿©ï¼Œæ¥¼çš„é«˜åº¦å’Œæ¥¼ä¹‹é—´çš„è·ç¦»ã€‚å‘ç°é™åˆ¶ä¹‹é—´æ˜¯æœ‰å…³ç³»çš„ï¼Œäºæ˜¯è€ƒè™‘å®šä½ä¸€ä¸ªï¼Œæ¯”å¦‚æ¥¼çš„é«˜åº¦ã€‚è€ƒè™‘è®¾ä¸¤æ ‹æ¥¼ä¹‹é—´çš„è·ç¦»æ˜¯ $x_i$ ï¼Œé‚£ä¹ˆè¦æ»¡è¶³ $x_i\geqslant \max\{h_i,h_{i-1}\}$ ã€‚è®¾ </p><script type="math/tex; mode=display">s=\sum _{i=2}^n\max\{h_i,h_{i-1}\}</script><p>é‚£ä¹ˆå¯çŸ¥æ–¹æ¡ˆæ•°å°±æ˜¯</p><script type="math/tex; mode=display">\binom{X-1-s+n}{n}</script><p>è¿™å°±æ˜¯ä¸€ä¸ª $n+1$ å…ƒä¸€æ¬¡ä¸å®šæ–¹ç¨‹ç»„çš„é—®é¢˜ã€‚è¿™ä¸ªåœ°æ–¹æ¶‰åŠåˆ°ä¸€ä¸ªæŠ€å·§ã€‚å°±æ˜¯è€ƒè™‘é¦–å…ˆå€¼åŸŸæ˜¯ $[1,X]$ ï¼Œæ‰€ä»¥å–å€¼æœ‰ $X-1$ ä¸ªã€‚å…¶æ¬¡ç”±äºè¦æ±‚æ€»å’Œ $\leqslant X$ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘å¤šè®¾å‡ºä¸€ä¸ªå˜é‡ç”¨æ¥ä¿å­˜ä½™å‡ºå»çš„ $X-s$ï¼Œæ‰€ä»¥å°±æ˜¯ $n+1$ ä¸ªå…ƒç´ ã€‚</p><p>ç„¶åå°±æ˜¯è€ƒè™‘å¯¹ $s$ è¿›è¡Œ dpã€‚å…·ä½“çš„ï¼Œè®¾ $f_{i,j,k}$ è¡¨ç¤ºç°åœ¨è€ƒè™‘äº† $1\sim i$ çš„æ’åˆ—ï¼Œè¿˜æœ‰ $j$ ä¸ªä½ç½®æ²¡æœ‰é—­åˆï¼Œå³è¿˜æœ‰ $j$ ä¸ªä½ç½®å¯èƒ½è¿˜ä¼šæ’å…¥æ›´å¤§çš„æ•°ï¼Œå½“å‰ $s$ å€¼ä¸º $k$ çš„æ–¹æ¡ˆæ•°ã€‚ç„¶åè€ƒè™‘æ¯æ¬¡ç›¸å½“äºé€‰ä¸€ä¸ªä½ç½®æ’å…¥ä¸€ä¸ª $i$ ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿä¸¤ä¸ªæ–°çš„ç©ºä½ï¼Œç„¶ååˆ†ç±»è®¨è®ºä¸€æ³¢é—­åˆä¸é—­åˆå°±å¥½äº†ã€‚æ³¨æ„åˆ°å¦‚æœæ’å…¥å¼€å¤´æˆ–è€…ç»“å°¾ï¼Œé‚£ä¹ˆå°±åªä¼šäº§ç”Ÿ $1$ ä¸ªç©ºä½ï¼Œç‰¹åˆ¤ä¸€ä¸‹è¿™ä¸ªè¾¹ç•Œå°±å¥½äº†ã€‚æœ€åå¤æ‚åº¦ $O(n^4+X)$ ã€‚ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> inv[N] ;</span><br><span class="line"><span class="keyword">int</span> fac[N] ;</span><br><span class="line"><span class="keyword">int</span> f[<span class="number">2</span>][M][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (b)&#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ret = (ll)ret * a % P ;</span><br><span class="line">        a = (ll)a * a % P ; b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="comment">//\binom&#123;x&#125;&#123;y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> (ll)fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prework</span><span class="params">(<span class="keyword">int</span> mx)</span></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">0</span>] = <span class="number">1</span> ; ans = res = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mx + <span class="number">1</span> ; ++ i)</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[mx + <span class="number">1</span>] = expow(fac[mx + <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mx ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i] = <span class="number">1l</span>l * inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; P ; <span class="keyword">int</span> t ;</span><br><span class="line">    prework(m) ; f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, d = <span class="number">0</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">t = i * i ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k) f[d ^ <span class="number">1</span>][j][k] = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line"><span class="keyword">if</span> (j)&#123;</span><br><span class="line"><span class="keyword">int</span> p = j + <span class="number">1</span>, q = j + <span class="number">2</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k)&#123;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j - <span class="number">1</span>][k + (i + <span class="number">1</span>) * <span class="number">2</span>], <span class="number">1l</span>l * j * f[d][j][k] % P) ;</span><br><span class="line">               add(f[d ^ <span class="number">1</span>][j][k + i + <span class="number">1</span>], <span class="number">2l</span>l * p * f[d][j][k] % P) ;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j + <span class="number">1</span>][k], <span class="number">1l</span>l * q * f[d][j][k] % P) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">int</span> p = j + <span class="number">1</span>, q = j + <span class="number">2</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= t ; ++ k)&#123;</span><br><span class="line">               add(f[d ^ <span class="number">1</span>][j][k + i + <span class="number">1</span>], <span class="number">2l</span>l * p * f[d][j][k] % P) ;</span><br><span class="line">                add(f[d ^ <span class="number">1</span>][j + <span class="number">1</span>][k], <span class="number">1l</span>l * q * f[d][j][k] % P) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">        d ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        add(ans, <span class="number">1l</span>l * f[!(n &amp; <span class="number">1</span>)][<span class="number">0</span>][i] * binom(m - i + n - <span class="number">1</span>, n) % P) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©å› ä¸ºè¡¥ CF å°±åˆåªæ‰“äº†ä¸€åœºã€‚å’•å’•å’•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ•°å­¦/è§‚å¯Ÿæ€§è´¨,ç»“è®ºä¸æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="ç»„åˆè®¡æ•°/æœ‰æŠ€å·§çš„è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="æœ‰è¶£çš„äºŒåˆ†ç­”æ¡ˆ" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ•°ä½DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%95%B0%E4%BD%8DDP/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒè®°å½•ã€‘6.5 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/09/6-5-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/09/6-5-è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-09T00:19:13.000Z</published>
    <updated>2020-06-09T05:57:07.689Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å•¦å•¦å•¦å•¦</p><a id="more"></a><h1 id="A-M"><a href="#A-M" class="headerlink" title="A.M."></a>A.M.</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><p>ç®€å•é¢˜ã€‚</p><p>å¤§æ¦‚æ˜¯è¯´å¦‚æœè¿ä¸Šäº†ä¸¤æ¡è¾¹ï¼Œé‚£ä¹ˆè¿™æ¡è¾¹è¿æ¥çš„ä¸¤ä¸ªç‚¹å°±å¯ä»¥ç›´æ¥åˆå¹¶èµ·æ¥ã€‚è€ƒè™‘ä¸ºäº†ä¿è¯å¤æ‚åº¦ï¼Œéœ€è¦è¿›è¡Œå¯å‘å¼åˆå¹¶ã€‚äºæ˜¯å°±å¯ä»¥æ‹¿ä¸€ä¸ª <code>set</code> ç»´æŠ¤ï¼Œä½†è¿™æ ·ä¼šå¤šä¸€ä¸ª logã€‚è€ƒè™‘ç›´æ¥æ‹¿ <code>vector</code> ç»´æŠ¤ï¼Œå¯¹æ¯ä¸ªç‚¹è®¾ä¸€ä¸ª <code>vis</code> å°±ä¸éœ€è¦åˆ é™¤äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, q ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; s[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fa[x] == x) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void merge(int x, int y)&#123;</span></span><br><span class="line"><span class="comment">    int f1 = find(x) ;</span></span><br><span class="line"><span class="comment">    int f2 = find(y) ;</span></span><br><span class="line"><span class="comment">    if (f1 != f2)</span></span><br><span class="line"><span class="comment">        fa[f1] = f2 ;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; q ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) fa[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        x = qr(), y = qr(), s[x].p_b(y), s[y].p_b(x) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        x = find(qr()) ;</span><br><span class="line">y = find(qr()) ;</span><br><span class="line">        <span class="keyword">if</span> (x == y)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">            <span class="keyword">continue</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> z : s[x])</span><br><span class="line"><span class="keyword">if</span> (z == y) <span class="keyword">goto</span> fuck ;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'1'</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (s[x].size() &gt; s[y].size())</span><br><span class="line">            swap(x, y) ; fa[x] = y ; vis[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> z : s[x])</span><br><span class="line">            <span class="keyword">if</span> (!vis[z]) s[z].p_b(y), s[y].p_b(z) ;</span><br><span class="line">      <span class="keyword">continue</span> ;</span><br><span class="line">        fuck : <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><p>ç®€å•é¢˜ã€‚</p><p>è€ƒè™‘ä¸€ä¸ªæ€§è´¨ï¼Œå¤§æ¦‚å°±æ˜¯è¯´å‰©ä¸‹æ²¡æœ‰è¿èµ·æ¥çš„å¼¦ï¼Œä¸ç›¸äº¤ä¸€å®šæ˜¯æœ€ä¼˜çš„ã€‚äºæ˜¯å°±å¯ä»¥ç›´æ¥ dp äº†ã€‚è®¾ $f_{i,j}$ è¡¨ç¤ºè€ƒè™‘ $[i,j]$ ä¹‹é—´è¿˜æ²¡è¿çš„ç‚¹ï¼Œæœ€å°ä»£ä»·æ˜¯å¤šå°‘ã€‚è½¬ç§»å°±è€ƒè™‘æšä¸¾ä¸€ä¸ª $[i,j]$ ä¹‹é—´å’Œ $i$ ç›¸è¿çš„ç‚¹å³å¯ã€‚æ³¨æ„åˆ°è¿™æ ·å°±éœ€è¦ $[i,j]$ é‡Œæ²¡æœ‰é…å¯¹çš„ç‚¹ä¸ºå¶æ•°ã€‚</p><p>ç„¶åè€ƒè™‘æ–¹æ¡ˆæ•° $g_{i,j}$ï¼Œå°±åªéœ€è¦åœ¨ç»´æŠ¤ $f_{i,j}$ æ—¶é¡ºä¾¿è®¡æ•°ä¸€ä¸‹å°±å¥½äº†ã€‚å¤æ‚åº¦ $O(n^3)$ ã€‚</p><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>æ¯”è¾ƒç¥å¥‡çš„é¢˜ç›®â€¦</p><blockquote><p>ç»™å®šä¸€ä¸ªæ’å…¥åºåˆ—ã€‚ç¼–å·ä¸º $i$ çš„å…ƒç´ æœ‰ä¸€ä¸ªé¢œè‰² $col_i$ å’Œä¸€ä¸ªé˜ˆå€¼ $a_i$ã€‚æ’å…¥ $i$ çš„æ—¶å€™ï¼Œ$i$ åº”å½“æ”¾åˆ°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æœ€é å‰çš„ä½ç½® $p$ï¼š</p><p>1ã€å½“å‰ä½äº $p$ æˆ–è€… $p+1$ çš„å…ƒç´ é¢œè‰²ä¸ $col_i$ ç›¸åŒã€‚</p><p>2ã€ä¸èƒ½æœ‰è¶…è¿‡ $a_i$ ä¸ªå…ƒç´ å› æ­¤è€Œåç§»ã€‚</p><p>æ±‚æœ€ç»ˆæ’å…¥å…¨éƒ¨å…ƒç´ åæ¯ä¸ªä½ç½®çš„å…ƒç´ ç¼–å·ã€‚$1\leq n\leq 3\times 10^5$ ã€‚</p></blockquote><p>é‚£å¿…ç„¶æ˜¯å…ˆè½ä¸€ä¸ª $50pts$ çš„ <code>vector</code> æš´åŠ›<del>ç„¶åå°± 250 æ»šç²—äº†</del> ã€‚</p><p>å¤§æ¦‚æ˜¯è€ƒè™‘å¦‚æœçŸ¥é“äº†æ¯ä¸ªå…ƒç´ åœ¨å½“æ—¶æ’å…¥å®Œæ¯•ååœ¨ç¬¬å‡ ä½ï¼Œå³ $rank_i$ ï¼Œå°±å¯ä»¥ç›´æ¥çº¿æ®µæ ‘äºŒåˆ†å‡ºæœ€åå®é™…çš„ rankã€‚å…·ä½“çš„ï¼Œè€ƒè™‘æŠŠæ•°ä»åå¾€å‰æ’å…¥çº¿æ®µæ ‘ï¼Œè¿™æ ·æ¯æ¬¡å°±éœ€è¦ä»çº¿æ®µæ ‘ä¸­äºŒåˆ†å‡ºç¬¬ä¸€ä¸ªä½ç½® $p$ ä½¿å¾— $p-sum_p=rank_i$ ï¼Œå…¶ä¸­ $sum_p$ æ˜¯å‰ç¼€å’Œã€‚ä¸éš¾çŸ¥é“è¿™æ ·åšæ˜¯å¯¹çš„ã€‚</p><p>ä¹‹åè€ƒè™‘æ€ä¹ˆæ±‚å‡º $rank_i$ ã€‚è¿™ä¸ªåœ°æ–¹æœ‰ä¸ªååˆ†æ·±åˆ»çš„æ€§è´¨ï¼Œå¤§æ¦‚æ˜¯è¯´è€ƒè™‘å¦‚æœæœ‰å¤šä¸ªç›¸é‚»é¢œè‰²çš„å…ƒç´ æ”¾åœ¨ç›¸é‚»çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹¶ä¸å…³å¿ƒé åçš„é‚£äº›å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥åˆå¹¶ï¼Œå› ä¸ºè¾¹ç•Œæ¯”è¾ƒå¥½å¤„ç†ï¼Œå¹¶ä¸”è¿™æ ·è½¬åŒ–ä¹‹åå°±åªä¼šå‡ºç°åœ¨åé¢æ’å…¥æ–°çš„å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥ <code>push_back</code>ã€‚é‚£ä¹ˆç°åœ¨å¦‚æœè¦æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆæ‰¾åˆ°è¿™ä¸ªå…ƒç´ ä¸è€ƒè™‘é¢œè‰²æ—¶æœ€å°‘åº”è¯¥æ”¾åœ¨çš„ä½ç½® $p$ï¼Œç„¶åå»å¯¹åº”é¢œè‰²çš„ <code>vector</code> é‡ŒäºŒåˆ†å³å¯ã€‚è¿™æ ·æ¯æ¬¡æ’å…¥å°±å¯ä»¥æ¢æˆåœ¨çº¿æ®µæ ‘ä¸Šè¿›è¡Œå•ç‚¹åŠ ã€‚æ³¨æ„å¯èƒ½å­˜åœ¨ä¸€ä¸ªé¢œè‰²çš„è¿ç»­æ®µè·¨è¿‡ $p$ çš„æƒ…å†µï¼Œåˆ¤ä¸€ä¸‹è¾¹ç•Œå°±å¥½äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chkmax</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span></span>&#123; x = y &gt; x ? y : x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line">vint col[N] ;</span><br><span class="line"><span class="keyword">int</span> org_rk[N] ;</span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _ed end</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _bg begin</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(seg[rt] += v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) upd(lc, l, mid, p, v) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rc, mid + <span class="number">1</span>, r, p, v) ;</span><br><span class="line">    seg[rt] = seg[lc] + seg[rc] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> l ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (seg[lc] &gt;= p) <span class="keyword">return</span> fd(lc, l, mid, p) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> fd(rc, mid + <span class="number">1</span>, r, p - seg[lc]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> seg[rt] ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid) <span class="keyword">return</span> qry(lc, l, mid, p) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> seg[lc] + qry(rc, mid + <span class="number">1</span>, r, p) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n) ;</span><br><span class="line">    <span class="keyword">int</span> x, y, z, o, p, q ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        qr(x), qr(y) ; </span><br><span class="line">z = fd(<span class="number">1</span>, <span class="number">0</span>, n, i - y - <span class="number">1</span>) ;</span><br><span class="line">        o = lower_bound(col[x]._bg(), col[x]._ed(), z) - col[x]._bg() ;</span><br><span class="line">        <span class="keyword">if</span> (o == col[x].size()) col[x].p_b(++ m) ; o = col[x][o] ;</span><br><span class="line">        org_rk[i] = qry(<span class="number">1</span>, <span class="number">0</span>, n, o - <span class="number">1</span>) + <span class="number">1</span> ;</span><br><span class="line">        chkmax(org_rk[i], i - y) ;</span><br><span class="line">        upd(<span class="number">1</span>, <span class="number">0</span>, n, o, <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n * <span class="number">3</span> ; ++ i) seg[i] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) upd(<span class="number">1</span>, <span class="number">1</span>, n, i, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        p = fd(<span class="number">1</span>, <span class="number">1</span>, n, org_rk[i]) ;</span><br><span class="line">        ans[p] = i ; upd(<span class="number">1</span>, <span class="number">1</span>, n, p, <span class="number">-1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">qwa(ans + <span class="number">1</span>, n, <span class="string">' '</span>, <span class="string">'\n'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>233</p><h1 id="P-M"><a href="#P-M" class="headerlink" title="P.M."></a>P.M.</h1><p>ä¸‹åˆçš„é¢˜æ¯”è¾ƒæ°´â€¦</p><h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p></blockquote><p>ç®€å•é¢˜ã€‚</p><p>ä¸€å¼€å§‹çš„æƒ³æ³•å°±æ˜¯æŠŠæ£‹ç›˜è½¬ä¸ª $45Â°$ å¯èƒ½ä¼šæ¯”è¾ƒå¥½åšã€‚åæ¥å‘ç°å®Œå…¨å¯ä»¥ç›´æ¥è®°ä¸€ä¸‹å¯¹è§’çº¿çš„ç¼–å·ã€‚ä¹‹åå°±è€ƒè™‘å…ˆç®—å‰¯å¯¹è§’çº¿ï¼Œç„¶åç®—ä¸»å¯¹è§’çº¿ã€‚è¿™æ ·çš„è¯ï¼Œç®—ä¸»å¯¹è§’çº¿æ—¶å°±éœ€è¦å¯¹ä¸æ‰€æœ‰å‰¯å¯¹è§’çº¿çš„äº¤ç‚¹çš„è´¡çŒ®è¿›è¡Œå®¹æ–¥ï¼Œä½†æ˜¯å‘ç°å’Œä¸€æ¡ä¸»å¯¹è§’çº¿çš„å‰¯å¯¹è§’çº¿ç¼–å·æ˜¯è¿ç»­çš„ï¼Œå°±æ¯”è¾ƒå¥½ç®—ã€‚</p><p>ç»†èŠ‚åœ¨äºï¼Œè¦è€ƒè™‘ç¼–å·å¥‡å¶æ€§ï¼Œå› ä¸ºç»è¿‡ $(1,2),(2,1)$ çš„å¯¹è§’çº¿å’Œç»è¿‡ $(1,1),(2,2)$ çš„å¯¹è§’çº¿è™½ç„¶ç›¸äº¤ï¼Œä½†æ˜¯äº¤ç‚¹ä¸æ˜¯æ•´ç‚¹ã€‚ç„¶åå¯¹å¥‡å¶ç¼–å·åˆ†åˆ«æ‹¿ä¸ªæ¡¶ç»´æŠ¤å°±å¥½äº†ã€‚å¤æ‚åº¦ $O(n+m)$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &gt; <span class="number">0</span> ? x : -x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(n), qr(m) ; <span class="keyword">int</span> z = <span class="number">3</span> * n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        qr(base[i].fr), qr(base[i].sc) ;</span><br><span class="line">        vis0[base[i].fr + base[i].sc - <span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        vis1[n - base[i].sc + base[i].fr] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">        ans += vis0[i] * (n - <span class="built_in">abs</span>(n - i)) ;</span><br><span class="line">        buc1[i] = buc1[i - <span class="number">1</span>] + (i &amp; <span class="number">1</span>) * vis0[i] ;</span><br><span class="line">        buc0[i] = buc0[i - <span class="number">1</span>] + (!(i &amp; <span class="number">1</span>)) * vis0[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">            ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">             ans -= buc1[i + n - <span class="number">1</span>] - buc1[n - i] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[i + n - <span class="number">1</span>] - buc0[n - i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">             ans -= buc1[z - i - <span class="number">1</span>] - buc1[i - n] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[z - i - <span class="number">1</span>] - buc0[i - n] ;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (!(i &amp; <span class="number">1</span>))</span><br><span class="line">             ans -= buc1[i + n - <span class="number">1</span>] - buc1[n - i] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[i + n - <span class="number">1</span>] - buc0[n - i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span> ; i &lt;= n + n - <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1[i])</span><br><span class="line">                <span class="keyword">continue</span> ;</span><br><span class="line">        ans += n - <span class="built_in">abs</span>(n - i) ;</span><br><span class="line">        <span class="keyword">if</span> (!(i &amp; <span class="number">1</span>))</span><br><span class="line">             ans -= buc1[z - i - <span class="number">1</span>] - buc1[i - n] ;</span><br><span class="line">        <span class="keyword">else</span> ans -= buc0[z - i - <span class="number">1</span>] - buc0[i - n] ;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    qw(ans, <span class="string">'\n'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><p>æ¯”è¾ƒç®€å•çš„åˆ†ç±»è®¨è®ºé¢˜ã€‚</p><p>ä¸€å¼€å§‹è¯»é”™é¢˜äº†ï¼Œä»¥ä¸ºæ¯ä¸ªç‚¹çš„ç¼–å·éƒ½å¿…é¡»æ˜¯ $1\sim n$ â€¦åæ¥å‘ç°åªè¦ $\lt 10^6$ å°±å¥½äº†ã€‚ç„¶åå¦‚æœæ˜¯ $\lt n$ ä¹Ÿä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œåªæ˜¯åªèƒ½åšå°ä¸€ç‚¹ï¼Œå¤§æ¦‚å°±æ˜¯è€ƒè™‘æ˜¾ç„¶åªéœ€è¦ç®¡é‚£äº› $\deg_x$ æ˜¯å¥‡æ•°çš„ $x$ ï¼Œç„¶åç›¸å½“äºä»è¿™äº›é‡Œé¢é€‰æ‹©æ°å¥½ $k$ ä¸ªå¯ä»¥æ”¹å˜ç¼–å·çš„å…ƒç´ ä½¿ä¹‹å¼‚æˆ–å’Œç­‰äºä¸€ä¸ªå®šå€¼ $c$ ã€‚è¿™æ˜¾ç„¶æ˜¯å¯ä»¥ $n^3$ dp çš„ã€‚</p><p>ç„¶åè€ƒè™‘æ­£å¸¸ç‰ˆæœ¬ï¼Œ$\lt 10^6$ çš„ã€‚è€ƒè™‘è¿™æ ·çš„è¯æƒå€¼ä¸€å®šç¨‹åº¦ä¸Šå°±å¯ä»¥ xjb æ‰¾ã€‚å…·ä½“çš„ï¼ŒæŠŠå¯ä»¥ä¿®æ”¹æƒå€¼å¹¶ä¸”åº¦æ•°ä¸ä¸ºå¶æ•°çš„èŠ‚ç‚¹ç§°ä½œ pks ç‚¹ï¼Œé‚£ä¹ˆåˆ†ç±»è®¨è®ºä¸€ä¸‹ pks ç‚¹çš„æ•°é‡(0/1/2/2+)ï¼Œç‰¹åˆ¤ä¸€äº›ä¸åˆæ³•çš„æƒ…å†µå°±å¥½äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> col[N] ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> able[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">out_put</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Yes"</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        qw(ans[i], <span class="string">' '</span>) ; <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    qr(n) ; res = n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        qr(col[i]), ans[i] = i ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">        qr(x), qr(y), res ^= x ^ y ;</span><br><span class="line">        deg[x] ^= <span class="number">1</span>, deg[y] ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!res) <span class="keyword">return</span> out_put() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (col[i] &amp;&amp; deg[i]) able[++ cnt] = i ;</span><br><span class="line">    <span class="keyword">if</span> (!cnt) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (cnt &lt;= <span class="number">1</span>)&#123;</span><br><span class="line">        x = able[<span class="number">1</span>] ;</span><br><span class="line">        y = res ^ x ; ans[x] = y ;</span><br><span class="line">        <span class="keyword">if</span> (y &lt;= n)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!col[y])</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">            ans[y] = MAXV ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out_put() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        z = <span class="number">0</span> ;</span><br><span class="line">        x = able[++ z] ;</span><br><span class="line">        y = able[++ z] ;</span><br><span class="line">        <span class="keyword">if</span> (res == (x ^ y))&#123;</span><br><span class="line">            <span class="keyword">if</span> (z == cnt)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">else</span> y = able[++ z] ;</span><br><span class="line">        &#125;</span><br><span class="line">        z = x ^ y ^ res ;</span><br><span class="line">        ans[x] = MAXV ; ans[y] = MAXV ^ z ;</span><br><span class="line">        <span class="keyword">return</span> out_put() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><blockquote><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼Œæ”¯æŒå¦‚ä¸‹ä¸¤ä¸ªæ“ä½œï¼š</p><p>1ã€å•ç‚¹ä¿®æ”¹ã€‚</p><p>2ã€ç»™å‡ºä¸€ä¸ª $x_i$ ã€‚å…¨å±€æŸ¥è¯¢æœ‰å¤šå°‘ä¸ªæé•¿çš„è¿ç»­æ®µï¼Œæ»¡è¶³è¿ç»­æ®µå†…çš„æ•°éƒ½ $\geqslant x_i$ </p><p>$5\times 10^5$  ã€‚</p></blockquote><p>æ„Ÿè§‰æ˜¯æ¯”è¾ƒç»å…¸çš„æ€è·¯ã€‚è€ƒè™‘è¿ç»­æ®µå¯ä»¥çœ‹åšè¿é€šå—ï¼Œæ›´è¿›ä¸€æ­¥æ˜¯ä¸€æ£µæ ‘ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ $s$ ä¸ªç‚¹å’Œ $s-1$ æ¡è¾¹ã€‚äºæ˜¯è€ƒè™‘æ‰€æœ‰è¿é€šå—é‡Œç‚¹çš„æ•°é‡ä¹‹å’Œå‡å»è¾¹çš„æ•°é‡ä¹‹å’Œå°±æ˜¯è¿é€šå—ä¸ªæ•°ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åˆ†åˆ«ç»´æŠ¤ã€Œæœ‰å¤šå°‘ä¸ª $a_i\geqslant x$ ã€å’Œæœ‰å¤šå°‘ä¸ªã€Œ $\min\{a_i,a_{i-1}\}\geqslant x$ã€ã€‚æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ä¸€æ³¢å°±å¥½äº†ã€‚éœ€è¦ç¦»æ•£åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lwb lower_bound</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BIT</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> _b[N], v_max ;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> low(x) (x &amp; -x)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> ( ; p &lt;= v_max ; p += low(p)) _b[p] += v ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> ( ; p ; p -= low(p)) ret += _b[p] ;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;_b1, _b2 ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> v[N] ;</span><br><span class="line"><span class="keyword">int</span> qm[N] ;</span><br><span class="line"><span class="keyword">int</span> qp[N] ;</span><br><span class="line"><span class="keyword">int</span> qv[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; q ; <span class="keyword">int</span> p ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        v[++ cnt] = base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        qm[i] = qr() ;</span><br><span class="line">        <span class="keyword">if</span> (qm[i] == <span class="number">1</span>) v[++ cnt] = qv[i] = qr() ;</span><br><span class="line">        <span class="keyword">else</span> qp[i] = qr(), v[++ cnt] = qv[i] = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>) ;</span><br><span class="line">    cnt = unique(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>) - (v + <span class="number">1</span>) ;</span><br><span class="line">    _b1.v_max = _b2.v_max = cnt ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        base[i] = lwb(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>, base[i]) - v ;</span><br><span class="line">        _b1.ins(base[i], <span class="number">1</span>) ; <span class="keyword">if</span> (i &gt; <span class="number">1</span>) _b2.ins(min(base[i], base[i - <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(base, 1, n) ;</span></span><br><span class="line"><span class="comment">//    debug(_b1.qry(_b1.v_max)) ;</span></span><br><span class="line"><span class="comment">//    debug(_b2.qry(_b1.v_max)) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        qv[i] = lwb(v + <span class="number">1</span>, v + cnt + <span class="number">1</span>, qv[i]) - v ;</span><br><span class="line"><span class="comment">//        debug(qv[i]) ;</span></span><br><span class="line">        <span class="keyword">if</span> (qm[i] == <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (n - _b1.qry(qv[i] - <span class="number">1</span>)) - (n - <span class="number">1</span> - _b2.qry(qv[i] - <span class="number">1</span>))) ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p = qp[i] ;</span><br><span class="line">            _b1.ins(qv[i], <span class="number">1</span>) ;</span><br><span class="line">            _b1.ins(base[p], <span class="number">-1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &lt; n) _b2.ins(min(qv[i], base[p + <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; <span class="number">1</span>) _b2.ins(min(qv[i], base[p - <span class="number">1</span>]), <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &lt; n) _b2.ins(min(base[p], base[p + <span class="number">1</span>]), <span class="number">-1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (p &gt; <span class="number">1</span>) _b2.ins(min(base[p], base[p - <span class="number">1</span>]), <span class="number">-1</span>) ;</span><br><span class="line">            base[p] = qv[i] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹åˆå®Œå®Œå…¨å…¨å°±æ˜¯åœ¨åˆ’æ°´å•Šï¼ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å•¦å•¦å•¦å•¦&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ™®é€šDP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="å¥½å¤šå¥½å¤šç»†èŠ‚" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="æ•°æ®ç»“æ„/çº¿æ®µæ ‘" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="æŠ€å·§/å¯¹åº”ä¸è½¬åŒ–" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢˜è§£ã€‘[CF Round#474(Combined) A~G] é¢˜è§£</title>
    <link href="https://www.orchidany.cn/2020/06/08/CF-474-Combined/"/>
    <id>https://www.orchidany.cn/2020/06/08/CF-474-Combined/</id>
    <published>2020-06-08T12:59:49.000Z</published>
    <updated>2020-06-09T00:08:55.923Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ„Ÿè§‰è¿™åœºçš„é¢˜ç›®è´¨é‡è¿˜æ˜¯ä¸é”™çš„ï¼Ÿç¡®å®æ¯”ä»¥å‰ vp è¿‡çš„å‡ åœº (Div1+Div2) è¦å¥½å¾ˆå¤šã€‚</p><p>å¤§æ¦‚æ˜¯æŠŠé™¤äº† H ä¹‹å¤–ä¸€æ•´åœºçš„é¢˜ç›®éƒ½åšæ‰äº†ã€‚æœ‰äº›ä¸æ˜¯ååˆ†å¿…è¦å†™çš„é¢˜ç›®å½“ç„¶å°±æ˜¯å£èƒ¡å•¦ã€‚</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>ç§’äº†ã€‚</p><p>äººå£æ™®æŸ¥é¢˜ã€‚</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p>æœ‰ä¸¤ä¸ªé•¿åº¦å‡ä¸º $n$ çš„åºåˆ— $a,b$ï¼Œå®šä¹‰ ${\rm cost}(a,b)$ ï¼š</p><script type="math/tex; mode=display">{\rm cost}(a,b)=\sum_{i=1}^{n}\left(a_{i}-b_{i}\right)^{2}</script><p>ç°åœ¨å¿…é¡»<strong>æ°å¥½</strong>å¯¹ $a$ è¿›è¡Œ $k_1$ æ¬¡æ“ä½œï¼Œå¯¹ $b$ è¿›è¡Œ $k_2$ æ¬¡æ“ä½œã€‚æ“ä½œå†…å®¹æ˜¯å°†æŸä¸€é¡¹åŠ ä¸€æˆ–è€…å‡ä¸€ã€‚æ±‚æ“ä½œåçš„æœ€å° $\rm cost$ã€‚</p><p>$1\leq n\leq 2000$ã€‚</p></blockquote><p>ç§’äº†ã€‚</p><p>é™æ™ºè´ªå¿ƒï¼Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±æƒ³äº†ä¸€ä¼šå„¿ï¼Œå‘ç° $n=2000$ ä¹‹åå°±ç§’æ‰äº†= = </p><p>å¤§æ¦‚æ˜¯è€ƒè™‘åˆ†ç±»è®¨è®ºç°åœ¨æ“ä½œæ˜¯è®©ä¸¤ä¸ªæ•°åˆ—å°½é‡é è¿‘è¿˜æ˜¯å°½é‡è¿œç¦»ã€‚ç¬¬ä¸€ç§æƒ…å†µæ¯æ¬¡æ“ä½œå‰æ‰¾åˆ°å¯ä»¥ä½¿ $\Delta$ å˜å°æœ€å¤šçš„ï¼Œç¬¬äºŒç§æ‰¾åˆ°è®© $\Delta$ å˜å¤§æœ€å°çš„å°±å¯ä»¥äº†ã€‚</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>çš®å¡ä¸˜å’Œä»–æ’æˆä¸€åˆ—ã€‚ä»–åœ¨çº¸ä¸Šå†™ä¸‹äº†æ•°ç»„çš„æ‰€æœ‰éç©ºå­åºåˆ—ã€‚åŒæ—¶ä»–åˆ é™¤äº†æ‰€æœ‰çš„ã€Œå­åºåˆ—çš„æœ€å¤§å…ƒç´ -å­åºåˆ—çš„æœ€å°å…ƒç´  $\geq d$ã€çš„å­åºåˆ—ï¼Œæœ€ç»ˆå‰©ä¸‹ $X$ ä¸ªå­åºåˆ—ã€‚ç°åœ¨ç»™å‡º $X,d$ ï¼Œæ„é€ ä¸€ä¸ªåˆæ³•çš„åŸåºåˆ—ã€‚</p><p>è¾“å‡ºæ•°ç»„ä¸­çš„å…ƒç´ æ•°ä¸åº”å¤§äº $10^4$ï¼Œæ•°å€¼å¤§å°ä¸åº”è¶…è¿‡ $10^{18}$ ã€‚ä¿è¯ $1\leq X,d\leq 10^9$ ã€‚</p></blockquote><p>ç§’äº†ã€‚</p><p>æ¯”è¾ƒ naive çš„ä¸€é“æ„é€ é¢˜ã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘é•¿åº¦ä¸º $n$ çš„åºåˆ—ä¼šäº§ç”Ÿ $2^n-1$ ä¸ªå­åºåˆ—ï¼Œé‚£ä¹ˆè€ƒè™‘ç›´æ¥å¯¹ $X$ è¿›è¡ŒäºŒè¿›åˆ¶æ‹†åˆ†ï¼Œä¹‹åå°±æ˜¯ä¸€æ®µ $1$ ä¸€ä¸ª $d+1$ çš„å½¢å¼æ„é€ å°±å®Œäº†ã€‚</p><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><blockquote><p>ç»™å‡ºä¸€é¢—æ— é™å±‚çš„æ»¡äºŒå‰æ ‘ã€‚ å¦‚æœ $x$ æ˜¯æ ¹ï¼Œå­©å­çš„å€¼æ˜¯ $2\times x$ï¼Œå³å­©å­çš„å€¼æ˜¯ $2\times x+1$ ã€‚</p><p>ç°åœ¨æœ‰ä¸‰ç§æ“ä½œï¼š</p><p>$(1,x,k)$ ï¼šå°† $x$ æ‰€åœ¨å±‚çš„æ‰€æœ‰èŠ‚ç‚¹æ•´ä½“å‘å³å¾ªç¯åœ°ç§»åŠ¨ $k$ ä¸ªå•ä½ã€‚</p><p>$(2,x,k)$ ï¼šå°† $x$ æ‰€åœ¨çš„å±‚çš„æ‰€æœ‰èŠ‚ç‚¹<strong>åŠå…¶å­æ ‘</strong>å‘å³å¾ªç¯åœ°ç§»åŠ¨ k ä¸ªå•ä½ã€‚</p><p>$(3,x)$ ï¼šè¾“å‡ºä» $x$ åˆ°æ ¹çš„è·¯å¾„ã€‚</p><p>$1\leq x,k,\leq 10^{18}$ ã€‚ </p></blockquote><p>æ¯”è¾ƒéº»çƒ¦çš„æ‰¾æ€§è´¨+æ¨¡æ‹Ÿé¢˜ï¼Œä½†è¿˜æ˜¯ç§’äº†ã€‚<del>ä½†æ˜¯ç”±äºå„ç§ç»†èŠ‚å®ç°ä¸ŠèŠ±äº†å¥½ä¹…</del></p><p>ä¸€å¼€å§‹çš„æƒ³æ³•å°±æ˜¯ï¼Œå¯¹æ“ä½œ $(1)$ çš„æ¯ä¸€å±‚æ‰“åå‘çš„æ ‡è®°ï¼Œç„¶åå‘ä¸Šè·³çš„æ—¶å€™é‡åˆ°è¿™ä¸€å±‚åå‘è·³ä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªæ“ä½œæ‰“å¦ä¸€ç§æ­£å‘çš„æ ‡è®°å°±å¥½äº†ã€‚å†™äº†åŠå¤©æ‰å†™å‡ºæ¥ï¼Œè¿™é‡Œè¯´å‡ ä¸ªå°ç»†èŠ‚ï¼š</p><p>1ã€ä¸¤ä¸ªæ“ä½œçš„æ ‡è®°éƒ½æ‰“åœ¨å½“å‰å±‚è€Œä¸æ˜¯ä¸Šä¸€å±‚ã€‚ä½†æ˜¯ä¸¤ä¸ªæ ‡è®°é‡Šæ”¾çš„æ—¶åˆ»ä¸åŒã€‚ç¬¬äºŒä¸ªæ ‡è®°æ¯æ¬¡è¦åœ¨è·³ä¹‹å‰ä¸‹ä¼ å½“å‰å±‚çš„ï¼Œè€Œç¬¬ä¸€ä¸ªæ ‡è®°è¦åœ¨è·³ä¹‹åä¸‹ä¼ ä¸‹ä¸€å±‚çš„ã€‚åŸå› æ˜¯ç¬¬ä¸€ä¸ªæ ‡è®°æ˜¯æ•´ä½“æœ‰æ•ˆçš„ï¼Œç¬¬äºŒä¸ªæ ‡è®°æ˜¯æš‚æ—¶æœ‰æ•ˆçš„ã€‚</p><p>2ã€ç¬¬ä¸€ä¸ªæ ‡è®°åœ¨è¾“å‡ºä¹‹åè¦æ¸…é™¤ã€‚</p><p>3ã€æ³¨æ„åˆ°æ“ä½œ $(1)$ æ ‡è®°åå‘æ˜¯å› ä¸ºè·³çš„æ—¶å€™è¦èµ°ç›¸å¯¹ä½ç§»ã€‚ä½†æ˜¯å¦‚æœä¸€å¼€å§‹èµ·ç‚¹æ—¶å­˜åœ¨æ ‡è®°ï¼Œè¿™ä¸ªæ ‡è®°çš„ä½œç”¨åº”è¯¥æ˜¯æ­£å‘çš„ã€‚åˆ¤ä¸€ä¸‹å³å¯ã€‚</p><p>4ã€<code>&lt;cmath&gt; log2()</code> è´¼æ…¢ï¼Œç”šè‡³æ¯”æ‰‹å†™çš„è¿˜è¦æ…¢â€¦</p><p>äºæ˜¯æœ€åå°±åšåˆ°äº† <code>log_2</code> å¤–çº¿æ€§ã€‚è¿„ä»Šä¸ºæ­¢æ˜¯ Codeforces å…¨ç«™æœ€å¿«çš„ä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line">ll buc1[<span class="number">70</span>] ;</span><br><span class="line">ll buc2[<span class="number">70</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">i_lg2</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">32</span>) m |= <span class="number">32</span>, n &gt;&gt;= <span class="number">32</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">16</span>) m |= <span class="number">16</span>, n &gt;&gt;= <span class="number">16</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">8</span>) m |= <span class="number">8</span>, n &gt;&gt;= <span class="number">8</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">4</span>) m |= <span class="number">4</span>, n &gt;&gt;= <span class="number">4</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">2</span>) m |= <span class="number">2</span>, n &gt;&gt;= <span class="number">2</span> ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;&gt; <span class="number">1</span>) m |= <span class="number">1</span>, n &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">return</span> m ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    qr(T) ; <span class="keyword">int</span> p ;</span><br><span class="line">    ll x, y, z, s, t, yf ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        qr(x), qr(y) ;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">1</span>)</span><br><span class="line">            y = i_lg2(y), qr(z), buc1[y] -= z ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">2</span>)</span><br><span class="line">            y = i_lg2(y), qr(z), buc2[y] += z ;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            qw(y, <span class="string">' '</span>) ;</span><br><span class="line">            p = i_lg2(y) ;</span><br><span class="line">            z = <span class="number">1l</span>l &lt;&lt; p ;</span><br><span class="line">            s = (z &lt;&lt; <span class="number">1</span>) - <span class="number">1</span> ;</span><br><span class="line">            t = - buc1[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">            x = y + t ;</span><br><span class="line">            <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                x = (x &amp; s) + z ;</span><br><span class="line">            y = x ;</span><br><span class="line">            <span class="keyword">while</span> (p &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                s = (z &lt;&lt; <span class="number">1</span>) - <span class="number">1</span> ;</span><br><span class="line">t = buc2[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                    t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                x = y + t ;</span><br><span class="line">                <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                    x = (x &amp; s) + z ;</span><br><span class="line">                y = x ;</span><br><span class="line">                </span><br><span class="line">                -- p ;</span><br><span class="line">                s = z - <span class="number">1</span> ;</span><br><span class="line">                z = z &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                y = y &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                t = buc1[p] &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                <span class="keyword">if</span> (t &lt; <span class="number">0</span>)</span><br><span class="line">                    t = (t + z) &amp; (z - <span class="number">1</span>) ;</span><br><span class="line">                x = y + t ;</span><br><span class="line">                <span class="keyword">if</span> (x &gt; s)</span><br><span class="line">                    x = (x &amp; s) + z ;</span><br><span class="line">                yf = y ; y = x ;</span><br><span class="line">                qw(y, <span class="string">' '</span>), y = yf ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">putchar</span>(<span class="string">'\n'</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><blockquote><p>ç»™å®šä¸€æ£µå¸¦ç‚¹æƒçš„æ ‘ï¼Œæ±‚æ‰€æœ‰æœ‰å‘è·¯å¾„çš„æƒå€¼å’Œã€‚</p><p>ä¸€æ¡æœ‰å‘è·¯å¾„çš„æƒå€¼å¦‚ä¸‹å®šä¹‰ï¼š </p><p>è®¾è¿™æ¡è·¯å¾„ä¾æ¬¡ç»è¿‡çš„ç‚¹çš„æƒå€¼åˆ†åˆ«ä¸º $a_1, a_2, â€¦, a_k$ã€‚</p><p>åˆ™è·¯å¾„çš„æƒå€¼ä¸º $a_1\times (-1)^2+a_2\times (-1)^3+â€¦+a_n\times (-1)^{(n+1)}$ã€‚</p><p>ç­”æ¡ˆå¯¹ $10^9+7$ å–æ¨¡ã€‚</p></blockquote><p>ç§’äº†ã€‚<del>æŒ‡æƒ³å‡ºæ¥ä½†å†™äº†ä¸€å¹´</del></p><p>ç„¶åä¸€çœ¼å°±æ˜¯ç‚¹åˆ†â€¦ä¸è¿‡å¥½åƒæ¯”è¾ƒéº»çƒ¦çš„æ ·å­ã€‚</p><p>æˆ–è€…è€ƒè™‘ç›´æ¥æ ‘å½¢ $dp$ ã€‚å°±åªéœ€è¦ç»Ÿè®¡å‡ºæ¯ä¸ªç‚¹åœ¨å¤šå°‘æ¡è·¯å¾„ä¸Šæ˜¯å¥‡æ•°ä½ç½®ï¼Œå¤šå°‘æ¡è·¯å¾„ä¸Šæ˜¯å¶æ•°ä½ç½®ã€‚è¿™ä¸ªå¯ä»¥ç”¨æ¯”è¾ƒ trivial çš„ up_and_down æŠ€å·§æ¥åšã€‚å…·ä½“çš„ï¼Œè€ƒè™‘å¯¹äºå¥‡å¶ä½ç½®åˆ†åˆ«ç»´æŠ¤ä¸‰ä¸ªä¿¡æ¯ï¼Œ$f,g,h$ åˆ†åˆ«è¡¨ç¤ºã€Œèµ·ç‚¹åœ¨å­æ ‘å¤–ã€ç»ˆç‚¹åœ¨å­æ ‘å†…ã€ã€ã€Œèµ·ç‚¹åœ¨å­æ ‘å†…ï¼Œç»ˆç‚¹åœ¨å­æ ‘å¤–ã€ã€ã€Œèµ·ç‚¹åœ¨å­æ ‘å†…ï¼Œç»ˆç‚¹åœ¨å­æ ‘å†…ã€ä¸‰ç§ä¿¡æ¯ï¼Œå…¶ä¸­ç¬¬ä¸‰ç§ä¾èµ–äºç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§éœ€è¦ç¬¬äºŒç§è¿›è¡Œ up_and_down ã€‚è¿™æ ·å°±å¯ä»¥ç»“åˆå­æ ‘ $size$ ç›´æ¥ç®—å‡ºè´¡çŒ®æ¥äº†ã€‚</p><p>æœ‰å°ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚å°±æ˜¯ $f_x,g_x$ åœ¨å¤„ç†å¥‡æ•°çš„æ—¶å€™éœ€è¦åˆ¤ä¸€ä¸‹ $x$ çš„è¾¹ç•Œã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span> :: <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; vint ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">1000000007</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line">ll f[N][<span class="number">3</span>] ;</span><br><span class="line">ll g[N][<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> size[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">dec</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x -= y ; x = x &lt; <span class="number">0</span> ? x + mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    f[x][<span class="number">0</span>] = size[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        dfs(y, x) ; size[x] += size[y] ;</span><br><span class="line">        f[x][<span class="number">0</span>] += g[y][<span class="number">0</span>] ; g[x][<span class="number">0</span>] += f[y][<span class="number">0</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        add(f[x][<span class="number">2</span>], (size[x] - size[y] - <span class="number">1</span>) * g[y][<span class="number">0</span>] % P) ;</span><br><span class="line">        add(g[x][<span class="number">2</span>], (size[x] - size[y] - <span class="number">1</span>) * f[y][<span class="number">0</span>] % P) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        f[y][<span class="number">1</span>] = g[x][<span class="number">1</span>] ;</span><br><span class="line">        g[y][<span class="number">1</span>] = f[x][<span class="number">1</span>] ;</span><br><span class="line">        f[y][<span class="number">1</span>] += (g[x][<span class="number">0</span>] - f[y][<span class="number">0</span>]) ;</span><br><span class="line">        g[y][<span class="number">1</span>] += (f[x][<span class="number">0</span>] - g[y][<span class="number">0</span>]) ;</span><br><span class="line">        dfs2(y, x) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span> ; x &lt;= n ; ++ x)&#123;</span><br><span class="line">        add(ans, f[x][<span class="number">2</span>] * base[x] % P) ;</span><br><span class="line">        dec(ans, g[x][<span class="number">2</span>] * base[x] % P) ;</span><br><span class="line">        dec(ans, base[x]) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        add(ans, (f[x][<span class="number">1</span>] + <span class="number">1</span>) * size[x] % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        add(ans, f[x][<span class="number">0</span>] * (n - size[x] + <span class="number">1</span>) % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        dec(ans, g[x][<span class="number">1</span>] * size[x] % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ;</span></span><br><span class="line">        dec(ans, g[x][<span class="number">0</span>] * (n - size[x] + <span class="number">1</span>) % P * base[x] % P) ;</span><br><span class="line"><span class="comment">//        printf("%lld\n", ans) ; puts("-----------") ;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>) ; dfs2(<span class="number">1</span>, <span class="number">0</span>) ; solve() ; <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans % P) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="F"><a href="#F" class="headerlink" title="F"></a>F</h1><blockquote><p>ç»™å®š $n$ ä¸ªç‚¹ $m$ æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå¯èƒ½ä¸è¿é€šï¼Œå¯èƒ½æœ‰é‡è¾¹ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰è‡ªç¯ã€‚æ±‚æœ€é•¿çš„è·¯å¾„(å¯ä»¥ç»è¿‡é‡å¤èŠ‚ç‚¹)ï¼Œä½¿å¾—è¿™æ¡è·¯å¾„çš„ç¼–å·å’Œæƒå€¼éƒ½<strong>ä¸¥æ ¼</strong>å•è°ƒé€’å¢ï¼Œå…¶ä¸­ç¼–å·æŒ‡è¾“å…¥çš„é¡ºåºã€‚</p><p>$1\leq n,m\leq 10^5$ ã€‚</p></blockquote><p>æ¯”è¾ƒå·§çš„ä¸€é“é¢˜ã€‚è€ƒè™‘è¿™é¢˜æœ¬è´¨å…¶å®æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ä¸Šè¾¹çš„ LISã€‚å¯¹æ¯ä¸ª $x$ ç»´æŠ¤ä¸€ä¸ª <code>map</code> ï¼ˆæˆ–è€…åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ï¼‰ï¼Œå­˜å…¥è¾¹æƒå€¼ä¸º $v$ æ—¶çš„æœ€é•¿é€’å¢è·¯å¾„ã€‚è€ƒè™‘æ¯æ¬¡åŠ è¿›æ¥ä¸€æ¡è¾¹ $(u,v,w)$ï¼Œç­”æ¡ˆå°±æ˜¯ä» $u$ çš„ map é‡Œæ‰¾å‡ºæœ€å¤§çš„å°äº $w$ çš„å€¼ï¼Œæ ¹æ®å•è°ƒæ€§å¯çŸ¥è¿™ä¸€å®šæ˜¯å°äº $w$ çš„é‚£ä¸ªæœ€å¤§å€¼ã€‚ç„¶åæš´åŠ›æ”¹å°±å¥½äº†ã€‚ä¸éš¾çŸ¥é“è¿™æ ·åšæ¯æ¡è¾¹è‡³å¤šè¢«åŠ ä¸€æ¬¡ã€åˆ ä¸€æ¬¡ï¼Œå¤æ‚åº¦æ˜¯ $O(m\log n)$ ã€‚</p><p>æ€è€ƒäº†ä¸€ä¸‹ï¼Œè¿™æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª DPã€‚è®¾ $f_k$ ä¸ºæœ€åä¸€æ¡è¾¹ä¸ºç¬¬ $k$ æ¡è¾¹çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆè½¬ç§»å°±æ˜¯ä»ä»¥è¾¹ $k$ å§‹ç‚¹ä¸ºç»ˆç‚¹çš„æ‰€æœ‰è·¯å¾„é‡Œé€‰å‡ºä¸€ä¸ªæ¥è½¬ç§»ã€‚å…¶å®å¦‚æœè€ƒè™‘åˆ° DP çš„è¯ï¼Œå°±å˜æˆä¸€é“ä¸­è§„ä¸­çŸ©çš„é¢˜ç›®äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: <span class="built_in">map</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span> :: lower_bound ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> en end</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> be begin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lbd lower_bound</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">300010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> &lt;<span class="keyword">int</span>, ll&gt; lis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">auto</span> p = lis[x].lbd(v) ;</span><br><span class="line">    ret = (p == lis[x].be()) ? <span class="number">0</span> : ((-- p) -&gt; second) ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) ; <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;z) ;</span><br><span class="line">        res = search(x, z) ; ++ res ;</span><br><span class="line">        <span class="keyword">if</span> (res &gt; search(y, z))&#123;</span><br><span class="line">            <span class="keyword">auto</span> p = lis[y].lbd(z) ; lis[y][z] = res ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> q = p ; q != lis[y].en() ; )&#123;</span><br><span class="line">                <span class="keyword">if</span> ((q -&gt; second) &gt; res) <span class="keyword">break</span> ; q = lis[y].erase(q) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="built_in">std</span> :: max(ans, res) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><blockquote><p>ç»™ä½ ä¸‰ä¸ªæ­£æ•´æ•° $n$ï¼Œ$a$ï¼Œ$b$ï¼Œå®šä¹‰ $A$ ä¸ºä¸€ä¸ªæ’åˆ—ä¸­æ˜¯å‰ç¼€æœ€å¤§å€¼çš„æ•°çš„ä¸ªæ•°ï¼Œå®šä¹‰ $B$ ä¸ºä¸€ä¸ªæ’åˆ—ä¸­æ˜¯åç¼€æœ€å¤§å€¼çš„æ•°çš„ä¸ªæ•°ï¼Œæ±‚é•¿åº¦ä¸º $n$ çš„æ’åˆ—ä¸­æ»¡è¶³ $A = a$ ä¸” $B = b$ çš„æ’åˆ—ä¸ªæ•°ã€‚</p><p>$1\le n \le 10^5$ ã€‚ç­”æ¡ˆå¯¹ $998,244,353$ å–æ¨¡ã€‚</p></blockquote><p>æ„Ÿè§‰è¿™é¢˜æš´åŠ›çš„è¯æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„è®¡æ•°é¢˜äº†ã€‚è‡ªå·±ä¸€å¼€å§‹è®¾çš„çŠ¶æ€æ˜¯ $f_{i,j,k}$ è¡¨ç¤ºè€ƒè™‘äº† $1\sim i$ çš„æ’åˆ—ï¼Œå‰ç¼€æœ€å¤§å€¼ä¸ªæ•°ä¸º $j$ï¼Œåç¼€æœ€å¤§å€¼ä¸ªæ•°ä¸º $k$ æ—¶æ–¹æ¡ˆæ•°ï¼Œä½†æ˜¯å‘ç°æ— è®ºæ˜¯æ’å…¥æœ€å¤§å€¼è¿˜æ˜¯æ’å…¥æœ€å°å€¼éƒ½ä¸æ˜¯å¾ˆå®¹æ˜“è½¬ç§»ã€‚</p><p>ä½†æ˜¯å‘ç°å¦‚æœç¡®å®šäº†æœ€å¤§å€¼åœ¨å“ªé‡Œï¼Œæœ€åçš„ç­”æ¡ˆå°±ä¼šæ¯”è¾ƒå®¹æ˜“è®¡ç®—ã€‚å…·ä½“çš„ï¼Œè®¾ $f_{i,j}$ è¡¨ç¤ºè€ƒè™‘äº† $1\sim i$ çš„æ’åˆ—ï¼Œå‰ç¼€æœ€å¤§å€¼ä¸ªæ•°ä¸º $j$ çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆæœ€åç­”æ¡ˆå°±æ˜¯</p><script type="math/tex; mode=display">\sum_{i=1}^{n-1} \dbinom{n-1}{i}\times f_{i,a-1}\times f_{n-i-1,b-1}\qquad(1)</script><p>ç„¶åè€ƒè™‘ $f$ æ€ä¹ˆç®—ï¼Œå› ä¸ºæœ€å¤§å€¼ä¼šç›´æ¥å½±å“å‰ç¼€æœ€å¤§å€¼çš„ä¸ªæ•°ï¼Œæ‰€ä»¥è½¬ç§»è€ƒè™‘æ’å…¥æœ€å°å€¼ã€‚</p><script type="math/tex; mode=display">f_{i,j}=f_{i-1,j-1}+(i-1)\times f_{i-1,j}</script><p>åˆ†åˆ«å¯¹åº”äº†æ’åœ¨ç¬¬ä¸€ä½å’Œæ’åœ¨ä¸­é—´æˆ–è€…æœ«å°¾ã€‚</p><p>ä¸éš¾çœ‹å‡º $\{f\}$ å°±æ˜¯ $\begin{bmatrix} n \ k \end{bmatrix} $ ã€‚ç„¶åå¦‚æœç›´æ¥æš´åŠ›çš„è¯æ˜¯ $O(n^2)$ çš„ã€‚</p><p>è€ƒè™‘ç›´æ¥ä» $(1)$ å¼çš„ç»„åˆæ„ä¹‰å‡ºå‘è®¡ç®—è´¡çŒ®ã€‚å‘ç°å¯¹äºåé¢ä¸¤é¡¹ç¬¬ä¸€ç»´çš„æŒ‡æ ‡å’Œæ˜¯ä¸€å®šçš„ï¼Œæ¢å¥è¯è¯´åé¢ä¸¤é¡¹å¯ä»¥çœ‹åšå°±æ˜¯åœ¨ $n-1$ é‡Œæ‰¾å‡ºäº† $a+b-2$ ä¸ªåœˆæ¥ã€‚å‰é¢çš„é‚£ä¸ªäºŒé¡¹å¼ç³»æ•°å°±å¯ä»¥çœ‹åšæ˜¯å¯¹é€‰å–çš„ä¸€ä¸ªç»„åˆç³»æ•°ã€‚é‚£ä¹ˆå¯ä»¥çŸ¥é“æœ€åç­”æ¡ˆå°±åº”è¯¥æ˜¯</p><script type="math/tex; mode=display">\begin{bmatrix} n-1 \\ a+b-2 \end{bmatrix}\times \binom{a+b-2}{a-1}</script><p>äºæ˜¯å°±è½¬åŒ–æˆå¦‚ä½•å¿«é€Ÿæ±‚æ–¯ç‰¹æ—æ•°æŸä¸€é¡¹çš„é—®é¢˜äº†ã€‚ä½†æ˜¯è¿™ä¸ªå¹¶æ²¡æœ‰ä»€ä¹ˆå¿«é€Ÿçš„åšæ³•â€¦äºæ˜¯å°±åªèƒ½æ±‚å‡ºä¸€æ•´è¡Œã€‚</p><p>è¿™è¿˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ $s_1$ æ±‚ä¸€è¡Œã€‚å¤§æ¦‚æ˜¯è¯´æœ‰æ’ç­‰å¼</p><script type="math/tex; mode=display">\sum _{k=0}^{n-1} \begin{bmatrix} n \\ k \end{bmatrix} =x^{\bar{n}}=\prod_{i=0}^{n-1} (x-i)</script><p>åé¢é‚£ä¸ªå•é¡¹å¼æ˜¾ç„¶æ˜¯å¯ä»¥åˆ†æ²»åšçš„ã€‚äºæ˜¯æœ€åå¤æ‚åº¦ $n\log ^2n$ ã€‚</p><p>ä¸è¿‡è¿™ä¸œè¥¿æ˜¯æœ‰å• $\log$ çš„å€å¢åšæ³•çš„ã€‚ä¸è¿‡æ„Ÿè§‰ä¸€èˆ¬è¿™ç§é¢˜ä¹Ÿæ²¡æœ‰å¡ $\log ^2$ çš„æ„å‘ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Poly&#123;</span><br><span class="line">    <span class="keyword">int</span> k, d ;</span><br><span class="line">    <span class="keyword">int</span> rev[N] ;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">20</span>][N] ;</span><br><span class="line">    <span class="function">ll <span class="title">expow</span><span class="params">(ll x, ll y)</span></span>&#123;</span><br><span class="line">        ll ret = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (y)&#123;</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % P ;</span><br><span class="line">            x = x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre_rt</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">19</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">int</span>* r = g[i], ut ; r[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">            ut = r[<span class="number">1</span>] = expow(<span class="number">3</span>, <span class="number">998244352</span> / (<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>))) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> ; j &lt; (<span class="number">1</span> &lt;&lt; i) ; ++ j) r[j] = (ll)r[j - <span class="number">1</span>] * ut % P ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(T *f, <span class="keyword">int</span> L, <span class="keyword">bool</span> mk)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (rev[i] &lt; i) swap(f[i], f[rev[i]]) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; L ; i &lt;&lt;= <span class="number">1</span>, ++ l)&#123;</span><br><span class="line">            <span class="keyword">int</span> *r = g[l], o = i &lt;&lt; <span class="number">1</span>, rt, irt ;</span><br><span class="line">            <span class="keyword">for</span> (rg <span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; L ; j += o)</span><br><span class="line">                <span class="keyword">for</span> (rg <span class="keyword">int</span> k = j ; k &lt; i + j ; ++ k)&#123;</span><br><span class="line">                    rt = f[k], irt = f[k + i] * r[k - j] % P ;</span><br><span class="line">                    f[k] = addn(rt, irt), f[k + i] = decn(rt, irt) ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!mk) <span class="keyword">return</span> ;</span><br><span class="line">        reverse(f + <span class="number">1</span>, f + L) ;</span><br><span class="line">        <span class="keyword">int</span> o = expow(L, P - <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i) (f[i] *= o) %= P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getlen</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        d = <span class="number">1</span>, k = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (d &lt;= x) d &lt;&lt;= <span class="number">1</span>, ++ k ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++ i)</span><br><span class="line">            rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (k - <span class="number">1</span>)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    ll tl[N] ;</span><br><span class="line">    ll tr[N] ;</span><br><span class="line">    <span class="keyword">int</span> len[N * <span class="number">3</span>] ;</span><br><span class="line">    vll poly[N * <span class="number">3</span>] ;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">            len[rt] = <span class="number">1</span> ;</span><br><span class="line">            poly[rt].p_b(<span class="number">1</span>) ;</span><br><span class="line">            poly[rt].p_b(l) ;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        cdq(lc, l, mid) ;</span><br><span class="line">        cdq(rc, mid + <span class="number">1</span>, r) ;</span><br><span class="line">        getlen(len[rt] = len[lc] + len[rc]) ;</span><br><span class="line"><span class="built_in">memset</span>(tl + len[lc] + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len[lc])) ;</span><br><span class="line"><span class="built_in">memset</span>(tr + len[rc] + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len[rc])) ;</span><br><span class="line"><span class="comment">//        for (int i = len[lc] + 1 ; i &lt;= d ; ++ i) tl[i] = 0 ;</span></span><br><span class="line"><span class="comment">//        for (int i = len[rc] + 1 ; i &lt;= d ; ++ i) tr[i] = 0 ;</span></span><br><span class="line">rg <span class="keyword">auto</span> lp = poly[lc].begin(), rp = poly[rc].begin() ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[lc] ; ++ i) tl[i] = *(lp ++) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[rc] ; ++ i) tr[i] = *(rp ++) ;</span><br><span class="line">        NTT(tl, d, <span class="number">0</span>) ; NTT(tr, d, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= d ; ++ i) (tl[i] *= tr[i]) %= P ;</span><br><span class="line">        NTT(tl, d, <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= len[rt] ; ++ i) poly[rt].p_b(tl[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> a, b ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll fac[N] ;</span><br><span class="line">ll inv[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;<span class="comment">//\binom&#123;x&#125;&#123;y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prework</span><span class="params">(<span class="keyword">int</span> mx)</span></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">0</span>] = <span class="number">1</span> ; ans = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= mx + <span class="number">1</span> ; ++ i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[mx + <span class="number">1</span>] = Poly :: expow(fac[mx + <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mx ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    gi(n) ; gi(a) ; gi(b) ; prework(n &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (n == <span class="number">1</span>) &#123; print(a &amp; b) ; <span class="keyword">return</span> <span class="number">0</span> ; &#125;  </span><br><span class="line"><span class="keyword">if</span> (!a || !b || a + b - <span class="number">1</span> &gt; n) &#123; pc(<span class="string">'0'</span>) ; <span class="keyword">return</span> <span class="number">0</span> ; &#125;</span><br><span class="line">    </span><br><span class="line">Poly :: pre_rt() ; Poly :: cdq(<span class="number">1</span>, <span class="number">0</span>, n - <span class="number">2</span>) ;</span><br><span class="line">    reverse(Poly :: poly[<span class="number">1</span>].begin(), Poly :: poly[<span class="number">1</span>].end()) ;</span><br><span class="line">    ans = Poly :: poly[<span class="number">1</span>][a + b - <span class="number">2</span>] * binom(a + b - <span class="number">2</span>, a - <span class="number">1</span>) % P ;</span><br><span class="line">    print(ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ„Ÿè§‰è¿™åœºçš„é¢˜ç›®è´¨é‡è¿˜æ˜¯ä¸é”™çš„ï¼Ÿç¡®å®æ¯”ä»¥å‰ vp è¿‡çš„å‡ åœº (Div1+Div2) è¦å¥½å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æ˜¯æŠŠé™¤äº† H ä¹‹å¤–ä¸€æ•´åœºçš„é¢˜ç›®éƒ½åšæ‰äº†ã€‚æœ‰äº›ä¸æ˜¯ååˆ†å¿…è¦å†™çš„é¢˜ç›®å½“ç„¶å°±æ˜¯å£èƒ¡å•¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ€ç»´é¢˜/æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="å¥½å¤šå¥½å¤šç»†èŠ‚" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="å¤šé¡¹å¼çš„åº”ç”¨/åˆ†æ²»FFT" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8-%E5%88%86%E6%B2%BBFFT/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ ‘å½¢DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="ç»„åˆè®¡æ•°/æ–¯ç‰¹æ—æ•°" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%96%AF%E7%89%B9%E6%9E%97%E6%95%B0/"/>
    
      <category term="æ•°æ®ç»“æ„/æ•°æ®ç»“æ„æ–¹æ³•/è½»é‡é“¾å‰–åˆ†" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%96%B9%E6%B3%95-%E8%BD%BB%E9%87%8D%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒè®°å½•ã€‘6.4 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/05/6-4-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/05/6-4-è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-04T23:49:54.000Z</published>
    <updated>2020-06-05T06:07:14.916Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ç”±äºå¥‡å¥‡æ€ªæ€ªçš„åŸå› (å…¶å®æ˜¯å› ä¸ºå¤ªå›°+vp CF)ï¼Œäºæ˜¯å°±åˆæ‘¸äº†å¥½ä¹…â€¦</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>çœ‹ä¸Šå»å°±æ˜¯ä¸€ä¸ªç»„åˆæ¸¸æˆï¼Œäºæ˜¯è€ƒè™‘å…ˆåˆ†ç±»å‡ºå±€é¢æ¥ã€‚å‘ç°ç¡®å®šçš„å¿…è´¥æ€å¿…ç„¶æ˜¯åªå‰©ä¸¤ä¸ªç‚¹ï¼Œè¿™æ—¶åæ‰‹å¿…èƒœã€‚é‚£ä¹ˆæ¥ç€è€ƒè™‘ä¸­é—´çš„æŸäº›å¿…è´¥å¿…èƒœæ€éƒ½æ˜¯æ€ä¹ˆäº’ç›¸è½¬ç§»çš„ã€‚</p><p>ç„¶åå¤§æ¦‚å°±æ˜¯é ä»€ä¹ˆå…ˆéªŒç›´è§‰æ¥è§‚å¯Ÿäº†ã€‚è€ƒè™‘åªå‰©ä¸¤ä¸ªç‚¹çš„æ—¶å€™ä¸å­˜åœ¨å¶åº¦ç‚¹ï¼ŒåŒæ—¶è¿™ä¸ªåšå¼ˆé•¿å¾—å°±è·Ÿåº¦æ•°ååˆ†æœ‰å…³ã€‚é‚£ä¹ˆå°±å¯ä»¥çŒœä¸€æ³¢åº¦æ•°ã€‚å…·ä½“çš„ï¼Œå°†å±€é¢åˆ†æˆä¸¤ç±»ï¼Œã€Œå…¨éƒ½æ˜¯å¥‡åº¦ç‚¹ $P$ã€å’Œã€Œè‡³å°‘å­˜åœ¨ä¸€ä¸ªå¶åº¦ç‚¹ $Q$ã€ã€‚å‘ç°å±€é¢ $Q$ è‡³å°‘å¯ä»¥ä¸“ç”¨åˆ°ä¸€ä¸ª $P$ ï¼Œè€Œå±€é¢ $P$ è½¬ç§»åˆ°çš„ä¸€å®šéƒ½æ˜¯å±€é¢ $Q$ ï¼Œå†åŠ ä¸Š $P$ ä¸€å®šåŒ…å«è‡³å°‘ä¸€ä¸ªå¿…è´¥æ€(å³ç»ˆæ€)ï¼Œæ‰€ä»¥ä¸éš¾çŸ¥é“è¿™ç§åˆ†ç±»è¿™ç¬¦åˆç»„åˆæ¸¸æˆå¯¹äºå¿…è´¥æ€å’Œå¿…èƒœæ€çš„å®šä¹‰ã€‚</p><p>äºæ˜¯å°±çåˆ¤ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p>ç»™å‡ºä¸€æ£µäºŒå‰æ ‘ã€‚é—®èƒ½å¦ç»™æ‰€æœ‰ç‚¹é»‘ç™½æŸ“è‰²ï¼Œä½¿å¾—åœ¨å°†è¿™æ£µæ ‘çš„æ‰€æœ‰å¶å­ç”¨ç©ºèŠ‚ç‚¹è¡¥å…¨ä¹‹åæ»¡è¶³ï¼š</p><p>1ã€ä»»æ„ä¸¤ä¸ªç™½ç‚¹ä¸ç›¸é‚»ã€‚</p><p>2ã€ä»æ ¹èŠ‚ç‚¹åˆ°ä»»æ„ä¸€ä¸ªç©ºèŠ‚ç‚¹ç»è¿‡çš„é»‘ç‚¹ä¸ªæ•°ä¸€æ ·å¤šã€‚</p><p>$1\leq n\leq 5000$ ã€‚</p></blockquote><p>ä¸€å¼€æ—¶è§‰å¾—ä¸ºäº†ä½¿ä¹‹å°½é‡åˆæ³•ï¼Œæ‰€ä»¥åº”è¯¥è®©æœ€é•¿çš„é‚£æ¡é“¾ä¸Šé»‘ç‚¹ä¸ªæ•°æ°å¥½æ˜¯ä¸€åŠâ€¦åæ­£å°±æ˜¯æ¨äº†å‡ ä¸ªç±»ä¼¼çš„ç¿æ™ºç»“è®ºï¼Œç„¶åå°±å½“åœºå»ä¸–äº†QAQã€‚</p><h2 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h2><p>è€ƒè™‘ç›´æ¥ç”¨ dp ç¡®å®šåˆæ³•æ€§ã€‚è®¾ $f_{i,j,0/1}$ è¡¨ç¤ºä»¥ $i$ ä¸ºæ ¹çš„å­æ ‘ï¼Œæ¯æ¡æ ¹åˆ°ç©ºèŠ‚ç‚¹è·¯å¾„ä¸Šçš„é»‘ç‚¹ä¸ªæ•°ä¸º $j$ ï¼Œå½“å‰ç‚¹æ¶‚æˆé»‘/ç™½æ˜¯å¦å¯ä»¥ã€‚é‚£ä¹ˆè½¬ç§»å°±æ˜¯æšä¸¾ä¸€ä¸ªå·¦å­æ ‘è½¬ç§»ã€‚</p><script type="math/tex; mode=display">f_{i,j,0}=\bigcap f_{k,j,1}\\f_{i,j,1}=\bigcap \left(f_{k,j-1,1}\cup f_{k,j-1,0}\right)</script><p>ç„¶ååˆå€¼çš„è¯ï¼Œè€ƒè™‘å¦‚æœæŸä¸ªå¶å­æ²¡æœ‰å…„å¼Ÿçš„è¯å°±å¿…é¡»æ¶‚ç™½è‰²ã€‚</p><p>äºæ˜¯å°±å¯ä»¥ç›´æ¥å¯¹ç€ $\{f\}$ æ„é€ äº†ã€‚å¤æ‚åº¦ $O(n^2)$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line">vint E[N] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">bool</span> foc[N] ;</span><br><span class="line"><span class="keyword">char</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N][<span class="number">2</span>] ;<span class="comment">//0r1b</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> r = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (E[x].size() == <span class="number">1</span>) foc[y] = <span class="number">1</span> ;</span><br><span class="line">        dep[y] = dep[x] + <span class="number">1</span> ;</span><br><span class="line">        dfs(y) ; r = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!r)&#123;</span><br><span class="line">        <span class="keyword">if</span> (foc[x])</span><br><span class="line">            f[x][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            f[x][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">            f[x][<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (E[x].size())&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            f[x][j][<span class="number">0</span>] = f[x][j][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        solve(y) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">            f[x][j][<span class="number">0</span>] &amp;= f[y][j][<span class="number">1</span>] ;</span><br><span class="line">            f[x][j][<span class="number">1</span>] &amp;= f[y][j - <span class="number">1</span>][<span class="number">1</span>] | f[y][j - <span class="number">1</span>][<span class="number">0</span>] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out_p</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> cnt_b, <span class="keyword">int</span> col)</span></span>&#123;</span><br><span class="line">    ans[x] = <span class="string">"RB"</span>[col] ;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; cnt_b &lt;&lt; " " &lt;&lt; col &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (!col || !f[y][cnt_b - <span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line">            out_p(y, cnt_b - col, <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">else</span> out_p(y, cnt_b - col, <span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; <span class="keyword">int</span> x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span> ; y &lt;= n ; ++ y)</span><br><span class="line">        x = qr(), E[x].push_back(y) ;</span><br><span class="line">    rt = E[<span class="number">0</span>][<span class="number">0</span>] ; dfs(rt) ; solve(rt) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; f[rt][i][0] &lt;&lt; " " &lt;&lt; f[rt][i][1] &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">if</span> (f[rt][i][<span class="number">0</span>]) <span class="keyword">return</span> out_p(rt, i, <span class="number">0</span>), !<span class="built_in">puts</span>(ans + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (f[rt][i][<span class="number">1</span>]) <span class="keyword">return</span> out_p(rt, i, <span class="number">1</span>), !<span class="built_in">puts</span>(ans + <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">puts</span>(<span class="string">"Impossible"</span>) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h2><p>ä¸Šé¢é‚£ä¸ªåšæ³•æ˜¯èƒƒç–¼åšæ³•ï¼Œèƒƒç–¼åœ¨æ²¡æœ‰æ·±åˆ»å‘ç°æ€§è´¨ã€‚</p><p>é¦–å…ˆè®¾æ•´æ£µæ ‘é‡Œæ‰€æœ‰å¶å­å’Œåªæœ‰ä¸€ä¸ªå­©å­çš„ç‚¹ä¸ºå…³é”®ç‚¹ã€‚é‚£ä¹ˆå¦‚æœå…³é”®ç‚¹ä¸­æ·±åº¦æå·® $\geqslant 2$ å¯ä»¥çŸ¥é“å¿…ç„¶ä¸å­˜åœ¨è§£ï¼Œå› ä¸ºè¿™æ ·å¿…ç„¶ä¼šå¤šä¸€ä¸ªé»‘ç‚¹ã€‚ä¹‹åè€ƒè™‘è¿™æ˜¯ä¸€å®šå¯ä»¥é»‘ç™½æŸ“è‰²çš„ï¼Œå› ä¸ºçº¢é»‘æ ‘æœ¬è´¨ä¸Šæ¯”è¿™ä¸ªé™åˆ¶è¦å¤šä½†ä¾ç„¶å¯ä»¥çº¢é»‘æŸ“è‰²ã€‚å…·ä½“çš„å¯ä»¥è€ƒè™‘è®©æ‰€æœ‰å’Œæœ€å°æ·±åº¦å…³é”®ç‚¹æ·±åº¦çš„å¥‡å¶æ€§ç›¸åŒçš„ç‚¹éƒ½æŸ“æˆé»‘è‰²ï¼Œå¦åˆ™æŸ“æˆçº¢è‰²ã€‚ä¸éš¾çŸ¥é“è¿™æ˜¯åˆæ³•çš„ã€‚</p><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>å¯¹äºä»»æ„ $1â‰¤kâ‰¤n$ï¼Œ æ±‚æœ‰å¤šå°‘ä¸ªå·¦å³åŒºåˆ†çš„æ°æœ‰ $k$ ä¸ªå¶å­èŠ‚ç‚¹çš„äºŒå‰æ ‘ï¼Œ æ»¡è¶³å¯¹äºæ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ²¡æœ‰å¶å­èŠ‚ç‚¹è¦ä¹ˆæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ åŒæ—¶ä¸å­˜åœ¨ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œ ä½¿å¾—æ ¹åˆ°å®ƒçš„è·¯å¾„ä¸Šæœ‰ä¸å°‘äº $m$ æ¡å‘å·¦çš„è¾¹ã€‚</p><p>ä½ åªéœ€è¦æ±‚å‡ºç­”æ¡ˆå¯¹ $998244353$ å–æ¨¡çš„ç»“æœã€‚</p><p>$1\leq n\leq 5000$ ã€‚</p></blockquote><p>æ¯”è¾ƒè€ƒå¯ŸåŸºç¡€çš„ä¸€é“ç»å…¸ DPï¼Ÿè™½ç„¶ä¸æ˜¯å¾ˆéš¾ã€‚</p><h2 id="Sol-1-1"><a href="#Sol-1-1" class="headerlink" title="Sol 1"></a>Sol 1</h2><p>æ¯”è¾ƒæš´åŠ›çš„æƒ³æ³•å°±æ˜¯è®¾è®¡ä¸€ä¸ª $f_{i,j}$ è¡¨ç¤ºå½“å‰æœ‰äº† $i$ ä¸ªå¶å­èŠ‚ç‚¹ï¼Œåˆ°æ¯ä¸ªå¶å­å·¦è¾¹ä¸ªæ•°æœ€å¤šä¸º $j$ çš„æ–¹æ¡ˆæ•°ã€‚è½¬ç§»çš„è¯è€ƒè™‘æšä¸¾å¶å­æ•°ï¼Œæ‹†å·¦å­æ ‘</p><script type="math/tex; mode=display">f_{i,j}=\sum _{k}f_{k,j-1}\times f_{i - k,j}</script><p>å³è€ƒè™‘æ‹†å‡ºæ¥çš„é‚£æ¡å·¦è¾¹å¯¹ç­”æ¡ˆçš„è´¡çŒ®ã€‚å¤æ‚åº¦ $O(n^3)$ ã€‚</p><p>ç„¶åå‘ç°è¿™æ˜¯ä¸ªå·ç§¯çš„å½¢å¼ï¼Œå¯ä»¥ä¿¡ä»°ä¸€æ³¢ä¼˜åŒ–åˆ° $O(n^2\log n)$ é€šè¿‡æ­¤é¢˜ã€‚</p><h2 id="Sol-2-1"><a href="#Sol-2-1" class="headerlink" title="Sol 2"></a>Sol 2</h2><p>è€ƒè™‘ä¸Šé¢é‚£ä¸ªåšæ³•å±å®èƒƒç–¼ã€‚è§‚å¯Ÿè½¬ç§»å¯ä»¥å‘ç°æ¯æ¬¡è½¬ç§»å·¦å­æ ‘å’Œå³å­æ ‘çš„ $j$ çš„å·®ä¸º $1$ ä¸”å›ºå®šã€‚äºæ˜¯å¯ä»¥æŠŠç¬¬äºŒç»´æ¢ä¸€ä¸‹ã€‚è®¾ $f_{i,k}$ è¡¨ç¤ºä»¥ $i$ ä¸ºæ ¹ï¼Œå·¦å³å­æ ‘çš„å·¦è¾¹ä¸ªæ•°ä¹‹å·®ä¸º $k$ çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆè€ƒè™‘æ¯æ¬¡æŒ‰ç…§ $dfs$ åºçš„é¡ºåºï¼Œå³å…ˆå·¦åå³ï¼Œæ’å…¥ä¸€ä¸ªæ–°çš„å¶å­ï¼Œä¼šå¾—åˆ°</p><script type="math/tex; mode=display">\begin{aligned}f_{i,k}&\to f_{i,k+1}\\f_{i,k}&\to f_{i+1,k-1} \end{aligned}</script><p>å³åˆ†ç±»è®¨è®ºæ’å…¥çš„æ˜¯å·¦å¶å­è¿˜æ˜¯å³å¶å­ã€‚å¤æ‚åº¦ $O(n^2)$ ã€‚</p><h2 id="Sol-3-by-duye"><a href="#Sol-3-by-duye" class="headerlink" title="Sol 3 (by duye)"></a>Sol 3 (by duye)</h2><p>è€ƒè™‘ä¸€ä¸ªè·‘å¾—æ›´å¿«çš„åšæ³•ã€‚å¤§æ¦‚è¯´è®¾é™åˆ¶ä¸º $m$ æ—¶çš„è¿™ç§æ ‘çš„ OGF æ˜¯ $F_m(x)$ï¼Œå…¶ä¸­ $[x^n]F_m(x)$ è¡¨ç¤ºæœ‰ $n$ ä¸ªå¶å­çš„ç»“æœã€‚é‚£ä¹ˆæœ‰è½¬ç§»</p><script type="math/tex; mode=display">F_m(x)=x\cdot F_{m-1}(x)\cdot F_m(x)+1</script><p>æ„Ÿè§‰è¿˜æ˜¯æŒºæ˜¾ç„¶çš„ï¼Ÿæœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ‹¼æ’ä¸€æ£µäºŒå‰æ ‘ã€‚å†™æˆé€’æ¨å½¢å¼å°±æ˜¯</p><script type="math/tex; mode=display">F_m(x)=\dfrac{1}{1-x\cdot F_{m-1}(x)}</script><p>å‘ç°å¯ä»¥åˆ†åˆ«ç»´æŠ¤åˆ†å­åˆ†æ¯ï¼Œæœ€åæ±‚é€†ä¸€æ¬¡å°±å¥½äº†ã€‚å¤æ‚åº¦ $O(n^2+n\log n)$ ã€‚ä½†å› ä¸ºå‰é¢ç»´æŠ¤åˆ†å­åˆ†æ¯åªç”¨ $\deg(F)$ æ¬¡è¿ç®—ï¼Œæ‰€ä»¥æœ€åå¸¦ä¸€ä¸ª $\dfrac{1}{2}$ çš„å¸¸æ•°ã€‚å®é™…æ•ˆç‡ä¼˜ç§€ã€‚</p><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p>æ¯”è¾ƒç®€å•çš„é¢˜ç›®ï¼Œä½†æ˜¯æ„Ÿè§‰ trick æŒºæ–°é¢–ã€‚</p><p>è€ƒè™‘é¦–å…ˆã€Œæœ€å°ã€ä¸€å®šæ˜¯å¯¹æ¯ä¸€è¶Ÿèˆªç­ä»å¤§åˆ°å°æ’åºæ¥åšï¼ŒåŒæ—¶ä¸åŒçš„èˆªç­ä¹‹é—´å½¼æ­¤æ²¡æœ‰å½±å“ã€‚ä¹‹åè€ƒè™‘å¦‚ä½•ç®—æœŸæœ›ã€‚ç”±äºç®—æœŸæœ›æ—¶ç»ˆæ€å›ºå®šï¼Œæ‰€ä»¥è€ƒè™‘å€’ç€åšã€‚è®¾ $\mathbb{E}_i$ è¡¨ç¤ºè€ƒè™‘ $i\sim n$ çš„èˆªç­çš„æœŸæœ›æœ€å°æ­¥æ•°ï¼Œå‘ç°æœ‰è½¬ç§»</p><script type="math/tex; mode=display">\mathbb{E}_i=\zeta(i)+\sum _{j=1}^{k_i}\left(\prod_{k=1}^{j-1} (1-p_{i,k})\right)\cdot p_{i,j} \cdot (\mathbb{E}_{i+1}+j)</script><p>å…¶ä¸­ $\zeta(i)$ æ˜¯è¿™è¶Ÿèˆªç­æ£€æŸ¥å®Œäº†ä¸€ä¸ªåæ‰çš„éƒ½æ²¡æœ‰çš„æœŸæœ›ï¼Œè½¬ç§»è·Ÿåé¢å·®ä¸å¤šä½†æ˜¯è¾¹ç•Œæ¯”è¾ƒå¥‡æ€ªå°±å•åˆ—å‡ºæ¥äº†ã€‚</p><p>é‚£ä¹ˆè€ƒè™‘ç­”æ¡ˆæœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ±‚è¿™ä¸ªä¸œè¥¿çš„æœ€å°å€¼ã€‚è€ƒè™‘è¿™ç›¸å½“äºæ˜¯ä¸€ç³»åˆ—ä¸€æ¬¡å‡½æ•°çš„åµŒå¥—ï¼Œäºæ˜¯è€ƒè™‘æŒ‰ç…§ä»€ä¹ˆé¡ºåºå»åµŒå¥—è¿™ $n$ ä¸ªå‡½æ•°ã€‚è€ƒè™‘å¦‚ä¸‹ååºå…³ç³»ï¼š</p><script type="math/tex; mode=display">\tau_i(\tau_j+\epsilon_j)+\epsilon_i<\tau_j(\tau_i+\epsilon_i)+\epsilon_j</script><p>ç§»é¡¹å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\frac{\tau_i-1}{\epsilon_i}<\frac{\tau_j-1}{\epsilon_j}</script><p>äºæ˜¯æŒ‰ç…§è¿™ä¸ªæ’åºå°±å¥½äº†ã€‚å¤æ‚åº¦ $O(\sum k_i+n\log n)$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"></span><br><span class="line">db ans ;</span><br><span class="line">db base[N] ;</span><br><span class="line">pdb func[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; db res, t ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k) ; res = <span class="number">1.0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= k ; ++ j) <span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;base[j]) ;</span><br><span class="line">        sort(base + <span class="number">1</span>, base + k + <span class="number">1</span>, [](db x, db y)&#123; <span class="keyword">return</span> x &gt; y ; &#125;) ;</span><br><span class="line">        <span class="keyword">while</span> (k &amp;&amp; base[k] &lt;= eps) k -- ;</span><br><span class="line">        <span class="keyword">if</span> (base[<span class="number">1</span>] &gt;= <span class="number">1.0</span> - eps) &#123; n --, i -- ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= k ; ++ j)&#123;</span><br><span class="line">            t = res * base[j], res *= (<span class="number">1.0</span> - base[j]) ;</span><br><span class="line">            func[i].fr += t , func[i].sc += t * j ;</span><br><span class="line">        &#125;</span><br><span class="line">        func[i].sc += res * k ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(func + <span class="number">1</span>, func + n + <span class="number">1</span>, [](pdb a, pdb b)&#123; <span class="keyword">return</span> a.fr * b.sc + a.sc &lt; b.sc + b.fr * a.sc ; &#125;) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        ans = func[i].fr * ans + func[i].sc ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.10lf"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>$1\leq m\leq 10^6,1\leq n\leq 30$ ã€‚</p></blockquote><p>é¦–å…ˆå…ˆçœ‹è¿™ä¸ªè¯¡å¼‚æ“ä½œï¼Œä¸éš¾å‘ç°å°±æ˜¯å·¦ç§»ï¼Œå¦‚æœ $2^{n-1}$ ä½æ˜¯ $1$ï¼Œé‚£ä¹ˆå°±æŠŠç¬¬ä¸€ä½æˆ–æˆ $1$ï¼Œå† $\rm and$ ä¸Š $2^{n}-1$ â€¦ç»“æœå‘ç°è¿™å°±æ˜¯ä¸€ä¸ªå¾ªç¯å·¦ç§»çš„æ“ä½œã€‚</p><p>ç„¶åä¸éš¾çœ‹å‡ºåˆå€¼æœ‰é™ã€‚ä½†æ˜¯å› ä¸ºåˆå€¼çš„é€‰å–å’Œå° Y çš„å†³ç­–éƒ½æ˜¯å˜é‡ï¼Œæ‰€ä»¥è€ƒè™‘å®šä½ä¸€è¾¹ã€‚å‘ç°è®© $x$ å¾ªç¯å·¦ç§»ä¹‹åå†å¼‚æˆ–ï¼Œç”±äºä½è¿ç®—çš„äº¤æ¢å¾‹ï¼Œæœ¬è´¨ä¸Šå¯ä»¥ç­‰ä»·äºè®©ç¬¬ $1\sim i$ çš„å‰ç¼€æ•´ä½“å¾ªç¯å·¦ç§»ä¸€ä½ç„¶åå†å¼‚æˆ–ä¸Š $x &lt;&lt; 1$ ï¼Œå³</p><script type="math/tex; mode=display">(a\operatorname{xor}b) \operatorname{<<}1=(a \operatorname{<<}1)\operatorname{xor}(b\operatorname{<<}1)</script><p>ç„¶åå°±å¯ä»¥é¢„å¤„ç†å¤„ä¸€ä¸ª $\{b_n\}$ è¡¨ç¤º</p><script type="math/tex; mode=display">(x<<1)\operatorname{xor} b_i=\left(x\operatorname{xor}{\left(\bigoplus_{j=1}^{i}a_i\right)}\right) <<1</script><p>ç„¶åè€ƒè™‘å¯¹äºä¸€ä¸ªå›ºå®šçš„ $x$ ï¼Œå° Y çš„ç­–ç•¥å°±ä¼šæ˜¯æ‰¾åˆ°å¯¹äºä¸€ä¸ªå›ºå®šçš„ $x$ çš„æœ€å°çš„ $b_i$ï¼Œè€Œå° D çš„ç­–ç•¥åˆ™æ˜¯é€‰æ‹©æœ€ä¼˜çš„åˆå€¼è¾¾åˆ°æœ€å¤§çš„ç»“æœã€‚</p><p>äºæ˜¯è€ƒè™‘æŒ‰ä½åˆ†æ²»ã€‚å…ˆå¯¹ $\{b_n\}$ æ’ä¸ªåºï¼Œè¿™æ ·å¯¹äºæ¯ä¸€ä½ä¸º $1$ æˆ–æ˜¯ä¸º $0$ å°±æ˜¯ä¸€ä¸ªè¿ç»­çš„åŒºé—´ã€‚é‚£ä¹ˆå¦‚æœæ•´ä¸ªåŒºé—´ä¸­çš„æ‰€æœ‰ $b_i$ ç¬¬ $p$ ä½å‡ä¸º $1$ ï¼Œé‚£ä¹ˆè¿™ä¸€ä½å°±å¿…é¡»è¦é€‰ $1$ ï¼Œå¦åˆ™å° Y å¯ä»¥åœ¨å° D é€‰ $0$ çš„æ—¶å€™ä¹Ÿé€‰ $0$ï¼Œé€‰ $1$ çš„æ—¶å€™ä¹Ÿé€‰ $1$ ä½¿å¾—ç­”æ¡ˆæœ€å°ã€‚</p><p>æ³¨æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸éœ€è¦ä½“ç°å‡º $x$ ä¹Ÿè¦ $&lt;&lt;1$ è¿™ä¸€ç‚¹æ¥ï¼Œå› ä¸ºæ¯ä¸ª $x$ å¯¹åº”ç€å”¯ä¸€çš„ $x&lt;&lt;1$ ï¼Œè€Œæˆ‘ä»¬åªå…³å¿ƒæœ€åçš„æœ€å°ç­”æ¡ˆå’Œæ–¹æ¡ˆæ•°ï¼Œå¹¶ä¸å…³å¿ƒå…·ä½“é€‰äº†ä»€ä¹ˆ $x$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> a[N] ;</span><br><span class="line"><span class="keyword">int</span> b[N] ;</span><br><span class="line"><span class="keyword">int</span> pre[N] ;</span><br><span class="line"><span class="keyword">int</span> suf[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p, <span class="keyword">int</span> res)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; p &lt;&lt; " " &lt;&lt; res &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (p &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (res &gt; ans)</span><br><span class="line">            ans = res, cnt = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (res == ans) ++ cnt ;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = l, now = <span class="number">1</span> &lt;&lt; p ;</span><br><span class="line">    <span class="keyword">while</span> (mid &lt;= r &amp;&amp; !(b[mid] &amp; now)) ++ mid ;</span><br><span class="line">    <span class="keyword">if</span> (mid == l || mid &gt; r)</span><br><span class="line">        <span class="keyword">return</span> solve(l, r, p - <span class="number">1</span>, res | now) ;</span><br><span class="line">    solve(l, mid - <span class="number">1</span>, p - <span class="number">1</span>, res) ;</span><br><span class="line">    solve(mid, r, p - <span class="number">1</span>, res) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i) a[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i) pre[i] = pre[i - <span class="number">1</span>] ^ a[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m ; i &gt;= <span class="number">1</span> ; -- i) b[i - <span class="number">1</span>] = suf[i] = suf[i + <span class="number">1</span>] ^ a[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        b[i] ^= ((pre[i] &gt;&gt; (n - <span class="number">1</span>) | (pre[i] &lt;&lt; <span class="number">1</span>)) &amp; ((<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>)) ;</span><br><span class="line">    sort(b, b + m + <span class="number">1</span>) ; solve(<span class="number">0</span>, m, n - <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">"\n"</span> ; <span class="keyword">if</span> (T) <span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äºå¥‡å¥‡æ€ªæ€ªçš„åŸå› (å…¶å®æ˜¯å› ä¸ºå¤ªå›°+vp CF)ï¼Œäºæ˜¯å°±åˆæ‘¸äº†å¥½ä¹…â€¦&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="æ€ç»´é¢˜/è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ™®é€šDP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="æ€ç»´é¢˜/æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="æŠ€å·§/åˆ†æ²»" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="æ•°å­¦/æ¦‚ç‡,æœŸæœ›" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="å¤šé¡¹å¼çš„åº”ç”¨" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    
      <category term="æŠ€å·§/æŒ‰ä½è€ƒè™‘" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E6%8C%89%E4%BD%8D%E8%80%83%E8%99%91/"/>
    
      <category term="æŠ€å·§/çŠ¶æ€åˆå¹¶" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E7%8A%B6%E6%80%81%E5%90%88%E5%B9%B6/"/>
    
      <category term="æ€ç»´é¢˜/å¯¹åº”ä¸è½¬åŒ–" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AF%B9%E5%BA%94%E4%B8%8E%E8%BD%AC%E5%8C%96/"/>
    
      <category term="åšå¼ˆè®º/ç»„åˆæ¸¸æˆ" scheme="https://www.orchidany.cn/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA-%E7%BB%84%E5%90%88%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢˜è§£ã€‘[Codeforces Global Round#5 A~F] å£èƒ¡è®°</title>
    <link href="https://www.orchidany.cn/2020/06/04/CF-Global-Round-5%E5%8F%A3%E8%83%A1%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/04/CF-Global-Round-5å£èƒ¡è®°/</id>
    <published>2020-06-04T07:54:22.000Z</published>
    <updated>2020-06-04T08:58:22.600Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å•ç‹¬æ•´ç†è¿™ä¸€åœºï¼Œä¸€æ˜¯å› ä¸ºè¿™ä¸€åœºçš„é¢˜ç›®è´¨é‡æ•´ä½“æ¯”è¾ƒé«˜ï¼ŒäºŒæ˜¯å› ä¸ºè¿™ä¸€åœºçš„ E æ˜¯å®åœ¨æ˜¯æœ‰ç‚¹ç¥ä»™â€¦</p><p>æ‰˜è€å¸ˆè¿˜æ˜¯å®åˆ€ä¸è€é¸­ï¼</p><p>ä»¥ä¸‹éƒ¨åˆ†ç®€å•é¢˜æ˜¯åœ¨å®¿èˆè‡ªä¹ å®¤é‡Œå£èƒ¡å‡ºæ¥çš„ã€‚</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p>ç§’äº†ã€‚é¢˜é¢å¤ªé•¿äº†ã€‚è€ƒè™‘ä¸€å®šå¯ä»¥è®©æ­£æ•°å’Œè´Ÿæ•°å„ä½™å‡º $1$ çš„è´¡çŒ®ï¼Œç„¶åå°±åšå®Œäº†ã€‚</p><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><p>ç§’äº†ã€‚ä¸€å¼€å§‹è§‰å¾—å¯èƒ½æ˜¯ä»€ä¹ˆä¿©æ’åˆ—çš„ LCS ä¹‹ç±»çš„ã€‚åæ¥é‡è¯»äº†ä¸€éé¢˜å‘ç°åŸæ¥åªéœ€è¦è®°ä¸€ä¸ªå‰ç¼€ $\max$ å»åˆ¤æ–­æ˜¯å¦æœ‰è½¦è¢«è‡ªå·±ä¹‹åçš„è¶…äº†å°±å®Œäº†ã€‚</p><h1 id="C1-amp-C2"><a href="#C1-amp-C2" class="headerlink" title="C1 &amp; C2"></a>C1 &amp; C2</h1><p>è¿™ä¸ª C ä¸çŸ¥ä¸ºä½•æŠŠæˆ‘ç»™ç‹™äº†â€¦äºæ˜¯å°±åªèƒ¡å‡ºæ¥äº† C1ã€‚</p><p>C1 å¤§æ¦‚æ˜¯è€ƒè™‘å…ˆ $n^2$ æ±‚ä¸€éäº¤ï¼Œç„¶åä¸æ–­åˆ ç›¸è·æœ€è¿‘çš„ç›¸äº¤çš„å¼¦ï¼Œåˆ åˆ°éƒ½ä¸ç›¸äº¤ä¸ºæ­¢ï¼Œç„¶åéšä¾¿é…å¯¹å°±å¥½äº†ã€‚</p><p>C2 ç¿»è½¦çš„åŸå› æ˜¯æ¨äº†ä¸ªå‡ç»“è®ºâ€¦è§‰å¾—å¦‚æœæ’ä¸ªåºä¹‹åï¼Œä»æœ€ä¸­é—´çš„ä¸¤ä¸ªå¼€å§‹åŒ¹é…ï¼Œ<code>l--,r++</code> è¿™ç§å°±ä¸€å®šå¯ä»¥ã€‚ç„¶åå‘ç°ç†è§£é”™é¢˜æ„äº†â€¦ä¸‰ä¸ªç‚¹çš„ååºé¡ºåºå¹¶ä¸éœ€è¦ç›¸åŒã€‚</p><p>å†·é™ä¸‹æ¥å‘ç°ï¼Œå¯ä»¥å¯¹æ¯ä¸€ç»´åˆ†æ²»ã€‚å³ $x,y$ ç›¸åŒçš„å¯ä»¥ç›¸é‚»åŒ¹é…ï¼Œåˆ æ‰ä¹‹å $x$ ç›¸åŒçš„å¯ä»¥ç›¸é‚»åŒ¹é…ã€‚æ„Ÿè§‰è¢«é™æ™ºäº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nd</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id ;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">&#125;base[N], re1[N], re2[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> nd &amp;a, <span class="keyword">const</span> nd &amp;b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.x == b.x ? (a.y == b.y ? a.z &lt; b.z : a.y &lt; b.y) : a.x &lt; b.x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">x_y_equal</span><span class="params">(<span class="keyword">const</span> nd &amp;a, <span class="keyword">const</span> nd &amp;b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a.x == b.x &amp;&amp; a.y == b.y) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">x_equal</span><span class="params">(<span class="keyword">const</span> nd &amp;a, <span class="keyword">const</span> nd &amp;b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a.x == b.x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        base[i].x = qr(), base[i].id = i ;</span><br><span class="line">        base[i].y = qr(), base[i].z = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, comp) ;</span><br><span class="line">    base[n + <span class="number">1</span>] = (nd) &#123;<span class="number">0</span>, -P, -P, -P&#125; ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (x_y_equal(base[i], base[i + <span class="number">1</span>]))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, base[i].id, base[i + <span class="number">1</span>].id), ++ i ;</span><br><span class="line">        <span class="keyword">else</span> re1[++ cnt] = base[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(re1, base) ;</span><br><span class="line">    n = cnt ; cnt = <span class="number">0</span> ;</span><br><span class="line">    base[n + <span class="number">1</span>] = (nd)&#123;<span class="number">0</span>, -P, -P, -P&#125; ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (x_equal(base[i], base[i + <span class="number">1</span>]))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, base[i].id, base[i + <span class="number">1</span>].id), ++ i ;</span><br><span class="line">        <span class="keyword">else</span> re2[++ cnt] = base[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(re2, base) ;</span><br><span class="line">    n = cnt ; cnt = <span class="number">0</span> ;</span><br><span class="line">    base[n + <span class="number">1</span>] = (nd)&#123;<span class="number">0</span>, -P, -P, -P&#125; ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; i += <span class="number">2</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, base[i].id, base[i + <span class="number">1</span>].id) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p>ç§’äº†ã€‚è™½ç„¶ä¸€å¼€å§‹æ²¡å•¥æƒ³æ³•ï¼Œä½†æ˜¯ç›´è§‰å‘Šè¯‰æˆ‘åº”è¯¥æ‰¾ä¸Šç•Œï¼Œç„¶åå‘ç°ä¸Šç•Œæ˜¯ $2n$ ã€‚äºæ˜¯å°±å¯ä»¥æŠŠæ•°ç»„æ‹¼ä¸‰éï¼Œç„¶åå°±å¯ä»¥å¯¹æ¯ä¸ªä½ç½® $i$ï¼Œç”±äºéƒ½å…·æœ‰å•è°ƒæ€§ï¼ŒäºŒåˆ†å‡ºç¬¬ä¸€ä¸ª $k\in[i+1,i+2\cdot n]$ ä½¿å¾—åç¼€ $\min$ &lt; å‰ç¼€ $\max\times \dfrac{1}{2}$ çš„ä½ç½®å°±å¥½äº†ã€‚</p><h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><p>è¿™ä¸ªæ‰¾æ€§è´¨é¢˜â€¦æœ‰ç‚¹å¼ºã€‚</p><blockquote><p>æ±‚æœ‰å¤šå°‘æ£µç‚¹æ•°ä¸º $n(n\leqslant 10^6)$ çš„ï¼Œé”®å€¼ä¸º $1\sim n$ çš„æ’åˆ—çš„äºŒå‰æœç´¢æ ‘æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><p>$(1)$ <code>balanced</code>æ¯ä¸ªç‚¹çš„æ€»æ·±åº¦å’Œæœ€å°ã€‚</p><p>$(2)$ <code>striped.1</code> å¯¹äºæ¯ä¸ªç‚¹ï¼Œå¦‚æœå®ƒæœ‰å·¦å„¿å­ï¼Œé‚£ä¹ˆå·¦å„¿å­çš„é”®å€¼å’Œå®ƒçš„é”®å€¼å¥‡å¶æ€§<strong>ä¸åŒ</strong>ã€‚</p><p>$(3)$  <code>striped.2</code> å¯¹äºæ¯ä¸ªç‚¹ï¼Œå¦‚æœå®ƒæœ‰å³å„¿å­ï¼Œé‚£ä¹ˆå³å„¿å­çš„é”®å€¼å’Œå®ƒçš„é”®å€¼å¥‡å¶æ€§<strong>ç›¸åŒ</strong>ã€‚</p><p>ç­”æ¡ˆå¯¹ $998,244,353$ å–æ¨¡ã€‚</p></blockquote><div><div class="fold_hider"><div class="close hider_title">ã€ä»¥ä¸‹æ˜¯å¿ƒè·¯å†ç¨‹ã€‘</div></div><div class="fold"><hr><p>è¯»é¢˜çš„æ—¶å€™ç”±äºæ—è¾¹åªæœ‰è¿‡æ—¶çš„ç‰›æ´¥å­—å…¸ï¼Œäºæ˜¯æŸ¥äº†æŸ¥å‘ç° <code>parity</code> æ˜¯ä»€ä¹ˆ <code>å¹³ä»·</code> ï¼Œç„¶å <code>striped</code> æ˜¯ä»€ä¹ˆæœ‰æ¡çº¹çš„ã€‚æˆ‘å°± <code>???</code> ã€‚ä¸è¿‡æƒ³äº†ä¸€ä¼šå„¿å°±çŒœå‡ºæ¥åº”è¯¥æ˜¯åœ¨è¯´å¥‡å¶æ€§äº†ã€‚ </p><p>ç„¶åå°±å‘ç€è¦ä¸€ä¸ªä¸€ä¸ªæ¡ä»¶åœ°å»å®¹æ–¥â€¦å¤§æ¦‚æ˜¯é¦–å…ˆå‘ç°åˆæ³•çš„äºŒå‰æ’åºæ ‘ä¸¥æ ¼å¯¹åº”äºä¸åŒå½¢æ€çš„äºŒå‰æ ‘ï¼Œæ¢å¥è¯è¯´æ¯ä¸€ç§å½¢æ€çš„äºŒå‰æ ‘éƒ½æœ‰æ°å¥½ä¸€ä¸ªå¡«å……æ–¹å¼ä½¿ä¹‹æˆä¸ºäºŒå‰æœç´¢æ ‘ã€‚å°è¯•è¯æ˜å‘ç°æ˜¾ç„¶ï¼Œå› ä¸ºæ¯ç§å½¢æ€çš„äºŒå‰æ ‘çš„ä¸­åºéå†å”¯ä¸€ï¼Œè€ŒäºŒå‰æœç´¢æ ‘çš„ä¸­åºéå†çš„é”®å€¼åºåˆ—æ°å¥½æ˜¯ $1\sim n$ çš„æ’åˆ—ã€‚æ‰€ä»¥å‘ç°è¿™éƒ¨åˆ†ç­”æ¡ˆå°±æ˜¯å¡ç‰¹å…°æ•°ã€‚</p><p>â€¦äº‹å®è¯æ˜å¦‚æœåŸºç¡€æŒæ¡ä¸æ‰å®ï¼Œå°±å¯èƒ½ä¼šèŠ±ä¸Šé‚£ä¹ˆå‡ åç§’çš„æ—¶é—´å»ç°æ¨ä¸€æ³¢å·²çŸ¥ç»“è®ºâ€¦</p><p>ä½†ï¼Œè¿™ä¸ªç»“è®ºï¼Œæœ€åä¹Ÿæ ¹æœ¬æ²¡æœ‰ç”¨ä¸Šã€‚å› ä¸ºå‘ç°å‰©ä¸‹ä¸¤ä¸ªæ¡ä»¶æ ¹æœ¬æ²¡ä»€ä¹ˆç®€æ´çš„æ–¹æ³•ç›´æ¥å®¹æ–¥å‡ºæ¥ã€‚ç›´åˆ°ä»Šå¤©æ—©ä¸Šæ—©è¯»â€”â€”</p><hr></div></div><p>å‘ç°è¿™ä¸ª <code>balanced</code> æ˜¯ä¸ªå¾ˆå¼ºçš„çº¦æŸï¼Œå¯ä»¥è§‚å¯Ÿåˆ°åœ¨ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸‹æ ¹èŠ‚ç‚¹åªèƒ½æ˜¯ $\left\lceil\dfrac{n}{2} \right\rceil$ æˆ–è€… $\left\lfloor\dfrac{n}{2} \right\rfloor$ ã€‚ç„¶åç´§æ¥ç€å¯ä»¥å‘ç°æ¯ä¸ªå­æ ‘åœ¨ç¬¬ä¸€ä¸ªçº¦æŸä¸‹éƒ½åªèƒ½æ˜¯ç±»ä¼¼çŠ¶æ€ã€‚ç„¶åè€ƒè™‘ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œä¸€ä¸ªå¾ˆé‡è¦çš„äº‹å®åœ¨äºï¼Œå¯ä»¥å‘ç°é”®å€¼ $n$ æ°¸è¿œæ˜¯åœ¨æœ€å³ä¾§çš„é“¾ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“ $n$ ä¸€å®šå’Œ $root$ çš„é”®å€¼å¥‡å¶æ€§ç›¸åŒã€‚æ¥ç€ï¼Œç”±äºå³å­æ ‘çš„ç‚¹é›†æ˜¯ $[root,n]$ ï¼Œé‚£ä¹ˆä¸éš¾çŸ¥é“<strong>æ¯ä¸ªæ ¹çš„å³å­æ ‘ $size$ éƒ½å¿…ç„¶æ˜¯å¶æ•°</strong> ã€‚</p><p>æœ‰äº†è¿™äº›æ€§è´¨ï¼Œå¯ä»¥å‘ç°å¯¹äºæ¯ä¸ª $n$ ï¼Œç­”æ¡ˆè‡³å¤šä¸º $1$ ã€‚</p><p>è¯æ˜å¯ä»¥è€ƒè™‘å‡è®¾æœ‰ä¸¤ä¸ªå‡æ»¡è¶³æ¡ä»¶çš„æ ‘ $T_1,T_2$ ï¼Œé‚£ä¹ˆä»–ä»¬ä¸€å®šæœ‰æŸéƒ¨åˆ†åŒæ„ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ä¸åŒæ„ã€‚è€ƒè™‘ä¸åŒæ„çš„é‚£éƒ¨åˆ†ï¼Œç”±äºè¦æ»¡è¶³ <code>perfect balanced</code> ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“ã€Œä¸åŒæ„ã€åªèƒ½æ˜¯æŠŠæŸä¸ªç‚¹çš„æŸä¸ªå­æ ‘çš„ä¸€ä¸ªç‚¹ç§»åˆ°å¦ä¸€é¢—å­æ ‘é‡Œï¼Œè¿™è¦æ»¡è¶³ä¸¤ä¸ªå­æ ‘ size ä¹‹å‰ç›¸å·® $1$ ï¼Œæ‰€ä»¥ $T_1,T_2$ ä¸­å¿…ç„¶æœ‰ä¸€æ£µæ ‘æ»¡è¶³å­˜åœ¨ä¸€ä¸ªç‚¹ï¼Œå…¶å³å­æ ‘çš„ size æ˜¯å¥‡æ•°ã€‚æ‰€ä»¥å¯çŸ¥ç­”æ¡ˆè‡³å¤šä¸º $1$ ã€‚</p><p>äºæ˜¯å°±å¯ä»¥ç›´æ¥ä» $size=1$ å¼€å§‹æ„é€ äº†ã€‚å¤æ‚åº¦ $\log n$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ans = <span class="number">1</span> ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ;</span><br><span class="line">    <span class="keyword">while</span> (ans &lt;= n)&#123;</span><br><span class="line">        <span class="keyword">if</span> (ans == n || ans == n - <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"1"</span>), <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">if</span> (ans &amp; <span class="number">1</span>) (ans &lt;&lt;= <span class="number">1</span>) += <span class="number">2</span> ; <span class="keyword">else</span> (ans &lt;&lt;= <span class="number">1</span>) += <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"0"</span>), <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="F"><a href="#F" class="headerlink" title="F"></a>F</h1><p>æ¯”è¾ƒç®€å•çš„è®¡æ•°é¢˜ï¼Ÿå¤§æ¦‚å°±æ˜¯è€ƒè™‘æ— è®ºæ˜¯æ¨ªç€çš„ç‰Œå äº†æŸä¸€åˆ—æˆ–ç«–ç€å äº†æŸä¸€åˆ—ï¼Œéƒ½æ˜¯å (<del>ä¹Ÿå«åšã€Œæ¨ªç«–éƒ½æ˜¯å ã€</del>)ï¼Œæ‰€ä»¥å¯ä»¥ç”¨è¡Œåˆ—æ— å…³çš„æ€æƒ³æ¥ DPã€‚å…·ä½“çš„ï¼Œè®¾ $f_{i,j}$ è¡¨ç¤ºå‰ $i$ è¡Œé€‰äº† $j$ å¯¹ç›¸é‚»çš„ä¸¤è¡Œï¼Œ$g_{i,j}$ è¡¨ç¤ºå‰ $i$ åˆ—é€‰äº† $j$ å¯¹ç›¸é‚»çš„ä¸¤åˆ—ã€‚é‚£ä¹ˆä¼šæœ‰è½¬ç§»</p><script type="math/tex; mode=display">\tau_{i,j}=\tau_{i-1,j}+\tau_{i-2,j-1}</script><p>å…¶ä¸­ $\{\tau\}$ å¯ä»¥çœ‹åšé€šé…ç¬¦ã€‚è½¬ç§»æ³¨æ„ç‰¹åˆ¤ä¸€ä¸‹åˆæ³•æ€§ã€‚ç„¶åå°±å¯ä»¥åˆå¹¶å‡ºç­”æ¡ˆæ¥</p><script type="math/tex; mode=display">ans=\sum_p\sum_q f_{n,p}\times g_{m,q}\times {\rm P}(m-2\cdot q,p)\times {\rm P}(n-2\cdot p,q)</script><p>å…¶ä¸­ ${\rm P}(n,m)$ æ˜¯ä» $n$ ä¸ªå…ƒç´ é‡Œé¢é€‰ $m$ ä¸ªå…ƒç´ çš„æ’åˆ—æ•°ã€‚ä¹‹æ‰€ä»¥æ˜¯æ’åˆ—æ•°æ˜¯å› ä¸ºå¯¹äºæŸäº›ç¡®å®šæ¨ªç€æ”¾çš„éª¨ç‰Œï¼Œ$dp$ æ•°ç»„åªæ˜¯ç¡®å®šäº†ä»–ä»¬çš„åˆ—è¯¥æ€ä¹ˆæ”¾ï¼Œæ‰€ä»¥ç›¸å½“äºç»™æ¯ä¸ªéª¨ç‰Œåˆ†é…ä¸€ä¸ªè¡Œå·ï¼Œæ‰€ä»¥æ˜¯æ’åˆ—æ•°ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5050</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> P = <span class="number">998244353</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> fac ;</span><br><span class="line"><span class="keyword">int</span> smax ;</span><br><span class="line"><span class="keyword">int</span> sn, sm ;</span><br><span class="line"><span class="keyword">int</span> n, m, k ;</span><br><span class="line"><span class="keyword">int</span> visr[N] ;</span><br><span class="line"><span class="keyword">int</span> visc[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N] ;</span><br><span class="line"><span class="keyword">int</span> g[N][N] ;</span><br><span class="line"><span class="keyword">int</span> perm[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(T &amp;x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; x = x &gt;= mod ? x - mod : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il T <span class="title">addn</span><span class="params">(T x, ll y, <span class="keyword">int</span> mod = P)</span></span>&#123;</span><br><span class="line">    x += y ; <span class="keyword">return</span> (x = x &gt; mod ? x - mod : x) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">chkr</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((!visr[x] &amp;&amp; !visr[x - <span class="number">1</span>]) &amp;&amp; y &amp;&amp; (<span class="keyword">bool</span>)(x - <span class="number">1</span>)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">chkc</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((!visc[x] &amp;&amp; !visc[x - <span class="number">1</span>]) &amp;&amp; y &amp;&amp; (<span class="keyword">bool</span>)(x - <span class="number">1</span>)) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b, c, d ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k) ;</span><br><span class="line">    smax = max(sn = n, sm = m), fac = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= smax ; ++ i) perm[i][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= smax ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= i ; ++ j)</span><br><span class="line">            perm[i][j] = addn(perm[i - <span class="number">1</span>][j], perm[i - <span class="number">1</span>][j - <span class="number">1</span>]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= smax ; ++ j)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = j ; i &lt;= smax ; ++ i)</span><br><span class="line">            perm[i][j] = <span class="number">1l</span>l * perm[i][j] * fac % P ;</span><br><span class="line">        fac = <span class="number">1l</span>l * fac * (j + <span class="number">1</span>) % P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;a, &amp;b) ;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;c, &amp;d) ;</span><br><span class="line">        <span class="keyword">if</span> (a == c)&#123;</span><br><span class="line">            -- sn, -- sm, -- sm ;</span><br><span class="line">            visr[a] = <span class="number">1</span>, visc[b] = visc[d] = <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b == d)&#123;</span><br><span class="line">            -- sm, -- sn, -- sn ;</span><br><span class="line">            visc[d] = <span class="number">1</span>, visr[a] = visr[c] = <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>] = g[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= (sn &gt;&gt; <span class="number">1</span>) ; ++ j)</span><br><span class="line">            f[i][j] = addn(chkr(i, j) * f[i - <span class="number">2</span>][j - <span class="number">1</span>], f[i - <span class="number">1</span>][j]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= (sm &gt;&gt; <span class="number">1</span>) ; ++ j)</span><br><span class="line">            g[i][j] = addn(chkc(i, j) * g[i - <span class="number">2</span>][j - <span class="number">1</span>], g[i - <span class="number">1</span>][j]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= (sn &gt;&gt; <span class="number">1</span>) ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= (sm &gt;&gt; <span class="number">1</span>) ; ++ j)</span><br><span class="line">            add(ans, <span class="number">1l</span>l * f[n][i] * g[m][j] % P * perm[sn - (i &lt;&lt; <span class="number">1</span>)][j] % P * perm[sm - (j &lt;&lt; <span class="number">1</span>)][i] % P) ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>ç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼ŒGå’ŒHæ˜¯ä¸å¯èƒ½åšçš„ (x</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å•ç‹¬æ•´ç†è¿™ä¸€åœºï¼Œä¸€æ˜¯å› ä¸ºè¿™ä¸€åœºçš„é¢˜ç›®è´¨é‡æ•´ä½“æ¯”è¾ƒé«˜ï¼ŒäºŒæ˜¯å› ä¸ºè¿™ä¸€åœºçš„ E æ˜¯å®åœ¨æ˜¯æœ‰ç‚¹ç¥ä»™â€¦&lt;/p&gt;
&lt;p&gt;æ‰˜è€å¸ˆè¿˜æ˜¯å®åˆ€ä¸è€é¸­ï¼&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹éƒ¨åˆ†ç®€å•é¢˜æ˜¯åœ¨å®¿èˆè‡ªä¹ å®¤é‡Œå£èƒ¡å‡ºæ¥çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="Codeforces" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/Codeforces/"/>
    
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ•°å­¦/è§‚å¯Ÿæ€§è´¨,ç»“è®ºä¸æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="æ€ç»´é¢˜/æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="ç»„åˆè®¡æ•°/æœ‰æŠ€å·§çš„è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="æŠ€å·§/è¡Œåˆ—æ— å…³" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E8%A1%8C%E5%88%97%E6%97%A0%E5%85%B3/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒè®°å½•ã€‘6.3 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/03/6-3-%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/03/6-3-è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-03T12:16:33.000Z</published>
    <updated>2020-06-03T13:11:20.285Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å› ä¸ºå¥‡æ€ªçš„é—®é¢˜ï¼Œå¯¼è‡´å…¶å®æ˜¨å¤©ç¬¬ä¸‰åœºçš„ T3 å†™çš„å¤æ‚åº¦å¹¶ä¸å¯¹ã€‚äºæ˜¯ä»Šå¤©å°±èŠ±äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹æ­£ç¡®çš„åšæ³•ï¼Œå¯¼è‡´åªæ‰“äº†ä¸€åœºâ€¦ï¼ˆå¹¶ä¸”åšå®Œæ²¡ç¡å¥½å¯¼è‡´ä¸Šåˆæ•ˆç‡æä½ï¼‰ã€‚</p><p>ä¸è¿‡æœ‰ä¸€è¯´ä¸€ï¼Œé¢˜ç›®è¿˜æ˜¯å¾ˆèµçš„ï¼æ„Ÿè§‰å­¦åˆ°äº†å¾ˆå¤šã€‚</p><a id="more"></a><h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><blockquote><p>ç»™å®šä¸¤ä¸ªé•¿åº¦åˆ†åˆ«ä¸º $n,m$ çš„ä¸² $s,t$ ã€‚æ±‚æœ‰å¤šå°‘ä¸ª $s$ çš„æœ¬è´¨ä¸åŒçš„å­ä¸²(èµ·å§‹ä½ç½®ä¸åŒ)åŒ…å« $t$ ä½œä¸ºå­åºåˆ—ã€‚</p><p>$1\leq n\leq 10^5,1\leq m\leq 100$ ã€‚</p></blockquote><p>æ‹¿äº†ä¸€ä¸ªæ¯” std æ›´æœ‰æŠ€æœ¯å«é‡çš„åšæ³•ç§’äº†è¿™é“é¢˜ã€‚å¤§æ¦‚æ˜¯è€ƒè™‘å¯ä»¥å…ˆé¢„å¤„ç†å‡º $s$ ä¸­æœ‰å“ªäº›æå°çš„åŒºé—´åŒ…å« $t$ ä½œä¸ºå­åºåˆ—ï¼Œè¿™éƒ¨åˆ†å¯ä»¥ç”¨å­åºåˆ—è‡ªåŠ¨æœºæ¥å®ç°ã€‚è§‚å¯Ÿåˆ° $m$ æ¯”è¾ƒå°ï¼Œå°±å¯ä»¥æšä¸¾æ¯ä¸€ä¸ª $s_i=t_1$ çš„ä½ç½® $i$ å¼€å§‹åœ¨è‡ªåŠ¨æœºä¸ŠåŒ¹é…ç›´åˆ°ç»“æŸã€‚</p><p>è¿™æ ·æœ€åä¸€å®šæ˜¯ä¸€å †åŒºé—´ã€‚è€ƒè™‘å¦‚æœä¸€ä¸ªåŒºé—´è¢«å¦ä¸€ä¸ªåŒºé—´å®Œå…¨åŒ…å«ï¼Œé‚£ä¹ˆé‚£ä¸ªå¤§åŒºé—´å°±æ²¡ç”¨äº†ï¼Œå¯ä»¥åˆ æ‰ã€‚äºæ˜¯å°±å¯ä»¥å¯¹ <code>vector</code> æ’ä¸ªåºç”¨ç±»ä¼¼å•è°ƒæ ˆçš„æ–¹æ³•åšè¿™ä¸ªè¿‡ç¨‹ã€‚ä¹‹åè€ƒè™‘ï¼Œå¯¹äºç›¸é‚»çš„ä¸¤ç«¯åŒºé—´ $[l_1,r_1],[l_2,r_2]$ï¼Œ$[l_2,r_2]$ å¯ä»¥äº§ç”Ÿçš„éƒ¨åˆ†è´¡çŒ® $[l_1,r_1]$ ä¹Ÿäº§ç”Ÿäº†ï¼Œä¸éš¾å‘ç°è¿™å°±æ˜¯é‚£äº›æ»¡è¶³ $[l_2,r_2]\subset [l,r]$ ä¸” $l\leq l_1$ çš„è´¡çŒ®ï¼Œäºæ˜¯å·¦ç«¯ç‚¹å°±åªå– $l_2-l_1$ è¿™äº›æ–¹æ¡ˆå°±å¥½äº†ã€‚å¤æ‚åº¦ $O(|\Sigma|\times n+nm)$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">char</span> a[N] ;</span><br><span class="line"><span class="keyword">char</span> b[N] ;</span><br><span class="line"><span class="keyword">int</span> nxt[N][<span class="number">26</span>] ;</span><br><span class="line"></span><br><span class="line">vpint ant ;</span><br><span class="line">vpint range ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">26</span> ; ++ j) nxt[L + <span class="number">1</span>][j] = L + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">26</span> ; ++ j)</span><br><span class="line">            nxt[i][j] = nxt[i + <span class="number">1</span>][j] ;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; L)</span><br><span class="line">            nxt[i][s[i + <span class="number">1</span>] - <span class="string">'a'</span>] = i + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_match</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> q = <span class="number">1</span>, o = p ;</span><br><span class="line">    <span class="keyword">while</span> (p &lt; n + <span class="number">1</span> &amp;&amp; q &lt; m)</span><br><span class="line">        ++ q, p = nxt[p][b[q] - <span class="string">'a'</span>] ;</span><br><span class="line">    range.p_b(make_pair(o, p)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(pint a, pint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fr == b.fr ? a.sc &gt; b.sc : a.fr &lt; b.fr ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">r_include</span><span class="params">(pint a, pint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fr &lt;= b.fr &amp;&amp; a.sc &gt;= b.sc ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, a + <span class="number">1</span>) ;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>, b + <span class="number">1</span>) ; build(a, n) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (a[i] == b[<span class="number">1</span>]) do_match(i) ;</span><br><span class="line">    sort(range.begin(), range.end()) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; range.size() ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = ant.size() - <span class="number">1</span> ; ~k ; -- k)</span><br><span class="line">            <span class="keyword">if</span> (r_include(ant[k], range[i])) ant.pop_back() ;</span><br><span class="line">        ant.push_back(range[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; ant.size() ; ++ i)</span><br><span class="line">        ans += <span class="number">1l</span>l * (n - ant[i].sc + <span class="number">1</span>) * (ant[i].fr - l), l = ant[i].fr ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>$1\leq m\leq 16$ ã€‚</p></blockquote><p>è¿™é¢˜æ˜¯çœŸçš„ç¥ç¥ç¥ç¥ç¥ã€‚ç„¶è€Œè‡ªå·±æ‰“äº†æš´åŠ›å°±è·‘äº†ã€‚</p><p>è€ƒè™‘æ‰¾æ€§è´¨+åˆ†æ²»ã€‚æœ‰è¿™ä¹ˆå‡ ä¸ª<del>æ‰¾ä¸å‡ºæ¥çš„</del>æ€§è´¨ï¼š</p><p>1ã€æ¯ä¸ª $1\sim n$ çš„æ•°è‡³å°‘ä¼šåœ¨ $p_0\sim p_{2^m-1}$ ä¸­å‡ºç°ä¸€æ¬¡ã€‚è€ƒè™‘å¯¹äºæŸä¸ª $a_i$ ï¼Œå°†å…¶å–åå¾—åˆ°çš„ $rev(a_i)$ä¸€å®šä¹Ÿæ˜¯ $[0,2^m-1]$ ä¹‹é—´çš„æ•°ï¼ŒåŒæ—¶å¿…ç„¶æœ‰ $a_i\operatorname{xor} rev(a_i)$ æœ€ä¼˜ï¼Œå¯ä»¥è¾¾åˆ° $2^m-1$ è¿™ä¸ªä¸Šç•Œ ã€‚</p><p>2ã€è€ƒè™‘å¯¹ $p$ æŒ‰ç…§<strong>äºŒè¿›åˆ¶(å½“å‰)æœ€é«˜ä½æ˜¯0/1</strong>è¿›è¡Œåˆ†æ²»ã€‚è€ƒè™‘åˆ†æ²»åˆ°æŸä¸ªæ—¶åˆ»çš„ $[l,r]$ã€‚è€ƒè™‘å¦‚æœå­˜åœ¨ $[l,mid]$ å’Œ $[mid+1,r]$ çš„æ‰€æœ‰ $p_i$ åˆ†åˆ«ç›¸åŒï¼Œé‚£ä¹ˆè¯´æ˜å½“å‰è¿™ä¸€ä½è®¾æˆ $0$ è¿˜æ˜¯ $1$ å¹¶æ²¡æœ‰ä»€ä¹ˆä»€ä¹ˆå½±å“ï¼Œæ‰€ä»¥æ­¤æ—¶å¯¹ç­”æ¡ˆä¼šäº§ç”Ÿ $2$ çš„è´¡çŒ®ã€‚å¹¶ä¸”ç”±äºå·¦å³åŒºé—´ç›¸åŒï¼Œéœ€è¦åªåˆ†æ²»ä¸€è¾¹ã€‚</p><p>3ã€å¦‚æœä¸åŒï¼Œé‚£ä¹ˆè€ƒè™‘å¦‚æœ $[l,mid]$ ä¸­çš„æŸä¸ª $p_i$ å‡ºç°åœ¨äº† $[mid+1,r]$ é‡Œé¢ï¼Œé‚£ä¹ˆæœ€åç­”æ¡ˆå°±æ˜¯ $0$ã€‚åŸå› æ˜¯å¦‚æœä¸æ»¡è¶³å½“å‰æœ€é«˜ä½å¡« $0/1$ éƒ½å¯ä»¥çš„è¯ï¼Œå°±å¯ä»¥å¯¹è¿™äº›æ•°æŒ‰ç…§å½“å‰äºŒè¿›åˆ¶ä½åˆ†ç»„ã€‚è€Œä¸€ä¸ªæ•°å­—ä¸å¯èƒ½å­˜åœ¨äºŒè¿›åˆ¶ä¸‹æŸä¸€ä½æ—¢æ˜¯ $0$ åˆæ˜¯ $1$ï¼Œæ‰€ä»¥æ— è§£ã€‚</p><p>4ã€å¦åˆ™åˆ†æ²»åˆ°æ›´å°çš„äºŒè¿›åˆ¶ä½å»è§‚å¯Ÿè´¡çŒ®ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> buc[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="comment">//debug(l, ' '), debug(r) ;</span></span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l, j = mid + <span class="number">1</span> ; i &lt;= mid ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (base[i] != base[j]) <span class="keyword">goto</span> no_contribute ; <span class="keyword">else</span> ++ j ;</span><br><span class="line">    (ans *= <span class="number">2l</span>l) %= P ; solve(l, mid) ; <span class="keyword">return</span> ;</span><br><span class="line">    no_contribute : <span class="keyword">void</span>() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l ; i &lt;= r ; ++ i) buc[base[i]] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l ; i &lt;= mid ; ++ i) buc[base[i]] ++ ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span> ; i &lt;= r ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (buc[base[i]]) <span class="built_in">puts</span>(<span class="string">"0"</span>), <span class="built_in">exit</span>(<span class="number">0</span>) ;</span><br><span class="line">    solve(l, mid) ; solve(mid + <span class="number">1</span>, r) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; m = <span class="number">1</span> &lt;&lt; m ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; m ; ++ i)</span><br><span class="line">        buc[base[i] = qr()] += <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (!buc[i]) <span class="keyword">goto</span> fuck ;</span><br><span class="line">    ans = <span class="number">1</span> ; solve(<span class="number">0</span>, m - <span class="number">1</span>) ; <span class="comment">/* */</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    fuck : <span class="built_in">puts</span>(<span class="string">"0"</span>) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><blockquote><p>ç»™å®šä¸€ä¸ªå®Œå…¨å›¾ã€‚æ±‚è¯¥å›¾çš„ã€Œæœ€å° xq ç”Ÿæˆæ ‘ã€çš„ xqã€‚</p><p>å®šä¹‰ä¸€æ£µæ ‘çš„ xqä¸º</p><script type="math/tex; mode=display">\sum_i\sum_j {\rm dist}(i,j)</script><p>å…¶ä¸­å…·æœ‰æœ€å°çš„ xq çš„é‚£æ£µæ ‘è¢«ç§°ä¸ºã€Œæœ€å° xq ç”Ÿæˆæ ‘ã€ã€‚</p><p>$1\leq n\leq 15$ ã€‚</p></blockquote><p>æ¯”è¾ƒæœ‰è¶£çš„ dp å§â€¦</p><p>è‡ªå·±ä¸€å¼€å§‹å†™äº†ä¸ªç‰¹åˆ«å¼±æ™ºçš„é”™è§£ã€‚å¤§æ¦‚æ˜¯å¯¹ç€æ¯ä¸ªç‚¹é›†è·‘ä¸€é Floydï¼Œç„¶åè®¾ $f_s$ è¡¨ç¤ºé›†åˆ $s$ ä¸­æœ€å° xq ç”Ÿæˆæ ‘çš„ xq å€¼ã€‚è½¬ç§»çš„æ—¶å€™æšä¸¾ä¸€ä¸ªç‚¹è¿›è¡Œè½¬ç§»ã€‚è¿™æ ·æ˜¾è€Œæ˜“è§åœ°å°±å¿½è§†äº†æ ‘çš„é™åˆ¶ã€‚äºæ˜¯è€ƒè™‘å¦‚ä½• dp å‡ºä¸€æ£µåˆç†çš„æ ‘ã€‚</p><p>å…·ä½“çš„ï¼Œè®¾ $f_{s,i}$ è¡¨ç¤ºä»¥ $i$ ä¸ºæ ¹ï¼Œæ ‘ä¸­çš„å…ƒç´ æ˜¯é›†åˆ $s$ çš„æœ€å° xq ç”Ÿæˆæ ‘çš„ xq å€¼ã€‚è€ƒè™‘æ€ä¹ˆè½¬ç§»ã€‚è½¬ç§»çš„æœ¬è´¨æ˜¯æšä¸¾ä¸€ä¸ªå­é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚æœé’¦å®šäº†æ ¹æ˜¯è°ï¼Œå°±å¯ä»¥ç›´æ¥æšä¸¾æ€ä¹ˆä»æ ¹æ‹†å‡ºä¸€ä¸ªå­æ ‘æ¥ã€‚æ›´ä¸ºå…·ä½“çš„ï¼Œæœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{s,i}=\min_{t\subseteq s,j\in t}\{f_{t,j}+f_{s\setminus t,i}+val(i,j)\times {\rm card}(t)\times {\rm card}\left(\complement_Ut\right)\}</script><p>ä¹Ÿå°±æ˜¯è€ƒè™‘åˆ å»çš„ä¸æ ¹ $i$ ç›¸è¿çš„æŸæ¡è¾¹ $(i,j)$ å¯¹æ€»ç­”æ¡ˆçš„è´¡çŒ®ã€‚é‚£ä¹ˆå°±å¯ä»¥æœ‰ä¸€ä¸ª $O(3^n\times n^2)$ çš„åšæ³•ï¼Œå¯ä»¥é€šè¿‡ $n\le 13$ ã€‚</p><p>ä¹‹åè€ƒè™‘åé¢é‚£éƒ¨åˆ†å¥½åƒå¾ˆå¤šä½™ï¼Œå› ä¸ºåé¢é‚£éƒ¨åˆ†å°±æœ¬è´¨ä¸Šè·Ÿ $s\setminus t$ æ— å…³äº†ã€‚å…·ä½“çš„ï¼Œå¯¹äºæ¯ä¸ªé›†åˆ $s$ ï¼Œå¯ä»¥åˆ©ç”¨ $f_s$ é¢å¤– dp å‡ºä¸€ä¸ª $g_{s,i}(i\notin s)$ æ»¡è¶³å®šä¹‰å¦‚ä¸‹</p><script type="math/tex; mode=display">g_{s,i}=\min_{j\in s}\{f_{s,j}+val(i,j)\times {\rm card}(s)\times {\rm card}\left(\complement_Us\right)\}</script><p>äºæ˜¯è½¬ç§»å°±å¯ä»¥åªæ‹¿ $g$ è½¬ç§»äº†ã€‚å¤æ‚åº¦ $O(3^n\times n+2^n\times n^2)$ å¯ä»¥é€šè¿‡æœ¬é¢˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">15</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">100000</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line">ll sz[M] ;</span><br><span class="line">ll unsz[M] ;</span><br><span class="line">ll A[N][N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll g[M][N] ;</span><br><span class="line">ll f[M][N] ;</span><br><span class="line"><span class="comment">//ll s[M][N] ;</span></span><br><span class="line"><span class="comment">//ll g[M][N][N] ;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">biout</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x) <span class="built_in">cout</span> &lt;&lt; (x &amp; <span class="number">1</span>), x &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    m = (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span> ;</span><br><span class="line">    <span class="built_in">memset</span>(g, <span class="number">63</span>, <span class="keyword">sizeof</span>(g)) ;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">63</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        f[<span class="number">1</span> &lt;&lt; i][i] = g[<span class="number">1</span> &lt;&lt; i][i] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt; n ; ++ j)</span><br><span class="line">            A[i][j] = A[j][i] = qr() ; unsz[<span class="number">0</span>] = n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        sz[i] = sz[i ^ (i &amp; (-i))] + <span class="number">1</span>, unsz[i] = n - sz[i] ;</span><br><span class="line"><span class="comment">//    debug(sz, 1, m) ; debug(unsz, 1, m) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">1</span> ; s &lt;= m ; ++ s)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> t = s ; t ; t = (t - <span class="number">1</span>) &amp; s)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; i &amp; t)</span><br><span class="line">                    chkmin(f[s][i], f[t][i] + g[s ^ t][i]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; i &amp; s) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; n ; ++ j)</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; j &amp; s)</span><br><span class="line">                    chkmin(g[s][i], f[s][j] + A[i][j] * sz[s] * unsz[s]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = f[m][<span class="number">0</span>] ;</span><br><span class="line"><span class="comment">//    debug(f[m], 0, n) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i) chkmin(ans, f[m][i]) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ $65$ åˆ†ï¼Œæ³¨é‡Šèµ·æ¥çš„æ˜¯ç¿»è½¦ç°åœºã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">15</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">100000</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> sz[M] ;</span><br><span class="line"><span class="keyword">int</span> A[N][N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll f[M][N] ;</span><br><span class="line"><span class="comment">//ll s[M][N] ;</span></span><br><span class="line"><span class="comment">//ll g[M][N][N] ;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">biout</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x) <span class="built_in">cout</span> &lt;&lt; (x &amp; <span class="number">1</span>), x &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">63</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        f[<span class="number">1</span> &lt;&lt; i][i] = <span class="number">0</span> ; m = (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt; n ; ++ j)</span><br><span class="line">            A[i][j] = A[j][i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        sz[i] = sz[i ^ (i &amp; (-i))] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> s = <span class="number">1</span> ; s &lt;= m ; ++ s)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> t = s ; t ; t = (t - <span class="number">1</span>) &amp; s)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; i &amp; t)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; n ; ++ j)</span><br><span class="line">                        <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; j &amp; (s ^ t))</span><br><span class="line">                            chkmin(f[s][i], f[t][i] + f[s ^ t][j] + <span class="number">1l</span>l * A[i][j] * sz[s ^ t] * (n - sz[s ^ t])) ;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (int o = 0 ; o &lt;= m ; ++ o)&#123;</span></span><br><span class="line"><span class="comment">        int stk[20], cnt = 0 ;</span></span><br><span class="line"><span class="comment">        for (int i = 0 ; i &lt; n ; ++ i)</span></span><br><span class="line"><span class="comment">            if (1 &lt;&lt; i &amp; o)&#123;</span></span><br><span class="line"><span class="comment">                stk[++ cnt] = i ;</span></span><br><span class="line"><span class="comment">                for (int j = 0 ; j &lt; n ; ++ j)</span></span><br><span class="line"><span class="comment">                    if (1 &lt;&lt; j &amp; o)</span></span><br><span class="line"><span class="comment">                        g[o][i][j] = g[o][j][i] = A[i][j] ;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        for (int k = 1 ; k &lt;= cnt ; ++ k)</span></span><br><span class="line"><span class="comment">            for (int i = 1 ; i &lt;= cnt ; ++ i)</span></span><br><span class="line"><span class="comment">                for (int j = 1 ; j &lt;= cnt ; ++ j)</span></span><br><span class="line"><span class="comment">                    if ((i ^ j) &amp;&amp; (j ^ k) &amp;&amp; (i ^ k))</span></span><br><span class="line"><span class="comment">                        chkmin(g[o][stk[i]][stk[j]], g[o][stk[i]][stk[k]] + g[o][stk[k]][stk[j]]) ;</span></span><br><span class="line"><span class="comment">        for (int i = 0 ; i &lt; n ; ++ i)</span></span><br><span class="line"><span class="comment">            if (1 &lt;&lt; i &amp; o)</span></span><br><span class="line"><span class="comment">                for (int j = 0 ; j &lt; n ; ++ j)</span></span><br><span class="line"><span class="comment">                    if (1 &lt;&lt; j &amp; o)</span></span><br><span class="line"><span class="comment">                        s[o][i] += g[o][i][j] ;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">        for (int j = 0 ; j &lt; n ; ++ j)&#123;</span></span><br><span class="line"><span class="comment">            if (!(1 &lt;&lt; j &amp; i)) continue ;</span></span><br><span class="line"><span class="comment">            chkmin(f[i], f[i ^ (1 &lt;&lt; j)] + s[i][j]) ;</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= m ; ++ i)</span></span><br><span class="line"><span class="comment">        cout &lt;&lt; i &lt;&lt; " ", biout(i), cout &lt;&lt; " " &lt;&lt; f[i] &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    ans = f[m][<span class="number">0</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i) chkmin(ans, f[m][i]) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å› ä¸ºå¥‡æ€ªçš„é—®é¢˜ï¼Œå¯¼è‡´å…¶å®æ˜¨å¤©ç¬¬ä¸‰åœºçš„ T3 å†™çš„å¤æ‚åº¦å¹¶ä¸å¯¹ã€‚äºæ˜¯ä»Šå¤©å°±èŠ±äº†å¾ˆå¤šæ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹æ­£ç¡®çš„åšæ³•ï¼Œå¯¼è‡´åªæ‰“äº†ä¸€åœºâ€¦ï¼ˆå¹¶ä¸”åšå®Œæ²¡ç¡å¥½å¯¼è‡´ä¸Šåˆæ•ˆç‡æä½ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æœ‰ä¸€è¯´ä¸€ï¼Œé¢˜ç›®è¿˜æ˜¯å¾ˆèµçš„ï¼æ„Ÿè§‰å­¦åˆ°äº†å¾ˆå¤šã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/çŠ¶å‹DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æŠ€å·§/åˆ†æ²»" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="æŠ€å·§/æŒ‰ä½è€ƒè™‘" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E6%8C%89%E4%BD%8D%E8%80%83%E8%99%91/"/>
    
      <category term="å­—ç¬¦ä¸²/å­åºåˆ—è‡ªåŠ¨æœº" scheme="https://www.orchidany.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2-%E5%AD%90%E5%BA%8F%E5%88%97%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒè®°å½•ã€‘6.2 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/03/6-2%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/03/6-2è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-02T23:00:09.000Z</published>
    <updated>2020-06-03T12:15:12.918Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è®°å½•ä¸€ä¸‹ä»Šå¤©çš„ä¸‰åœºæ¯”èµ›ï¼Œåˆæ‡’å¾—æ¬é¢˜é¢äº†ã€‚</p><p>å¦‚æœæƒ³è¦é¢˜é¢å¯ä»¥ QQ æˆ³æˆ‘ï¼Œæˆ‘è§‰å¾—ä½ å¯çˆ±å°±ç»™ä½ å•¦ã€‚</p><a id="more"></a><h1 id="A-M"><a href="#A-M" class="headerlink" title="A.M."></a>A.M.</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><p>ç§’æ‰äº†ã€‚å¤§æ¦‚æ˜¯è€ƒè™‘ä»å€¼åŸŸ $m$ å¼€å§‹å€’ç€åŠ æ•°ï¼ŒLISå°±ä¸€å®šä¸ä¼šé”…ã€‚æœ€ååˆ¤ä¸€ä¸‹åºåˆ—æ˜¯å¦æ°å¥½æœ‰ $n$ ä¸ªå…ƒç´ å³å¯ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b[N] ;</span><br><span class="line">vint ans ;</span><br><span class="line"><span class="keyword">int</span> n, m, k ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; k ; <span class="keyword">int</span> t = n, s ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i) b[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)&#123;</span><br><span class="line">        s = m ;</span><br><span class="line">        <span class="keyword">while</span> (t &gt; k - i + <span class="number">1</span> &amp;&amp; s &gt; b[i])</span><br><span class="line">            ans.p_b(s --), t -- ;</span><br><span class="line">        ans.p_b(b[i]) ; -- t ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ans.size() &lt; n) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No"</span>), <span class="number">0</span> ;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Yes"</span>) ; <span class="keyword">for</span> (<span class="keyword">auto</span> o : ans) <span class="built_in">printf</span>(<span class="string">"%d "</span>, o) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><p>åˆç§’æ‰äº†ã€‚å¤§æ¦‚æ˜¯è€ƒè™‘å€’ç€æšä¸¾æ¯ä¸ªåº¦æ•°å’Œ $k$ï¼Œå» check ç­”æ¡ˆæ˜¯å¦åˆæ³•ã€‚check çš„æ—¶å€™è€ƒè™‘æ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼ SPFA çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡æ¾å¼›ä»ã€Œè¾¹æƒã€è½¬æˆäº†ã€Œåº¦æ•°å’Œã€ã€‚æ ¹æ®ç„å­¦ç†è®ºï¼Œè¿™ä¸ªè¿‡ç¨‹åº”è¯¥ä¹Ÿä¼šæ˜¯ $O(Km)$ çš„ï¼Œå…¶ä¸­ $K$ æ˜¯æŸä¸ªä¸å¤§çš„å¸¸æ•°ã€‚é‚£ä¹ˆæœ€åå¤æ‚åº¦å¤§æ¦‚å°±æ˜¯ $O(nKm)$ é™„è¿‘ï¼Œå¯ä»¥é€šè¿‡æ­¤é¢˜ã€‚</p><p>ç„¶è€Œè‡ªå·±ç”¨äº†ä¸€ä¸ªå †ç»´æŠ¤åº¦æ•°ã€‚æ„Ÿè§‰è¿™æ ·æ‰å¯ä»¥ä¿è¯å¤æ‚åº¦æ˜¯å¯¹çš„ï¼Œäºæ˜¯å¤æ‚åº¦å°±å¤§æ¦‚é™ä¸ºäº†æ¯”è¾ƒç¨³çš„ $O(n^2\log n)$ å·¦å³ï¼Ÿ</p><p>ç„¶åå‰ªäº†ä¸€ä¸‹æï¼Œå¤§æ¦‚æ˜¯è¯´è€ƒè™‘æ¯æ¬¡åº¦æ•°å’Œä» $2\times \max\{\deg_x\}$ å¼€å§‹æšä¸¾è€Œä¸ä» $2\times n$ å¼€å§‹ã€‚å®æµ‹è¿™æ ·æ€»ç”¨æ—¶å¯ä»¥å¿« $15$ å€ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> _up ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> A[N][N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">comp</span>&#123;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">operator</span> <span class="params">()</span><span class="params">(<span class="keyword">int</span> A, <span class="keyword">int</span> B)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> tmp[A] &lt; tmp[B] ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">priority_queue &lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, comp&gt; q ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; <span class="keyword">int</span> u, v ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        u = qr(), v = qr() ;</span><br><span class="line">        deg[u] ++, deg[v] ++ ;</span><br><span class="line">        A[u][v] = A[v][u] = <span class="number">1</span> ;</span><br><span class="line">        chkmax(_up, deg[u] &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line">        chkmax(_up, deg[v] &lt;&lt; <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (!A[i][j] &amp;&amp; i != j) E[i].p_b(j), E[j].p_b(i) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ans = _up ; ans &gt;= <span class="number">0</span> ; -- ans)&#123;</span><br><span class="line">        <span class="keyword">int</span> res = m, s = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            tmp[i] = deg[i] ;</span><br><span class="line">            vis[i] = <span class="number">1</span>, q.push(i) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> j : E[i]) A[i][j] = <span class="number">0</span> ;</span><br><span class="line"><span class="comment">//        debug(ans)  ;</span></span><br><span class="line">        <span class="keyword">while</span> (q.size())&#123;</span><br><span class="line">            <span class="keyword">int</span> x = q.top() ;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; x &lt;&lt; ' ' ;</span></span><br><span class="line">            q.pop() ; vis[x] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">                <span class="keyword">if</span> (A[x][y]) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (tmp[y] + tmp[x] &gt;= ans)&#123;</span><br><span class="line">                    ++ res ;</span><br><span class="line">                    tmp[y] ++, tmp[x] ++ ;</span><br><span class="line">                    A[x][y] = A[y][x] = <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[y]) q.push(y) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(res) ;</span></span><br><span class="line">        <span class="keyword">if</span> (res == n * (n - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">" "</span>, <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>$n,q\le 10^5,m\leq 5$ ã€‚</p></blockquote><p>æœ¬ä»¥ä¸ºå¯ä»¥è¿…é€Ÿè¿‡æ‰è¿™ä¸€åœºï¼Œç„¶åå°±  è¢«  ç‹™  äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€è®ºæˆ‘æ˜¯å¦‚ä½•è¢«ç‹™å‡»çš„ã€‘</div></div><div class="fold"><p>è‡ªå·±ä¸€å¼€å§‹æƒ³äº†ä¸€ä¸ª bitset çš„åšæ³•è§‰å¾—å¾ˆç¨³ï¼Œå¤æ‚åº¦å¤§æ¦‚æ˜¯ä»€ä¹ˆ $O\left(q\log n +\dfrac{n\cdot q\cdot m}{w}\right)$ ã€‚å¤§æ¦‚æ€è·¯å°±æ˜¯è€ƒè™‘æ‹¿ <code>bitset</code> ç»´æŠ¤å½“å‰è¯¢é—®ç‚¹ä¼šè¢«è¿™äº›çº¿æ®µé®ä½çš„ç‚¹çš„å¹¶é›†ï¼Œæœ€å <code>n-ans.count()</code> å°±æ˜¯ç­”æ¡ˆã€‚</p><p>ç„¶åï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼šç»´æŠ¤çš„æ—¶å€™è€ƒè™‘æŠŠæ‰€æœ‰ç‚¹æŒ‰ç…§æ¨ªåæ ‡æ’ä¸ªåºï¼Œå‡è®¾æŸæ¡çº¿æ®µçš„ç«¯ç‚¹æ˜¯ $A$ï¼Œå½“å‰è¯¢é—®ç‚¹æ˜¯ $O$ï¼ŒæŸä¸ªå¯èƒ½ä¼šè¢«æŒ¡ä½çš„ç‚¹æ˜¯ $B$ï¼Œç„¶åè€ƒè™‘æ‹¿å‰ç§¯å»äºŒåˆ†å‡ºç¬¬ä¸€ä¸ªä½¿å¾— $\overrightarrow{OA}\times \overrightarrow{OB}$ å°äºæˆ–è€…å¤§äº $0$ çš„ç‚¹ï¼ˆå–å†³äºå·¦å³ç«¯ç‚¹ï¼‰ã€‚</p><p>å†™å®Œä¹‹åå¯»æ€äº†ä¸€ä¸‹å‘ç°ä¸å¯¹ã€‚å› ä¸ºè€ƒè™‘çº¿æ®µå·¦ç«¯ç‚¹çš„æ—¶å€™ï¼Œè¦æŒ‰ç…§ $y$ åæ ‡ä»å°åˆ°å¤§æ’åºæ‰èƒ½å¯¹ï¼Œè€Œè€ƒè™‘å³ç«¯ç‚¹çš„æ—¶å€™åˆ™æ˜¯è¦åè¿‡æ¥æ’åºã€‚ç„¶åæ”¹äº†æ”¹è§‰å¾—å¾ˆç¨³ã€‚</p><p>ç„¶ååˆé”™äº†ï¼Œå› ä¸ºå¦‚æœæŸä¸ªç‚¹çš„æ¨ªåæ ‡åœ¨æŸçº¿æ®µçš„å·¦ç«¯ç‚¹çš„å¤–éƒ¨ï¼Œå’Œå†…éƒ¨çš„å¤„ç†æ–¹å¼è¦åï¼è¿‡ï¼æ¥ï¼ç„¶åå†™äº†ä¸ªåˆ†ç±»è®¨è®ºè§‰å¾—å¾ˆç¨³ã€‚</p><p>ç„¶ååˆæŒ‚äº† ï¼Œè°ƒäº†ä¸€ä¼šå„¿å‘ç°è¿™ä¹ˆåˆ¤æ²¡æ³•è§£å†³å®Œå…¨ä½äºæŸæ¡çº¿æ®µä¹‹ä¸‹çš„ç‚¹ã€‚äºæ˜¯å°±é¢„å¤„ç†äº†ä¸€æ³¢å’Œç­”æ¡ˆæˆ–èµ·æ¥ï¼Œè§‰å¾—å¾ˆç¨³ã€‚</p><p>ç„¶åè°ƒäº†åŠå¤©è¿˜æ˜¯è¿‡ä¸å»â€¦çªç„¶é†’æ‚Ÿï¼Œæˆ‘æ‹¿ bitsetï¼Œç»´æŠ¤çš„æ˜¯ç‚¹çš„ç»å¯¹é¡ºåºï¼Œä½†æ˜¯å¦‚æœå·¦ç«¯ç‚¹å’Œå³ç«¯ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç”¨æ­£ç€æ’åºäºŒåˆ†çš„ï¼Œä¸€ä¸ªä½¿ç”¨åç€æ’åºäºŒåˆ†çš„ï¼Œå°±å› ä¸ºé¡ºåºä¸åŒè€Œä¸ï¼èƒ½ï¼ç›´ï¼æ¥ï¼åˆï¼å¹¶ï¼æ‰€ä»¥è¿™ä¸œè¥¿å°±éœ€è¦å†™ä¸€ä¸ªæ˜ å°„ï¼Œä½†æ˜¯å¦‚æœæ˜ å°„çš„è¯è¿™ä¸å•æ¬¡è¯¢é—®å¤æ‚åº¦åˆå˜æˆ $O(n)$ äº†å—ï¼ï¼Ÿç„¶åå°± GG äº†ã€‚é€‰æ‹©å†™ $20$ åˆ†æš´åŠ›æ»šç²—ã€‚</p><p>ç„¶åè¢« std ç§€äº†ä¸€è„¸= =ã€‚</p></div></div><hr><p>è€ƒè™‘æ­£ç»åšæ³•ï¼Œè¿˜æ˜¯æ‰¾æ€§è´¨ã€‚è€ƒè™‘å…·è±¡åŒ–ä¸€ä¸‹æŸä¸ªç‚¹ä¸èƒ½çœ‹åˆ°æŸä¸ªç‚¹çš„æ¡ä»¶ï¼Œè€ƒè™‘è¿™æ ·</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="2.png" alt=""></p><p>ç„¶åå°±æ˜¯è®¾ä»å·¦è‡³å³å››ä¸ªä¸ $x$ è½´çš„äº¤ç‚¹åˆ†åˆ«ä¸º $W,X,Y,Z$ ï¼Œé‚£ä¹ˆå½“ä¸”ä»…å½“ $W &lt;X$ ä¸” $Y&lt;Z$ æ—¶ï¼Œä¹Ÿå°±æ˜¯è§‚æµ‹ç‚¹ä¸è¯¥çº¿æ®µç«¯ç‚¹çš„è¿çº¿ä¸ $x$ è½´çš„äº¤ç‚¹è¢«ä¸Šæ–¹æŸè¢«è§‚æµ‹ç‚¹ä¸è¯¥çº¿æ®µç«¯ç‚¹çš„è¿çº¿ä¸ $x$ è½´çš„äº¤ç‚¹å®Œå…¨åŒ…å«æ—¶ï¼Œå½“å‰è¢«è§‚æµ‹ç‚¹ä¼šè¢«ç»Ÿè®¡åˆ°ã€‚</p><p>åŒæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´å¼ºçš„æ€§è´¨ã€‚å°±æ˜¯å¦‚æœå½“å‰è§‚æµ‹ç‚¹æ»¡è¶³ $Y<Z$ æˆ–è€… $X>W$ ï¼Œé‚£ä¹ˆå¦ä¸€åŠçš„æ¡ä»¶å¿…ç„¶ä¹Ÿæ»¡è¶³ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„ã€‚ç„¶åè€ƒè™‘è¿™æ ·çš„è¯å°±å¯ä»¥ç›´æ¥æš´åŠ›å®¹æ–¥äº†ã€‚å…·ä½“çš„ï¼Œå…ˆé¢„å¤„ç†å‡ºå¯¹äºæ¯ä¸ªçº¿æ®µé›†åˆï¼Œæ¯ä¸ªä¸Šæ–¹çš„ç‚¹ä¸è¯¥é›†åˆå†…çº¿æ®µçš„è¿çº¿ä¸ $x$ è½´æ‰€äº¤çš„åŒºé—´çš„<strong>äº¤</strong>ã€‚ç„¶åå¯¹äºå½“å‰é›†åˆä¸‹æ¯ä¸ªç‚¹å¾—å‡ºçš„ $l,r$ åˆ†åˆ«æ’åºï¼Œè¯¢é—®å°±å¯ä»¥æš´åŠ›äºŒåˆ†å‡ºä½ç½®æ¥åšäº†ã€‚</p><p>å®ç°ä¸Šæœ‰ç‚¹ç»†èŠ‚ã€‚å¤§æ¦‚æ˜¯ä»€ä¹ˆ $l$ è¦ <code>lower_bound</code> ï¼Œ$r$ è¦ <code>upper_bound</code> ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p><p>ç„¶åï¼Œè¿™é¢˜ï¼Œä»–å¡ï¼ç²¾ï¼åº¦ï¼ç›´æ¥å¼€ <code>long double</code> å•¥äº‹æ²¡æœ‰ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€Œçå†™çš„</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, m, q ;</span><br><span class="line"></span><br><span class="line">pint base[N] ;</span><br><span class="line"></span><br><span class="line">pint esab[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ns[<span class="number">10</span>][N] ;</span><br><span class="line"></span><br><span class="line">pint line[<span class="number">10</span>][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; all ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; blw ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; below[<span class="number">10</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">(pint a, pint b, pint c)</span></span>&#123;</span><br><span class="line">    pint x = make_pair(b.fr - a.fr, b.sc - a.sc) ;</span><br><span class="line">    pint y = make_pair(c.fr - a.fr, c.sc - a.sc) ;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1l</span>l * x.fr * y.sc - <span class="number">1l</span>l * y.fr * x.sc &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk2</span><span class="params">(pint a, pint b, pint c)</span></span>&#123;</span><br><span class="line">    pint x = make_pair(b.fr - a.fr, b.sc - a.sc) ;</span><br><span class="line">    pint y = make_pair(c.fr - a.fr, c.sc - a.sc) ;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1l</span>l * x.fr * y.sc - <span class="number">1l</span>l * y.fr * x.sc &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp1</span><span class="params">(pint a, pint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fr == b.fr ? a.sc &lt; b.sc : a.fr &lt; b.fr ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp2</span><span class="params">(pint a, pint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.fr == b.fr ? a.sc &gt; b.sc : a.fr &lt; b.fr ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; q ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) all[i] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i].fr = qr(), base[i].sc = qr() ;</span><br><span class="line">    sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, comp1) ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) esab[i] = base[i] ;</span><br><span class="line">    sort(esab + <span class="number">1</span>, esab + n + <span class="number">1</span>, comp2) ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">rev[i] = lower_bound(base + <span class="number">1</span>, base + n + <span class="number">1</span>, esab[i]) - base ;</span><br><span class="line"><span class="comment">//for (int i = 1 ; i &lt;= n ; ++ i) cout &lt;&lt; rev[i] &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        line[i][<span class="number">0</span>].fr = qr() ;</span><br><span class="line">        line[i][<span class="number">1</span>].fr = qr() ;</span><br><span class="line">        line[i][<span class="number">0</span>].sc = line[i][<span class="number">1</span>].sc = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">blw.<span class="built_in">set</span>() ; blw[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">below[i].reset() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (base[j].sc &lt; line[i][<span class="number">0</span>].sc)</span><br><span class="line">                below[i][j] = <span class="number">1</span>, ns[i][++ ns[i][<span class="number">0</span>]] = j ;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        x = qr(), y = qr() ;</span><br><span class="line">        pint now = make_pair(x, y) ;</span><br><span class="line">        <span class="built_in">bitset</span> &lt;N&gt; ans, t, tt, tmp ;</span><br><span class="line">ans.<span class="built_in">set</span>() ; ans[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line"><span class="keyword">bool</span> val1, val2 ;</span><br><span class="line">            <span class="keyword">int</span> l = <span class="number">1</span>, r = n, mid, res = <span class="number">0</span>, old ;</span><br><span class="line">            <span class="keyword">if</span> (x &gt;= line[i][<span class="number">0</span>].fr)&#123;</span><br><span class="line">val1 = <span class="number">0</span> ;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">                    mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (chk(now, line[i][<span class="number">0</span>], base[mid]))</span><br><span class="line">                        res = mid, l = mid + <span class="number">1</span> ; <span class="keyword">else</span> r = mid - <span class="number">1</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">val1 = <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">                    mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (chk(now, line[i][<span class="number">0</span>], esab[mid]))</span><br><span class="line">                        res = mid, l = mid + <span class="number">1</span> ; <span class="keyword">else</span> r = mid - <span class="number">1</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            t = all &amp; (all &lt;&lt; (n - res)) ; t &gt;&gt;= n - res ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">10</span> ; ++ i) <span class="built_in">cout</span> &lt;&lt; t[i] &lt;&lt; <span class="string">" "</span> ; <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; t.count() &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">            l = res + <span class="number">1</span>, r = n, old = res, res = n + <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= line[i][<span class="number">1</span>].fr)&#123;</span><br><span class="line">val2 = <span class="number">0</span> ;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">                    mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (chk2(now, line[i][<span class="number">1</span>], esab[mid]))</span><br><span class="line">                        res = mid, r = mid - <span class="number">1</span> ; <span class="keyword">else</span> l = mid + <span class="number">1</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">val2 = <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">                    mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (chk2(now, line[i][<span class="number">1</span>], base[mid]))</span><br><span class="line">                        res = mid, r = mid - <span class="number">1</span> ; <span class="keyword">else</span> l = mid + <span class="number">1</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            tt = (all &gt;&gt; res) &lt;&lt; res ;</span><br><span class="line"><span class="keyword">if</span> (!val1)&#123;</span><br><span class="line">            </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (val2)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">10</span> ; ++ i) <span class="built_in">cout</span> &lt;&lt; t[i] &lt;&lt; <span class="string">" "</span> ; <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; t.count() &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">            t |= below[i] ;</span><br><span class="line">ans &amp;= t ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (<span class="keyword">int</span>)ans.count()) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, m, q ;</span><br><span class="line"></span><br><span class="line">vint s[<span class="number">36</span>] ;</span><br><span class="line"></span><br><span class="line">vdb Lr[<span class="number">36</span>] ;</span><br><span class="line">vdb Rr[<span class="number">36</span>] ;</span><br><span class="line"></span><br><span class="line">pint base[N] ;</span><br><span class="line"></span><br><span class="line">pint line[<span class="number">10</span>][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">getsec</span><span class="params">(<span class="keyword">const</span> pint &amp;x, <span class="keyword">const</span> pint &amp;y)</span></span>&#123;</span><br><span class="line">    db d1 = x.fr - y.fr ;</span><br><span class="line">    db d2 = x.sc - y.sc ;</span><br><span class="line">    <span class="keyword">if</span> (!d1) <span class="keyword">return</span> x.fr ;</span><br><span class="line">    db k = (d2 / d1) ;</span><br><span class="line">    <span class="keyword">return</span> (k * x.fr - x.sc) / k ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get_mask</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x ? <span class="number">-1</span> : <span class="number">1</span> ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">do_do</span><span class="params">(<span class="keyword">const</span> pint &amp;d, <span class="keyword">int</span> num, <span class="keyword">const</span> vdb &amp;L, <span class="keyword">const</span> vdb &amp;R)</span></span>&#123;</span><br><span class="line">    db lc = <span class="number">-1e18</span>, rc = <span class="number">1e18</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : s[num])&#123;</span><br><span class="line">        chkmax(lc, getsec(d, line[k][<span class="number">0</span>])) ;</span><br><span class="line">        chkmin(rc, getsec(d, line[k][<span class="number">1</span>])) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; lc &lt;&lt; " " &lt;&lt; rc &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">int</span> l = lower_bound(R.begin(), R.end(), rc) - R.begin() ;</span><br><span class="line">    <span class="keyword">int</span> r = upper_bound(L.begin(), L.end(), lc) - L.begin() ;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; num &lt;&lt; " " &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">return</span> max(<span class="number">0</span>, (r - <span class="number">1</span>) - (l - <span class="number">1</span>)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; q ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i].fr = qr(), base[i].sc = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        line[i][<span class="number">0</span>].fr = qr() ;</span><br><span class="line">        line[i][<span class="number">1</span>].fr = qr() ;</span><br><span class="line">        line[i][<span class="number">0</span>].sc = line[i][<span class="number">1</span>].sc = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">1</span> ; o &lt; (<span class="number">1</span> &lt;&lt; m) ; ++ o)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>) &amp; o) s[o].p_b(i) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">bool</span> chk = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k : s[o])</span><br><span class="line">                chk &amp;= (line[k][<span class="number">0</span>].sc &lt; base[i].sc) ;</span><br><span class="line">            <span class="keyword">if</span> (!chk) <span class="keyword">continue</span> ;</span><br><span class="line">            db l = <span class="number">-1e18</span>, r = <span class="number">1e18</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k : s[o])&#123;</span><br><span class="line">                chkmax(l, getsec(base[i], line[k][<span class="number">0</span>])) ;</span><br><span class="line">                chkmin(r, getsec(base[i], line[k][<span class="number">1</span>])) ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//          cout &lt;&lt; o &lt;&lt; " " &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">if</span> (l &lt;= r) Lr[o].p_b(l), Rr[o].p_b(r) ;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(Lr[o].begin(), Lr[o].end()) ;</span><br><span class="line">        sort(Rr[o].begin(), Rr[o].end()) ;</span><br><span class="line"><span class="comment">//cout &lt;&lt; Lr[o].size() &lt;&lt; " " &lt;&lt; Rr[o].size() &lt;&lt; '\n' ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        ans = n ;</span><br><span class="line">        x = qr(), y = qr() ;</span><br><span class="line">        pint now = make_pair(x, y) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">1</span> ; o &lt; (<span class="number">1</span> &lt;&lt; m) ; ++ o)</span><br><span class="line">            ans += get_mask(s[o].size() &amp; <span class="number">1</span>) * do_do(now, o, Lr[o], Rr[o]) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="A-M-P-M"><a href="#A-M-P-M" class="headerlink" title="A.M.~P.M."></a>A.M.~P.M.</h1><p><del>è¿™ä¸ªH1æ„æ€æ˜¯ä¸Šä¸‹åˆæ—¶é—´æ··ç€æ‰“çš„</del></p><h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><p>å¤§æ¦‚å°±æ˜¯æš´åŠ›è´ªå¿ƒã€‚æ ¹æ® $2^k&gt;\sum _{j&lt;k} 2^j$ å¯ä»¥çŸ¥é“ä»æœ€é«˜ä½å¼€å§‹è´ªå¿ƒä¸€å®šæ²¡é—®é¢˜ã€‚ç§’äº†ç§’äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> to, next ; </span><br><span class="line">&#125;E[MAXN &lt;&lt; <span class="number">1</span>] ; <span class="keyword">int</span> head[MAXN], cnt ; LL ans ;</span><br><span class="line"><span class="keyword">int</span> N, L[MAXN], R[MAXN], P[MAXN], A[MAXN], vis[MAXN] ; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfsp</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!u) <span class="keyword">return</span> ; </span><br><span class="line">P[++ P[<span class="number">0</span>]] = u ;</span><br><span class="line">dfsp(L[u]), dfsp(R[u]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfsa</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!u) <span class="keyword">return</span> ;</span><br><span class="line">dfsa(L[u]), dfsa(R[u]) ;</span><br><span class="line">A[++ A[<span class="number">0</span>]] = u ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">expow</span><span class="params">(LL a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">LL res = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">if</span> (!a) <span class="keyword">return</span> <span class="number">0l</span>l ;</span><br><span class="line"><span class="keyword">while</span> (b)&#123;</span><br><span class="line"><span class="keyword">if</span> (b &amp; <span class="number">1</span>) </span><br><span class="line">(res *= a) %= Mod ;</span><br><span class="line">(a *= a) %= Mod, b &gt;&gt;= <span class="number">1</span> ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res % Mod ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N ; <span class="keyword">int</span> i, j, u, v ; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v), L[i] = u, R[i] = v ;</span><br><span class="line">dfsp(<span class="number">1</span>), dfsa(<span class="number">1</span>) ; <span class="built_in">memset</span>(vis, <span class="number">-1</span>, <span class="keyword">sizeof</span>(vis)) ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>, j = N - <span class="number">1</span> ; i &lt;= N ; ++ i, -- j)&#123;</span><br><span class="line"><span class="keyword">if</span> (vis[A[i]] &gt; <span class="number">-1</span> &amp;&amp; vis[P[i]] &gt; <span class="number">-1</span>) </span><br><span class="line">(ans += expow(<span class="number">2</span> * vis[P[i]], j) - expow(<span class="number">2</span> * vis[A[i]], j) + Mod) %= Mod ; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (vis[P[i]] &gt; <span class="number">-1</span>) vis[A[i]] = <span class="number">0</span>, (ans += expow(<span class="number">2</span> * vis[P[i]], j)) %= Mod ; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (vis[A[i]] &gt; <span class="number">-1</span>) vis[P[i]] = <span class="number">1</span>, (ans += expow(<span class="number">2</span> * vis[P[i]], j) - expow(<span class="number">2</span> * vis[A[i]], j)) %= Mod ; </span><br><span class="line"><span class="keyword">else</span> vis[A[i]] = <span class="number">0</span>, vis[P[i]] = <span class="number">1</span>, (ans += expow(<span class="number">2</span> * vis[P[i]], j) - expow(<span class="number">2</span> * vis[A[i]], j)) %= Mod ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ((ans % Mod) + Mod) % Mod &lt;&lt; <span class="built_in">endl</span> ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><p>ç¾å›¢æ¯æµ‹è¯•èµ›çš„ Aã€‚æŒºå¥½ä¸€é¢˜ï¼Œä¸å†å¤šè¯´äº†ã€‚</p><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><p>å’•å’•å’•å’•å’•ã€‚</p><h1 id="P-M"><a href="#P-M" class="headerlink" title="P.M."></a>P.M.</h1><h2 id="A-2"><a href="#A-2" class="headerlink" title="A"></a>A</h2><h3 id="Sol-1-æˆ‘çš„åšæ³•"><a href="#Sol-1-æˆ‘çš„åšæ³•" class="headerlink" title="Sol 1 æˆ‘çš„åšæ³•"></a>Sol 1 æˆ‘çš„åšæ³•</h3><p>è€ƒè™‘è´ªå¿ƒç€å»åšã€‚é¦–å…ˆä¸éš¾å‘ç°å­æ ‘ä¹‹å‰ç‹¬ç«‹ï¼Œå› ä¸º Alice è‚¯å®šä¼šé€‰ä¸€æ£µæœ€ä¼˜çš„å­æ ‘ï¼Œå¦‚æœ Alice é€‰æ‹©äº†æŸæ£µå­æ ‘ï¼Œå¥¹è¿˜éœ€è¦å†èµ°å›æ ¹çš„è¯æ˜¾ç„¶ä¸ä¼˜ã€‚ä¸€å¼€å§‹æƒ³çš„ç›´æ¥æ‹¿æ¯ä¸ªç‚¹å­©å­ä¸­çš„å¶å­ä¸ªæ•° $s(x)$ å’Œæ·±åº¦ $dep(x)$ æ¯”ä¸€ä¸‹ï¼Œåæ¥å‘ç°å¦‚æœæŸä¸ªæ¯”è¾ƒæµ…çš„åœ°æ–¹æœ‰å¶å­çš„è¯ï¼ŒBob æ˜¯ä¸€å®šè¦å µçš„ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†Bobæµªè´¹çš„æ­¥æ•°ä¹Ÿè¦ç®—ä¸Šã€‚</p><p>æŒ‚äº†ä¸€å‘åå‘ç°â€¦åŸæ¥ Bob æ‰æ˜¯å…ˆæ‰‹(smwy)ã€‚ç„¶åè‡ªå·±æƒ³çš„æ˜¯ä¸€å®šä¼šæŒ‘ä¸€ä¸ª $s(x)$ å°½é‡å¤§ä¸” $dep(x)$ å°½é‡å°çš„å¶å­åˆ æ‰ã€‚å†·é™äº†ä¸€ä¼šå„¿å‘ç°è¿™å¹¶ä¸æ˜¯æœ€ä¼˜çš„ç­–ç•¥ã€‚æœ€ä¼˜çš„ç­–ç•¥åº”è¯¥æ˜¯ Bob é¢„æµ‹åˆ°äº† Alice ä¼šæ€ä¹ˆèµ°å¹¶åˆ é™¤ Alice è·¯å¾„ä¸Šçš„æŸä¸ªå…³é”®å¶å­ã€‚äºæ˜¯å°±åº”è¯¥æ‹¿ $dep(x)$ å’Œ $s(x)-1$ æ¯”è¾ƒã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> sum[N] ;</span><br><span class="line"><span class="keyword">int</span> leaf[N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        dep[k] = dep[x] + <span class="number">1</span> ;</span><br><span class="line">        dfs(k) ; sum[x] += leaf[k] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!E[x].size()) leaf[x] = <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sum[x] + k &gt; dep[x] + <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Y"</span>) ; <span class="built_in">exit</span>(<span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        <span class="keyword">if</span> (!leaf[y]) dfs(y, k + sum[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; <span class="keyword">int</span> x, y = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        x = qr(), E[x].p_b(i) ; dfs(<span class="number">1</span>) ;</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>) ; <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"D"</span>), <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h3 id="Sol-2-std-çš„åšæ³•"><a href="#Sol-2-std-çš„åšæ³•" class="headerlink" title="Sol 2 std çš„åšæ³•"></a>Sol 2 std çš„åšæ³•</h3><p>è¯´å®è¯è¿™ç§åšåšå¼ˆçš„æ€è·¯æˆ‘è¿˜æ˜¯çœŸæ²¡æ€ä¹ˆè§è¿‡ã€‚è€ƒè™‘ç›´æ¥ $dp$ ã€‚è®¾ $f_u$ è¡¨ç¤ºè€ƒè™‘äº†ä»¥ $u$ ä¸ºæ ¹çš„å­æ ‘ï¼ŒBob è¦è·èƒœçš„è¯éœ€è¦<strong>æå‰æ“ä½œå¤šå°‘æ¬¡</strong>ã€‚é‚£ä¹ˆä¼šæœ‰è½¬ç§»</p><script type="math/tex; mode=display">\begin{cases}f_u=1&u~\mathrm{is~a~leaf}\\f_u=\max\{-1+\sum f_{v},0\}&\rm{otherwise}\end{cases}</script><p>å› ä¸º Bob è‡³å°‘è¦æŠŠæ‰€æœ‰å¶å­éƒ½åˆ æ‰ï¼Œä¸”å¯ä»¥æå‰æ“ä½œä¸€æ¬¡ã€‚æœ€åå¦‚æœ $f_1=0$ é‚£ä¹ˆBob å¿…èƒœã€‚</p><h2 id="B-2"><a href="#B-2" class="headerlink" title="B"></a>B</h2><p>è°”è°”é¢˜ã€‚è€ƒè™‘éšä¾¿é€‰ $k$ ä¸ªç‚¹ç»„æˆçš„å‡¸åŒ…ç‚¹ç¼–å·å¯èƒ½ä¸è¿ç»­ï¼Œæ‰€ä»¥æ­£ç€åšå¾ˆéš¾ï¼Œäºæ˜¯è€ƒè™‘åç€åšï¼Œç»´æŠ¤è¢«åˆ æ‰çš„é¢ç§¯ã€‚å…·ä½“çš„ï¼Œå¯ä»¥ç”¨ä¸‰è§’å‰–åˆ†æ±‚å‡ºä»»æ„ä¸€æ®µè¿ç»­ç¼–å· $[i,j]$ ä¹‹é—´çš„å¤šè¾¹å½¢é¢ç§¯ ${\rm S}_{i,j}$ ã€‚ç„¶ååˆ æ‰å®ƒçš„å¤šè¾¹å½¢æ–¹æ¡ˆæ•°å°±æ˜¯ $\binom{n-(j-i+1)}{k-2}$ ã€‚ç„¶ååŠ ä¸€éå°±å¥½äº†ã€‚</p><p>ä¸è¿‡æˆ‘è®¤ä¸ºè¿™é¢˜çš„äº®ç‚¹åœ¨äºå¡å¸¸ã€‚è¿™é¢˜ç”±äºæ¶‰åŠåˆ° $5e3$ çº§åˆ«çš„çš„ç»„åˆæ•°ï¼Œç²¾åº¦å¾ˆéš¾ä¿è¯ã€‚å…¨å¼€ long double æ—¶é—´ä¼šå¾ˆçˆ†ç‚¸ ã€‚äºæ˜¯è€ƒè™‘è¿™ä¹ˆå‡ æ¡å¡å¸¸æ”»ç•¥ï¼š</p><p>1ã€$\binom{n}{k-2}$ å¯ä»¥çº¿æ€§æš´åŠ›ç®—ã€‚</p><p>2ã€ç”¨ $\binom{n}{k}=\binom{n-1}{k}\cdot \frac{n}{n-k}$ æ¥ç®—å‡ºæ‰€æœ‰çš„ $\binom{n-(j-i+1)}{k-2}$ ã€‚</p><p>3ã€é™¤æ³•å’Œä¸‰è§’å‰–åˆ†ä¹˜ $0.5$ ä»€ä¹ˆçš„å¯ä»¥æœ€åä¸€èµ·ç®—ã€‚</p><p>ç„¶åå¤§æ¦‚å°±èƒ½å¿«ä¸ªä¸‰å€å·¦å³ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5010</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    ldb x ;</span><br><span class="line">    ldb y ;</span><br><span class="line">&#125;base[N] ;</span><br><span class="line"></span><br><span class="line">ldb ans ;</span><br><span class="line">ldb sum ;</span><br><span class="line"><span class="comment">//ldb fac[N] ;</span></span><br><span class="line"><span class="comment">//ldb inv[N] ;</span></span><br><span class="line">ldb pks[N] ;</span><br><span class="line">db f[N][N] ;</span><br><span class="line"><span class="comment">//db comb[N][N] ;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ldb binom(int x, int y)&#123; return fac[x] / fac[y] / fac[x - y] ; &#125;</span></span><br><span class="line"><span class="keyword">inline</span> db <span class="keyword">operator</span> * (<span class="keyword">const</span> Node &amp;a, <span class="keyword">const</span> Node &amp;b)&#123; <span class="keyword">return</span> (a.x * b.y - a.y * b.x) ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    pks[m - <span class="number">2</span>] = <span class="number">1.0</span> ; sum = <span class="number">1.0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = m - <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        pks[i] = pks[i - <span class="number">1</span>] * (ldb)i / (ldb)(i - m + <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        sum = sum / (ldb)i * (ldb)(n - i + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%Lf%Lf"</span>, &amp;base[i].x, &amp;base[i].y) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i + n] = base[i] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= i + n - <span class="number">1</span> ; ++ j)</span><br><span class="line">            f[i][j] = f[i][j - <span class="number">1</span>] + base[j - <span class="number">1</span>] * base[j] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= i + n - <span class="number">1</span> ; ++ j)</span><br><span class="line">            f[i][j] = <span class="built_in">fabs</span>(f[i][j] + base[j] * base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= n - m + i + <span class="number">1</span> ; ++ j)</span><br><span class="line">            ans += f[i][j] * pks[n - (j - i + <span class="number">1</span>)] ;</span><br><span class="line">    ans = f[<span class="number">1</span>][n] - ans / sum ;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.10Lf"</span>, <span class="number">0.5</span> * ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="C-2"><a href="#C-2" class="headerlink" title="C"></a>C</h2><p>è¿™é¢˜æ˜¯çœŸçš„æœ‰è¶£ã€‚</p><blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="3.png" alt=""></p><p>$1\leq n\leq 2\times10^5$ ã€‚</p></blockquote><p>orz åˆæ˜¯æ‰¾æ€§è´¨â€¦åˆæ˜¯æ‰¾æ€§è´¨â€¦æ€ä¹ˆåˆæ˜¯æ‰¾æ€§è´¨Qaq</p><p>è€ƒè™‘ $35$ åˆ†æš´åŠ›æ€ä¹ˆåšã€‚è®¾ $f_i$ è¡¨ç¤ºå‰ $i$ æ ¹å¼¦éƒ½è¢«åˆ é™¤çš„æœ€å°ä»£ä»·ã€‚è€ƒè™‘è½¬ç§»ã€‚è€ƒè™‘æ€æ ·çš„è½¬ç§»ä¼šåˆæ³•ï¼Œé‚£å¿…ç„¶æ˜¯ $j$ å’Œ $i$ æŠŠ $[i,j]$ ä¹‹é—´æ‰€æœ‰å¼¦éƒ½ç»™åˆ æ‰æ‰ç®—åˆæ³•ã€‚é‚£ä¹ˆä¸éš¾å†³ç­–ç‚¹ $j_1,j_2,j_3\cdots j_k$  ä¸€å®šæ»¡è¶³è¿™ç§æ€§è´¨ï¼š</p><script type="math/tex; mode=display">(1)\quad i>j_1>j_2>j_3>\cdots >j_k\\(2)\quad p(j_1)<p(j_2)<p(j_3)<\cdots <p(j_k)<p(i)</script><p>é¦–å…ˆä¸éš¾çŸ¥é“ï¼Œå¦‚æœä¸€æ¡å¼¦ä¼šè¢« $i$ å‰²æ‰ï¼Œé‚£ä¹ˆæ‹¿ä»–è½¬ç§»ä¸€å®šä¸ä¼šä¼˜ã€‚å› æ­¤åªæœ‰å½“ä¸€æ¡æ¯”è¾ƒè¿œçš„å¼¦å¯ä»¥æŠŠæ¯”è¾ƒè¿‘çš„æ‰€æœ‰å†³ç­–ç‚¹éƒ½å‰²æ‰ï¼Œå‰ $i$ æ¡å¼¦æ‰éƒ½å¯ä»¥è¢«å‰²æ‰ã€‚é‚£ä¹ˆå°±å¯ä»¥ $O(n^2)$ dpäº†ã€‚</p><p>åŒæ—¶æ³¨æ„åˆ°æœ‰ä¸€æ¡£éƒ¨åˆ†åˆ†æ˜¯è¯´ $|i-p_i|\leq 5$ ã€‚æ®æ­¤å¯ä»¥çŸ¥é“å†³ç­–ç‚¹æ•°é‡ä¸€å®šä¸ä¼šå¤ªå¤šã€‚äºæ˜¯è¿™éƒ¨åˆ†å°±æ¯”è¾ƒç„å­¦ï¼Œå¯ä»¥åªæ‰« $|i-j|&lt;20$ çš„æ‰€æœ‰ $j$ æ¥è½¬ç§»ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//55pts</span></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">127</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        rev[pos[i] = qr()] = i ; f[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">rev[n + <span class="number">1</span>] = pos[n + <span class="number">1</span>] = n + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>, mx = <span class="number">0</span> ; j &gt;= <span class="number">0</span> ; -- j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (n &gt;= <span class="number">3000</span> &amp;&amp; i - j &gt;= <span class="number">16</span>) <span class="keyword">break</span> ;</span><br><span class="line">            <span class="keyword">if</span> (pos[j] &gt;= mx &amp;&amp; pos[j] &lt; pos[i])</span><br><span class="line">                mx = pos[j], chkmin(f[i], base[i] + f[j]) ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//for (int j = pos[i] - 1, k = 0 ; j &gt;= 0 ; -- j)</span></span><br><span class="line"><span class="comment">//            if (rev[j] &gt;= k &amp;&amp; rev[j] &lt; i)</span></span><br><span class="line"><span class="comment">//                chkmax(k, rev[j]), chkmin(f[i], base[i] + f[rev[j]]) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; f[n + <span class="number">1</span>] &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯é”™è¯¯çš„ç bbã€‚</p><blockquote><p>ç„¶åè¿™ä¸ª $100$ åˆ†å°±ååˆ†çš„å¼ºã€‚é¦–å…ˆæ¥è€ƒè™‘ï¼Œè¿™äº›å†³ç­–ç‚¹ä¹‹é—´å¹¶ä¸è¿ç»­ï¼Œå¾ˆéš¾ç”¨æ•°æ®ç»“æ„ç»´æŠ¤ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå¯¹äºæ¯ä¸ª $i$ çš„å†³ç­–ç‚¹çš„æ•°é‡å’Œã€‚è€ƒè™‘è¿™ä¸ªå€¼ä¸€å®šæœ‰ä¸€ä¸ªä¸‹ç•Œï¼Œè¿™ä¸ªä¸‹ç•Œæœ¬è´¨ä¸Šå°±æ˜¯</p><blockquote><p>$\{p_n\}$ æ˜¯ä¸€ä¸ª $1\sim n$ çš„æ’åˆ—ã€‚æ±‚</p><script type="math/tex; mode=display">\sum_{i=1}^n\sum_{j=1}^{i-1}\left[p_j\in\left(\max_{k=j+1}^{i-1}\{p_k\}, p_i\right)\right]</script><p>å…¶ä¸­ $(l,r)$ è¡¨ç¤ºä¸€æ®µè¿ç»­çš„å€¼åŸŸã€‚</p></blockquote><p>ç›´è§‚çš„æ„Ÿå—æ˜¯ï¼Œä¼¼ä¹ä¸æ˜¯å¾ˆå¤§ï¼Ÿå› ä¸ºå¦‚æœ $\sqrt n$ åˆ†å—å»å¡çš„è¯ä¹Ÿåªä¼šå¡åˆ° $n$ å·¦å³ã€‚ä»”ç»†è§‚å¯Ÿçš„è¯å¯ä»¥å‘ç°â€”â€”<strong>æ¯ä¸ª $j$ åªä¼šäº§ç”Ÿè‡³å¤š $1$ çš„è´¡çŒ®</strong>ã€‚åŸå› æ˜¯æ¯ä¸ª $j$ çš„è´¡çŒ®éƒ½åªä¼šè¢«ç®—åˆ°åé¢çš„ç¬¬ä¸€ä¸ª $i$ ä¸Šã€‚</p><p>æ‰€ä»¥å¯ä»¥æ¯æ¬¡è¯¢é—®æš´åŠ›æ‰€æœ‰çš„å†³ç­–ç‚¹ï¼Œåœ¨ä¸€ä¸ªçº¿æ®µæ ‘ä¸Šç”¨ $\max\{p_i\}$ äºŒåˆ†ä¸€ä¸‹å°±å¥½äº†ã€‚å¤æ‚åº¦ $O(n\log ^2 n)$ ã€‚</p></blockquote><p>ä¸ºä»€ä¹ˆé”™å‘¢ï¼Ÿå› ä¸ºè¿™ï¼æ ¹ï¼æœ¬ï¼å°±ï¼ä¸ï¼æ˜¯ï¼ä»–ï¼çš„ï¼ä¸Šï¼ç•Œï¼ã€‚æ³¨æ„åˆ° max å–å¾—ä¸æ˜¯æ‰€æœ‰ j+1~i è€Œæ˜¯åˆæ³•çš„ j+1~iã€‚æ‰€ä»¥è¿™ä¸ªä¸Šç•Œæ ¹æœ¬ä¸å¯¹ã€‚é‚£ä¹ˆé—®é¢˜å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>å¤§æ¦‚å°±æ˜¯è®¸å¤šäººè¿™é¢˜å¤æ‚åº¦å†™çš„æ˜¯ä¸å¯¹çš„â€¦å†™æ³•å¤§æ¦‚æ˜¯çº¿æ®µæ ‘ä¸Šåªç»´æŠ¤ p[i] çš„åŒºé—´æœ€å¤§å€¼ï¼Œè¯¢é—®çš„æ—¶å€™æ ¹æ®è¿™ä¸ªåœ¨çº¿æ®µæ ‘ä¸ŠäºŒåˆ†ã€‚ä½†è¿™ä¸ªäºŒåˆ†æ˜¯å‡çš„ï¼Œå¤æ‚åº¦æ˜¯ $O(\sum (\zeta(i))\cdot \rm poly\log)$ï¼Œå…¶ä¸­ $\zeta(i)$ æ˜¯ $i$ çš„å†³ç­–ç‚¹ä¸ªæ•°ã€‚é‚£ä¹Ÿå°±æ˜¯è¯´å¤§æ¦‚æ˜¯å¦‚ä¸‹ç¨‹åºçš„ $cnt$ å€¼ä¹˜ä¸Šä¸€ä¸ª $\rm polylog$ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>, mx = <span class="number">0</span> ; j &gt;= <span class="number">0</span> ; -- j)</span><br><span class="line">   <span class="keyword">if</span> (pos[j] &gt;= mx &amp;&amp; pos[j] &lt; pos[i])</span><br><span class="line">       mx = pos[j], ++ cnt ;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿™ä¸ªå¤æ‚åº¦æ˜¯æ˜¾ç„¶ä¸å¯¹çš„ã€‚è€ƒè™‘å°†é¢˜ç›®ä¸­çš„ $\{p_n\}$ æŒ‰ç…§è¿™ç§æ–¹å¼ç”Ÿæˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n&#x2F;2,n&#x2F;2-1,n&#x2F;2-2 â€¦ 1,n,n-1,n-2 â€¦ n&#x2F;2+1</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥è½»æ˜“è¢«å¡åˆ° $n^2$ ã€‚</p><blockquote><p>é“¾æ¥:<a href="https://pan.baidu.com/s/1WeQD6qsORfyUmX6LeONuRw" target="_blank" rel="noopener">https://pan.baidu.com/s/1WeQD6qsORfyUmX6LeONuRw</a>  å¯†ç :ua1f</p></blockquote><p><del>ç”±äºä¸ä¼šå†™ Validator æ‰€ä»¥å¤§å®¶å¯ä»¥è‡ªè¡Œæµ‹ä¸€ä¸‹è‡ªå·±çš„ç¨‹åº</del></p><p>ä¸è¿‡åœ¨ä¸ç‰¹åˆ«å¡çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ª $cnt$ ä¼šæ˜¯ $O(n\ln n)$ çš„çº§åˆ«ã€‚æ® mls è¯´æ˜¯è·Ÿå•è°ƒæ ˆåœ¨æ¯ä¸ªä½ç½®çš„æœŸæœ›é•¿åº¦ä¹‹å’Œæ˜¯ä¸€ä¸ªç•Œã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™äº›é”™è§£èƒ½è¿‡æ‰çš„åŸå› ã€‚</p></blockquote><p>= = è¿™å°±å¾ˆç‹—ã€‚</p><p>æ‰€ä»¥æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯åˆå¹¶çš„æ—¶å€™å°† $dp$ å€¼ä¸€èµ·åˆå¹¶è¿›å»ã€‚è¿™æ · update çš„æ—¶å€™å°±æ˜¯ $\log ^2$ çš„äº†ã€‚æœ€åæ€»å¤æ‚åº¦ $O(n\log ^2n)$ ã€‚</p><p>ä»”ç»†åˆ†æä¸€ä¸‹ç»†èŠ‚ï¼Œå…¶å®æœ¬è´¨ä¸Šè·Ÿã€Œå…”é˜Ÿçº¿æ®µæ ‘ã€é‡Œé¢è®²çš„å†…å®¹å·®ä¸å¤šã€‚è€ƒè™‘ç»´æŠ¤è¿™æ ·ä¸¤ä¸ªå€¼ï¼šè¯¥èŠ‚ç‚¹çš„æ€»è´¡çŒ®ï¼Œå’Œè€ƒè™‘äº†è¯¥èŠ‚ç‚¹å³å­æ ‘åè¯¥èŠ‚ç‚¹å·¦å­æ ‘çš„è´¡çŒ®ã€‚é‚£ä¹ˆç”±äºæ¯ä¸ªå³å­æ ‘éƒ½ä¼šå¯¹å·¦å­æ ‘äº§ç”Ÿä¸åŒç¨‹åº¦çš„å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ¬è´¨ä¸Šåªå…³å¿ƒç¬¬äºŒä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªå€¼åªä¼šèµ·è¾…åŠ©ä½œç”¨ã€‚ç„¶åæ˜¯æ¯ä¸ªå‡½æ•°çš„ç»†èŠ‚ï¼š</p><p>0ã€è€ƒè™‘å¯¹ç€ $p_i$ å»ºç«‹çº¿æ®µæ ‘ï¼Œæ¯ä¸ªç‚¹ç»´æŠ¤é”®å€¼ $i$ å’Œæƒå€¼ $dp_i$ ã€‚</p><p>1ã€<code>query</code> ã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘å¿…ç„¶æ˜¯è¦å…ˆè¿›å³å­æ ‘å†è¿›å·¦å­æ ‘ã€‚æœ€åä¼šè¿”å›ä¸€ä¸ª <code>calc(root,l,r,limx)</code> çš„å‡½æ•°ã€‚</p><p>2ã€<code>update</code>ã€‚åªéœ€è¦è€ƒè™‘åœ¨ <code>push_up</code> çš„æ—¶å€™ï¼Œå…ˆè®¡ç®—åœ¨å³å­æ ‘å½±å“ä¸‹å·¦å­æ ‘çš„è´¡çŒ®ï¼Œç„¶åå’Œå³å­æ ‘çš„è´¡çŒ®åˆå¹¶å°±å¥½äº†ã€‚</p><p>3ã€è€ƒè™‘ <code>calc</code> å‡½æ•°æœ¬è´¨ä¸Šæ˜¯åœ¨è®¡ç®—åœ¨ <code>limx</code> è¿™ä¸ªé™åˆ¶çš„å½±å“ä¸‹ä»¥ <code>root</code> ä¸ºæ ¹çš„å­æ ‘çš„è´¡çŒ®ã€‚æ³¨æ„åˆ°ç”±äºç»´æŠ¤äº†ä¸€ä¸ªã€Œè€ƒè™‘äº†è¯¥èŠ‚ç‚¹å³å­æ ‘çš„å½±å“åè¯¥èŠ‚ç‚¹å·¦å­æ ‘çš„è´¡çŒ®ã€ï¼Œå¯ä»¥çŸ¥é“å¦‚æœå½“å‰çš„æœ€å¤§çš„ $j$ æ»¡è¶³ $j\gt \max_{jâ€™\in rchild} jâ€™$ï¼Œé‚£ä¹ˆå°±åªéœ€è¦å…³å¿ƒå³å­æ ‘ä¸­çš„è´¡çŒ®ï¼Œå°±å¯ä»¥é€’å½’è¿›å³å­æ ‘å¹¶ç±»åŠ ä¸Š $lchild$ çš„è´¡çŒ®ï¼›å¦åˆ™è¿›å…¥å·¦å­æ ‘ã€‚</p><p>æ„Ÿè§‰æ¯”è¾ƒç²¾å¦™çš„åœ°æ–¹å°±åœ¨äºç»´æŠ¤äº†ä¸€ä¸ªã€Œè€ƒè™‘äº†è¯¥èŠ‚ç‚¹å³å­æ ‘çš„å½±å“åè¯¥èŠ‚ç‚¹å·¦å­æ ‘çš„è´¡çŒ®ã€ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨çº¿æ®µæ ‘ä¸Šè¿›è¡Œå¤æ‚åº¦æ­£ç¡®çš„äºŒåˆ†äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€Œå¤æ‚åº¦ä¸å¯¹çš„ä»£ç ã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f_now ;</span><br><span class="line"><span class="keyword">int</span> now_mx ;</span><br><span class="line"><span class="keyword">int</span> val[N * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">int</span> seg[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (seg[rt] &lt; now_mx) <span class="keyword">return</span> Inf ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> now_mx = seg[rt], val[rt] ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ; <span class="keyword">int</span> ret = Inf ;</span><br><span class="line">    <span class="keyword">if</span> (seg[rc] &gt; now_mx) ret = calc(rc, mid + <span class="number">1</span>, r) ;</span><br><span class="line">    <span class="keyword">if</span> (seg[lc] &gt; now_mx) chkmin(ret, calc(lc, l, mid)) ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> limx)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (r &lt;= limx)</span><br><span class="line">        <span class="keyword">return</span> calc(rt, l, r) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, ret = Inf ;</span><br><span class="line">    <span class="keyword">if</span> (limx &gt; mid) ret = qry(rc, mid + <span class="number">1</span>, r, limx) ;</span><br><span class="line">    chkmin(ret, qry(lc, l, mid, limx)) ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> po, <span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> seg[rt] = v1, <span class="keyword">void</span>(val[rt] = v2) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (po &lt;= mid) upd(lc, l, mid, po, v1, v2) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rc, mid + <span class="number">1</span>, r, po, v1, v2) ;</span><br><span class="line">    seg[rt] = max(seg[lc], seg[rc]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">127</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">2000</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            rev[pos[i] = qr()] = i ; f[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">        rev[n + <span class="number">1</span>] = pos[n + <span class="number">1</span>] = n + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i - <span class="number">1</span>, mx = <span class="number">0</span> ; j &gt;= <span class="number">0</span> ; -- j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (n &gt;= <span class="number">3000</span> &amp;&amp; i - j &gt;= <span class="number">16</span>) <span class="keyword">break</span> ;</span><br><span class="line">                <span class="keyword">if</span> (pos[j] &gt;= mx &amp;&amp; pos[j] &lt; pos[i])</span><br><span class="line">                    mx = pos[j], chkmin(f[i], base[i] + f[j]) ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//    for (int j = pos[i] - 1, k = 0 ; j &gt;= 0 ; -- j)</span></span><br><span class="line"><span class="comment">//                if (rev[j] &gt;= k &amp;&amp; rev[j] &lt; i)</span></span><br><span class="line"><span class="comment">//                    chkmax(k, rev[j]), chkmin(f[i], base[i] + f[rev[j]]) ;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; f[n + <span class="number">1</span>] &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        pos[n + <span class="number">1</span>] = n + <span class="number">1</span> ;</span><br><span class="line">        <span class="built_in">memset</span>(val, <span class="number">127</span>, <span class="keyword">sizeof</span>(val)) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) pos[i] = qr() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line">            f_now = qry(<span class="number">1</span>, <span class="number">1</span>, n + <span class="number">1</span>, pos[i]) ;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; i &lt;&lt; " " &lt;&lt; f_now &lt;&lt; '\n' ;</span></span><br><span class="line">            f[i] = base[i] + (f_now &gt;= Inf ? <span class="number">0</span> : f_now) ;</span><br><span class="line">            upd(<span class="number">1</span>, <span class="number">1</span>, n + <span class="number">1</span>, pos[i], i, f[i]), now_mx = <span class="number">0</span> ;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; f[i] &lt;&lt; '\n' ;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; f[n + <span class="number">1</span>] &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div><div class="fold_hider"><div class="close hider_title">ã€Œå¤æ‚åº¦æ­£ç¡®çš„ä»£ç ã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ycy make_pair</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line">pint f_now ;</span><br><span class="line">pint ept_val ;</span><br><span class="line">pint zero_val ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc (rt &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line">pint val[N * <span class="number">3</span>] ;</span><br><span class="line">pint lval[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">mx</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123; <span class="keyword">return</span> x &gt; y ? x : y ; &#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">mn</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123; <span class="keyword">return</span> x &lt; y ? x : y ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">il pint <span class="title">merge</span><span class="params">(<span class="keyword">const</span> pint &amp;x, <span class="keyword">const</span> pint &amp;y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ycy( mx(x.fr, y.fr), mn(x.sc, y.sc) ) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il pint <span class="title">solve</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">const</span> pint &amp; now)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; ' ' &lt;&lt; now.fr &lt;&lt; ' ' &lt;&lt; now.sc &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (val[rt].fr &lt;= now.fr) <span class="keyword">return</span> ept_val ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> val[rt] ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (now.fr &lt; val[rc].fr)</span><br><span class="line">         <span class="keyword">return</span> merge(lval[rt], solve(rc, mid + <span class="number">1</span>, r, now)) ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> solve(lc, l, mid, now) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    lval[rt] = solve(lc, l, mid, val[rc]) ;</span><br><span class="line">    val[rt] = merge(lval[rt], val[rc]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> po, <span class="keyword">const</span> pint &amp;v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(val[rt] = v) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (po &lt;= mid) upd(lc, l, mid, po, v) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rc, mid + <span class="number">1</span>, r, po, v) ;</span><br><span class="line">    push_up(rt, l, r) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> po)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt;  " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (r &lt;= po)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(f_now = merge(f_now, solve(rt, l, r, f_now))) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (mid &lt; po) qry(rc, mid + <span class="number">1</span>, r, po) ;</span><br><span class="line">    qry(lc, l, mid, po) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    pos[n + <span class="number">1</span>] = n + <span class="number">1</span> ;</span><br><span class="line">    ept_val = ycy(<span class="number">-1</span>, Inf) ;</span><br><span class="line">    zero_val = ycy(<span class="number">2333</span>, <span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) pos[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) base[i] = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n * <span class="number">3</span> ; ++ i)</span><br><span class="line">        val[i] = ept_val, lval[i] = ept_val ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)&#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; i &lt;&lt; '\n' ;</span></span><br><span class="line">        f_now = ept_val ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; i &lt;&lt; '\n' ;</span></span><br><span class="line">        qry(<span class="number">1</span>, <span class="number">1</span>, n, pos[i]) ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; i &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">if</span> (f_now == ept_val)</span><br><span class="line">            f_now = zero_val ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; i &lt;&lt; '\n' ;</span></span><br><span class="line">        f[i] = base[i] + f_now.sc ;</span><br><span class="line">        upd(<span class="number">1</span>, <span class="number">1</span>, n, pos[i], ycy(i, f[i])) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(f, 1, n + 1) ;</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; f[n + <span class="number">1</span>] &lt;&lt; <span class="string">" "</span> ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>æœ‰æœ‰æœ‰ç‚¹å“äººã€‚ç†è®ºå¤æ‚åº¦æ­£ç¡®çš„ä»£ç å±…ç„¶æ¯”ä¸æ­£ç¡®çš„æ…¢ $1000ms+$ ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•ä¸€ä¸‹ä»Šå¤©çš„ä¸‰åœºæ¯”èµ›ï¼Œåˆæ‡’å¾—æ¬é¢˜é¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦é¢˜é¢å¯ä»¥ QQ æˆ³æˆ‘ï¼Œæˆ‘è§‰å¾—ä½ å¯çˆ±å°±ç»™ä½ å•¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="è®¡ç®—å‡ ä½•/ä¸‰è§’å‰–åˆ†" scheme="https://www.orchidany.cn/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95-%E4%B8%89%E8%A7%92%E5%89%96%E5%88%86/"/>
    
      <category term="æ•°å­¦/è§‚å¯Ÿæ€§è´¨,ç»“è®ºä¸æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="æ€ç»´é¢˜/æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="æ€ç»´é¢˜/å®¹æ–¥" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AE%B9%E6%96%A5/"/>
    
      <category term="ç»„åˆè®¡æ•°/æœ‰æŠ€å·§çš„è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E8%AE%A1%E6%95%B0/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ ‘å½¢DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="æ•°æ®ç»“æ„/çº¿æ®µæ ‘" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="è®¡ç®—å‡ ä½•/åŸºç¡€çš„ç‚¹ã€ç›´çº¿ä¸åœ†" scheme="https://www.orchidany.cn/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95-%E5%9F%BA%E7%A1%80%E7%9A%84%E7%82%B9%E3%80%81%E7%9B%B4%E7%BA%BF%E4%B8%8E%E5%9C%86/"/>
    
  </entry>
  
  <entry>
    <title>ã€è®­ç»ƒçºªå½•ã€‘6.1 è®­ç»ƒç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/06/01/6-1%E8%AE%AD%E7%BB%83%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/06/01/6-1è®­ç»ƒç¬”è®°/</id>
    <published>2020-06-01T12:18:14.000Z</published>
    <updated>2020-06-02T23:35:14.756Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>è®°å½•ä¸€ä¸‹ä»Šå¤©çš„ä¸¤åœºæ¯”èµ›ã€‚æ‡’å¾—æ¬é¢˜é¢äº†ã€‚</p><a id="more"></a><h1 id="A-M"><a href="#A-M" class="headerlink" title="A.M."></a>A.M.</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><p>ä¸€å¼€å§‹å†™è¿™é¢˜ï¼Œåœ¨ä¸€çœ¼äºŒåˆ†ä¹‹åæ‘¸äº†å¾ˆä¹…ã€‚åŸå› æ˜¯æˆ‘è§‰å¾—ä¸¤ä¸ªåœ†åˆå¹¶èµ·æ¥åº”è¯¥ç­‰æ•ˆäºä¸€ä¸ªå¤§åœ†ã€‚å†™äº†ä¸€ä¼šå„¿æŒ‚äº†å°±å» Geogebra ä¸Šæ¨¡æ‹Ÿäº†ä¸€ç»„æ‰‹æçš„å°æ ·ä¾‹å‘ç°è‡ªå·±å‡äº†= =</p><p>ç„¶åå‘ç°ä¼¼ä¹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¥¶é…ªï¼Œäºæ˜¯å°±å†™äº†ä¸ª $k^2$ çš„å¹¶æŸ¥é›†å» checkï¼Œå–œæ $75$ åˆ†ã€‚æƒ³äº†æƒ³è§‰å¾— $k^2\log V$ å¤§æ¦‚è¿‡ä¸å» $k=7000$ å°±å»æ T2 äº†ã€‚</p><p>ç„¶åè€ƒè™‘æ»¡åˆ†ã€‚å¤§æ¦‚æ˜¯é¦–å…ˆæŠŠä¸Šä¸‹è¾¹ç•Œä¹Ÿä½œä¸ºç‚¹åŠ è¿›å»ã€‚æ ¹æ®äºŒåˆ† check çš„è¿‡ç¨‹ï¼Œæ˜¯æ¯æ¬¡äºŒåˆ†å‡ºä¸€ä¸ªåŠå¾„ç„¶åæŠŠè¯¥åŠå¾„ä¸‹ç›¸äº¤çš„åœ†éƒ½è¿è¾¹ï¼Œç„¶åå»åˆ¤æ–­ä¸Šä¸‹è¾¹ç•Œæ˜¯å¦åœ¨ä¸€ä¸ª dsu é‡Œï¼Œæ¢å¥è¯è¯´å°±æ˜¯å» check ä¸Šä¸‹è¾¹ç•Œä¹‹é—´çš„æ‰€æœ‰è·¯å¾„ä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€æ¡è·¯å¾„çš„æœ€é•¿è¾¹å°äºäºŒåˆ†å‡ºçš„ $v$ ã€‚å‘ç°æœ‰å•è°ƒæ€§ï¼Œåªå…³å¿ƒè¾ƒå°çš„é‚£äº›è¾¹ã€‚äºæ˜¯å°±è½¬åŒ–æˆæ±‚ MSTï¼Œç„¶åæ‰¾ä¸€ä¸‹ $k+1,k+2$ ä¹‹é—´çš„è¾¹æƒæœ€å¤§å€¼å³å¯ã€‚</p><p>MST éœ€è¦ç”¨ Prim (è¯è¯´è¿™è¿˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ Primï¼Œæ ¹æ®ç™¾åº¦ç™¾ç§‘ yy å‡ºæ¥çš„ï¼Œæ„Ÿè§‰æŒºez)ï¼Œå› ä¸ºæœ¬é¢˜æ˜¯ååˆ†ç¨ å¯†çš„ç¨ å¯†å›¾ã€‚</p><p>æœ€åå¤æ‚åº¦ $O(n^2)$ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆè‡ªå·±å¸¸æ•°è¿‡å¤§å¯¼è‡´ä¸èƒ½æ˜¾å¼å»ºè¾¹= =</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db ans ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line">db mx[N] ;</span><br><span class="line">db mn[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, k ;</span><br><span class="line">db A[N][N] ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Planet</span>&#123;</span></span><br><span class="line">    db x ; db y ; db r ;</span><br><span class="line">    Planet (db a = <span class="number">0</span>, db b = <span class="number">0</span>, db c = <span class="number">0</span> )&#123; x = a, y = b, r = c ; &#125;</span><br><span class="line">&#125;base[N], crs[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == fa[x]) <span class="keyword">return</span> x ;</span><br><span class="line">    <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; y &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">int</span> f1 = find(x) ;</span><br><span class="line">    <span class="keyword">int</span> f2 = find(y) ;</span><br><span class="line">    <span class="keyword">if</span> (f1 != f2)&#123;</span><br><span class="line">        fa[f1] = f2 ;</span><br><span class="line">        mn[f2] = min(mn[f1], mn[f2]) ;</span><br><span class="line">        mx[f2] = max(mx[f1], mx[f2]) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> Planet &amp;A, <span class="keyword">const</span> Planet &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.x == B.x ? A.y &lt; B.y : A.x &lt; B.x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">dist</span><span class="params">(db a, db b, db c, db d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>((a - c) * (a - c) + (b - d) * (b - d)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> db <span class="title">cross</span><span class="params">(<span class="keyword">const</span> Planet &amp;A, <span class="keyword">const</span> Planet &amp;B, db r)</span></span>&#123;</span><br><span class="line">    db ds = dist(A.x, A.y, B.x, B.y) ;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">bool</span>)(ds &lt;= r + r) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(db r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        fa[i] = i, mx[i] = mn[i] = base[i].y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; i ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (cross(base[i], base[j], r))</span><br><span class="line">                merge(i, j) ;</span><br><span class="line">    <span class="comment">//debug(r), debug(fa, 1, k) ;</span></span><br><span class="line"><span class="comment">//    cout &lt;&lt; mx[4] &lt;&lt; " " &lt;&lt; mn[4] &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (mx[find(i)] + r &gt;= m - r &amp;&amp; mn[find(i)] - r &lt;= r) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">vint E[N] ;</span><br><span class="line">db val[N] ;</span><br><span class="line">db cost[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> done[N] ;</span><br><span class="line"><span class="keyword">int</span> minv[N] ;</span><br><span class="line"><span class="function">db <span class="title">dis</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= k - <span class="number">1</span>) base[b].x = base[a].x ;</span><br><span class="line">    <span class="keyword">if</span> (a &gt;= k - <span class="number">1</span>) base[a].x = base[b].x ;</span><br><span class="line">    <span class="keyword">return</span> dist(base[a].x, base[a].y, base[b].x, base[b].y) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Prim</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    done[++ cnt] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        cost[i] = dis(<span class="number">1</span>, i), minv[i] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span>(cnt &lt; k)&#123;</span><br><span class="line">        db cst = <span class="number">1e18</span> ; <span class="keyword">int</span> id = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[i]) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (cost[i] &lt; cst)</span><br><span class="line">                cst = cost[id = i] ;</span><br><span class="line">        &#125;</span><br><span class="line">        E[id].p_b(minv[id]) ;</span><br><span class="line">        E[minv[id]].p_b(id) ;</span><br><span class="line">        done[++ cnt] = id ; vis[id] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[i]) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (cost[i] &gt; dis(id, i))</span><br><span class="line">                cost[i] = dis(id, i), minv[i] = id ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; val[x] &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> d : E[x])</span><br><span class="line">        <span class="keyword">if</span> (d != fa)&#123;</span><br><span class="line">            val[d] = max(dis(x, d), val[x]) ; dfs(d, x) ;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; k ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        base[i].x = qr(), base[i].y = qr() ;</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= <span class="number">20</span>)&#123;</span><br><span class="line">        sort(base + <span class="number">1</span>, base + k + <span class="number">1</span>, comp) ;</span><br><span class="line">        db l = <span class="number">0.0</span>, r = max(n, m), mid ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">fabs</span>(r - l) &gt; eps)&#123;</span><br><span class="line">            mid = (l + r) * <span class="number">0.5</span> ;</span><br><span class="line">            <span class="keyword">if</span> (check(mid))</span><br><span class="line">                ans = mid, l = mid + eps ;</span><br><span class="line">            <span class="keyword">else</span> r = mid - eps ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.7lf"</span>, ans) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        base[++ k] = Planet(<span class="number">0</span>, m) ;</span><br><span class="line">        base[++ k] = Planet(<span class="number">0</span>, <span class="number">0</span>) ;</span><br><span class="line">        Prim() ; dfs(k - <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.8lf\n"</span>, <span class="number">0.5</span> * val[k]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><p>è°”è°”é¢˜ã€‚æ ¹æ®æŸã€Œå¹³é¢æœ€è¿‘ç‚¹å¯¹ã€å¯ä»¥çŸ¥é“ï¼Œå¹³é¢æ’’ç‚¹ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä¹±æã€‚ç„¶åå»å¯ä»¥è€ƒè™‘äºŒåˆ†ä¸€ä¸ªç­”æ¡ˆï¼Œè§‚å¯Ÿåˆ°ä¸Šè¾¹ç•Œå’Œæœ‰è¾¹ç•Œéƒ½æ˜¯å•è°ƒä¸é™çš„ï¼Œäºæ˜¯ check çš„æ—¶å€™è€ƒè™‘ç›´æ¥æš´åŠ› check ç›´åˆ°å‡‘é½ $n$ ä¸ªç‚¹ã€‚ä¼¼ä¹ä¸€å¼€å§‹ random_shuffle ä¸€æ¬¡å°±å¾ˆéš¾è¢«å¡æ‰äº†ã€‚</p><p>std æ˜¯ä»€ä¹ˆè¯¡å¼‚çš„åˆ†ç±»è®¨è®ºè´ªå¿ƒï¼Œè¿™ä¸œè¥¿æ€ä¹ˆä¼šæœ‰æ­£å¸¸äººå†™= =</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tr</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, id ;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> tr &amp; t)</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="keyword">return</span> t.x == x ? t.y &lt; y : t.x &lt; x ; &#125;</span><br><span class="line">&#125;base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">bool</span> nt ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(ll v, <span class="keyword">bool</span> ouf)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">1</span> ;</span><br><span class="line">    cnt = <span class="number">0</span>, nt = <span class="number">0</span> ;</span><br><span class="line">    fill(vis + <span class="number">1</span>, vis + n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">        nt = <span class="number">0</span> ; <span class="comment">//cout &lt;&lt; x &lt;&lt; " " &lt;&lt; y &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (!vis[i] &amp;&amp; max(x, base[i].x) - x + max(y, base[i].y) - y &lt;= v)&#123;</span><br><span class="line">                <span class="keyword">if</span> (ouf) <span class="built_in">printf</span>(<span class="string">"%d "</span>, base[i].id) ; vis[i] = <span class="number">1</span> ;</span><br><span class="line">                chkmax(x, base[i].x), chkmax(y, base[i].y), ++ cnt, nt = <span class="number">1</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">if</span> (cnt == n) <span class="keyword">return</span> <span class="number">1</span> ; <span class="keyword">if</span> (!nt) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; ll l, r, mid ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i].x = qr(), base[i].y = qr(), base[i].id = i ;</span><br><span class="line">    random_shuffle(base + <span class="number">1</span>, base + n + <span class="number">1</span>) ;</span><br><span class="line">    l = <span class="number">0</span>, r = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//        debug(mid) ;</span></span><br><span class="line">        <span class="keyword">if</span> (check(mid, <span class="number">0</span>))</span><br><span class="line">             ans = mid, r = mid - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(ans) ;</span></span><br><span class="line">    <span class="keyword">return</span> !check(ans, <span class="number">1</span>) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>ç»“è®ºé¢˜ï¼Œå¹¶ä¸”ç»“è®ºè¿˜ä¸å®¹æ˜“çŒœ= =</p><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘è¿™ä¹ˆä¸€ç§æ“ä½œï¼ŒæŠŠä¸€åªæ”¾åœ¨ä¸­é—´çš„é‹å­å½“ä½œå·¥å…·äººï¼Œä¸éš¾å‘ç°å‘¨å›´ 4 ä¸ªéƒ½å¯ä»¥è¢«è°ƒæ•´å¥½ï¼ŒåŒç†ä»–ä»¬ä¹‹å‰ä¹Ÿå¯ä»¥ä½œä¸ºå·¥å…·äººå»è°ƒæ•´åˆ«çš„ã€‚æ‰€ä»¥ä¸éš¾å‘ç°ç›´æ¥æŠŠæ‰€æœ‰ç›¸é‚»çš„å·¦å³é‹è¿è¾¹åšä¸€ä¸ªäºŒåˆ†å›¾åŒ¹é…æˆ–è®¸æ˜¯å¯¹çš„ï¼Œå› ä¸ºå¯ä»¥æŠŠæ‰€æœ‰ä¸åœ¨åŒ¹é…é‡Œçš„ç‚¹å½“åšå·¥å…·äººã€‚ä½†æ˜¯è¿™ä¸ªæ€è·¯æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœè·‘å‡ºæ¥çš„åŒ¹é…æ˜¯å®Œç¾åŒ¹é…æ€ä¹ˆåŠï¼Ÿ</p><p>é¦–å…ˆä¸éš¾çŸ¥å®Œç¾åŒ¹é…æ—¶ç­”æ¡ˆä¼šæ˜¯ $\dfrac{n\times m}{2}$ æˆ–è€… $\dfrac{n\times m}{2} -1$ ã€‚ç„¶å emmmã€‚</p><p>ç„¶åå°±å˜å¾—å¥‡æ€ªèµ·æ¥äº†ã€‚å¤§æ¦‚æ˜¯è€ƒè™‘å°†é‹å­çš„æœå‘è®¾ä¸ªæƒå€¼ $0,1,2,3$ åˆ†åˆ«è¡¨ç¤ºå·¦ä¸Šå³ä¸‹ã€‚é‚£ä¹ˆå¦‚æœè®¾åŒ¹é…ä¹‹åé‹å­çš„æœå‘çš„æƒå€¼å’Œ $\rm S_1$ ï¼ŒåŒ¹é…ä¹‹å‰çš„æƒå€¼å’Œä¸º $\rm S_0$ ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªåŒ¹é…æ˜¯å®Œç¾åŒ¹é…ä¸”æˆç«‹ï¼Œé‚£ä¹ˆéœ€è¦æ»¡è¶³ </p><script type="math/tex; mode=display">\rm S_0\equiv S_1\pmod 4</script><p>è¯æ˜çš„è¯è€ƒè™‘ 1ã€å®Œç¾åŒ¹é…å½¼æ­¤ä¹‹é—´ä¸€å®šæ˜¯å¯¹ $4 $ å–æ¨¡åŒä½™çš„ã€‚2ã€ä»»æ„æƒå€¼å’Œæ¨¡ $4$ åŒä½™çš„çŠ¶æ€ä¸¤ä¸¤å¯è¾¾ã€‚ç„¶åå› ä¸ºæ‡’äºæ˜¯å°±ç›´æ¥æ”¾é¢˜è§£å›¾ç‰‡äº†= =</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>è¿™ç§é¢˜åˆ°åº•è¯¥æ€ä¹ˆåšå•Šï¼Ÿè€ƒåœºä¸Šç°è¯ä¸€éï¼Ÿæˆ‘å¯»æ€ç€è¿™ä¸€ç‚¹ä¹Ÿä¸å¥½çŒœå•Š QAQ</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> re1 ;</span><br><span class="line"><span class="keyword">int</span> re2 ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> mat[M] ;</span><br><span class="line"><span class="keyword">int</span> vis[M] ;</span><br><span class="line"><span class="keyword">int</span> Id[N][N] ;</span><br><span class="line"><span class="keyword">int</span> isleft[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> S[M] ;</span><br><span class="line"><span class="keyword">char</span> T[M] ;</span><br><span class="line"></span><br><span class="line">vint E[M] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">do_match</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[k]) <span class="keyword">continue</span> ; vis[k] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (!mat[k] || do_match(mat[k]))</span><br><span class="line">            <span class="keyword">return</span> mat[x] = k, mat[k] = x, <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            Id[i][j] = ++ cnt ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; (S + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (S[j] == <span class="string">'L'</span>) isleft[i][j] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> ((isleft[i][j] ^ isleft[i + <span class="number">1</span>][j]) &amp;&amp; i + <span class="number">1</span> &lt;= n)</span><br><span class="line">                E[Id[i][j]].p_b(Id[i + <span class="number">1</span>][j]), E[Id[i + <span class="number">1</span>][j]].p_b(Id[i][j]) ;</span><br><span class="line">            <span class="keyword">if</span> ((isleft[i][j] ^ isleft[i][j + <span class="number">1</span>]) &amp;&amp; j + <span class="number">1</span> &lt;= m)</span><br><span class="line">                E[Id[i][j]].p_b(Id[i][j + <span class="number">1</span>]), E[Id[i][j + <span class="number">1</span>]].p_b(Id[i][j]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> ((i + j) &amp; <span class="number">1</span>)&#123;</span><br><span class="line">                fill(vis + <span class="number">1</span>, vis + cnt + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">                ans += do_match(Id[i][j]) ; <span class="comment">//debug(ans) ;</span></span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">if</span> (n * m &amp; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(ans) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; (T + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (T[j] == <span class="string">'L'</span>) ++ re1 ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (T[j] == <span class="string">'U'</span>) re1 += <span class="number">2</span> ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (T[j] == <span class="string">'R'</span>) re1 += <span class="number">3</span> ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (T[j] == <span class="string">'D'</span>) re1 += <span class="number">4</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> ( ((i + j) &amp; <span class="number">1</span>) &amp;&amp; (mat[Id[i][j]] == Id[i - <span class="number">1</span>][j] || mat[Id[i][j]] == Id[i + <span class="number">1</span>][j])) re2 += <span class="number">2</span> ;</span><br><span class="line">    <span class="keyword">if</span> (re1 % <span class="number">4</span> == re2 % <span class="number">4</span> || ans != n * m / <span class="number">2</span>) <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; ans - <span class="number">1</span> &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="P-M"><a href="#P-M" class="headerlink" title="P.M."></a>P.M.</h1><h2 id="A-1"><a href="#A-1" class="headerlink" title="A"></a>A</h2><p>çœŸ Â· æ‰¾æ€§è´¨é¢˜ã€‚å¯èƒ½æ˜¯å› ä¸º dls ä¹Ÿè§‰å¾—çº¯æ‰¾æ€§è´¨å¤ªæ— èŠäº†å°±ç»™äº†æš´åŠ› $50$ ã€‚</p><p>æ„Ÿè§‰åšè¿™é¢˜çš„æ—¶å€™å°±æ˜¯å‘ç°ï¼Œè‡ªå·±å½’çº³çš„èƒ½åŠ›ä¸å¤ªè¡Œã€‚å¯¹äºä¸€äº›ç°è±¡å¾ˆéš¾ç»™å‡ºä¸€èˆ¬åŒ–çš„ç»“è®ºã€‚å¦‚æœå†æ¥ä¸ªä»€ä¹ˆåˆ†ç±»è®¨è®ºä¹‹ç±»çš„å°±å½»åº•æ­‡èœäº†ã€‚</p><p>1ã€å¦‚æœå­˜åœ¨ $\geqslant 2$ ä¸ªäººæ˜¯è‡ªå·±çš„è¶…é›†é‚£å°±æ²¡æ•‘äº†ã€‚</p><p>2ã€å¦‚æœå­˜åœ¨æ°å¥½ $1$ ä¸ªäººæ˜¯è‡ªå·±çš„è¶…é›†é‚£ä¹ˆå°±ä¸€å®šæœ‰è§£ã€‚</p><p>ä»¥ä¸Šä¸¤ç‚¹å› ä¸ºæ¯”è¾ƒæ°´æ‰€ä»¥å½“æ—¶æƒ³åˆ°äº†ï¼Œä½†æ˜¯ç”±äºå¤šæµ‹æ‰€ä»¥å¹¶æ²¡å•¥ç”¨ã€‚</p><p>ç„¶åè€ƒè™‘ç›´æ¥å»æšä¸¾ç¬¬ä¸€å $i$ã€‚ç„¶åè€ƒè™‘å¦‚æœè®¾è‡ªå·±ä¸º $k$ï¼Œå¯¹äºä¸€ä¸ªå…¶ä»–äºº $j$ æ»¡è¶³ </p><script type="math/tex; mode=display">s_k\cap s_i \neq s_k\cap s_j</script><p>é‚£ä¹ˆè¿™äº› $j$ å°±ä¸€å®šå¯ä»¥è¢«æ”¾åˆ°åé¢ã€‚è¿™æ˜¯ä¸ªå¾ˆå¼ºçš„æ€§è´¨ï¼Œä¹Ÿæ¯”è¾ƒå¥½æ¨ã€‚æ¥ç€è€ƒè™‘é‚£äº› $s_k\cap s_i = s_k\cap s_{jâ€™}$ çš„ $jâ€™$ ã€‚å‘ç°å¦‚æœå­˜åœ¨æŸä¸€é“é¢˜ $o$ æ˜¯è‡ªå·±æ²¡åšè¿‡ä¸” $jâ€™$ éƒ½æ²¡åšè¿‡çš„ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ç»„åˆæ³•è§£ï¼Œå¦åˆ™æ— è®ºæ€æ ·ä¹Ÿæ‰¾ä¸åˆ°åˆæ³•è§£ã€‚</p><p>äºæ˜¯å°±å¯ä»¥æš´åŠ›åˆ¤äº†ã€‚å¤æ‚åº¦ $O\left(\dfrac{n^2\times m}{w}\right)$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> mxp ;</span><br><span class="line"><span class="keyword">int</span> val ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> t[N] ;</span><br><span class="line"><span class="keyword">int</span> buc[N] ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line"><span class="keyword">char</span> In[N] ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; base ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; otr[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123; <span class="keyword">return</span> buc[a] &gt; buc[b] ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; (In + <span class="number">1</span>) ; </span><br><span class="line">val = <span class="number">0</span> ; -- n ; base.reset() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">            base[i] = (<span class="keyword">bool</span>)(In[i] == <span class="string">'Y'</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; (In + <span class="number">1</span>) ; otr[i].reset() ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">                otr[i][j] = (<span class="keyword">bool</span>)(In[j] == <span class="string">'Y'</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> ((base &amp; otr[i]) == base) ++ val ;</span><br><span class="line">        <span class="keyword">if</span> (val &gt;= <span class="number">2</span>) <span class="keyword">goto</span> NO ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (val &gt;= <span class="number">1</span>) <span class="keyword">goto</span> YES ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; cap, res ; </span><br><span class="line">res.reset(), cap = base &amp; otr[i] ; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                <span class="keyword">if</span> (i != j &amp;&amp; (otr[j] &amp; cap) == cap) res = res | otr[j] ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line"><span class="keyword">if</span> (!base[j] &amp;&amp; otr[i][j] &amp;&amp; !res[j]) <span class="keyword">goto</span> YES ;</span><br><span class="line">        &#125;</span><br><span class="line">        NO : <span class="built_in">puts</span>(<span class="string">"NO"</span>) ; <span class="keyword">continue</span> ;</span><br><span class="line">        YES : <span class="built_in">puts</span>(<span class="string">"YES"</span>) ; <span class="keyword">continue</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="B-1"><a href="#B-1" class="headerlink" title="B"></a>B</h2><p>å”‰ï¼Œè‡ªå·± dp çœŸæ˜¯èœçš„å¯æ€œã€‚å’Œæ‰¾æ€§è´¨ç»“åˆèµ·æ¥å°±æŒ‚äº†ã€‚</p><p>è®¾ $f_{l,r,0/1}$ è¡¨ç¤ºå·²ç»èµ°å®Œäº† $l\sim r$ è¿™ä¸ªåŒºé—´ï¼Œå½“å‰åœ¨ $l/r(0/1)$ æ—¶ï¼Œèµ°å®Œ $[1,n]$ æœ€å°‘è¿˜éœ€è¦å¤šå°‘ä¸ªç –å—ã€‚é‚£ä¹ˆè€ƒè™‘è½¬ç§»ã€‚é¦–å…ˆä¸€ä¸ªè§‚å¯Ÿï¼Œæ ¹æ®è´ªå¿ƒæˆ‘ä»¬æ˜¯ä¸ä¼šç•™ç®±å­çš„ï¼Œä¸€å®šæ˜¯æ°å¥½æ”¾åˆ°å¢™çš„é«˜åº¦ ã€‚é‚£ä¹ˆè€ƒè™‘ä» $l-1,r$ è½¬ç§»åˆ° $l,r$ ï¼Œå‘ç°æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{l,r,0}=\max\{f_{l-1,r,0},h_l-rs(l,r)\}</script><p>å…¶ä¸­ $rs(l,r)$ æ˜¯åœ¨èµ°å®Œ $(l,r)$ å¯ä»¥å‰©ä¸‹å¤šå°‘çŸ³å—ã€‚æ„æ€æ˜¯é¦–å…ˆè‡³å°‘è¦ $f_{l-1,r,0}$ è¿™ä¹ˆå¤šï¼Œå…¶æ¬¡ä¹Ÿå¿…é¡»è¦å¯ä»¥è·¨è¿‡ $h_l$ è¿™å µå¢™ã€‚åŒæ—¶è¿™ç§ $0/1$ åˆ¤æ–­æ–¹ä½çš„è¿˜ä¼šæœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{l,r,1}\to f_{l,r,0}</script><p>ä½†æ˜¯ä¸ä¸€å®šèƒ½èµ°è¿‡å»ã€‚è¿™éƒ¨åˆ†å¯ä»¥è€ƒè™‘æšä¸¾ä¸€ä¸ªæœ€åˆæºå¸¦çš„çŸ³å—ä¸ªæ•° $t$ ç„¶åæ¨¡æ‹Ÿï¼Œè¿™æ ·è½¬ç§»å°±æ˜¯ $O(n)$ çš„ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡è§‚å¯Ÿå‘ç°æ˜¯éœ€è¦</p><script type="math/tex; mode=display">\max_{i\in[l,r-1]}\{h_i\}-rst(l,r)</script><p>çš„çŸ³å—å°±å¯ä»¥äº†ã€‚åŸå› æ˜¯è€ƒè™‘æ¯æ¬¡é»˜è®¤æŠŠæ‰€ç«™åœ¨çš„ç«¯ç‚¹å¤„çš„çŸ³å—æ‹¿åœ¨èº«ä¸Šï¼Œè¿™æ ·å°±ç›¸å½“äºä» $0$ å¼€å§‹è¦çˆ¬è¿‡ $\max h$ è‡³å°‘éœ€è¦çš„çŸ³å—é‡ã€‚</p><p>åŒæ—¶å¯ä»¥å‘ç°ï¼Œ$l\to r$ å’Œ $r \to l$ æœ¬è´¨ç›¸ä¼¼ï¼Œå› ä¸ºå¢™è¿˜æ˜¯é‚£äº›å¢™ï¼Œåªæ˜¯æ¢äº†ä¸ªæ–¹å‘ç»è¿‡è€Œå·²ã€‚</p><p>äºæ˜¯æœ€åå¤æ‚åº¦ $O(n^2)$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> s1[N] ;</span><br><span class="line"><span class="keyword">int</span> s2[N] ;</span><br><span class="line"><span class="keyword">int</span> blk[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> mx[N][N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        s1[i] = s1[i - <span class="number">1</span>] + (base[i] = qr()) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        s2[i] = s2[i - <span class="number">1</span>] + (blk[i] = qr()) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i ; j &lt;= n ; ++ j)</span><br><span class="line">            mx[i][j] = max(mx[i][j - <span class="number">1</span>], blk[j]) ;</span><br><span class="line">    <span class="built_in">memset</span>(f, <span class="number">127</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">    f[<span class="number">1</span>][n][<span class="number">0</span>] = f[<span class="number">1</span>][n][<span class="number">1</span>] = <span class="number">0</span> ; <span class="keyword">int</span> rst ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">1</span> ; l &lt;= n ; ++ l)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r = n ; r &gt;= l ; -- r)&#123;</span><br><span class="line">            <span class="keyword">if</span> (l == <span class="number">1</span> &amp;&amp; r == n) <span class="keyword">continue</span> ;</span><br><span class="line">            rst = s1[r] - s1[l - <span class="number">1</span>] - s2[r - <span class="number">1</span>] + s2[l - <span class="number">1</span>] ;</span><br><span class="line">            <span class="keyword">if</span> (l &gt; <span class="number">1</span>) chkmin(f[l][r][<span class="number">0</span>], max(f[l - <span class="number">1</span>][r][<span class="number">0</span>], blk[l - <span class="number">1</span>] - rst)) ;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; n) chkmin(f[l][r][<span class="number">1</span>], max(f[l][r + <span class="number">1</span>][<span class="number">1</span>], blk[r] - rst)) ;</span><br><span class="line">            chkmin(f[l][r][<span class="number">0</span>], max(f[l][r][<span class="number">1</span>], mx[l][r - <span class="number">1</span>] - rst)) ;</span><br><span class="line">            chkmin(f[l][r][<span class="number">1</span>], max(f[l][r][<span class="number">0</span>], mx[l][r - <span class="number">1</span>] - rst)) ;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, min(f[i][i][<span class="number">0</span>], f[i][i][<span class="number">1</span>])) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><blockquote><p>ç»™å®šä¸€ä¸ª $n\times 3$ çš„æ•°è¡¨ $\{a\}$ ã€‚åˆå§‹æ—¶æ¯ä¸ªæ•°éƒ½ $\leq m$ ï¼Œæ±‚è‡³å°‘ä¿®æ”¹å¤šå°‘ä¸ªæ•°å¯ä»¥ä½¿å¾—</p><script type="math/tex; mode=display">\sum_{j=1}^{3} a_{i, j} \geq \sum_{j=1}^{3} a_{i+1, j}</script><p>å¯¹æ‰€æœ‰ $i\in[1,n-1]$ æˆç«‹ã€‚å…¶ä¸­ä¿®æ”¹ä¹‹åçš„æ•°ä¹Ÿè¦ $\in[0,m]\cap\mathbb{Z}$ ã€‚</p><p>$1\leq n\leq 10^5,0\leq m\le 10^{10}$ ã€‚</p></blockquote><p> è¿™é¢˜æ˜¯çœŸç¥w</p><p>ä¸€å¼€å§‹çš„æ—¶å€™ååˆ†æ‡µåœˆï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•ä¸€æ¡£éƒ¨åˆ†åˆ†æ˜¯å¯ä»¥å¸¦ç€å€¼åŸŸè¿›è¡Œ dpã€‚</p><p>é‚£ä¹ˆé¦–å…ˆç»™å‡ºä¸€ä¸ªæ¨æ–­ï¼š</p><blockquote><p>è€ƒè™‘æ¯ä¸ªä½ç½®çš„ $a_{i,j}$ çš„å’Œ $s_i$ ï¼Œä¿®æ”¹å®Œåçš„ $s_i$ åªä¼šæ˜¯ç¬¬ $i$ ä¸ªä½ç½®ä¿®æ”¹ $0,1,2,3$ æ¬¡çš„å€¼åŸŸåŒºé—´çš„ç«¯ç‚¹ã€‚</p></blockquote><p>æ„Ÿè§‰æœ‰ç‚¹å¯ä»¥çŒœå‡ºæ¥ã€‚å¤§æ¦‚æ˜¯è¯´åæ­£æ¨ªç«–éƒ½æ˜¯æ”¹ï¼Œè¿˜ä¸å¦‚æ”¹çš„æ ‡å‡†ç‚¹ã€‚ç„¶åè€ƒè™‘è¿™æ ·æ”¾åœ¨ä¸€èµ·ç¦»æ•£åŒ–ä¸€ä¸‹ï¼Œæœ¬è´¨ä¸åŒçš„çŠ¶æ€å°±æœ‰ $O(7\times n)$ ä¸ªäº†ã€‚äºæ˜¯å¯ä»¥è®¾ $f_{i,j}$ è¡¨ç¤ºè€ƒè™‘äº†å‰ $i$ ä¸ªä½ç½®ï¼Œå½“å‰ç¬¬ $i$ ä¸ªä½ç½®çš„ $s_i=j$ ä¸”åˆæ³•æ—¶çš„æœ€å°ä»£ä»·çš„æ˜¯å¤šå°‘ã€‚é‚£ä¹ˆè€ƒè™‘å°±æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{i,j}=\min_{k\geqslant j}\{f_{i-1,k}\} + val(i,j)</script><p>å…¶ä¸­ $val(i,j)$ æ˜¯æŠŠç¬¬ $i$ ä¸ªä½ç½®çš„å’Œè°ƒæ•´æˆ $j$ çš„æœ€å°ä»£ä»·ã€‚äºæ˜¯è¿™æ ·å°±å¯ä»¥å–œæ $50pts$  ã€‚</p><p>ç„¶åè€ƒè™‘æ»¡åˆ†ã€‚é¦–å…ˆæœ‰ä¸¤ä¸ª Observationï¼š</p><p>1ã€ $f_{i,j}$ ä¸€å®šæ˜¯éšç€ $j\uparrow$ è€Œå•è°ƒä¸é™ã€‚æ—¢å¯ä»¥æ„Ÿæ€§ç†è§£ä¹Ÿå¯ä»¥æ‰“ä¸ªè¡¨ã€‚</p><p>2ã€è®¾ $[l_{i,k},r_{i,k}]$ è¡¨ç¤ºç¬¬ $i$ ä¸ªä½ç½®ä¿®æ”¹äº† $k$ æ¬¡åçš„å€¼åŸŸåŒºé—´ï¼Œä¸éš¾å‘ç°æœ‰</p><script type="math/tex; mode=display">l_{i,3}\leq l_{i,2}\leq l_{i,1}\leq l_{i,0}=r_{i,0}\leq r_{i,1}\leq r_{i,2}\leq r_{i,3}</script><p>ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆæ•´ä¸ª $f_{i,j}$ åœ¨å–åç¼€æœ€å°å€¼ååŠ ä¸Šçš„æ•°ä¼šæ˜¯è¿™æ ·ï¼š</p><script type="math/tex; mode=display">3,3,3\cdots2,2,2,\cdots 1,1,1\cdots1,0,1\cdots1,1,1\cdots2,2,2\cdots3,3,3</script><p>æ€»å…±æœ‰ $7$ æ®µã€‚å…¶ä¸­åé¢ $4$ æ®µæ ¹æ®ç¬¬ä¸€ä¸ªè§‚å¯Ÿå¯ä»¥çŸ¥é“å¯ä»¥ç›´æ¥æš´åŠ›åŠ (æ ¹æ®å•è°ƒæ€§è½¬åŒ–æˆåç¼€åŠ )ï¼Œå› ä¸ºè¿™ä¸å½±å“å•è°ƒæ€§ã€‚è€Œå‰é¢å‡ æ®µå¯èƒ½ä¼šå½±å“ã€‚è€ƒè™‘æ€ä¹ˆä¿®æ”¹å‰é¢å‡ æ®µï¼Œå‘ç°ä¿®æ”¹çš„æ¬¡æ•°å°‘ã€é‡ä¹Ÿå°‘ã€‚äºæ˜¯å¯ä»¥å¯¹äºæ¯ä¸ªä¸åŒçš„ä¸€æ®µï¼ŒäºŒåˆ†å‡ºç¬¬ä¸€ä¸ªåŠ ä¸Š $1$ ä¹‹åä¸ä¼šæ¯”è¿™ä¸€æ®µçš„æœ«å°¾ $+1$ çš„ä½ç½®çš„ $dp$ å€¼å¤§çš„ï¼Œå½“å‰æ®µä¸­é‚£ä¸ªå…³é”®ä½ç½® $p$ æ¥ï¼Œç„¶åè¿›è¡Œ $1\sim p$ çš„åŒºé—´åŠ ã€‚æœ€åå¤æ‚åº¦ $O(n\log n)\sim O(n\log ^2 n)$ã€‚</p><p>ç„¶åå¤§æ¦‚æ˜¯è¦è¿›è¡Œä¸€ä¸ªç±»ä¼¼çº¿æ®µæ ‘ä¸ŠäºŒåˆ†çš„æ“ä½œã€‚è¿™ä¸ªåœ°æ–¹è·Ÿ <code>ymzqwq</code> å­¦äº†ä¸€ä¸‹ç”¨çš„æ ‘çŠ¶æ•°ç»„ã€‚å¤§æ¦‚æ˜¯è€ƒè™‘é¦–å…ˆæŠŠ $m$ è¡¥é½æˆ $2^k$ çš„å½¢å¼ï¼Œè¿™æ ·äºŒåˆ†å°±å¯ä»¥ç›´æ¥åŠ  $mid$ ï¼Œä¹‹åæ ¹æ® BIT çš„ç‰¹æ€§æŠŠé—®é¢˜ç¿»è½¬ä¸€ä¸‹å˜æˆè¦åœ¨å‰ç¼€é‡ŒäºŒåˆ†å‡ºä¸€ä¸ªä½ç½®æ¥ã€‚å®æµ‹å¸¸æ•°æ¯”è¾ƒä¼˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> len ;</span><br><span class="line">ll s[N] ;</span><br><span class="line">ll pd[M] ;</span><br><span class="line">ll dp[M] ;</span><br><span class="line">ll m, f[M] ;</span><br><span class="line">ll base[<span class="number">3</span>][N] ;</span><br><span class="line"></span><br><span class="line">vll tmp ;</span><br><span class="line">pll t[N][<span class="number">4</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _bit[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> ( ; p &lt;= m ; p += (p &amp; -p)) _bit[p] += v ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; p ; p -= (p &amp; -p)) ret += _bit[p] ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">    ins(l, <span class="number">1</span>), ins(r + <span class="number">1</span>, <span class="number">-1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>) ;</span><br><span class="line">    <span class="built_in">cout</span>.tie(<span class="number">0</span>) ;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">0</span> ; o &lt; <span class="number">3</span> ; ++ o)</span><br><span class="line">            base[o][i] = qr(), s[i] += base[o][i] ;</span><br><span class="line"><span class="comment">//    debug(base[0], 1, n) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        t[i][<span class="number">0</span>].fr = t[i][<span class="number">0</span>].sc = s[i] ;</span><br><span class="line">        t[i][<span class="number">1</span>].fr = <span class="number">3l</span>l *  m, t[i][<span class="number">1</span>].sc = <span class="number">0</span> ;</span><br><span class="line">        t[i][<span class="number">2</span>].fr = <span class="number">3l</span>l *  m, t[i][<span class="number">2</span>].sc = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; ++ j)&#123;</span><br><span class="line">            chkmin(t[i][<span class="number">1</span>].fr, s[i] - base[j][i]) ;</span><br><span class="line">            chkmax(t[i][<span class="number">1</span>].sc, s[i] - base[j][i] + m) ;</span><br><span class="line">            chkmin(t[i][<span class="number">2</span>].fr, base[j][i]) ;</span><br><span class="line">            chkmax(t[i][<span class="number">2</span>].sc, <span class="number">2l</span>l * m + base[j][i]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        t[i][<span class="number">3</span>].fr = <span class="number">0</span>, t[i][<span class="number">3</span>].sc = <span class="number">3l</span>l * m ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= <span class="number">3</span> ; ++ j)</span><br><span class="line">            tmp.p_b(t[i][j].fr), tmp.p_b(t[i][j].sc) ;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(tmp.begin(), tmp.end()) ;</span><br><span class="line">    tmp.erase(unique(tmp.begin(), tmp.end()), tmp.end()) ;</span><br><span class="line">    len = <span class="keyword">int</span>(tmp.size()) ; <span class="comment">//debug(len) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= <span class="number">3</span> ; ++ j)&#123;</span><br><span class="line">            t[i][j].fr = lower_bound(tmp.begin(), tmp.end(), t[i][j].fr) - tmp.begin() + <span class="number">1</span> ;</span><br><span class="line">            t[i][j].sc = lower_bound(tmp.begin(), tmp.end(), t[i][j].sc) - tmp.begin() + <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//            debug(t[i][j].fr, ' '), debug(t[i][j].sc, ' ') ;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        puts("") ;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(tmp, 0, len - 1, '\n') ;</span></span><br><span class="line"><span class="comment">//     ; debug(len) ;</span></span><br><span class="line">    m = <span class="number">1</span> ; <span class="keyword">while</span> (m &lt;= len) m &lt;&lt;= <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//cout &lt;&lt; m &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line"><span class="comment">//        debug(i) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (t[i][j].fr &gt;= <span class="number">1</span>) modify(<span class="number">1</span>, t[i][j].fr - <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">int</span> pos = qry(t[i][j].sc) ; <span class="comment">//cout &lt;&lt; pos &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">int</span> l = <span class="number">1</span>, r = m, mid, res = <span class="number">0</span> ; ll now = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">                mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">if</span> (now + _bit[mid] &gt;= pos)</span><br><span class="line">                     now += _bit[mid], res = mid, l = mid + <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">else</span> r = mid - <span class="number">1</span> ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; res &lt;&lt; '\n' ;</span></span><br><span class="line">            modify(res + <span class="number">1</span>, m) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= n ; ++ i)&#123;</span></span><br><span class="line"><span class="comment">        for (int j = 3 ; j &gt;= 1 ; -- j)</span></span><br><span class="line"><span class="comment">            for (int k = t[i][j].fr ; k &lt; t[i][j - 1].fr ; ++ k)</span></span><br><span class="line"><span class="comment">                dp[k] += j ;</span></span><br><span class="line"><span class="comment">        for (int j = 1 ; j &lt;= 3 ; ++ j)</span></span><br><span class="line"><span class="comment">            for (int k = t[i][j - 1].sc + 1 ; k &lt;= t[i][j].sc ; ++ k)</span></span><br><span class="line"><span class="comment">                dp[k] += j ;</span></span><br><span class="line"><span class="comment">    for (int j = len - 1 ; j &gt;= 1 ; -- j)</span></span><br><span class="line"><span class="comment">chkmin(dp[j], dp[j + 1]) ;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="comment">//    debug(dp, 1, len) ;</span></span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= m ; ++ i) cout &lt;&lt; qry(i) &lt;&lt; " " ;</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; qry(len) &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®°å½•ä¸€ä¸‹ä»Šå¤©çš„ä¸¤åœºæ¯”èµ›ã€‚æ‡’å¾—æ¬é¢˜é¢äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="ZROI" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/ZROI/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ•°æ®ç»“æ„/æ ‘çŠ¶æ•°ç»„" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ™®é€šDP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="å¥‡æ€ªçš„æŠ€å·§" scheme="https://www.orchidany.cn/tags/%E5%A5%87%E6%80%AA%E7%9A%84%E6%8A%80%E5%B7%A7/"/>
    
      <category term="æœ‰è¶£çš„äºŒåˆ†ç­”æ¡ˆ" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E8%B6%A3%E7%9A%84%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="æ•°æ®ç»“æ„/çº¿æ®µæ ‘" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="å›¾è®º/äºŒåˆ†å›¾" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="æŠ€å·§/çŠ¶æ€åˆå¹¶" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E7%8A%B6%E6%80%81%E5%90%88%E5%B9%B6/"/>
    
      <category term="å›¾è®º/åŒ¹é…" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D/"/>
    
      <category term="å›¾è®º/æœ€å°ç”Ÿæˆæ ‘" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>ã€æ³›åšã€‘ç½‘ç»œæµä¹±æè®°å½•</title>
    <link href="https://www.orchidany.cn/2020/05/29/%E7%BD%91%E7%BB%9C%E6%B5%81%E7%9E%8E%E5%81%9A%E8%AE%B0%E5%BD%95/"/>
    <id>https://www.orchidany.cn/2020/05/29/ç½‘ç»œæµçåšè®°å½•/</id>
    <published>2020-05-29T05:53:26.000Z</published>
    <updated>2020-05-31T13:31:42.264Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åšäº†ç‚¹ç½‘ç»œæµé¢˜ç›®ï¼Œç®—æ˜¯å¯¹ç½‘ç»œæµçš„ä¸€ä¸ªå¤ä¹ å§ã€‚</p><p>æ„Ÿè§‰ç°åœ¨å»ºèµ·å›¾æ¥å·²ç»å¯ä»¥ç®—æ˜¯å¾—å¿ƒåº”æ‰‹äº†.jpg</p><p>æ‰“æ˜Ÿçš„é¢˜ç›®éƒ½æ¯”è¾ƒæœ‰è¶£ã€‚å¤§éƒ¨åˆ†é¢˜ç›®å¯èƒ½æ²¡æœ‰æ•°æ®èŒƒå›´ï¼Œå½“ä½œ O(ç½‘ç»œæµèƒ½è¿‡) å°±å¥½äº†ã€‚</p><p><del>è™½ç„¶ç°åœ¨éƒ½è€ƒæ¨¡æ‹Ÿè´¹ç”¨æµï¼Œå»ºå›¾è´¹ç”¨æµå·²ç»æ˜¯å†å²çš„çœ¼æ³ªäº†ã€‚</del> </p><a id="more"></a><h1 id="æœ€å¤§æµ"><a href="#æœ€å¤§æµ" class="headerlink" title="æœ€å¤§æµ"></a>æœ€å¤§æµ</h1><h2 id="UVA11167-Monkeys-in-the-Emei-Moutain"><a href="#UVA11167-Monkeys-in-the-Emei-Moutain" class="headerlink" title="*[UVA11167] Monkeys in the Emei Moutain"></a>*[UVA11167] Monkeys in the Emei Moutain</h2><blockquote><p>å¤§æ¦‚è¯´æœ‰ $n$ åªçŒ´å­ï¼ŒçŒ´å­ä»¬åœ¨æŸä¸ªæ—¶é—´æ®µéœ€è¦å– $v_i$ æ—¶é—´çš„æ°´ï¼Œå„ä¸ªå•ä½æ—¶é—´æ®µæœ€å¤šå…è®¸ $m$ åªçŒ´å­åŒæ—¶å–æ°´ï¼Œé—®çŒ´å­ä»¬èƒ½å¦æˆåŠŸå–æ°´å¹¶è¾“å‡ºä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆï¼Œè¾“å‡ºæ–¹æ¡ˆçš„æ—¶é—´æ®µåŒºé—´è¦ä»å°åˆ°å¤§æ’åºå¹¶ä¸”åˆå¹¶è¿ç»­çš„åŒºé—´ã€‚</p><p>$1\leq l_i,r_i\leq 50000,n\leq 100$ ã€‚</p></blockquote><p>è€ƒè™‘æš´åŠ›å»ºå›¾ï¼Œæˆ‘ä¸€å¼€å§‹çš„æ€è·¯æ˜¯å¯¹äºæ¯ä¸ªæ—¶é—´ç‚¹æ‹†æˆä¸¤ä¸ªç‚¹ $tâ€™,t$ ä¹‹é—´è¿ $f=m$ çš„è¾¹ï¼Œç„¶åçŒ´å­ $i$ å‘ä¸€ä¸ªåŒºé—´çš„ç‚¹è¿ $f=+\infty$ çš„è¾¹ï¼Œæºç‚¹å‘çŒ´å­è¿ $f=v_i$ çš„è¾¹ã€‚è¿™æ ·è¾¹æ•°å¯ä»¥é€šè¿‡çº¿æ®µæ ‘æ¥ææˆ $T\log T$ çš„ã€‚</p><p>ç„¶è€Œä¸Šé¢è¿™ä¸ªå»ºå›¾è‚‰çœ¼å¯è§çš„ä¸æ˜¯æ­£è§£ã€‚è€ƒè™‘å‘åŒºé—´æ¨¡å‹ä¸Šé ï¼Œå› ä¸ºçŒ´å­æ•°å¾ˆå°‘ï¼Œæœ€å¤šæœ‰ $O(n)$ ä¸ªæœ¬è´¨ä¸åŒçš„åŒºé—´ç«¯ç‚¹ã€‚äºæ˜¯å¯ä»¥è€ƒè™‘æŠŠä¸Šé¢é‚£ç§åšæ³•ä¸­æ²¡æœ‰ç”¨åˆ°çš„å¤šä¸ªæ—¶é—´ç‚¹åˆå¹¶æˆä¸€ä¸ªï¼Œå¹¶ä¸”æŠŠ $f=m$ æ”¹æˆ $f=k\times m$ ã€‚ä¾æ—§åšå°±å¥½äº†ã€‚</p><h2 id="UVA11082-Matrix-Decompressing"><a href="#UVA11082-Matrix-Decompressing" class="headerlink" title="[UVA11082] Matrix Decompressing"></a>[UVA11082] Matrix Decompressing</h2><blockquote><p>ç»™å‡ºä¸€ä¸ª R è¡ŒC åˆ—çš„æ­£æ•´æ•°çŸ©é˜µï¼Œè®¾å‰ $A_i$ é¡¹ä¸ºå…¶å‰ $i$ è¡Œæ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œ$B_i$ é¡¹ä¸ºå…¶å‰ i åˆ—æ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œå·²çŸ¥ R,C,A,Bï¼Œæ‰¾å‡ºä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„çŸ©é˜µã€‚å…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯1~20 çš„æ­£æ•´æ•°ã€‚</p></blockquote><p>sb é¢˜ã€‚è€ƒè™‘æºå‘æ¯ä¸€è¡Œè¿ $f=r_i$ çš„è¾¹ï¼Œæ¯ä¸€åˆ—å‘æ±‡è¿ $f=c_i$ çš„è¾¹ï¼Œè¡Œåˆ—å†å‘æ¯ä¸ªç‚¹è¿ $f=\infty$ çš„è¾¹ã€‚åŒæ—¶ç»™ä¸­é—´çš„æ¯æ¡è¾¹è®¾ç½®ä¸€ä¸ªä¸Šä¸‹ç•Œ $1$ ï¼Œæµå°±å®Œäº†ã€‚</p><p>ç„¶åå‘ç°å¹¶ä¸ç”¨å»ºå‡ºä¸­é—´çš„é‚£ä¸€æ’ç‚¹æ¥ã€‚å¹¶ä¸”ä¸‹ç•Œå¦‚æœä¸º $1$ â€¦å°±å¯ä»¥ç›´æ¥ä¸Šä¸‹ç•Œå„å‡ $1$ ç„¶åè·‘æ™®é€šçš„æµå³å¯ã€‚</p><h2 id="ACM-ICPC-NEERC2009-Inspection"><a href="#ACM-ICPC-NEERC2009-Inspection" class="headerlink" title="**[ACM/ICPC NEERC2009] Inspection"></a>**[ACM/ICPC NEERC2009] Inspection</h2><blockquote><p>æ±‚è§£æ— æƒ DAG çš„æœ€å°è·¯å¾„<strong>è¾¹</strong>è¦†ç›–ã€‚ç‰¹åˆ«çš„ï¼Œè·¯å¾„å¯ä»¥é‡å¤èµ°ã€‚</p></blockquote><p>å¾ˆç¥å¥‡ä¸€é“é¢˜ã€‚ç¥å¥‡åœ¨æˆ‘åœ¨ check è‡ªå·±çš„ Sol çš„æ—¶å€™å‘ç°äº†è¿™ä¹ˆä¸€å›äº‹ï¼š</p><blockquote><p>å¯¹äºå›¾ä¸­çš„æ¯ä¸ªç‚¹ $i$ï¼Œè®¾ $d_i$ ä¸º( $i$ çš„å…¥åº¦ - $i$ çš„å‡ºåº¦)çš„å€¼ï¼ŒæŒ‰ç…§ $d_i$å°†å›¾ä¸­çš„ç‚¹åˆ†ç±»ï¼š</p><p>$d_i\lt 0$ çš„ç§°ä¸ºâ€œå…¥å°‘å‡ºå¤šâ€çš„ç‚¹ï¼Œ$d_i\gt 0$ çš„ç§°ä¸ºâ€œå‡ºå°‘å…¥å¤šâ€çš„ç‚¹ï¼Œ$d_i=0$ çš„ç§°ä¸ºâ€œå…¥å‡ºç›¸ç­‰â€çš„ç‚¹ã€‚åˆ™æœ‰ï¼š</p><blockquote><p>å®šç†ï¼šæœ‰å‘æ— ç¯å›¾ä¸­æœ€å°è¾¹è·¯å¾„è¦†ç›–çš„å€¼ç­‰äºå›¾ä¸­æ‰€æœ‰â€œå…¥å°‘å‡ºå¤šâ€çš„ç‚¹çš„ $d_i$ ç»å¯¹å€¼ä¹‹å’Œã€‚ </p></blockquote></blockquote><p>è¿™è¿˜æ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„ï¼Œæ³¨æ„åˆ°è¿™ä¸ªå®šç†æ˜¯åœ¨é™ˆè¿°ã€Œè¾¹è¦†ç›–ã€å°±ä¸éš¾ç†è§£äº†ã€‚ ç„¶åå€Ÿæ­¤å…ˆè¯´ Sol 1:</p><h3 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h3><p>è€ƒè™‘æœ¬é¢˜å’Œä¸èƒ½é‡å¤èµ°çš„æœ€å°è·¯å¾„è¦†ç›–æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œé‚£å¿…ç„¶æ˜¯å­˜åœ¨ä¸€äº›è·¯å¾„å¯ä»¥é‡å¤ç»è¿‡ã€‚æˆ‘æ–­è¨€ï¼Œè¿™æ ·çš„è·¯å¾„å¿…ç„¶æ»¡è¶³èµ·ç‚¹ $d_i&gt;0$ï¼Œç»ˆç‚¹çš„ $d_i\lt0$ ï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦é‡å¤ç»è¿‡ã€‚è€ƒè™‘æŸæ¡è¿™æ ·çš„è·¯å¾„ $(s:t)$ æ¯è¢«é‡å¤ç»è¿‡ä¸€æ¬¡ï¼Œå°±å¿…ç„¶æ˜¯ä¸ºäº†å°† $t$ ä¹‹åçš„æŸæ¡è·¯ç»å’Œ $s$ ä¹‹å‰çš„æŸæ¡è·¯å¾„æ‹¼æ’èµ·æ¥ï¼Œè¿™æ ·åŸæ¥éœ€è¦ $2$ æ¬¡ç°åœ¨å°±åªéœ€è¦ $1$ æ¬¡ã€‚</p><p>äºæ˜¯è€ƒè™‘ç›´æ¥å¯¹ç€è¿™ä¸ªè·‘ä¸€æ¬¡æœ€å¤§æµå³å¯ï¼Œå„ä¸ªåœ°æ–¹çš„æµé‡éƒ½æ˜¯ $1$ ï¼Œæ‹¿å®šç†ä¸­çš„ç­”æ¡ˆå‡å»è¿™ä¸ªæœ€å¤§æµå°±å¥½äº†ã€‚</p><h3 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h3><p>â€¦å‘ç°è¿™é¢˜å°±æ˜¯ä¸€ä¸ªå¸¦ä¸‹ç•Œçš„æœ€å°æµã€‚äºæ˜¯å°±è·‘ä¸€ä¸ªå¸¦ä¸‹ç•Œçš„æœ€å°æµå³å¯ã€‚</p><h2 id="ACM-ICPC-NWERC-2007-March-of-the-Penguins"><a href="#ACM-ICPC-NWERC-2007-March-of-the-Penguins" class="headerlink" title="[ACM/ICPC NWERC 2007] March of the Penguins"></a>[ACM/ICPC NWERC 2007] March of the Penguins</h2><blockquote><p>æœ‰ä¸€ç¾¤ä¼é¹…ï¼Œä¸€äº›å†°ã€‚ä¼é¹…ä»¬åœ¨å¿«ä¹åœ°ç©è€ã€‚</p><p>ç»™å‡ºæ¯ä¸ªä¼é¹…çš„æœ€å¤§è·³è·ƒè·ç¦»(å¤§å®¶éƒ½ä¸€æ ·)ï¼Œå†ç»™å‡ºå†°çš„åæ ‡å’Œä¸Šé¢å­˜åœ¨çš„ä¼é¹…ä¸ªæ•°å’Œå…è®¸è·³è·ƒçš„æ¬¡æ•°ï¼Œé—®æœ‰å“ªäº›å†°æ˜¯å¯ä»¥å°†æ‰€æœ‰çš„ä¼é¹…æ±‡èšèµ·æ¥çš„ã€‚</p></blockquote><p>æ¯”è¾ƒç®€å•ä¸€é¢˜ã€‚ä¹‹å‰çš„æƒ³æ³•æ˜¯è¿™ä¹ˆå»ºå›¾(äº‹å®ä¸Šå°±æ˜¯è¿™ä¹ˆå»ºå›¾)ï¼šæºç‚¹å‘æ¯å—å†°è¿ $n_i$ çš„è¾¹ä»£è¡¨åŸæœ‰ä¼é¹…ï¼Œæ¯å—å†°æ‹†æˆä¿©ç‚¹é™åˆ¶è·³è·ƒæ¬¡æ•°ã€‚ç„¶åå†°ä¹‹é—´æ ¹æ®è·³è·ƒè·ç¦»è¿è¾¹å°±å¥½äº†ã€‚</p><p>ä½†æ˜¯è‡ªå·±çš„å¤„ç†æ–¹å¼ä¸æ˜¯å¾ˆåˆ°ä½ã€‚æˆ‘çš„æƒ³æ³•æ˜¯æšä¸¾æ¯ä¸ªç‚¹ä½œä¸ºæ±‡ç‚¹è·‘ä¸€éæœ€å¤§æµå†å» check æ˜¯å¦æ»¡æµï¼Œåæ¥å‘ç°å…¶å®å¹¶ä¸éœ€è¦ï¼Œåªéœ€è¦ä¸€ä¸ªè·‘ä¸€éæœ€å¤§æµå°±å¥½äº†ã€‚å› ä¸ºå¦‚æœå¯¹äºæŸä¸ª $i$ æ»¡æµï¼Œä»–è¦ä¹ˆå¯ä»¥å°†è¿™ä¸€ä»½æ»¡æµè¾“é€ç»™å…¶ä»–ç‚¹ï¼Œè¦ä¹ˆå°±æ˜¯è¢«å…¶ä»–ç‚¹æ•°è¾“é€è¿‡æ¥çš„ã€‚</p><h2 id="ACM-ICPC-Hangzhou-2005-Duopoly"><a href="#ACM-ICPC-Hangzhou-2005-Duopoly" class="headerlink" title="*[ACM/ICPC Hangzhou 2005] Duopoly"></a>*[ACM/ICPC Hangzhou 2005] Duopoly</h2><blockquote><p>Cå…¬å¸æœ‰ä¸€äº›èµ„æºï¼Œæ¯ç§åªæœ‰1ä¸ªï¼Œæœ‰Aã€Bä¸¤ä¸ªå…¬å¸åˆ†åˆ«å¯¹å…¶ä¸­ä¸€äº›èµ„æºè¿›è¡Œåˆ†ç»„ç«æ ‡ï¼Œæ¯ç»„ç«æ ‡å¯¹ä¸€äº›èµ„æºå‡ºä¸€ä¸ªæ€»ä»·ã€‚é—®Cå…¬å¸çš„æœ€å¤§æ”¶ç›Šã€‚</p></blockquote><p>è°”è°”ï¼Œæ„Ÿè§‰æœ‰è¢«é™æ™ºåˆ°ã€‚</p><p>ä¸€å¼€å§‹æƒ³äº†å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„å»ºå›¾æ–¹å¼ï¼Œéƒ½æ˜¯é”™çš„ã€‚åæ¥çœ‹äº†é¢˜è§£å‘ç°â€¦å…¶å®æœ¬è´¨ä¸Šæ ¹æœ¬ä¸å…³å¿ƒæ¯ç§èµ„æºåˆ°åº•æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼Œåªå…³å¿ƒæŸäº›èµ„æºçš„ç»„åˆèƒ½å¤Ÿå¸¦æ¥å¤šå°‘æ”¶ç›Šã€‚äºæ˜¯å»ºå›¾å°±ä¸éœ€è¦è€ƒè™‘æ¯ç§èµ„æºäº†ï¼Œç›´æ¥å¯¹ A å’Œ B çš„æ‰€æœ‰ç«æ ‡åˆ†ç«‹ä¸¤ä¾§ï¼Œæœ‰å†²çªçš„å°±è¿è¾¹ï¼Œè·‘ä¸€ä¸ªæœ€å°å‰²å°±å¥½äº†ã€‚</p><h2 id="ç»å…¸é¢˜-äºŒåˆ†å›¾å¸¦æƒæœ€å¤§ç‹¬ç«‹é›†"><a href="#ç»å…¸é¢˜-äºŒåˆ†å›¾å¸¦æƒæœ€å¤§ç‹¬ç«‹é›†" class="headerlink" title="[ç»å…¸é¢˜] äºŒåˆ†å›¾å¸¦æƒæœ€å¤§ç‹¬ç«‹é›†"></a>[ç»å…¸é¢˜] äºŒåˆ†å›¾å¸¦æƒæœ€å¤§ç‹¬ç«‹é›†</h2><blockquote><p>ç»™å®šä¸€å¼ äºŒåˆ†å›¾ï¼Œå›¾é‡Œé¢æ¯ä¸ªç‚¹ä¼šå¸¦ä¸€ä¸ªæƒã€‚æ±‚æƒæœ€å¤§ç‹¬ç«‹é›†ã€‚</p></blockquote><p>å°†æƒè°ƒæ•´åˆ° $\rm S\to â€¦$ å’Œ $\rm â€¦\to T$ ä¸Š ã€‚å°±å˜æˆç¿æ™ºæœ€å°å‰²äº†ã€‚æˆ‘ä¸ºä»€ä¹ˆè¦æ•´è¿™ä¸ªé¢˜ï¼ï¼Ÿ</p><h2 id="ç»å…¸é¢˜-æœ€ä¼˜è°ƒåº¦-å…¬å¹³åˆ†é…-LA3231-Fair-Share"><a href="#ç»å…¸é¢˜-æœ€ä¼˜è°ƒåº¦-å…¬å¹³åˆ†é…-LA3231-Fair-Share" class="headerlink" title="[ç»å…¸é¢˜]æœ€ä¼˜è°ƒåº¦(å…¬å¹³åˆ†é…) /LA3231 Fair Share"></a>[ç»å…¸é¢˜]æœ€ä¼˜è°ƒåº¦(å…¬å¹³åˆ†é…) /LA3231 Fair Share</h2><blockquote><p>mä¸ªä»»åŠ¡nä¸ªå¤„ç†å™¨ï¼Œä¸€ä¸ªä»»åŠ¡åªèƒ½åœ¨å¯ä¾›è¿è¡Œçš„ä¸¤ä¸ªæœºå™¨ä¸­çš„å…¶ä¸­ä¸€ä¸ªä¸Šè¿è¡Œï¼Œé—®æ€æ ·åˆ†é…ä½¿å¾—ä»»åŠ¡æœ€å¤šçš„æœºå™¨å°½é‡å°‘ã€‚</p></blockquote><p>é‚£å¿…ç„¶æ˜¯è¦äºŒåˆ†ç­”æ¡ˆã€‚ä¹‹åæµä¸€ä¸‹çœ‹çœ‹ä¸æºç‚¹ç›¸è¿çš„æ¯ä¸ªä»»åŠ¡é‚£æ¡è¾¹æ˜¯å¦æ»¡æµå°±å¥½äº†ã€‚</p><h2 id="UVA11248-Frequency-Hopping"><a href="#UVA11248-Frequency-Hopping" class="headerlink" title="*[UVA11248] Frequency Hopping"></a>*[UVA11248] Frequency Hopping</h2><blockquote><p>ç»™å®šä¸€ä¸ªæœ‰å‘ç½‘ç»œï¼Œæ¯æ¡è¾¹å‡æœ‰ä¸€ä¸ªå®¹é‡ã€‚é—®æ˜¯å¦å­˜åœ¨ä¸€ä¸ªä»ç‚¹1åˆ°ç‚¹Nï¼Œæµé‡ä¸ºCçš„æµï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ˜¯å¦å¯ä»¥æ°å¥½ä¿®æ”¹ä¸€æ¡å¼§çš„å®¹é‡ï¼Œä½¿å¾—å­˜åœ¨è¿™æ ·çš„æµã€‚</p></blockquote><p>æ¯”è¾ƒæœ‰æ„æ€çš„é¢˜ï¼Œè€ƒè™‘å¦‚æœè¦ä¿®æ”¹ï¼Œé‚£å¿…ç„¶æ˜¯è¦ä¿®æ”¹æœ€å°å‰²ä¸Šçš„è¾¹ã€‚ç„¶åå°±æŠŠæœ€å°å‰²æ±‚å‡ºæ¥ï¼Œå†æšä¸¾æ¯ä¸€æ¡è¾¹ã€‚ä½†æ˜¯æ³¨æ„åˆ°ä¸éœ€è¦æ¯æ¬¡é‡æ–°æ±‚ä¸€éæœ€å¤§æµï¼Œå¯ä»¥ç›´æ¥åœ¨åŸå›¾ä¸Šå¢å¹¿ã€‚è¿™ä¸ªæŠ€å·§éœ€è¦å¿ƒé¢†ç¥ä¼šã€‚</p><h2 id="ACM-ICPC-Taejon-2002-The-K-league"><a href="#ACM-ICPC-Taejon-2002-The-K-league" class="headerlink" title="*[ACM/ICPC Taejon 2002] The K-league"></a>*[ACM/ICPC Taejon 2002] The K-league</h2><p>Taejonï¼šå¤§ç”°ï¼Œä¼¼ä¹æ˜¯éŸ©å›½çš„æŸåŸå¸‚ï¼Œé•¿è§è¯†äº†ã€‚</p><blockquote><p>æœ‰nä¸ªé˜Ÿä¼è¿›è¡Œæ¯”èµ›ï¼Œæ¯åœºæ¯”èµ›ï¼Œæ°å¥½æœ‰ä¸€æ”¯é˜Ÿä¼å–èƒœã€ä¸€æ”¯é˜Ÿä¼è´¥ã€‚æ¯ä¸ªé˜Ÿä¼éœ€è¦æ‰“çš„æ¯”èµ›åœºæ•°ç›¸åŒã€‚</p><p>ç»™ä½ æ¯ä¸ªé˜Ÿä¼ç›®å‰å·²ç»èµ¢å¾—çš„åœºæ•° $done_i$ï¼Œå†ç»™ä½ ä¸€ä¸ªçŸ©é˜µï¼Œè¡¨ç¤ºé˜Ÿä¼ i å’Œé˜Ÿä¼ j è¿˜éœ€è¦æ‰“çš„æ¯”èµ›æ•°ï¼Œé—®ä½ å“ªäº›é˜Ÿä¼æœ‰å¯èƒ½è·å¾—å† å†›ï¼ˆèƒœåœºæœ€å¤šçš„å³ä¸ºå† å†›ï¼Œå¯ä»¥å¹¶åˆ—ï¼‰ã€‚</p></blockquote><p>è¿™é¢˜æ¯”è¾ƒç¥ã€‚é¦–å…ˆä¸€ä¸ªè§‚å¯Ÿå°±æ˜¯å¯ä»¥ç‹¬ç«‹æ±‚å‡ºæ¯ä¸ªé˜Ÿä¼æ˜¯å¦å¯ä»¥å¤ºå† ã€‚è€ƒè™‘é¦–å…ˆè¦é’¦å®šå½“å‰é˜Ÿä¼èµ¢å¾—æ‰€æœ‰æœªç«Ÿæ¯”èµ›ï¼Œè®¾è¿™ä¸ªæ•°é‡ä¸º $s$ã€‚ä¹‹åè€ƒè™‘å°±æ˜¯èƒ½å¦æœ‰ä¸€ç§å®‰æ’ç­–ç•¥ä½¿å¾—å…¶å®ƒçš„é˜Ÿä¼è·èƒœåœºæ•°å‡ $\leq s$ã€‚</p><p>å‘ç°è¿™å°±æ˜¯ä¸€ä¸ªä¸Šé¢æåˆ°è¿‡çš„å…¬å¹³åˆ†é…æ¨¡å‹ã€‚è€ƒè™‘å°†æ¯ä¸€åœºæ¯”èµ›åˆ†é…ç»™æ¯æ”¯é˜Ÿä¼ã€‚æŠŠä¸€æ”¯é˜Ÿä¼çš„æœ€å¤šè·èƒœåœºæ¬¡è®¾ä¸º $s-done_u$ ï¼Œç„¶åæ£€æŸ¥ä¸€ä¸‹æ¯ä¸ªæ¯”èµ›çš„é‚£æ¡è¾¹æ˜¯å¦æ»¡æµå°±å¥½äº†ã€‚</p><h2 id="UVA10779-Collectorâ€™s-Problem"><a href="#UVA10779-Collectorâ€™s-Problem" class="headerlink" title="**[UVA10779] Collectorâ€™s Problem"></a>**[UVA10779] Collectorâ€™s Problem</h2><blockquote><p>ç°åœ¨æœ‰åŒ…æ‹¬äº†Bobåœ¨å†…çš„ n ä¸ªå°æœ‹å‹ï¼Œm ç§æ¸¸æˆå¡ç‰‡ï¼ŒBobå¯ä»¥å’Œå…¶ä»–äººäº¤æ¢å¡ç‰‡ï¼Œé™¤äº†Bobï¼Œæ¯ä¸ªäººçš„äº¤æ¢åŸåˆ™éƒ½æ˜¯åªç»™å‡ºè‡ªå·±çš„æ‹¥æœ‰å¤šå¼ å¡ç‰‡ï¼Œæ¥å—è‡ªå·±æ²¡æœ‰çš„å¡ç‰‡ã€‚çš„é—®ä»–æœ€åæœ‰å¤šå°‘ä¸åŒçš„å¡ç‰‡ã€‚ </p><p>$n\leq 10, m\leq 25$ ã€‚</p></blockquote><p>è€ƒè™‘å¦‚æœ $m$ ç¨å¾®å°ä¸€ç‚¹ï¼Œæ¯”å¦‚ $10$ ä¹‹ç±»çš„å°±å¯ä»¥ç›´æ¥çŠ¶å‹äº†ã€‚$f_{s_1,s_2}$ è¡¨ç¤ºç°åœ¨è€ƒè™‘äº† Bob çš„æœ‹å‹é›†åˆä¸º $s_1$ ï¼Œæ‹¥æœ‰çš„å¡ç‰Œé›†åˆä¸º $s_2$ æ˜¯å¦å¯è¡Œã€‚è¿™æ ·æ¯æ¬¡è½¬ç§»å°±å¯ä»¥åˆ·ä¸ªè¡¨ã€‚å¤æ‚åº¦ $O(2^n\cdot n\cdot m\cdot 2^m)$ ã€‚</p><p><del>m=10å¥½åƒä¹Ÿä¸æ˜¯å¾ˆèƒ½è¿‡</del> ã€‚</p><p>äºæ˜¯è€ƒè™‘æ­£ç»å»ºå›¾ï¼Œè¿˜æ˜¯æ¯”è¾ƒä»™çš„ã€‚è€ƒè™‘æ€ä¹ˆæ­£ç¡®å¯¹å¾…ã€Œåªç»™å‡ºè‡ªå·±çš„æ‹¥æœ‰å¤šå¼ å¡ç‰‡ï¼Œæ¥å—è‡ªå·±æ²¡æœ‰çš„å¡ç‰‡ã€è¿™ä¸ªé™åˆ¶ï¼Œå‘ç°è¿™ä¸ªé™åˆ¶ååˆ†çš„å¼ºï¼Œé™åˆ¶äº†æ¯ä¸ªå°æœ‹å‹å·²ç»æœ‰çš„å¡ç‰‡æ•°ç›®åœ¨è¿‡ç¨‹ä¸­ä¹Ÿä¸èƒ½ $\lt1$ ã€‚äºæ˜¯å¯¹äºæ¯ä¸ªå°æœ‹å‹å…³å¿ƒçš„å°±åªåœ¨äºå…¶ $&gt;2$ çš„æ•°é‡çš„å¡ç‰Œã€‚</p><p>è€ƒè™‘æ€ä¹ˆå»ºå›¾ï¼ˆå¥½ç¥å•Šï¼‰ã€‚ å¤§æ¦‚å°±æ˜¯è¯´å°ä¼™ä¼´åªæ˜¯ç”¨æ¥æ¢çš„å·¥å…·äººï¼Œå¹¶ä¸å…³å¿ƒä»–ä»¬æ€ä¹ˆåˆ†é…ï¼Œåªå…³å¿ƒæœ€åæ¯å¼ ç‰Œæ˜¯å¦å¯ä»¥æ‹¿åˆ°ã€‚äºæ˜¯å°±å¯ä»¥è€ƒè™‘ä»æºç‚¹å‘æ¯ä¸€å¼ ç‰Œè¿ä¸€å¼  $f=a_i$ ï¼Œå…¶ä¸­ $a_i$ æ˜¯ Bob åŸæœ‰çš„å¡çš„å¼§ï¼Œæ¯å¼ ç‰Œå‘ $T$ è¿ $f=1$ çš„å¼§ã€‚è€ƒè™‘æ€ä¹ˆäºå°ä¼™ä¼´ä»¬äº¤äº’ï¼Œå¦‚æœå°ä¼™ä¼´ $j$ æ²¡æœ‰æŸå¼ ç‰Œ $i$ ï¼Œå°±è¿ $i\to j$ æµé‡ä¸º $1$ ï¼›å¦‚æœå¦‚æœå°ä¼™ä¼´ $j$ çš„æŸå¼ ç‰Œæ•°é‡ $b_{j,i}&gt;1$ ï¼Œå°±å‘ $i$ è¿ $f=b_{j,i}-1$ çš„è¾¹ã€‚æµä¸€ä¸‹å°±å¥½äº†ã€‚</p><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h1 id="è´¹ç”¨æµ"><a href="#è´¹ç”¨æµ" class="headerlink" title="è´¹ç”¨æµ"></a>è´¹ç”¨æµ</h1><h2 id="ACM-ICPC-Taiwan-2005-Optimal-Bus-Route-Design"><a href="#ACM-ICPC-Taiwan-2005-Optimal-Bus-Route-Design" class="headerlink" title="*[ACM/ICPC Taiwan 2005] Optimal Bus Route Design"></a>*[ACM/ICPC Taiwan 2005] Optimal Bus Route Design</h2><blockquote><p> ç»™å‡ºä¸€ä¸ªæœ‰å‘å›¾ï¼Œä½ éœ€è¦è®©æ¯ä¸€ä¸ªç‚¹éƒ½æ°å¥½åœ¨ä¸€ä¸ªç¯ä¸­ï¼Œå¹¶ä¸”è¾¹æƒå’Œæœ€å°ã€‚</p></blockquote><p>â€¦å–œé—»ä¹è§çš„æ‰¾æ€§è´¨é¢˜ã€‚</p><p>é¦–å…ˆè½¬åŒ–ä¸€ä¸‹ï¼Œã€Œæ¯ä¸ªç‚¹æ°å¥½åœ¨ä¸€ä¸ªç¯ä¸­ã€=ã€Œæ¯ä¸ªç‚¹åç»§çš„å”¯ä¸€ã€ã€‚å› ä¸ºæ¯ä¸ªç‚¹éƒ½æ˜¾ç„¶ä¼šæœ‰ä¸€æ¡å‡ºè¾¹ä¸€æ¡å…¥è¾¹ï¼Œæ‰€ä»¥ç›´æ¥æ‹†ç‚¹è·‘ä¸€ä¸ª KM æˆ–è€…è´¹ç”¨æµå°±ä¸€å®šæ˜¯åˆæ³•è§£ã€‚</p><p>â€¦â€¦ä¸€å¼€å§‹çš„æ—¶å€™æ„Ÿè§‰æ˜¯ä¸ªè£¸åŒ¹é…ï¼Œç„¶åå›å¿†èµ·æ›¾ç»åšè¿‡çš„æ— å‘å›¾æ‰¾éç®€å•ç¯çš„è®¡æ•°é¢˜ä¼¼ä¹ç­”æ¡ˆæ˜¯ä¸ªè´¼å¤§çš„æ•°ï¼Œå°±ååˆ†æ‡µé€¼ã€‚</p><h2 id="LA4043-Ants"><a href="#LA4043-Ants" class="headerlink" title="**[LA4043]  Ants"></a>**[LA4043]  Ants</h2><blockquote><p>ç»™å®šä¸€äº›é»‘ç‚¹ç™½ç‚¹ï¼Œè¦æ±‚ä¸€ä¸ªé»‘ç‚¹è¿æ¥ä¸€ä¸ªç™½ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰çº¿æ®µéƒ½ä¸ç›¸äº¤ã€‚</p><p>$n\leq 500$ ã€‚</p></blockquote><p>æ„Ÿè§‰è¿™é¢˜çš„ä¿©åšæ³•éƒ½å¾ˆç»å…¸æœ‰è¶£å•Šã€‚</p><h3 id="Sol-1-1"><a href="#Sol-1-1" class="headerlink" title="Sol 1"></a>Sol 1</h3><p>å¤§æ¦‚æ˜¯éœ€è¦æ·±åˆ»åœ°å‘ç°ä¸€äº›æ€§è´¨ã€‚è€ƒè™‘å¦‚æœå››ä¸ªç‚¹è¿ä¸¤æ¡çº¿æ®µæƒ³è¦ä¸äº¤çš„è¯ï¼Œé‚£ä¹ˆæ„Ÿæ€§ç†è§£ä¸€ä¸‹è¦ä¹ˆå¹¶æ’ç€ç«–ç€è¿ï¼Œè¦ä¹ˆå¹¶æ’ç€æ¨ªç€è¿ï¼Œéšä¾¿æ—‹è½¬ä¸€ä¸‹åæ ‡ç³»å¯ä»¥çŸ¥é“ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚é‚£ä¹ˆè€ƒè™‘å¦‚ä½•æ¨ªç€é€‰ï¼Œå‘ç°å¦‚æœå¯¹äºç¬¬ä¸€åˆ—çš„ç‚¹å¦‚æœå„è‡ªæ‰¾ä¸è‡ªå·±è·ç¦»æœ€å°çš„ç‚¹ï¼Œå°±ä¸€å®šä¸ä¼šç›¸äº¤ã€‚è¿›ä¸€æ­¥è€ƒè™‘å…¨å±€ï¼Œå¦‚æœæœ€åç‚¹å¯¹ä¹‹é—´çš„æ€»è·ç¦»ä¹‹å’Œæœ€å°é‚£ä¹ˆåŒæ ·ä¸ä¼šäº¤ã€‚æ‰€ä»¥åšä¸€é KM å°±å¥½äº†ã€‚</p><h3 id="Sol-2-1"><a href="#Sol-2-1" class="headerlink" title="Sol 2"></a>Sol 2</h3><p>è€ƒè™‘æš´åŠ›åˆ†æ²»ã€‚æ„Ÿè§‰è¿™ä¸ªåšæ³•æ²¡ç‚¹ç»éªŒæ˜¯æƒ³ä¸å‡ºæ¥çš„ã€‚è€ƒè™‘ä¸Šé¢ KM ç®—æ³•æ‰€æ‰¾çš„æœ€è¿‘ç‚¹å¯¹å®Œå…¨å¯ä»¥åˆ†æ²»åšã€‚å…·ä½“çš„ï¼Œå…ˆéšæœºé€‰ä¸€ä¸ªç‚¹ï¼Œç„¶åè®©å…¶ä»–çš„ç‚¹æŒ‰ç…§ä»¥å½“å‰ç‚¹ä¸ºåæ ‡åŸç‚¹çš„æè§’æ’åºï¼Œè§‚å¯Ÿæœ€å°çš„é‚£ä¸ªï¼š</p><p>1ã€å¦‚æœé¢œè‰²ä¸åŒï¼Œé‚£ä¹ˆå°±ç›´æ¥åŒ¹é…ã€‚</p><p>2ã€å¦‚æœé¢œè‰²ç›¸åŒï¼Œå°±ç»§ç»­æ‰¾æ›´å¤§çš„ï¼Œç›´åˆ°æ‰¾è¿‡çš„æ‰€æœ‰ç‚¹ä¸­ä¸¤ç§é¢œè‰²æ•°é‡ç›¸ç­‰ä¸”å½“å‰ç‚¹ä¸æºç‚¹é¢œè‰²ä¸åŒã€‚æ­¤æ—¶å¤´å°¾åŒ¹é…ä¸€ä¸‹ï¼Œå°±å¯ä»¥åˆ†æ²»æˆä¸¤éƒ¨åˆ†ç»§ç»­åšäº†ã€‚</p><h2 id="ACM-ICPC-Harbin-2010-è´§ç‰©è¿è¾“"><a href="#ACM-ICPC-Harbin-2010-è´§ç‰©è¿è¾“" class="headerlink" title="[ACM/ICPC Harbin 2010] è´§ç‰©è¿è¾“"></a>[ACM/ICPC Harbin 2010] è´§ç‰©è¿è¾“</h2><blockquote><p>è´¹ç”¨ä¸º $af^2$ çš„è´¹ç”¨æµã€‚</p></blockquote><p>ä¸»è¦å°±æ˜¯ç”¨äº†è¿™ä¸ªæŠ€å·§ã€‚è€ƒè™‘å¸¸è§çš„æ‹†å¹³æ–¹æŠ€å·§</p><script type="math/tex; mode=display">f^2=1+3+5+7+\cdots</script><p>ç„¶åå°±å¯ä»¥æ ¹æ®å€¼åŸŸæ‹†æˆå¤šä¸ªå¼§æ¥åšäº†ã€‚</p><h2 id="ACM-ICPC-Dhaka-2006-Paint-the-Roads"><a href="#ACM-ICPC-Dhaka-2006-Paint-the-Roads" class="headerlink" title="[ACM/ICPC Dhaka 2006] Paint the Roads"></a>[ACM/ICPC Dhaka 2006] Paint the Roads</h2><blockquote><p>ä¸€ä¸ª $n$ ä¸ªç‚¹ $m$ æ¡å¸¦æƒæœ‰å‘è¾¹çš„å›¾ï¼Œè¦ç»™è¾¹æŸ“è‰²ï¼ŒæŸ“è‰²çš„è¾¹å½¢æˆè‹¥å¹²ä¸ªå›è·¯ä¸”æ¯ä¸ªç‚¹éƒ½æ°å¥½å±äºå…¶ä¸­ $k$ ä¸ªå›è·¯ã€‚é—®æœ€å°‘è¦æŸ“å¤šå°‘è¾¹æƒå’Œçš„è·¯ã€‚</p></blockquote><p>è€ƒè™‘æœ‰äº†å‰é¢çš„é“ºå«ï¼Œå±äº $k$ ä¸ªå›è·¯å¯ä»¥ç›´æ¥æ‹†æˆ $k$ ç»„åŒ¹é…ã€‚åšå°±å¥½äº†ã€‚</p><h2 id="ACM-ICPC-World-Final-2011-Chips-Challenge"><a href="#ACM-ICPC-World-Final-2011-Chips-Challenge" class="headerlink" title="*[ACM/ICPC World Final 2011] Chips Challenge"></a>*[ACM/ICPC World Final 2011] Chips Challenge</h2><blockquote><p>æœ‰ä¸€ä¸ªèŠ¯ç‰‡ï¼ŒèŠ¯ç‰‡ä¸Šæœ‰ $N*N(1â‰¤Nâ‰¤40)$ ä¸ªæ’æ§½ï¼Œå¯ä»¥åœ¨é‡Œé¢è£…é›¶ä»¶ã€‚<br>æœ‰äº›æ’æ§½ä¸èƒ½è£…é›¶ä»¶ï¼Œæœ‰äº›æ’æ§½å¿…é¡»è£…é›¶ä»¶ï¼Œå‰©ä¸‹çš„æ’æ§½éšæ„ã€‚<br>è¦æ±‚è£…å¥½ä¹‹åæ»¡è¶³å¦‚ä¸‹ä¸¤æ¡è¦æ±‚ï¼š</p><p>1ã€ç¬¬ i è¡Œå’Œç¬¬ i åˆ—çš„é›¶ä»¶æ•°ç›®å¿…é¡»ä¸€æ ·å¤šï¼ˆ$1â‰¤iâ‰¤N$ï¼‰ã€‚</p><p>2ã€ç¬¬ i è¡Œçš„é›¶ä»¶æ•°ç›®ä¸èƒ½è¶…è¿‡æ€»çš„é›¶ä»¶æ•°ç›®çš„ $A/B$ï¼ˆ$1â‰¤iâ‰¤N$ï¼Œ$0â‰¤Aâ‰¤Bâ‰¤1000$ï¼Œ$Bâ‰ 0$ï¼‰ã€‚</p><p>æ±‚æœ€å¤šå¯ä»¥å¦å¤–æ”¾å¤šå°‘ä¸ªé›¶ä»¶ï¼ˆå°±æ˜¯é™¤æ‰å¿…é¡»æ”¾çš„ï¼‰ã€‚å¦‚æœæ— è§£è¾“å‡ºimpossibleã€‚</p></blockquote><p>å­¦åˆ°äº†ï¼Œå¤§æ¦‚æ˜¯å‘ç°æœ‰äº›çº¦æŸäº’ç›¸å½±å“ï¼Œæˆ–è€…æ˜¯ä¸ªå˜é‡ä¸å¥½å¤„ç†çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘æšä¸¾è¿™ä¸ªçº¦æŸã€‚</p><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘æšä¸¾é›¶ä»¶æ€»æ•° $s$ ï¼Œç„¶åå»checkè¿™ä¸ªç»“æœæ˜¯å¦åˆç†ã€‚è€ƒè™‘æ€ä¹ˆ checkï¼Œä¸éš¾çŸ¥é“è¦è¡Œåˆ—äºŒåˆ†å›¾é‚£ç§æ„Ÿè§‰ï¼Œä¸­é—´é’¦å®šä¸º $1$ çš„å°±è¿ä¸Šä¸‹ç•Œå‡ä¸º $1$ çš„è¾¹ï¼Œé’¦å®šä¸º $0$ çš„å°±ä¸è¿è¾¹ï¼Œæ²¡é’¦å®šçš„å°±è¿ä¸Šç•Œä¸º $1$ çš„è¾¹ã€‚ç„¶åæ±‚å‡ºæ­¤æ—¶å¯ä»¥æ”¾çš„éƒ¨ä»¶æ•°ã€‚å¦‚æœå¤§äºæšä¸¾çš„ $ans$ å°±è¯´æ˜åˆæ³•ã€‚</p><p>äºæ˜¯æœ€åå¤§æ¦‚è¦è·‘ä¸€ä¸ªæœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å¤§è´¹ç”¨æœ€å¤§æµï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åšäº†ç‚¹ç½‘ç»œæµé¢˜ç›®ï¼Œç®—æ˜¯å¯¹ç½‘ç»œæµçš„ä¸€ä¸ªå¤ä¹ å§ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰ç°åœ¨å»ºèµ·å›¾æ¥å·²ç»å¯ä»¥ç®—æ˜¯å¾—å¿ƒåº”æ‰‹äº†.jpg&lt;/p&gt;
&lt;p&gt;æ‰“æ˜Ÿçš„é¢˜ç›®éƒ½æ¯”è¾ƒæœ‰è¶£ã€‚å¤§éƒ¨åˆ†é¢˜ç›®å¯èƒ½æ²¡æœ‰æ•°æ®èŒƒå›´ï¼Œå½“ä½œ O(ç½‘ç»œæµèƒ½è¿‡) å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;del&gt;è™½ç„¶ç°åœ¨éƒ½è€ƒæ¨¡æ‹Ÿè´¹ç”¨æµï¼Œå»ºå›¾è´¹ç”¨æµå·²ç»æ˜¯å†å²çš„çœ¼æ³ªäº†ã€‚&lt;/del&gt; &lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/çŠ¶å‹DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æŠ€å·§/åˆ†æ²»" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="å›¾è®º/äºŒåˆ†å›¾" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="ç½‘ç»œæµ/æœ€å¤§æµ" scheme="https://www.orchidany.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81-%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
      <category term="ç½‘ç»œæµ/è´¹ç”¨æµ" scheme="https://www.orchidany.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81-%E8%B4%B9%E7%94%A8%E6%B5%81/"/>
    
      <category term="å›¾è®º/åŒ¹é…" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D/"/>
    
      <category term="å›¾è®º/æ™®é€šå»ºå›¾æŠ€å·§" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E6%99%AE%E9%80%9A%E5%BB%BA%E5%9B%BE%E6%8A%80%E5%B7%A7/"/>
    
      <category term="å›¾è®º/çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%BC%98%E5%8C%96%E5%BB%BA%E5%9B%BE/"/>
    
      <category term="ç½‘ç»œæµ/å¸¦æœ‰ä¸Šä¸‹ç•Œçš„ç½‘ç»œæµ" scheme="https://www.orchidany.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81-%E5%B8%A6%E6%9C%89%E4%B8%8A%E4%B8%8B%E7%95%8C%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="å›¾è®º/åŒ¹é…/KMç®—æ³•" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D-KM%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ã€é¢˜è§£ã€‘ç®€å•æ•°å­¦é¢˜æ”¾é€</title>
    <link href="https://www.orchidany.cn/2020/05/27/%E7%AE%80%E5%8D%95%E6%95%B0%E5%AD%A6%E9%A2%98%E6%94%BE%E9%80%81/"/>
    <id>https://www.orchidany.cn/2020/05/27/ç®€å•æ•°å­¦é¢˜æ”¾é€/</id>
    <published>2020-05-27T11:59:53.000Z</published>
    <updated>2020-05-28T00:31:08.884Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å››å¤„æ‰¾æ¥çš„ç®€å•æ•°å­¦é¢˜ï¼ŒæŒ‘äº†ä¸€äº›é¢˜ç›®æ•´ç†ä¸€ä¸‹ã€‚</p><a id="more"></a><h1 id="ACM-ICPC-CERC-2013-Magical-GCD"><a href="#ACM-ICPC-CERC-2013-Magical-GCD" class="headerlink" title="[ACM/ICPC CERC 2013] Magical GCD"></a>[ACM/ICPC CERC 2013] Magical GCD</h1><blockquote><p>ç»™ä¸€ä¸ªé•¿åº¦ä¸º $n(nâ‰¤100000)$ çš„æ•°åˆ—(æ¯ä¸ªæ•° $a[i]â‰¤10^{12}$ )ï¼Œæ‰¾åˆ°ä¸€ä¸ªè¿ç»­å­åºåˆ—ä½¿å¾—å­åºåˆ—çš„å…¬çº¦æ•°ä¸é•¿åº¦çš„ä¹˜ç§¯æœ€å¤§ï¼Œæ±‚è¿™ä¸ªæœ€å¤§å€¼ã€‚å…± T ç»„æ•°æ®ã€‚</p></blockquote><p>å¤§æ¦‚æ˜¯åˆ©ç”¨äº† $\gcd$ çš„ä¸€å®šæ€§è´¨ã€‚è€ƒè™‘å¯¹äºä¸€ä¸ªç¡®å®šçš„å³ç«¯ç‚¹ $r$ ï¼Œåˆ›å»ºä¸€å¼ ä¿å­˜ $\gcd(l,r)$ æœ¬è´¨ä¸åŒçš„ $l$ è¡¨ï¼Œä¸éš¾å‘ç°è¿™å¼ è¡¨çš„é•¿åº¦æ˜¯ $O(\log n)$ çš„ã€‚è¿™æ ·å°±å¯ä»¥ç”¨é“¾è¡¨ç»´æŠ¤ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œæ¯æ¬¡å³ç«¯ $+1$ æ—¶æš´åŠ›åˆå¹¶è¡¨ä¸­é—´ç›¸åŒçš„å…ƒç´ ã€‚æœ€ç»ˆå¤æ‚åº¦ $O(n\log n)$ ã€‚</p><h1 id="é™¤æ³•è¡¨è¾¾å¼"><a href="#é™¤æ³•è¡¨è¾¾å¼" class="headerlink" title="é™¤æ³•è¡¨è¾¾å¼"></a>é™¤æ³•è¡¨è¾¾å¼</h1><blockquote><p>ç»™å‡ºä¸€ä¸ªé™¤æ³•è¡¨è¾¾å¼ $X_1/X_2/X_3\cdots/X_n$ ã€‚æ±‚èƒ½å¦é€šè¿‡åŠ æ‹¬å·çš„æ–¹å¼è®©å¼å­çš„å€¼ä¸ºæ•´æ•°</p></blockquote><p>è€ƒè™‘è´ªå¿ƒçš„æ”¾æ‹¬å·ï¼Œä¸€å®šæ˜¯è¿™ä¹ˆæ”¾çš„ï¼š$X_1/(X_2/X_3\cdots/X_n)$ ã€‚å› ä¸ºè¿™æ ·ä¼šä½¿åˆ†æ¯ä¸Šçš„æ•°æœ€å¤šï¼Œä¸º $X_1\cdot \prod X_{j{[j=2\to n]}}$ ã€‚äºæ˜¯å°±åˆ†è§£ä¸€ä¸‹è´¨å› æ•°å°±å¥½äº†ã€‚</p><h1 id="UVA11582-Colossal-Fibonacci-Numers-åŠ å¼ºç‰ˆ"><a href="#UVA11582-Colossal-Fibonacci-Numers-åŠ å¼ºç‰ˆ" class="headerlink" title="[UVA11582] Colossal Fibonacci Numers! åŠ å¼ºç‰ˆ"></a>[UVA11582] Colossal Fibonacci Numers! åŠ å¼ºç‰ˆ</h1><blockquote><p>æ±‚ä¸€ä¸ªå¹¿ä¹‰çš„æ–æ³¢é‚£å¥‘é€’æ¨ï¼šåœ¨ $f(0)=c,f(1)=d$ æ—¶ï¼š</p><script type="math/tex; mode=display">f(n)=a f(n-1)+b f(n-2)</script><p>çš„ç¬¬ $f(x^y)$ é¡¹åœ¨æ¨¡ $n$ ä¸‹çš„å€¼ã€‚$1\leq n\leq 5000$ ã€‚</p></blockquote><p>è€ƒè™‘ç”±äºæ˜¯ $2$ é˜¶çº¿æ€§é€’æ¨ï¼Œé‚£ä¹ˆæ˜¾ç„¶åœ¨æ¨¡ $n$ æ„ä¹‰ä¸‹å¾ªç¯èŠ‚é•¿åº¦æœ‰ä¸€ä¸ªä¸Šç•Œ $O(n^2)$ ã€‚äºæ˜¯å°±å¯ä»¥æš´åŠ›æ±‚å‡ºå¾ªç¯èŠ‚é•¿åº¦ $o$ï¼Œè®¡ç®— $a^b$ çš„æ—¶å€™æ¨¡ $o$ å³å¯ã€‚</p><h1 id="UVA10791-Minimum-Sum-LCM"><a href="#UVA10791-Minimum-Sum-LCM" class="headerlink" title="[UVA10791] Minimum Sum LCM"></a>[UVA10791] Minimum Sum LCM</h1><blockquote><p>ç»™å®šä¸€ä¸ª $n$ ï¼Œæ±‚è‡³å°‘ä¸¤ä¸ªæ­£æ•´æ•°ä½¿å¾—ä»–ä»¬æœ€å°å…¬å€æ•°ä¸º $n$ ä¸”å…¶å’Œæœ€å°ã€‚$n\in \rm int$ ã€‚</p></blockquote><p>è€ƒè™‘ä¸ºäº†ä½¿å’Œæœ€å°ï¼Œæœ‰å¤šä½™å› å­æ˜¯ä¸å¤Ÿä¼˜çš„ã€‚æ‰€ä»¥ç­”æ¡ˆå°±æ˜¯ $\sum p_k^{a_k}$ ã€‚æ³¨æ„å½“ $n$ æ˜¯ç´ æ•°å¹‚æˆ–è€… $1$ æ—¶éœ€è¦åˆ¤ä¸€ç‚¹ç»†èŠ‚ã€‚</p><h1 id="ACM-ICPC-Dhaka-2013-GCD-XOR"><a href="#ACM-ICPC-Dhaka-2013-GCD-XOR" class="headerlink" title="[ACM/ICPC Dhaka 2013] GCD XOR"></a>[ACM/ICPC Dhaka 2013] GCD XOR</h1><blockquote><p>ç»™å®š $n$ ï¼Œæ±‚æœ‰å¤šå°‘å¯¹æ­£æ•´æ•° $(a,b)$ æ»¡è¶³ $1\leq b\leq a\leq n$ ï¼Œä¸” $\gcd(a,b)=a\operatorname{xor} b$ ã€‚</p><p>$1\leq n\leq 10^6$ .</p></blockquote><p>è€ƒè™‘æš´åŠ›æšä¸¾ $a$ çš„çº¦æ•° $c$ å†å» check çš„å¤æ‚åº¦æ˜¯ $\log^2n$ çš„ï¼Œéœ€è¦ä¼˜åŒ–ã€‚å‘ç°å¦‚æœ $\gcd(a,b)=a\operatorname{xor} b$ ï¼Œé‚£ä¹ˆ $a-b=a\operatorname{xor} b$ ã€‚åŸå› æ˜¯è€ƒè™‘ $\gcd(a,b)=\gcd(b,a-b)\leq a-b\leq a\operatorname{xor} b$ ã€‚æ‰€ä»¥è¿™å°±å¯ä»¥çœæ‰ä¸€ä¸ªæ±‚ $\gcd$ çš„ $\log$ ï¼Œç›´æ¥æšä¸¾ $a$ çš„çº¦æ•° $c$ ï¼Œå†å» check æ˜¯å¦æœ‰ $c=a\operatorname{xor}(a-c)$ å³å¯ã€‚</p><h1 id="ACM-ICPC-NEERC-2004-Irrelevant-Elements"><a href="#ACM-ICPC-NEERC-2004-Irrelevant-Elements" class="headerlink" title="[ACM/ICPC NEERC 2004] Irrelevant Elements"></a>[ACM/ICPC NEERC 2004] Irrelevant Elements</h1><blockquote><p>ç»™å®šä¸€ä¸ªé•¿ä¸º $n$ çš„æ•°åˆ—ï¼Œæ¯æ¬¡ç›¸é‚»ä¸¤é¡¹ç›¸åŠ å¾—åˆ°ä¸€ä¸ªé•¿åº¦å‡å° $1$ çš„æ–°æ•°åˆ—ï¼Œæ±‚æœ€åé•¿åº¦ä¸º $1$ æ—¶çš„æ•°æ¨¡ $m$ çš„ä½™æ•°å’Œå“ªå‡ é¡¹æ— å…³ã€‚</p><p>$1\leq n\leq 10^6$ ã€‚</p></blockquote><p>è€ƒè™‘æœ€åæ¯ä¸€é¡¹çš„è´¡çŒ®ç³»æ•°ä¸€å®šæ˜¯æ¨è¾‰ä¸‰è§’çš„å½¢å¼ã€‚è¿™æ ·åªéœ€è¦æ±‚æ¯ä¸€ä¸ªç³»æ•°æ˜¯å¦æ˜¯ $m$ çš„å€æ•°ã€‚æ³¨æ„åˆ°æš´åŠ›æ±‚ç»„åˆæ•°ç²¾åº¦ä¼šçˆ†ç‚¸ï¼Œäºæ˜¯è€ƒè™‘åˆ†è§£ï¼Œä½†æ˜¯åˆ†è§£äº†ä¹‹åå¤æ‚åº¦ä¼šçˆ†ç‚¸ã€‚è€ƒè™‘æœ‰</p><script type="math/tex; mode=display">\binom{n}{k}=\frac{n-k+1}{k}\cdot \binom{n}{k-1}</script><p>é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åˆ†è§£è´¨å› æ•°çš„æ–¹å¼æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ $m$ çš„å€æ•°ã€‚æœ€åå¤æ‚åº¦ $O(n\log n)$ã€‚</p><h1 id="ACM-ICPC-NEERC-2009-Headshot"><a href="#ACM-ICPC-NEERC-2009-Headshot" class="headerlink" title="[ACM/ICPC NEERC 2009] Headshot"></a>[ACM/ICPC NEERC 2009] Headshot</h1><blockquote><p>æªé‡Œæœ‰ $n$ ä¸ªå¼¹å¤¹ $m$ é¢—å­å¼¹ã€‚ä½ æ‰£äº†ä¸€æ¬¡æ‰³æœºä¹‹åæ²¡æœ‰å­å¼¹ã€‚ä½ å¸Œæœ›ä¸‹ä¸€æªä¹Ÿæ²¡å­å¼¹ã€‚ä½ æ˜¯åº”è¯¥ç«‹å³å†æ‰£ä¸€æªè¿˜æ˜¯éšæœºè½¬ä¸€ä¸‹å†æ‰£ï¼Ÿ</p></blockquote><p>å› ä¸ºå·²ç»æ‰£äº†ä¸€æªï¼Œæ‰€ä»¥è€ƒè™‘æ¡ä»¶æ¦‚ç‡å…¬å¼ $P(A) = P(B)\times P(A\mid B)$ ï¼Œå³å¯ä»¥çŸ¥é“è¿ç»­ä¸¤æªæ²¡æœ‰å­å¼¹çš„æ¦‚ç‡æ˜¯ $\dfrac{\mathrm{cnt}(00)}{\mathrm{cnt}(0)}$ ã€‚éšæœºè½¬ä¸€ä¸‹çš„æ¦‚ç‡æ˜¯ $\dfrac{\mathrm{cnt}(0)}{\mathrm{cnt}(0)+\mathrm{cnt}(1)}$ ã€‚æ¯”è¾ƒä¸€ä¸‹å³å¯ã€‚</p><h1 id="UVA10491-Cows-and-Cars"><a href="#UVA10491-Cows-and-Cars" class="headerlink" title="[UVA10491] Cows and Cars"></a>[UVA10491] Cows and Cars</h1><blockquote><p>è‘—åä¸»æŒäººå’Œç¾Šå’Œè½¦é—®é¢˜ã€‚å…±æœ‰ $m$ ä¸ªç¾Šå’Œ $n$ ä¸ªè½¦ã€‚ä¸»æŒäººä¼šæ‰“å¼€ $k$ æ‰‡é—¨ã€‚è¾“å‡ºåœ¨ã€Œæ€»æ˜¯æ¢é—¨ã€ç­–ç•¥çš„åŸºç¡€ä¸Šèµ¢å¾—è½¦çš„æ¦‚ç‡ã€‚</p></blockquote><p>è¿˜æ˜¯æ¡ä»¶æ¦‚ç‡é¢˜ã€‚è€ƒè™‘ä¸€å¼€å§‹åœ¨æ‰“å¼€äº† $k$ ä¸ªğŸ‘é—¨ä¹‹åï¼Œè¿˜å‰© $m-k$ ä¸ªç¾Šé—¨ï¼Œå‰© $m+n-k-1$ ä¸ªé—¨å¯ä»¥æ¢ã€‚é‚£ä¹ˆè€ƒè™‘å§åˆ†ç±»ï¼š</p><p>1ã€ä¸€å¼€å§‹é€‰çš„æ˜¯ç¾Šé—¨ï¼Œè¿™éƒ¨åˆ†æ¦‚ç‡æ˜¯ $\dfrac{m}{n+m}\cdot \dfrac{n}{n+m-k-1}$ ã€‚</p><p>2ã€ä¸€å¼€å§‹é€‰çš„æ˜¯è½¦é—¨ï¼Œè¿™éƒ¨åˆ†æ¦‚ç‡æ˜¯ $\dfrac{n}{n+m}\cdot \dfrac{n-1}{n+m-k-1}$ ã€‚</p><p>ç›¸åŠ ä¸€ä¸‹å³å¯ã€‚</p><h1 id="UVA580-Critical-Mass"><a href="#UVA580-Critical-Mass" class="headerlink" title="[UVA580] Critical Mass"></a>[UVA580] Critical Mass</h1><blockquote><p>è¦æ±‚ä½ ç»Ÿè®¡æ‰€æœ‰é•¿åº¦ä¸º $n$ çš„ $01$ ä¸²ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªä¸²å†…è‡³å°‘æœ‰  $3$ ä¸ª $1$ æ”¾åœ¨ä¸€èµ·ã€‚</p></blockquote><p>è€ƒè™‘åˆ†ç±»è®¨è®ºæœ€å·¦è¾¹è¿ç»­ä¸‰ä¸ª $1$ çš„ä½ç½®ï¼Œå‡è®¾æ˜¯ $i,i+1,i+2$ã€‚è®¾ $f(i)$ è¡¨ç¤ºç­”æ¡ˆï¼Œé‚£ä¹ˆæœ‰</p><script type="math/tex; mode=display">f(n)=\sum_{i=1}^{n-2} \left(2^{i-1}-f(i-1)\right)\cdot 2^{n-i-2}</script><p>ä½†æ˜¯è¿™å¹¶ä¸å¯¹ï¼Œå› ä¸ºå¯èƒ½ä¼šå­˜åœ¨ $i-2,i-1,i$ æˆ–è€… $i-1,i,i+1$ æ˜¯è¿ç»­ $3$ ä¸ª $1$ <del>ï¼ˆæ¢¦å›éº»å°†ï¼‰</del> ã€‚äºæ˜¯å°±è€ƒè™‘é’¦å®š $i-1$ æ”¾ $0$ ã€‚æ‰€ä»¥å°±å˜æˆäº†</p><script type="math/tex; mode=display">f(n)=2^{n-3}+\sum_{i=2}^{n-2} \left(2^{i-2}-f(i-2)\right)\cdot 2^{n-i-2}</script><p>å…¶ä¸­è¦å•ç‹¬åŠ ä¸Š $i=1$ çš„è´¡çŒ®ã€‚æ³¨æ„åˆ°è¿™å°±æ˜¯ä¸€ä¸ªåˆ†æ²» FFT çš„æ ‡å‡†å½¢å¼ï¼Œéšä¾¿ä¼˜åŒ–ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h1 id="UVA12034-Race"><a href="#UVA12034-Race" class="headerlink" title="[UVA12034] Race"></a>[UVA12034] Race</h1><blockquote><p>æ±‚ $n$ ä¸ªäººèµ›é©¬çš„æœ€ç»ˆåæ¬¡å¯èƒ½æ€§ç§ç±»æ•°ã€‚</p><p>$1\leq n\leq 10^5$ ã€‚</p></blockquote><p>æš´åŠ›çš„è¯ï¼Œè€ƒè™‘æœ€åæœ‰ $k$ ä¸ªäººå¹¶åˆ—ç¬¬ä¸€ã€‚é‚£ä¹ˆæœ‰è½¬ç§»</p><script type="math/tex; mode=display">f(n)=\sum \binom{n}{k}\cdot f(n-k)</script><p>ç®—ä¸€ä¸‹å³å¯ã€‚é‚£ä¹ˆå¦‚æœ $n=10^5$ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥åˆ†æ²» FFTã€‚å³è€ƒè™‘æŠŠå¼å­æ‹†å¼€ä¸º</p><script type="math/tex; mode=display">f(n)=n!\cdot \sum \frac{1}{k!}\cdot\frac{f(n-k)}{(n-k)!}</script><p>ä»¤ $g(i)=\dfrac{1}{i!}$ï¼Œå°±å¯ä»¥ç›´æ¥åšäº†ã€‚å¤æ‚åº¦ $O(n\log ^2 n)$ ã€‚</p><h1 id="ACM-ICPC-Daejon-2012-Pole-Arrangement"><a href="#ACM-ICPC-Daejon-2012-Pole-Arrangement" class="headerlink" title="[ACM/ICPC Daejon 2012] Pole Arrangement"></a>[ACM/ICPC Daejon 2012] Pole Arrangement</h1><blockquote><p>é•¿åº¦åˆ†åˆ«ä¸º $1\sim n$ çš„æ†å­æ’æˆä¸€åˆ—ã€‚ä»å·¦è¾¹èƒ½çœ‹åˆ° $l$ æ ¹ï¼Œä»å³è¾¹èƒ½çœ‹åˆ° $r$ æ ¹ã€‚æ±‚æœ‰å¤šå°‘ç§æ’åˆ—æ•°ã€‚</p><p>$1\leq n\leq 300$ ã€‚</p></blockquote><p>è€ƒè™‘ç›´æ¥ $dp$ ã€‚è®¾ $f_{i,j,k}$ è¡¨ç¤ºè€ƒè™‘ä»å°åˆ°å¤§çš„ $i$ ä¸ªæ†å­ï¼Œä»å·¦è¾¹çœ‹åˆ° $j$ æ ¹ï¼Œä»å³è¾¹çœ‹åˆ° $k$ æ ¹çš„æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆè€ƒè™‘æ¯æ¬¡é€šè¿‡æ”¾ä¸€ä¸ªæ›´åŠ å°çš„æ†å­æ¥è½¬ç§»ã€‚å³</p><script type="math/tex; mode=display">f_{i,j,k}=f_{i-1,j-1,k}+f_{i-1,j,k-1}+f_{i-1,j,k}</script><p>å…¶ä¸­åˆ†åˆ«æ˜¯æ”¾åœ¨ä¸¤è¾¹å’Œä¸­é—´çš„æ–¹æ¡ˆæ•°ã€‚</p><p>è€ƒè™‘è¿™ç§æ’åˆ—è®¡æ•°çš„é¢˜ç›®å¤§éƒ¨åˆ†éƒ½æ˜¯æšä¸¾æœ€å¤§çš„æˆ–è€…æœ€å°çš„æ¥è½¬ç§»ã€‚ç„¶è€Œæ­¤é¢˜æ”¾æœ€é•¿çš„æ†å­ä¼šé”…ï¼Œäºæ˜¯å°±åªèƒ½æ‹¿æœ€å°çš„æ†å­æ¥è½¬ç§»ã€‚</p><h1 id="ACM-ICPC-Wuhan-2009-Crossing-Rivers"><a href="#ACM-ICPC-Wuhan-2009-Crossing-Rivers" class="headerlink" title="[ACM/ICPC Wuhan 2009] Crossing Rivers"></a>[ACM/ICPC Wuhan 2009] Crossing Rivers</h1><blockquote><p>ä¸¤åœ°ä¹‹é—´è·ç¦»ä¸º $n$ ï¼Œè¡Œèµ°é€Ÿåº¦ $1/s$ ã€‚æœ‰ $m$ æ¡é•¿åº¦åˆ†åˆ«ä¸º $L_i$ çš„æ²³ï¼Œåœ¨ä¸Šé¢åˆ’èˆ¹é€Ÿåº¦ä¸º $v_i$ ã€‚æ¯æ¬¡åˆ°è¾¾ä¸€æ¡æ²³æ—¶éœ€è¦ç­‰èˆ¹è¿‡æ¥å†èµ°ã€‚å¦‚æœå‡ºé—¨æ—¶èˆ¹çš„ä½ç½®å’Œæœå‘éƒ½æ˜¯éšæœºåˆ†å¸ƒï¼Œæ±‚æœŸæœ›å¤šä¹…åˆ°è¾¾å¯¹å²¸ã€‚</p></blockquote><p>æ¯”è¾ƒåŸºç¡€çš„ä¸€é“æœŸæœ›é¢˜ç›®ã€‚è€ƒè™‘è¿‡ç¬¬ $i$ æ¡æ²³çš„æ—¶é—´åœ¨ $\left[\dfrac{L_i}{v_i},\dfrac{3\cdot L_i}{v_i}\right)$ ä¸­å‡åŒ€éšæœºï¼Œäºæ˜¯æœŸæœ›å°±æ˜¯åšä¸ªå¹³å‡æ•°ï¼Œç”¨çº¿æ€§æ€§åŠ ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h1 id="ç»å…¸é—®é¢˜-å¤šè¾¹å½¢"><a href="#ç»å…¸é—®é¢˜-å¤šè¾¹å½¢" class="headerlink" title="[ç»å…¸é—®é¢˜] å¤šè¾¹å½¢"></a>[ç»å…¸é—®é¢˜] å¤šè¾¹å½¢</h1><blockquote><p>æœ‰ä¸€æ ¹é•¿åº¦ä¸º $1$ çš„æœ¨æ£’ã€‚éšæœºé€‰ $k$ ä¸ªä½ç½®åˆ‡å¼€ï¼Œæ±‚è¿™äº›å°æœ¨æ¡èƒ½ç»„æˆä¸€ä¸ªå¤šè¾¹å½¢çš„æ¦‚ç‡ã€‚ </p></blockquote><p>å† æ”¾ é€ã€‚</p><p>è€ƒè™‘è¿æˆä¸€ä¸ªåœ†ä¹‹åå˜æˆäº†éšä¾¿é€‰ $k+1$ ä¸ªä½ç½®ã€‚é‚£ä¹ˆè€ƒè™‘æ‹¼æˆä¸€ä¸ªå¤šè¾¹å½¢å½“ä¸”ä»…å½“å…¶ä¸­æœ€é•¿çš„é‚£æ®µå¼§é•¿åº¦ä¸¥æ ¼å°äº $\dfrac{1}{2}$ ã€‚é‚£ä¹ˆç­”æ¡ˆå°±æ˜¯</p><script type="math/tex; mode=display">1-\frac{k+1}{2^k}</script><p>å³è€ƒè™‘å¯¹å¼§è®¡æ•°ã€‚è€ƒè™‘å¯¹äºå¼§çš„ä¸€ä¸ªç«¯ç‚¹ $p$ ï¼Œæœ‰ $k+1$ ç§å–æ³•ï¼Œå¯¹äºå…¶ä»–çš„ç‚¹æœ‰ $\dfrac{1}{2^k}$ çš„æ¦‚ç‡éƒ½åœ¨åŒä¸€ä¾§ã€‚å¯¹ç­”æ¡ˆå–ä¸ªè¡¥å³å¯ã€‚</p><p>â€¦â€¦æ³¨æ„åˆ°æ˜¯ä¸ä¼šæœ‰å¼§é•¿åº¦è¶…è¿‡ $\dfrac{1}{2}$ çš„ï¼Œè¿™ä¸ªå°ç»†èŠ‚ä¸€å¼€å§‹è¢«è‡ªå·±å¿½ç•¥äº†ã€‚</p><h1 id="UVA10213-How-many-pieces-of-Land"><a href="#UVA10213-How-many-pieces-of-Land" class="headerlink" title="[UVA10213] How many pieces of Land?"></a>[UVA10213] How many pieces of Land?</h1><blockquote><p>ç»™å®šä¸€ä¸ªåœ†ï¼Œè¾¹ç•Œä¸Šé€‰ $n$ ä¸ªç‚¹ä¸¤ä¸¤è¿è¾¹ï¼Œæœ€å¤šèƒ½åˆ’åˆ†å‡ºå¤šå°‘ä¸ªåŒºåŸŸã€‚</p></blockquote><p>è€ƒè™‘ä¸€ç§æ¬§ç¥æ•™æˆ‘çš„ç¥å¥‡åšæ³•ã€‚é¦–å…ˆä¸éš¾å‘ç°æ˜¯å¯ä»¥åšåˆ°ä¸å­˜åœ¨ä¸‰ç‚¹å…±çº¿çš„ï¼Œå¹¶ä¸”ä¸å…±çº¿ç»“æœè‡³å°‘ä¸ä¼šæ›´åŠ£ã€‚é‚£ä¹ˆå¦‚æœè®¾ $g(i)$ è¡¨ç¤ºäº¤å‡ºçš„è¿™äº›åŒºåŸŸä¸­ $i $ è¾¹å½¢çš„ä¸ªæ•°ï¼ˆåªè€ƒè™‘äº¤å‡ºæ¥çš„æœ€å°å•å…ƒï¼‰ï¼Œä¼šæœ‰</p><script type="math/tex; mode=display">\sum _{i=3}^{n} i\times g(i)=n+2\cdot \left(2\cdot \binom{n}{4}+ \binom{n}{2}-n\right)</script><p>å³æ¯æ¡è¾¹ä¼šäº§ç”Ÿä¸¤æ¬¡è´¡çŒ®ï¼Œè¿™ $n$ ä¸ªç‚¹æœ€åè¿å‡ºçš„è¾¹å¯ä»¥äº¤å‡º $\binom{n}{4}$ ä¸ªäº¤ç‚¹ï¼Œæ¯åˆ æ‰ä¸€ä¸ªäº¤ç‚¹å¯ä»¥å¤šå‡ºä¸¤æ¡çº¿æ®µã€‚åŒæ—¶æœ€åäº¤ç‚¹åˆ å¹²å‡€ä¹‹åè¿˜å‰© $\binom{n}{2}$ æ¡çº¿æ®µï¼ŒåŒæ—¶ä¸ºäº†å•ç‹¬è®¡ç®—ç›¸é‚»ç‚¹ä¹‹é—´çš„è¿è¾¹è¦å…ˆå‡å» $n$ å¹¶ä¸”æœ€åå†åŠ å›æ¥ã€‚</p><p>åŒæ—¶å†è€ƒè™‘å†…è§’å’Œçš„è´¡çŒ®ã€‚å³</p><script type="math/tex; mode=display">\sum_{i=3}^ng(i)\cdot(i-2) \pi=2\pi\cdot \binom{n}{4}+(n-2)\pi</script><p>å…¶ä¸­å³è¾¹ç¬¬ä¸€é¡¹æ˜¯æ¯ä¸ªç‚¹å‘¨å›´ä¸€åœˆæ˜¯ $2\pi$ ï¼Œç¬¬äºŒé¡¹æ˜¯è€ƒè™‘æœ€å¤§çš„é‚£ä¸ª $n$ è¾¹å½¢çš„å†…è§’å’Œã€‚</p><p>è€ƒè™‘ä¸Šé¢ä¸¤ä¸ªå¼å­ä½œå·®ï¼Œå¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\sum_{i=3}^n g(i)=\binom{n}{4}+\binom{n-1}{2}+n</script><p>å³ä¸ºç­”æ¡ˆã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å››å¤„æ‰¾æ¥çš„ç®€å•æ•°å­¦é¢˜ï¼ŒæŒ‘äº†ä¸€äº›é¢˜ç›®æ•´ç†ä¸€ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="æ•°å­¦/è§‚å¯Ÿæ€§è´¨,ç»“è®ºä¸æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E8%A7%82%E5%AF%9F%E6%80%A7%E8%B4%A8-%E7%BB%93%E8%AE%BA%E4%B8%8E%E6%9E%84%E9%80%A0/"/>
    
      <category term="æ€ç»´é¢˜/æ„é€ " scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%9E%84%E9%80%A0/"/>
    
      <category term="æ•°å­¦/æ•°è®º" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%95%B0%E8%AE%BA/"/>
    
      <category term="æ•°å­¦/æ¦‚ç‡,æœŸæœ›" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="å¤šé¡¹å¼çš„åº”ç”¨/åˆ†æ²»FFT" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8-%E5%88%86%E6%B2%BBFFT/"/>
    
  </entry>
  
  <entry>
    <title>ã€èµ›é¢˜æ•´ç†ã€‘APIO2019 ç®€è¦é¢˜è§£</title>
    <link href="https://www.orchidany.cn/2020/05/25/APIO2019/"/>
    <id>https://www.orchidany.cn/2020/05/25/APIO2019/</id>
    <published>2020-05-25T01:16:51.000Z</published>
    <updated>2020-05-25T03:34:29.291Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>åšäº†ä¸€ä¸‹å»å¹´ APIO çš„é¢˜ã€‚</p><p>å£èƒ¡äº†ä¸€ä¸‹å‘ç°å¯ä»¥ $60(=13+16+17+14)+100+40(=20+20)$ï¼Œå¤§æ¦‚ $200$ åˆ†æ‹¿ä¸ª Ag çš„æ ·å­ã€‚</p><p>å¯èƒ½è¿˜æ˜¯æ¯”è¾ƒèœå§ï¼Œå”‰ã€‚</p><p>å“¦ï¼Œä¼¼ä¹ä»é¢˜ç›®æ³¨é‡Šé‡Œé¢å¯ä»¥çœ‹å‡ºæ¥è¿™æ˜¯æ¯›å­å‡ºçš„é¢˜ã€‚ä¸æ˜ç™½æ¯›å­ä¸ºä»€ä¹ˆåˆå¯¹è¿™ç§é¢˜æ„Ÿå…´è¶£äº†ã€‚</p><a id="more"></a><h1 id="A-Bridges"><a href="#A-Bridges" class="headerlink" title="A Bridges"></a>A Bridges</h1><blockquote><p>ç»™å®šä¸€å¼ å›¾ï¼Œæ¯æ¡è¾¹æœ‰ä¸ªé™é‡ã€‚æœ‰ä¸¤ç§æ“ä½œï¼Œç¬¬ä¸€ç§æ˜¯ä¿®æ”¹æŸæ¡è¾¹çš„é™é‡ï¼Œç¬¬äºŒç§æ˜¯è¯¢é—®ä»æŸä¸ªç‚¹ä»¥é‡é‡ $w$ å¼€å§‹èµ°ï¼Œå¯ä»¥èµ°åˆ°å¤šå°‘ä¸ªç‚¹ã€‚$n\leq 5\times 10^4,1\leq q,m\leq 2\times 10^5$ ã€‚</p></blockquote><p>æš´åŠ›åˆ†ä¸è¯´äº†ï¼Œ$16$ åˆ†çš„é“¾å¯ä»¥çº¿æ®µæ ‘ä¸ŠäºŒåˆ†ï¼Œ$17$ åˆ†çš„å®Œå…¨äºŒå‰æ ‘ç”±äºæ ‘é«˜å¾ˆä½æ‰€ä»¥å¯ä»¥éšä¾¿æ‹¿ä¸ªä»€ä¹ˆæ•°æ®ç»“æ„æ¥æš´åŠ›ç»´æŠ¤ã€‚è€ƒè™‘åªæœ‰è¯¢é—®æ“ä½œçš„ $14$ åˆ†ã€‚å‘ç°å¯ä»¥å°†å…¨éƒ¨çš„è¯¢é—®ç¦»çº¿ï¼Œç„¶åå’Œè¾¹æ”¾åœ¨ä¸€èµ·æŒ‰ç…§æƒé‡ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æ‹¿ä¸ªå¹¶æŸ¥é›†æ¥ç»´æŠ¤ sizeã€‚ä¸éš¾ç†è§£è¿™æ ·åšçš„æ­£ç¡®æ€§ã€‚</p><p>ä¹‹åè€ƒè™‘æ»¡åˆ†â€¦å¤§æ¦‚æ˜¯æ²¡æ€ä¹ˆè§è¿‡çš„åˆ†å—æŠ€å·§ã€‚è€ƒè™‘å¯¹æ‰€æœ‰æ“ä½œæŒ‰æ—¶é—´åˆ†å—ï¼Œå—å¤§å°ä¸º $B$ ã€‚é‚£ä¹ˆå‰é¢çš„å—é‡Œçš„ä¿®æ”¹å°±å¯ä»¥æš´åŠ›æ”¹å®Œï¼Œå½“å‰å—å†…åˆ™æŒ‰ç…§ä¸Šé¢ $\rm subtask4$ çš„åšæ³•ç¦»çº¿ä¸‹æ¥ã€‚æ³¨æ„åˆ°å¦‚æœæŸæ¡è¾¹åœ¨è¿™ä¸ªå—é‡Œä¸ä¼šè¢«ä¿®æ”¹å°±ä¸ç®¡ä»–ï¼Œç»§ç»­æ”¾åœ¨ä¸€èµ·ç¦»çº¿ã€‚å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œæš´åŠ›æ¯ä¸ªä¿®æ”¹æ“ä½œï¼Œåˆ¤æ–­æ­¤æ—¶è¿™æ¡è¾¹æ˜¯å¦æœ‰ç”¨ã€‚æ³¨æ„åˆ°æ­¤å¤„åº”è¯¥æŒ‰æ—¶é—´æ¥å¯¹æ‰€æœ‰ä¿®æ”¹è¿›è¡Œæ’åºï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“å¯¹äºæ¯æ¡è¾¹åªæœ‰æœ€åä¸€ä¸ªä¿®æ”¹æ‰ä¼šæœ‰æ•ˆã€‚</p><p>è¿™æ ·å°±éœ€è¦å†ç»´æŠ¤ä¸€ä¸ªå¯æ’¤é”€çš„å¹¶æŸ¥é›†ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€æ¬¡è¯¢é—®éƒ½éœ€è¦æš´åŠ›é‚£äº›ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™æ ·ä¼šå¸¦ $\log$ ã€‚äºæ˜¯æœ€åçš„å¤æ‚åº¦å°±æ˜¯</p><script type="math/tex; mode=display">O(\frac{q}{B}\cdot\left(B^2\log n+m\log m\right))=O(qB\log n+\frac{q}{B}m\log m)</script><p>å®æµ‹æœ€åä¼¼ä¹åœ¨ $B=800\sim 1300$ æ—¶æ•ˆæœæœ€å¥½ã€‚ä½†æ˜¯æˆ‘å†™çš„æ—¶å€™ç”±äºç”¨äº† <code>vector</code> å¥— <code>tuple</code> ï¼Œå¸¸æ•°æ¯”è¾ƒå¤§â€¦</p><p>æ„Ÿè§‰æ€è·¯è¿˜æ˜¯æŒºç›´æ¥çš„ï¼Œæƒ³å‡ºåˆ†å—æ¥å¯èƒ½å°± win äº†ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edg</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, z, id ;</span><br><span class="line">    edg (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>)&#123;</span><br><span class="line">        x = a ; y = b ; z = c ; id = d ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;E[N], e[N] ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">opt</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">int</span> id, o ;</span><br><span class="line">&#125;op[N] ;</span><br><span class="line">opt tmp[N] ;</span><br><span class="line">opt pmt[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, q, k ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> L[N] ;</span><br><span class="line"><span class="keyword">int</span> R[N] ;</span><br><span class="line"><span class="keyword">int</span> cnt1 ;</span><br><span class="line"><span class="keyword">int</span> cnt2 ;</span><br><span class="line"><span class="keyword">int</span> ctn ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;tuple&lt;<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; stk ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x != fa[x])</span><br><span class="line">        x = fa[x] ; <span class="keyword">return</span> x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f1 = find(x) ;</span><br><span class="line">    <span class="keyword">int</span> f2 = find(y) ;</span><br><span class="line">    <span class="keyword">if</span> (f1 == f2) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span> (sz[f1] &gt; sz[f2])&#123;</span><br><span class="line">        stk.emplace_back(f1, f2, sz[f1]) ;</span><br><span class="line">        fa[f2] = f1, sz[f1] += sz[f2] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        stk.emplace_back(f2, f1, sz[f2]) ;</span><br><span class="line">        fa[f1] = f2, sz[f2] += sz[f1] ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp_y</span><span class="params">(opt a, opt b)</span></span>&#123; <span class="keyword">return</span> a.y &gt; b.y ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp_val</span><span class="params">(edg a, edg b)</span></span>&#123; <span class="keyword">return</span> a.z &gt; b.z ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> yz)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (stk.size() &gt; yz)&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, z ;</span><br><span class="line">        tie(x, y, z) = stk.back() ;</span><br><span class="line">        sz[x] = z ; fa[y] = y ; stk.pop_back() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        x = qr() ;</span><br><span class="line">        y = qr() ;</span><br><span class="line">        z = qr() ;</span><br><span class="line">        E[i] = edg(x, y, z) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; q ; k = q / M + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        L[i] = R[i - <span class="number">1</span>] + <span class="number">1</span>, R[i] = L[i] + M - <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (L[k] &gt; q) -- k ; R[k] = min(R[k], q) ;</span><br><span class="line"><span class="comment">//    debug(L, 1, k) ;</span></span><br><span class="line"><span class="comment">//    debug(R, 1, k) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        op[i].id = i, op[i].o = qr() ;</span><br><span class="line">        op[i].x = qr(), op[i].y = qr() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            fa[j] = j, sz[j] = <span class="number">1</span> ; cnt1 = cnt2 = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j) vis[j] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = L[i] ; j &lt;= R[i] ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (op[j].o == <span class="number">1</span>)</span><br><span class="line">                vis[op[j].x] = <span class="number">1</span>, tmp[++ cnt1] = op[j] ;</span><br><span class="line">            <span class="keyword">else</span> pmt[++ cnt2] = op[j] ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(vis, 1, m) ;</span></span><br><span class="line">        ctn = <span class="number">0</span> ; <span class="keyword">int</span> p = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (!vis[j]) e[++ ctn] = E[j] ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; ctn &lt;&lt; '\n' ;</span></span><br><span class="line">        sort(e + <span class="number">1</span>, e + ctn + <span class="number">1</span>, comp_val) ;</span><br><span class="line">        sort(pmt + <span class="number">1</span>, pmt + cnt2 + <span class="number">1</span>, comp_y) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt2 ; ++ j)&#123;</span><br><span class="line"><span class="comment">//            debug(pmt[j].x, ' ') ;</span></span><br><span class="line"><span class="comment">//            debug(pmt[j].y, ' ') ;</span></span><br><span class="line"><span class="comment">//            debug(p) ;</span></span><br><span class="line">            <span class="keyword">while</span> (e[p].z &gt;= pmt[j].y &amp;&amp; p &lt;= ctn)</span><br><span class="line">                merge(e[p].x, e[p].y), ++ p ;</span><br><span class="line"><span class="comment">//            debug(fa, 1, n) ;</span></span><br><span class="line"><span class="comment">//            debug(sz, 1, n) ;</span></span><br><span class="line">            <span class="keyword">int</span> t = stk.size() ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h = cnt1 ; h &gt;= <span class="number">1</span> ; -- h)&#123;</span><br><span class="line">                <span class="keyword">if</span> (tmp[h].id &lt;= pmt[j].id &amp;&amp; vis[tmp[h].x])&#123;</span><br><span class="line">                    vis[tmp[h].x] = <span class="number">0</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (tmp[h].y &gt;= pmt[j].y)</span><br><span class="line">                        merge(E[tmp[h].x].x, E[tmp[h].x].y) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            puts("**************************") ;</span></span><br><span class="line"><span class="comment">//            debug(vis, 1, m) ;</span></span><br><span class="line"><span class="comment">//            debug(fa, 1, n) ;</span></span><br><span class="line"><span class="comment">//            debug(sz, 1, n) ;</span></span><br><span class="line"><span class="comment">//            puts("- - - - - - - - - - - - - - -") ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">1</span> ; h &lt;= cnt1 ; ++ h)</span><br><span class="line">                <span class="keyword">if</span> (vis[tmp[h].x] &amp;&amp; E[tmp[h].x].z &gt;= pmt[j].y)</span><br><span class="line">                    merge(E[tmp[h].x].x, E[tmp[h].x].y) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">1</span> ; h &lt;= cnt1 ; ++ h)</span><br><span class="line">                <span class="keyword">if</span> (!vis[tmp[h].x]) vis[tmp[h].x] = <span class="number">1</span> ;</span><br><span class="line"><span class="comment">//            puts("********&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;******") ;</span></span><br><span class="line"><span class="comment">//            debug(vis, 1, m) ;</span></span><br><span class="line"><span class="comment">//            debug(fa, 1, n) ;</span></span><br><span class="line"><span class="comment">//            debug(sz, 1, n) ;</span></span><br><span class="line"><span class="comment">//            puts("- - - -^^^^^^^^^- - - - - -") ;</span></span><br><span class="line"><span class="comment">//            cout &lt;&lt;  find(pmt[j].x)  &lt;&lt; '\n' ;</span></span><br><span class="line">            ans[pmt[j].id] = sz[find(pmt[j].x)] ;</span><br><span class="line">            clear(t) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt1 ; ++ j)</span><br><span class="line">            E[tmp[j].x].z = tmp[j].y ;</span><br><span class="line">        clear(<span class="number">0</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (ans[i]) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans[i]) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="B-Device"><a href="#B-Device" class="headerlink" title="B Device"></a>B Device</h1><blockquote><p>ç»™å®šä¸€æ¡æ•°è½´å’Œ  $A,B$ã€‚</p><p>æ•°è½´ä¸Šçš„æ¯ä¸ªä½ç½®éƒ½å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ•°å¯¹ $(x,y)$ ï¼Œå…¶ä¸­ $x = ((t + \left\lfloor \frac{t}{B} \right\rfloor) \bmod A),y = (t \bmod B)$ã€‚</p><p>åœ¨ç»™å®š $n$ ä¸ªè¿ç»­åŒºé—´ $[l_i,r_i]$ ã€‚æ±‚æ‰€æœ‰åŒºé—´é‡Œæœ‰å¤šå°‘æœ¬è´¨ä¸åŒçš„ä½ç½®ã€‚æœ¬è´¨ä¸åŒæŒ‡äº§ç”Ÿçš„æ•°å¯¹ä¸åŒã€‚</p><p>$1\le n\le 10^6,1\le A,B\le 10^{18},0\le l_i\le r_i\le 10^{18},r_i&lt;l_{i+1}$ã€‚</p></blockquote><p>å¤§æ¦‚æ˜¯åœºä¸Šæœ€ç®€å•çš„é¢˜äº†ã€‚æ¨çš„æ—¶å€™å¯èƒ½éœ€è¦ç»†å¿ƒä¸€ç‚¹ã€‚ç„¶åä»¥ä¸‹æ˜¯æˆ‘ xjb æ¨çš„è¿‡ç¨‹</p><script type="math/tex; mode=display">\begin{aligned}t_{1}+\left\lfloor\frac{t_1}{B}\right\rfloor&\equiv t_{2}+\left\lfloor\frac{t_{2}}{B}\right\rfloor \pmod{A} \\t_{1}-B\cdot \left\lfloor \frac{t_1}{B}\right\rfloor&\equiv t_{2}- B \cdot\left\lfloor\frac{t_2}{B}\right\rfloor\end{aligned}</script><p>$(1)-(2)$ å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\begin{aligned}(B+1)\left\lfloor\frac{t_1}{B}\right\rfloor &\equiv(B+1)\left\lfloor \frac{t_2}{B}\right\rfloor \pmod A \\\left\lfloor\frac{t_1}{B}\right\rfloor&\equiv \left\lfloor \frac{t_{2}}{B}\right\rfloor \pmod{\frac{A}{(B + 1, A)}}\end{aligned}</script><p>ä»è€Œ</p><script type="math/tex; mode=display">\begin{aligned}\because t_{2}&=t_{1}+B t \\\therefore \left\lfloor\frac{t_{1}}{B}\right\rfloor &\equiv \left\lfloor \frac{t_{1}+Bt}{B}\right\rfloor \equiv\left\lfloor\frac{t_1}{B}+t\right\rfloor \\&\equiv\left\lfloor\frac{t_{1}}{B}\right\rfloor + t\pmod {\frac{A}{(B+1,A)}}\end{aligned}</script><p>é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´éœ€è¦ä¸¤ä¸ª $t$ ä¹‹é—´æ»¡è¶³</p><script type="math/tex; mode=display">\Delta t=\frac{A\times B}{(A, B+1)}</script><p>äºæ˜¯å°±å¯ä»¥å…ˆåˆ¤ä¸€ä¸‹æ˜¯å¦å­˜åœ¨åŒºé—´é•¿åº¦ $\geq \Delta t$ ã€‚å¦‚æœæœ‰ç­”æ¡ˆå°±æ˜¯ $\Delta t$ ï¼Œå¦åˆ™è€ƒè™‘æ¯ä¸ªåŒºé—´éƒ½å¯ä»¥å¯¹å…¶å–æ¨¡ï¼Œä¹‹åå°±ä¼šå˜æˆä¸€æ®µæˆ–è€…ä¸¤æ®µ(å–å†³äºå–æ¨¡å®Œå $l,r$ çš„å¤§å°å…³ç³»)ï¼Œç„¶åå°±å˜æˆç»å…¸çš„æ±‚ä¸€ä¸ªåŒºé—´å†…åˆ°åº•è¦†ç›–äº†å¤šå°‘ä¸ªä½ç½®çš„é—®é¢˜ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line">ll ans ;</span><br><span class="line">ll res ;</span><br><span class="line">ll A, B ;</span><br><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rgs</span>&#123;</span></span><br><span class="line">    ll l, r ;</span><br><span class="line">    rgs (ll a = <span class="number">0</span>, ll b = <span class="number">0</span>)&#123; l = a, r = b ; &#125;</span><br><span class="line">&#125;base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll x, ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> y ? gcd(y, x % y) : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> rgs &amp; a, <span class="keyword">const</span> rgs &amp; b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.l == b.l ? a.r &lt; b.r : a.l &lt; b.l ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//    freopen("05", "r", stdin) ;</span></span><br><span class="line"><span class="comment">//    freopen("1.out", "w", stdout) ;</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; A &gt;&gt; B ; tot = n ;</span><br><span class="line">    res = A / gcd(A, B + <span class="number">1</span>), res *= B ;</span><br><span class="line"><span class="comment">//  cout &lt;&lt; res &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        base[i].l = qr(), base[i].r = qr() ;</span><br><span class="line">        <span class="keyword">if</span> (base[i].r - base[i].l + <span class="number">1</span> &gt;= res)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="string">'\n'</span>, <span class="number">0</span> ;</span><br><span class="line">        base[i].r %= res ; base[i].l %= res ;</span><br><span class="line">        <span class="keyword">if</span> (base[i].l &gt; base[i].r)&#123;</span><br><span class="line">            base[++ tot] = rgs(base[i].l, res - <span class="number">1</span>) ;</span><br><span class="line">            base[i] = rgs(<span class="number">0</span>, base[i].r) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= tot ; ++ i)</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; base[i].l &lt;&lt; " " &lt;&lt; base[i].r &lt;&lt; '\n' ;</span></span><br><span class="line">    n = tot ;</span><br><span class="line">    sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, comp) ;</span><br><span class="line">    ll l = base[<span class="number">1</span>].l, r = base[<span class="number">1</span>].r ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (base[i].l &gt; r)</span><br><span class="line">            ans += r - l + <span class="number">1</span>, l = base[i].l ;</span><br><span class="line">        r = max(r, base[i].r) ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans += r - l + <span class="number">1</span> ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="C-Lamps"><a href="#C-Lamps" class="headerlink" title="C Lamps"></a>C Lamps</h1><blockquote><p>ç»™å®šä¸€æ¡é•¿ä¸º $n+1$ çš„æ•°è½´ï¼Œæ¯ä¸ª $[i,i+1]$ ä¹‹é—´éƒ½æœ‰ä¸€ç›ç¼–å·ä¸º $i$ çš„ç¯ï¼Œå¦‚æœäº®åˆ™æ„å‘³ç€ $i,i+1$ è¿é€šï¼Œå¦åˆ™ä¸è¿é€šã€‚æœ‰ä¸¤ç§æ“ä½œï¼Œæ¯æ¬¡ä¼šé€‰æ‹©æŸç›ç¯å°†å…¶çŠ¶æ€å–åï¼Œæˆ–è€…è¯¢é—®ä¸¤ä¸ªç‚¹ $a,b$ ä»ç¬¬ä¸€æ¬¡æ“ä½œå¼€å§‹æœ‰å¤šå°‘æ¬¡æ“ä½œæ˜¯ç­çš„ã€‚</p><p>$n,q\leq 3\times 10^5$ ã€‚</p></blockquote><p>orz ç¥ä»™é¢˜ï¼Œå¤§æ¦‚æ˜¯ä¸€å † trick çš„å †ç Œï¼Œç„¶åæˆ‘å°±å•¥éƒ½ä¸ä¼š QAQã€‚</p><p>è€ƒè™‘è¿™ä¸œè¥¿ä¸€ç‚¹ä¹Ÿä¸å¥½ç»´æŠ¤ï¼Œäºæ˜¯å°±å°†ä¿¡æ¯æŠ½è±¡åˆ°äºŒç»´ä¸Šã€‚å…·ä½“çš„ï¼Œå¯ä»¥å°†ç‚¹å¯¹ $(a,b)$ ä½œä¸ºè¯¢é—® $(a,b)$ çš„ç­”æ¡ˆã€‚</p><p>ä¹‹åè€ƒè™‘æ€ä¹ˆç»´æŠ¤ã€‚é¦–å…ˆå¯ä»¥ç”¨ç‚æœµè‰æ ‘é‚£æ ·ç”¨ <code>set</code> ç»´æŠ¤äº®ç€çš„è¿ç»­æ®µã€‚ä¹‹åå‡è®¾å–åäº† $i$ å·ç¯ï¼Œé‚£ä¹ˆå‡è®¾ä¸ $i$ ç›¸è¿çš„è¿é€šå—æœ€å·¦è¾¹æ˜¯ $l$ï¼Œä¸ $i+1$ ç›¸è¿çš„è¿é€šå—æœ€å·¦è¾¹æ˜¯ $r$ã€‚é‚£ä¹ˆè€ƒè™‘æ¯æ¬¡å®é™…ä¸Šæ˜¯è®© </p><script type="math/tex; mode=display">(l,i+1),(l,i+2)\cdots (l,r),(l+1,i+1),(l+1,i+2)\cdots(i,r)</script><p>è¿™äº›ç‚¹è¿é€šèµ·æ¥ã€‚è¿™åœ¨äºŒç»´å¹³é¢ä¸Šå°±æ˜¯ä¸€ä¸ªå·¦ä¸Šè§’ä¸º $(l,i+1)$ ï¼Œå³ä¸‹è§’ä¸º $(i,r)$ çš„çŸ©é˜µã€‚è€ƒè™‘å¦‚ä½•å¯¹è¿™ä¸ªçŸ©é˜µæäº‹æƒ…ï¼Œå‘ç°å¾ˆéš¾ç»´æŠ¤è¿™ä¸ªçŸ©é˜µé‡Œçš„è¿é€šæ€§ï¼Œäºæ˜¯è€ƒè™‘å·®åˆ†ã€‚å…·ä½“çš„ï¼Œå¦‚æœè®¾æ€»æ—¶é—´ä¸º $t$ ï¼Œå½“å‰æ—¶é—´ä¸º $t_0$ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘åœ¨æ¯æ¬¡å¼€çš„æ—¶å€™å°†è¿™ä¸ªçŸ©é˜µåŠ ä¸Š $t-t_0$ ï¼Œå…³çš„æ—¶å€™å‡å» $t-t_0$ ï¼Œè¿™æ ·ä¸¤æ¬¡ä¿®æ”¹çš„ $\Delta$ å°±æ˜¯ $t-t_1-(t-t_2)=t_2-t_1$ ã€‚ç”±äºä¸€ç›ç¯æ¯æ¬¡åªä¼šè¿›è¡Œå–åæ“ä½œï¼Œæ‰€ä»¥æ­£ç¡®æ€§å¯ä»¥ä¿è¯ã€‚</p><p>åŒæ—¶ï¼Œè€ƒè™‘è¿™æ ·åšçš„è¯ï¼Œè¯¢é—® $(a,b)$ æ—¶å¯èƒ½è¿˜æ˜¯ä¸¤è€…ä¹‹é—´æ­¤æ—¶ä¾æ—§æ˜¯è¿é€šçš„ã€‚ä¸ºäº†è®¡ç®—è¿™ä¸€éƒ¨åˆ†è´¡çŒ®éœ€è¦è®©è¯¢é—®ä¸€å¼€å§‹å°±å‡å» $t-t_0$ ã€‚</p><p>ç„¶åå°±æ˜¯ä¸€ä¸ªæœ´ç´ çš„çŸ©é˜µåŠ ï¼Œå•ç‚¹è¯¢é—®äº†ã€‚å°†æ¯ä¸ªä¿®æ”¹å·®åˆ†æˆå››ä¸ªä¹‹åå¯ä»¥ç›´æ¥è·‘ CDQã€‚</p><p>è¿™æ ·åšçš„å¤æ‚åº¦æ˜¯ $O((n+4\cdot q)\log n\log q)$ çš„ã€‚è¿™ä¸œè¥¿â€¦ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±èƒ½è·‘å¾—è¿‡ $1e6$ ã€‚åæ­£å¸¸æ•°å¾ˆææ€–ã€‚</p><p>ä¼¼ä¹æ˜¯æœ‰æŠŠä¸€ä¸ªä¿®æ”¹æ‹†æˆä¿©ä¿®æ”¹å† CDQ çš„ï¼Œè¿™æ ·åšç›´æ¥èŠ‚çº¦äº†ä¸€å€å¸¸æ•°ã€‚ä½†æ˜¯æˆ‘å¹¶ä¸çŸ¥é“é‚£æ˜¯ä¸ªä»€ä¹ˆåŸç†â€¦</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="keyword">int</span> n, q ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"><span class="keyword">int</span> _bit[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">char</span> Inp[<span class="number">50</span>] ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">qss</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id, isq ;</span><br><span class="line">    <span class="keyword">int</span> x, y, v ;</span><br><span class="line">    qss (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> z = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>)&#123;</span><br><span class="line">        id = a ; isq = z ; x = b ; y = c ; v = d ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;qs[N], tmp[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> qss &amp; a, <span class="keyword">const</span> qss &amp; b)</span></span>&#123; <span class="keyword">return</span> a.id &lt; b.id ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> ( ; x &lt;= n + <span class="number">1</span> ; x += (x &amp; -x)) _bit[x] += v ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x ; x -= (x &amp; -x)) ret += _bit[x] ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">int</span> tl = l, tr = mid + <span class="number">1</span> ;</span><br><span class="line">    cdq(l, mid) ; cdq(mid + <span class="number">1</span>, r) ;</span><br><span class="line">    <span class="keyword">while</span> (tr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">while</span> (tl &lt;= mid &amp;&amp; qs[tl].x &lt;= qs[tr].x)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!qs[tl].isq) ins(qs[tl].y, qs[tl].v) ; ++ tl ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (qs[tr].isq)&#123;</span><br><span class="line"><span class="comment">//            debug(qs[tr].x) ;</span></span><br><span class="line"><span class="comment">//            debug(qs[tr].y) ;</span></span><br><span class="line"><span class="comment">//            debug(</span></span><br><span class="line">            ans[qs[tr].id] += qry(qs[tr].y) ;</span><br><span class="line"><span class="comment">//            ) ;</span></span><br><span class="line">        &#125; ++ tr ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (tl &gt; l)</span><br><span class="line">        <span class="keyword">if</span> (!qs[-- tl].isq) ins(qs[tl].y, - qs[tl].v) ;</span><br><span class="line">    tr = mid + <span class="number">1</span> ; <span class="keyword">int</span> tot = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">while</span> (tl &lt;= mid || tr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span> (tr &lt;= r &amp;&amp; qs[tl].x &gt;= qs[tr].x) tmp[++ tot] = qs[tr ++] ;</span><br><span class="line">        <span class="keyword">if</span> (tl &lt;= mid &amp;&amp; qs[tl].x &lt;= qs[tr].x) tmp[++ tot] = qs[tl ++] ;</span><br><span class="line">        <span class="keyword">if</span> (tl &lt;= mid &amp;&amp; tr &gt; r) tmp[++ tot] = qs[tl ++] ;</span><br><span class="line">        <span class="keyword">if</span> (tr &lt;= r &amp;&amp; tl &gt; mid) tmp[++ tot] = qs[tr ++] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l ; i &lt;= r ; ++ i) qs[i] = tmp[i - l + <span class="number">1</span>] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id, l, r ;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> seg &amp;t)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="keyword">return</span> t.l &gt; l ; &#125;</span><br><span class="line">seg (<span class="keyword">int</span> L = <span class="number">0</span>, <span class="keyword">int</span> R = <span class="number">0</span>, <span class="keyword">int</span> idd = <span class="number">0</span>)&#123;</span><br><span class="line">        l = L ; r = R ; id = idd ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="built_in">set</span> &lt;seg&gt; s ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; q ;</span><br><span class="line">    <span class="keyword">int</span> x, y, b, c ;</span><br><span class="line">    s.insert(seg(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)</span><br><span class="line">        s.insert(seg(i, i, ++ cnt)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%1d"</span>, &amp;base[i]) ;</span><br><span class="line">        <span class="keyword">if</span> (base[i])&#123;</span><br><span class="line">            <span class="keyword">auto</span> l = -- s.lower_bound(seg(i, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">            <span class="keyword">auto</span> r = s.lower_bound(seg(i + <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">            <span class="keyword">if</span> (l -&gt; r &lt; i) ++ l ; <span class="keyword">int</span> L = l-&gt;l, R = r-&gt;r ;</span><br><span class="line">            <span class="comment">//cout &lt;&lt; L &lt;&lt; " " &lt;&lt; R &lt;&lt; '\n' ;</span></span><br><span class="line">            ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, L, i + <span class="number">1</span>, q) ;</span><br><span class="line">            ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, i + <span class="number">1</span>, i + <span class="number">1</span>, -q) ;</span><br><span class="line">            ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, L, R + <span class="number">1</span>, -q) ;</span><br><span class="line">            ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, i + <span class="number">1</span>, R + <span class="number">1</span>, q) ;</span><br><span class="line">            s.erase(l) ;</span><br><span class="line">            <span class="keyword">if</span> (r != l)</span><br><span class="line">                s.erase(r) ;</span><br><span class="line">            s.insert(seg(L, R, ++ cnt)) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(ans, <span class="number">-1</span>, <span class="keyword">sizeof</span>(ans)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= q ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>, Inp + <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (Inp[<span class="number">1</span>] == <span class="string">'q'</span>)&#123;</span><br><span class="line">            ++ tot ;</span><br><span class="line">            x = qr(), y = qr()  ;</span><br><span class="line">            <span class="keyword">auto</span> l = -- s.lower_bound(x) ;</span><br><span class="line">            <span class="keyword">auto</span> r = -- s.lower_bound(y) ;</span><br><span class="line">            <span class="keyword">if</span> (l -&gt; r &lt; x) ++ l ;</span><br><span class="line">            <span class="keyword">if</span> (r -&gt; r &lt; y) ++ r ;</span><br><span class="line">            qs[tot] = qss(tot, <span class="number">1</span>, x, y, <span class="number">0</span>) ;</span><br><span class="line">            ans[tot] = (l == r) ? -(q - i) : <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            x = qr() ;</span><br><span class="line">            <span class="keyword">if</span> (base[x])&#123;</span><br><span class="line">                <span class="keyword">auto</span> y = -- s.lower_bound(seg(x, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">                <span class="keyword">if</span> (y -&gt; r &lt; x) ++ y ; <span class="keyword">int</span> l = y -&gt; l, r = y -&gt; r ;</span><br><span class="line"><span class="comment">//                cerr &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, l, x + <span class="number">1</span>, i - q) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, x + <span class="number">1</span>, x + <span class="number">1</span>, q - i) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, l, r + <span class="number">1</span>, q - i) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, x + <span class="number">1</span>, r + <span class="number">1</span>, i - q) ;</span><br><span class="line">                s.erase(y) ;</span><br><span class="line">                s.insert(seg(l, x, ++ cnt)) ;</span><br><span class="line">                s.insert(seg(x + <span class="number">1</span>, r, ++ cnt)) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">auto</span> l = -- s.lower_bound(seg(x, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">                <span class="keyword">auto</span> r = -- s.lower_bound(seg(x + <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)) ;</span><br><span class="line">                <span class="keyword">if</span> (l -&gt; r &lt; x) ++ l ;</span><br><span class="line">                <span class="keyword">if</span> (r -&gt; r &lt; x + <span class="number">1</span>) ++ r ;</span><br><span class="line">                <span class="keyword">int</span> L = l -&gt; l, R = r -&gt; r ;</span><br><span class="line"><span class="comment">//                cerr &lt;&lt; L &lt;&lt; " " &lt;&lt; R &lt;&lt; '\n' ;</span></span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, L, x + <span class="number">1</span>, q - i) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, x + <span class="number">1</span>, x + <span class="number">1</span>, i - q) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, L, R + <span class="number">1</span>, i - q) ;</span><br><span class="line">                ++ tot, qs[tot] = qss(tot, <span class="number">0</span>, x + <span class="number">1</span>, R + <span class="number">1</span>, q - i) ;</span><br><span class="line">                s.erase(l) ;</span><br><span class="line">                <span class="keyword">if</span> (l != r)</span><br><span class="line">                    s.erase(r) ;</span><br><span class="line">                s.insert(seg(L, R, ++ cnt)) ;</span><br><span class="line">            &#125;</span><br><span class="line">            base[x] ^= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    for (int i = 1 ; i &lt;= tot ; ++ i)</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; qs[i].x &lt;&lt; " " &lt;&lt; qs[i].y &lt;&lt; " " &lt;&lt; qs[i].v &lt;&lt; '\n' ;</span></span><br><span class="line"><span class="comment">//    debug(tot) ;</span></span><br><span class="line">    cdq(<span class="number">1</span>, tot) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (~ans[i]) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans[i]) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åšäº†ä¸€ä¸‹å»å¹´ APIO çš„é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å£èƒ¡äº†ä¸€ä¸‹å‘ç°å¯ä»¥ $60(=13+16+17+14)+100+40(=20+20)$ï¼Œå¤§æ¦‚ $200$ åˆ†æ‹¿ä¸ª Ag çš„æ ·å­ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½è¿˜æ˜¯æ¯”è¾ƒèœå§ï¼Œå”‰ã€‚&lt;/p&gt;
&lt;p&gt;å“¦ï¼Œä¼¼ä¹ä»é¢˜ç›®æ³¨é‡Šé‡Œé¢å¯ä»¥çœ‹å‡ºæ¥è¿™æ˜¯æ¯›å­å‡ºçš„é¢˜ã€‚ä¸æ˜ç™½æ¯›å­ä¸ºä»€ä¹ˆåˆå¯¹è¿™ç§é¢˜æ„Ÿå…´è¶£äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="loj" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/loj/"/>
    
    
      <category term="æŠ€å·§/åˆ†å—" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E5%9D%97/"/>
    
      <category term="æ•°å­¦/æ•°è®º" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%95%B0%E8%AE%BA/"/>
    
      <category term="ç¦»çº¿ç®—æ³•/CDQåˆ†æ²»" scheme="https://www.orchidany.cn/tags/%E7%A6%BB%E7%BA%BF%E7%AE%97%E6%B3%95-CDQ%E5%88%86%E6%B2%BB/"/>
    
      <category term="æŠ€å·§/ä¿¡æ¯äºŒç»´åŒ–" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E4%BF%A1%E6%81%AF%E4%BA%8C%E7%BB%B4%E5%8C%96/"/>
    
      <category term="æœ‰æŠ€å·§çš„å·®åˆ†" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E5%B7%AE%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>ã€æ³›åšã€‘è¿‘æœŸåšé¢˜è®°å½•#1</title>
    <link href="https://www.orchidany.cn/2020/05/17/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://www.orchidany.cn/2020/05/17/åšé¢˜è®°å½•/</id>
    <published>2020-05-17T06:53:10.000Z</published>
    <updated>2020-06-05T03:40:25.531Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¤§æ¦‚æ˜¯å’Œã€Œç®€å•é¢˜é€‰åš ã€æ†ç»‘çš„ã€‚</p><p>é‚£ä¸ªé‡Œé¢ç”¨æ¥è®°å½•è‡ªå·±ç§’æ‰è´¨é‡è¿˜å¯ä»¥çš„çš„é¢˜ç›®ï¼Œè¿™ä¸ªç”¨æ¥è®°å½•è‡ªå·±æƒ³äº†/å†™äº†å¥½ä¸€ä¼šå„¿çš„é¢˜ç›®ã€‚</p><p>å—¯ï¼ŒåŠ æ²¹å§ã€‚åŠæ—¶å½“å‹‰åŠ±ï¼Œå²æœˆä¸å¾…äººã€‚</p><p>å°±æ•´ç† 20 ä¸ªé¢˜å§ï¼å¼€æ–°çš„å•¦ï¼</p><a id="more"></a><h1 id="ç¾å›¢æ¯-2020-æµ‹è¯•èµ›-A-å­åºåˆ—"><a href="#ç¾å›¢æ¯-2020-æµ‹è¯•èµ›-A-å­åºåˆ—" class="headerlink" title="[ç¾å›¢æ¯ 2020 æµ‹è¯•èµ› A] å­åºåˆ—"></a>[ç¾å›¢æ¯ 2020 æµ‹è¯•èµ› A] å­åºåˆ—</h1><blockquote><p>ç»™å®š $n$ ä¸ªå­—ç¬¦ã€‚$s_0$ ä¸ºç©ºï¼Œæ¯æ¬¡ä¼šè®© $s_{i}=c s_{i-1}[1] c s_{i-1}[2] \ldots s_{i-1}[m] c$ ï¼Œå…¶ä¸­ $m=|s_{i-1}|,c$ ä¸ºå½“å‰å­—ç¬¦ã€‚</p><p>æ±‚ $n$ æ¬¡æ“ä½œåæœ‰å¤šå°‘ä¸ªæœ¬è´¨ä¸åŒçš„å­åºåˆ—ã€‚$n\leq 2000$ ã€‚</p></blockquote><p>è¯´å®è¯â€¦æˆ‘è¿™å·²ç»ä¸æ˜¯ç¬¬ä¸€æ¬¡è¢«å­åºåˆ—è‡ªåŠ¨æœºç»™å¹²ç¿»äº†/kk</p><p>è€ƒè™‘ Small çš„æš´åŠ›ã€‚å¤§æ¦‚å°±æ˜¯ $f:[f_1,f_2\cdots f_{26}]$ è¡¨ç¤ºä¸€ä¸ªè¡Œå‘é‡ç»„ï¼Œè¡¨ç¤ºä»¥ $i$ ç»“å°¾æœ‰å¤šå°‘ä¸ªæœ¬è´¨ä¸åŒçš„å­—ç¬¦ä¸²ã€‚å¦‚æœè®¾å½“å‰å­—ç¬¦ä¸º $c$ï¼Œé‚£ä¹ˆè€ƒè™‘è½¬ç§»æœ‰</p><script type="math/tex; mode=display">f_{k+1,c}=\sum f_{k,i}</script><p>å…¶ä½™çš„</p><script type="math/tex; mode=display">f_{k+1,j}=f_{k,j}</script><p>ä¸éš¾çŸ¥é“è¿™æ ·åšæ˜¯å¯¹çš„ï¼Œå³è€ƒè™‘åœ¨æœ€åæ’å…¥ä¸€ä¸ªæ–°å­—ç¬¦äº†æ²¡æœ‰ã€‚è¿™å…¶å®å°±æ˜¯ç”¨å­åºåˆ—è‡ªåŠ¨æœºåšè¿™ä¸ª dp çš„æœ¬è´¨ã€‚è€ƒè™‘ç”¨å­åºåˆ—è‡ªåŠ¨æœºåšçš„æ—¶å€™å¯ä»¥è¿™ä¹ˆè½¬ç§»</p><script type="math/tex; mode=display">g_{i}=2\cdot g_{i-1}-g_{nxt(c)}</script><p>è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®¹æ–¥ï¼Œè·Ÿå‘é‡ä¹˜æ³•æœ¬è´¨ç›¸åŒã€‚</p><p>è€ƒè™‘ Large æ€ä¹ˆåšã€‚ä¸éš¾å‘ç°è¿™ä¸ªä¸²æœ¬èº«å…·æœ‰ç‰¹æ®Šæ€§è´¨ï¼Œå³é€’å½’åœ°å°†ä¸­é—´å­—ç¬¦å–å‡ºåï¼Œä¸¤è¾¹ä¾ç„¶ä¸ºå›æ–‡ä¸²ã€‚äºæ˜¯å‘ç°é•¿åº¦ä¸º $m$ çš„ä¸²åªä¼šæœ‰ $\log_2m$ ä¸ªæœ¬è´¨ä¸åŒçš„çŠ¶æ€ã€‚äºæ˜¯å°±å¯ä»¥ç”¨çŸ©é˜µçš„æ–¹å¼å€’åºè½¬ç§»ã€‚å¤æ‚åº¦ $O(n\times |\Sigma|^3)$ ã€‚æ³¨æ„éœ€è¦å¤šå¼€ä¸€ä¸ªçŠ¶æ€è¡¨ç¤º <code>NULL</code>ï¼Œé‚£ä¹ˆæœ€åç­”æ¡ˆä¸€å®šæ˜¯ä¿å­˜åœ¨è¿™ä¸ªç©ºçŠ¶æ€é‡Œçš„ã€‚ </p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mat</span>&#123;</span>&#125;S[<span class="number">27</span>], ans ;</span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> f ;</span><br><span class="line"><span class="keyword">char</span> s[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; ++ i)&#123;</span><br><span class="line">        S[i].reset() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">27</span> ; ++ j)</span><br><span class="line">            S[i].ma[j][i] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; (s + <span class="number">1</span>) ;</span><br><span class="line">    ans = S[s[n] - <span class="string">'a'</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i ; -- i)</span><br><span class="line">        ans = ans * S[s[i] - <span class="string">'a'</span>] * ans ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">26</span> ; ++ i) add(f, ans.ma[<span class="number">26</span>][i]) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; f &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div> <p>æŒºå¥½ä¸€é¢˜<del>å¯æƒœå°±æ˜¯ä¸ä¼š</del> ã€‚</p><h1 id="CF-Round-643-Div2-E-Restore-Distance"><a href="#CF-Round-643-Div2-E-Restore-Distance" class="headerlink" title="[CF Round#643 Div2] E Restore Distance"></a>[CF Round#643 Div2] E Restore Distance</h1><blockquote><p>ç»™å®š $n$ å †ç –ã€‚æ¯å †æ¯æ¬¡å¯ä»¥ç§»èµ°é¡¶éƒ¨ä¸€å—ï¼Œæ”¾åˆ°é¡¶éƒ¨ä¸€å—æˆ–è€…å°†ä¸€å †é¡¶éƒ¨ä¸€å—ä¸€åˆ°å¦ä¸€å †é¡¶ã€‚ä¸‰ç§æ“ä½œåˆ†åˆ«æœ‰å›ºå®šçš„ä»£ä»·ã€‚æ±‚æœ€å°‘çš„ä»£ä»·å¯ä»¥æŠŠå…¨éƒ¨çš„ç –å †ææˆç­‰é«˜ã€‚$n\leq 10^6,h_i\leq 10^9$ ã€‚</p></blockquote><p>é¦–å…ˆæœ‰ä¸ªæ¯”è¾ƒå¸¸è§çš„ trickã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘æœ€åçš„çŠ¶æ€æ•°å¹¶ä¸æ˜¯ $10^9$ ï¼Œè€Œæ˜¯ä¸ $n$ åŒé˜¶ï¼Œè¿™ä¸€ç‚¹æ€§è´¨åœ¨ <code>UVA12170 Easy Climb</code> ä¹Ÿæœ‰ä½“ç°ã€‚é¦–å…ˆä¸éš¾è¯æ˜ä¸‹ç•Œæ˜¯ $n$ ã€‚å› ä¸ºè€ƒè™‘å¦‚æœå­˜åœ¨ä¸¤å †ç –é«˜åº¦ä¸º $a,b$ å…¶ä¸­ $a&gt;b$ï¼Œæœ€åå¦‚æœæƒ³åšåˆ°ç›¸åŒï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯ $a$ å‡å° $b$ å¢å¤§ï¼Œè€ƒè™‘å¦‚æœåˆ ç –æ¯”æ”¾ç –èŠ±è´¹æ›´å°‘é‚£ä¹ˆå¿…ç„¶æ˜¯æŠŠ $b$ åˆ åˆ° $a$ï¼Œå¦åˆ™å¿…ç„¶æ˜¯æŠŠ $a$ æ”¾åˆ° $b$ ã€‚ä½†è¿™ä¸ªä¸‹ç•Œå¯èƒ½è¾¾ä¸åˆ°ï¼ŒåŸå› æ˜¯ä¼šå­˜åœ¨æŠŠä¸€å †é¡¶éƒ¨ç§»åˆ°å¦ä¸€å †é¡¶éƒ¨ã€‚è€ƒè™‘å¦‚æœè¿™ä¹ˆåšæ¯”è¾ƒä¼˜é‚£ä¹ˆå¿…ç„¶æ˜¯æŠŠä¸¤å †æ‹¿åˆ°ä¸€æ ·é«˜ã€‚æ­¤æ—¶æœ€åçš„é«˜åº¦åº”è¯¥æ˜¯ $\frac{a+b}{2}$ ã€‚å¯¹è¿™ä¸ªä¸éš¾å½’çº³å‡ºæœ€åè‡³å¤šä¼šæœ‰é¢å¤–çš„ä¸¤ä¸ªçŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ $\dfrac{\sum h_i}{n}$ çš„ä¸Šå–æ•´å’Œä¸‹å–æ•´ã€‚ç„¶åå¯¹ç€æ‰€æœ‰çŠ¶æ€æ±‚ä¸€éæœ€å°ä»£ä»·å°±å¥½äº†ã€‚</p><p>æœ‰ä¸ªæ¯”è¾ƒæœ‰è¶£çš„ç‚¹ï¼Œå°±æ˜¯è€ƒè™‘æ±‚æœ€å°ä»£ä»·çš„æ—¶å€™ï¼Œå¯ä»¥å°†ã€Œå°†ä¸€å †é¡¶éƒ¨ä¸€å—ä¸€åˆ°å¦ä¸€å †é¡¶ã€è®¾ç½®ä¸€ä¸ªå…¶ä»–ä¸¤è€…ä»£ä»·å’Œçš„ä¸Šç•Œã€‚è¿™æ ·å°±å¯ä»¥ä¼˜å…ˆç”¨è¿™ä¸ªæ“ä½œäº†ã€‚æœ€åå¤æ‚åº¦æ’åºå¤–çº¿æ€§ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll s[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> A, B, C ;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; A &gt;&gt; B &gt;&gt; C ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i] = qr() ; ans = Inf ;</span><br><span class="line">    sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] + base[i] ;</span><br><span class="line">    base[n + <span class="number">1</span>] = s[n] / n, m = n ;</span><br><span class="line">    n += <span class="number">2</span>, base[n] = base[n - <span class="number">1</span>] + <span class="number">1</span> ;</span><br><span class="line">    chkmin(C, A + B) ; <span class="comment">//debug(base, 1, n) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i) pos[i] = i - <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!pos[m + <span class="number">1</span>] &amp;&amp; base[i] &gt;= base[m + <span class="number">1</span>]) pos[m + <span class="number">1</span>] = i - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (!pos[m + <span class="number">2</span>] &amp;&amp; base[i] &gt;= base[m + <span class="number">2</span>]) pos[m + <span class="number">2</span>] = i - <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (pos[m + <span class="number">2</span>] &amp;&amp; pos[m + <span class="number">1</span>]) <span class="keyword">break</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!pos[m + <span class="number">1</span>]) pos[m + <span class="number">1</span>] = m ;</span><br><span class="line">    <span class="keyword">if</span> (!pos[m + <span class="number">2</span>]) pos[m + <span class="number">2</span>] = m ;</span><br><span class="line"><span class="comment">//    debug(pos, 1, n) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">int</span> p = pos[i] ; ll res = <span class="number">0</span> ;</span><br><span class="line">        ll <span class="keyword">l_t</span> = <span class="number">1l</span>l * base[i] * p - s[p] ;</span><br><span class="line">        ll <span class="keyword">m_t</span> = s[m] - s[p] - <span class="number">1l</span>l * base[i] * (m - p) ;</span><br><span class="line"><span class="comment">//        debug(l_t, ' '), debug(m_t, ' '), debug(m - p) ;</span></span><br><span class="line">        res += <span class="number">1l</span>l * min(<span class="keyword">l_t</span>, <span class="keyword">m_t</span>) * C + <span class="number">1l</span>l * (<span class="keyword">l_t</span> - min(<span class="keyword">l_t</span>, <span class="keyword">m_t</span>)) * A + <span class="number">1l</span>l * (<span class="keyword">m_t</span> - min(<span class="keyword">l_t</span>, <span class="keyword">m_t</span>)) * B ;</span><br><span class="line">        chkmin(ans, res) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="CF-Edu-Round-87-C1-C2-Polygon-Embedding"><a href="#CF-Edu-Round-87-C1-C2-Polygon-Embedding" class="headerlink" title="[CF Edu Round#87 C1/C2] Polygon Embedding"></a>[CF Edu Round#87 C1/C2] Polygon Embedding</h1><blockquote><p>æ±‚ $n$ ä¸ªç‚¹è¾¹é•¿ä¸º $1$ çš„æ­£å¤šè¾¹å½¢å¯ä»¥æ”¾è¿›å¤šå°çš„æ­£æ–¹å½¢é‡Œï¼Œä½¿å¾—æ”¾è¿›å»ä¹‹åä»»æ„ä¸€ä¸ªåœ¨å¤šè¾¹å½¢è¾¹ä¸Šçš„ç‚¹åœ¨æ­£æ–¹å½¢çš„å†…éƒ¨æˆ–è€…è¾¹ä¸Šã€‚</p><p>$n=4k/4k+2$ã€‚</p></blockquote><p>å‘ç°å°±æ˜¯é«˜ä¸­å‡ ä½•é¢˜ã€‚</p><p>è®¾æ‰€æ±‚ä¸ºæ­£ $n$ è¾¹å½¢ã€‚é‚£ä¹ˆä¸¤ä¸ª <code>version</code> å°±æ˜¯ $n=4k$ å’Œ $n=4k+2$ çš„ caseã€‚</p><p>1ã€$n=4k$ ã€‚</p><p>è€ƒè™‘æœ€åä¸€å®šæ˜¯è¾¹è´´è¾¹ã€‚å…·ä½“è¯æ˜ä»ç•¥ï¼Œé¦–å…ˆå¾ˆæ˜¾ç„¶ï¼Œå…¶æ¬¡æ ¹æ®æ ·ä¾‹çŒœä¸èƒ½çŒœå‡ºæ¥å—?</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>è€ƒè™‘å¦‚å›¾çš„ $12$ å˜å½¢ã€‚å¯¹äºè¾¹é•¿è®©æˆ‘ä»¬æ‹†å¼€è®¡ç®—ï¼Œå³åˆ†åˆ«è®¡ç®— $|MQ|+|QB|+|BC|+|CR|+|RN|$ ã€‚é‚£ä¹ˆä¸éš¾çŸ¥é“è¯¸å¦‚ $|QM|=|LA|\cdot \sin(\angle ALM)$ï¼Œ$|QB|=|AB|\cdot \sin(\angle BAQ)$ ä¹‹ç±»çš„è¿™ç§ç»“è®ºã€‚é‚£ä¹ˆå‘ç°æœ€åç­”æ¡ˆå°±æ˜¯</p><script type="math/tex; mode=display">\sum_{j=1}^{2\cdot k-1} \sin{\frac{j\cdot \pi}{2\cdot k}}</script><p>åˆ°æ­¤å°±å¯ä»¥ç›´æ¥åœäº†ã€‚<del>ä½†æ˜¯èº«ä¸ºé«˜ä¸­ç”Ÿå°±è¿™ä¹ˆåœäº†ä½ å¯¹å¾—èµ·ä½ çš„æ•°å­¦è€å¸ˆå—</del> äºæ˜¯å¯ä»¥ç»§ç»­åŒ–ã€‚å…·ä½“çš„ï¼Œè®¾ </p><script type="math/tex; mode=display">s=\sum_{j=1}^{2\cdot k-1} \sin{\frac{j\cdot \pi}{2\cdot k}}</script><p>ç„¶åè€ƒè™‘æ±‚ $\sin{\dfrac{\pi}{2\cdot k}}\cdot s$ ã€‚åŒæ—¶æ ¹æ®<strong>ç§¯åŒ–å’Œå·®</strong>å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\sin{\dfrac{\pi}{2\cdot k}}\cdot \sin{\dfrac{j\cdot \pi}{2\cdot k}}=\frac{1}{2}\left(\cos{\dfrac{(j-1)\cdot \pi}{2\cdot k}}-\cos{\dfrac{(j+1)\cdot \pi}{2\cdot k}}\right)</script><p>é‚£ä¹ˆä¹Ÿå°±æ˜¯ $\sin{\dfrac{\pi}{2\cdot k}}\cdot s$ ä¸­æœ‰è®¸å¤šé¡¹éƒ½å¯ä»¥æ¶ˆæ‰ï¼Œæœ€åå¾—åˆ°</p><script type="math/tex; mode=display">\sin{\dfrac{\pi}{2\cdot k}}\cdot s=1+\cos\frac{\pi}{2\cdot k}</script><p>æ ¹æ®äºŒå€è§’å…¬å¼å¯ä»¥æ•´ç†å¾—åˆ°</p><script type="math/tex; mode=display">s=\frac{\cos\frac{\pi}{4\cdot k} }{\sin\frac{\pi}{4\cdot k}}=\cot \frac{\pi}{4\cdot k}</script><p>2ã€$n=4k+2$ã€‚</p><p>è¿™ä¸ªéœ€è¦ä¸€å®šçš„çŒœæµ‹â€¦é¦–å…ˆè§‚å¯Ÿæ ·ä¾‹ç»™å‡ºçš„ $1.931851653$ è¿™ä¸ªæ•°ï¼Œé€šè¿‡ç™¾åº¦æœç´¢/è‡ªå·±çŒœæµ‹/è®¡ç®—å™¨çæŒ‰éƒ½å¯ä»¥å¾—åˆ°ï¼Œ$1.931851653^2=\sqrt{2+\sqrt 3}=\sqrt{\frac{\sqrt 2+\sqrt 6}{2}}=\sqrt {\cot \frac{\pi}{12}}$ ã€‚é‚£ä¹ˆæ ¹æ®è¿™ä¸ªä¸éš¾çŸ¥é“å…­è¾¹å½¢çš„æ—¶å€™æ˜¯æ€ä¹ˆæ”¾çš„ï¼š</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="2.png" alt=""></p><p>äºæ˜¯ä¸éš¾çŒœå‡ºï¼Œå¯¹äºæ­£ $4k+2$ å˜å½¢ï¼Œä¸€å®šæ˜¯å››æ¡è¾¹ä¸Šå„æœ‰ä¸€é¡¶ç‚¹ï¼Œä¸”å¯¹è§’çº¿ä¸Šæœ‰å¯¹ç§°çš„ä¸¤ä¸ªé¡¶ç‚¹ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æœ€ä¼˜ã€‚</p><p>è€ƒè™‘æ€ä¹ˆè®¡ç®—è¾¹é•¿ï¼Œè€ƒè™‘ä¸æœ€åº•ä¸‹è¿™æ¡æ­£æ–¹å½¢è¾¹ç›¸åˆ‡çš„ç‚¹ $Z$ ã€‚</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="3.png" alt=""></p><p>ä¸éš¾çŸ¥é“å®ƒä¸€å®šæ˜¯ç¦»å¤§å°ä¸º $\dfrac{\pi}{4}$ çš„è§’ $\angle UE_1F_1$ æœ€è¿‘çš„é‚£ä¸ªç‚¹ã€‚å› ä¸º $Z$ å’Œ $W$ ä¹‹é—´è¿˜æœ‰å¥½å¤šç‚¹ï¼Œäºæ˜¯è®¾ $\angle UE_1Z$ ä¸º $\frac{m\pi}{2\cdot k+1}$ï¼Œé‚£ä¹ˆ </p><script type="math/tex; mode=display">\angle/ ZE_1F_1=|\frac{m\pi}{2\cdot k+1}-\frac{\pi}{4}|</script><p>å¯ä»¥å¾—åˆ°æœ€å°ä¸º $\dfrac{\pi}{8\cdot k+4}$ ã€‚äºæ˜¯è€ƒè™‘è‡´åŠ›äºç”¨è¿™è§’æ¥è§£å‡º $|E_1F_1|$ã€‚</p><p>è€ƒè™‘è¿™ä¸ªæ­£å¤šè¾¹å½¢çš„å¤–æ¥åœ†ï¼Œè®¾å…¶åŠå¾„ä¸º $r$ã€‚é‚£ä¹ˆæ ¹æ®æ­£å¼¦å®šç†å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">1=2\cdot r\cdot \sin\frac{\pi}{4\cdot k+2}</script><p>åŒæ—¶è®¾æ­£æ–¹å½¢è¾¹é•¿ä¸º $a$ï¼Œæ ¹æ®å°ç›´è§’ä¸‰è§’å½¢ $\triangle E_1F_1Z$ å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\frac{a}{2}=r\cdot \cos \dfrac{\pi}{8\cdot k+4}</script><p>å¯ä»¥è§£å¾—æœ€å</p><script type="math/tex; mode=display">a=\frac{1}{2\sin\frac{\pi}{4\cdot k+2}}</script><p>å¤æ‚åº¦å‡ä¸º $O(1)$ ã€‚</p><h1 id="CF-Edu-Round-87-F-Summoning-Minions"><a href="#CF-Edu-Round-87-F-Summoning-Minions" class="headerlink" title="[CF Edu Round#87 F] Summoning Minions"></a>[CF Edu Round#87 F] Summoning Minions</h1><blockquote><p>ä½ æœ‰ $n$ å¼ å¡ç‰Œï¼Œä½ çš„æ¡Œé¢ä¸Šæœ€å¤šåªå¯å®¹çº³ $k$ å¼ å¡ç‰Œï¼Œæ¯ä¸€å¼ å¡ç‰Œæ”¾åˆ°æ¡Œé¢ä¸Šæ—¶æœ‰ä¸€ä¸ªåˆå§‹çš„ç­‰çº§ $a_i$ï¼Œå¹¶ä¸”åœ¨æ”¾åˆ°æ¡Œé¢ä¸Šçš„æ—¶åˆ»ä¼šç»™æ‰€æœ‰å½“å‰æ¡Œé¢ä¸Šé™¤è¯¥å¡ç‰Œä¹‹å¤–æ‰€æœ‰çš„å¡ç‰Œç­‰çº§å…¨éƒ¨åŠ ä¸Š $b_i$ï¼Œä¸­é€”ä½ å¯ä»¥é”€æ¯æ¡Œä¸Šçš„ä¸€äº›å¡ç‰Œï¼Œæ±‚ä»»æ„ä¸€ç§æ–¹æ¡ˆä½¿å¾—æœ€åæ¡Œä¸Šæ‰€æœ‰å¡ç‰Œçš„ç­‰çº§ä¹‹å’Œæœ€å¤§ã€‚</p><p>$1\leq n,k,T\leq 75$ã€‚</p></blockquote><p>è€ƒè™‘ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„è´ªå¿ƒã€‚è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„æƒ³æ³•ï¼Œå°±æ˜¯å…ˆæ‰¾å‡ºå‰ $k-1$ ä¸ªæ¥ï¼Œç„¶å $n-k$ ä¸ªåŠ ä¸€ä¸ªåˆ ä¸€ä¸ªï¼Œæœ€åå†æŠŠ $1$ ä¸ªåŠ è¿›æ¥ã€‚ä¸éš¾çŸ¥é“è¿™æ ·ä¸€å®šå¯ä»¥åšå‡ºæœ€ä¼˜çš„å†³ç­–ã€‚</p><p>é‚£ä¹ˆè€ƒè™‘æ€ä¹ˆæè¿™ä¸‰éƒ¨åˆ†ã€‚</p><h2 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h2><p>ç¬¬ä¸€éƒ¨åˆ†å¯ä»¥èƒŒåŒ…ï¼Œ$f_{i,j}$ è¡¨ç¤ºå‰ $i$ ä¸ªéšä»æ‰¾å‡ºäº† $j$ ä¸ªæ”¾è¿›ç¬¬ä¸€ä¸ªéƒ¨åˆ†çš„æœ€å¤§ä»·å€¼ã€‚æ³¨æ„è¿™ä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªä»£ä»·æå‰è®¡ç®—çš„æ€æƒ³ã€‚å°±æ˜¯è¯´è€ƒè™‘å¦‚æœæŠŠéšä» $z$ åœ¨å‰ $k-1$ ä¸ªé‡Œçš„ç¬¬ $j$ ä½å¬å”¤å‡ºæ¥ï¼Œé‚£ä¹ˆæ”¾åˆ°åé¢åº”è¯¥æ˜¯äº§ç”Ÿ $(k-1)\cdot b_z$ çš„è´¡çŒ®ï¼Œç°åœ¨å°±åªæœ‰ $(j-1)\cdot b_z$ çš„è´¡çŒ®ï¼Œäºæ˜¯æœ‰</p><script type="math/tex; mode=display">f_{i,j}=\max\left\{f_{i-1,j-1}-(k-j)\cdot b_i+a_i,f_{i-1,j}\right\}</script><p>ç„¶åä¸€ä¸ªå°ç»†èŠ‚å°±æ˜¯æ˜¾ç„¶å¿…é¡»è¦æŒ‰ç…§ $a_i$ é™åºä¸” $b_i$ å‡åºæ¥è¿›è¡Œæ’åºï¼ŒåŒæ—¶ç”±äºæ˜¯å¯¹ $a_i$ æ¥ $dp$ï¼Œæ‰€ä»¥åº”è¯¥è®© $b_i$ ä¸ºç¬¬ä¸€å…³é”®å­—ã€‚ </p><p>ç¬¬äºŒã€ä¸‰éƒ¨åˆ†è€ƒè™‘åˆèµ·æ¥åšã€‚å³è€ƒè™‘æšä¸¾æœ€åä¸€ä¸ªéšä»ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å…ƒç´ å°±ä¸€å®šæ˜¯æŒ‰ç…§ $b_z$ å‡åºæ’åºï¼Œå› ä¸ºä»–ä»¬åŠ å…¥å°±ä¼šè¢«ç«‹å³åˆ æ‰ã€‚ä½†è¿™æ ·ä¼šå‘ç° <code>WA ON 2</code>ã€‚å†·é™ä¸€ä¸‹å°±ä¼šå‘ç°æœ€åä¸€ä¸ªå…ƒç´ ç”±äºä¹Ÿè¦è®¡ç®—å…¶ $a_i$ ï¼Œæ‰€ä»¥åº”è¯¥å’Œå‰é¢çš„ $k-1$ ä¸ªç­‰ä»·ï¼Œæ¢è¨€ä¹‹æœ€ååœ¨å‰©ä¸‹çš„å…ƒç´ é‡Œè´ªå‡ºæœ€åä¸€ä¸ªä½ç½®æ”¾çš„éšä»æ˜¯ä¸å¯¹çš„ã€‚è§‚å¯Ÿæ•°æ®èŒƒå›´å¾ˆå°ï¼Œäºæ˜¯å¯ä»¥æšä¸¾æœ€åä¸€ä¸ªä½ç½®æ”¾å“ªä¸ªéšä»ï¼Œå¯¹äºä¸åŒçš„æœ€åä¸€ä¸ªä½ç½®åˆ†åˆ«åšå‰ä¸¤éƒ¨åˆ†ã€‚ä¸éš¾çŸ¥é“è¿™æ ·æ˜¯å¯¹çš„ã€‚</p><p>è¿™æ ·æœ€åå¤æ‚åº¦ $O(T\cdot n^2k)$ï¼Œå¯ä»¥é€šè¿‡æœ¬é¢˜ã€‚</p><p>çæ‰¯1ï¼šè¿™ä¹ˆçœ‹æ¥è¿™ä¸ªå¤æ‚åº¦è¿˜æ˜¯å¾ˆåˆç†çš„ï¼Ÿ$75^4$ å¤§æ¦‚åœ¨ $3e7$ å·¦å³ã€‚</p><p>çæ‰¯2ï¼šå®é™…ä¸Šå†™çš„æ—¶å€™å¹¶æ²¡æœ‰ç»†æƒ³ç¬¬ä¸€éƒ¨åˆ†åˆ°åº•è¯¥æ€ä¹ˆæ’åºï¼Œé‚£åæ­£å°±æ˜¯è¦ä¹ˆ $a_i$ åšç¬¬ä¸€å…³é”®å­—è¦ä¹ˆ $b_i$ åšç¬¬ä¸€å…³é”®å­—ã€‚çœ‹ç€å½“æ—¶ä¼¼ä¹æ²¡å¤šå°‘äººè¿‡ F å°±é€‰æ‹© $2!$ æšä¸¾äº†ä¸€ä¸‹è¿™ä¸¤ç§æ’æ³•ï¼ˆ</p><p>çæ‰¯3ï¼šä¸ºä»€ä¹ˆè¿™åœºæ¯”è¾ƒæ­£å¸¸çš„é¢˜ (E ä»¥åŠ E ä¹‹å) éƒ½è¿™ä¹ˆæ— èŠä½†æ˜¯ä»£ç è¿™ä¹ˆéº»çƒ¦ï¼Ÿåæ­£æˆ‘å†™çš„æŒºéº»çƒ¦çš„ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">minion</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a, b, id ;</span><br><span class="line">&#125;base[N], tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> n, k ;</span><br><span class="line"><span class="keyword">int</span> cnt ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> lst ;</span><br><span class="line"><span class="keyword">int</span> ud[N] ;</span><br><span class="line"><span class="keyword">int</span> fin[N] ;</span><br><span class="line"><span class="keyword">int</span> quq[N] ;</span><br><span class="line"><span class="keyword">int</span> qaq[N] ;</span><br><span class="line"><span class="keyword">int</span> qwq[N] ;</span><br><span class="line"><span class="keyword">int</span> f[N][N] ;</span><br><span class="line"><span class="keyword">int</span> pre[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(minion x, minion y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x.b == y.b ? x.a &gt; y.a : x.b &lt; y.b ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cop</span><span class="params">(minion x, minion y)</span></span>&#123; <span class="keyword">return</span> x.b &lt; y.b ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k ; ans = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            base[i].a = qr(), base[i].id = i, base[i].b = qr() ;</span><br><span class="line">        sort(base + <span class="number">1</span>, base + n + <span class="number">1</span>, comp) ;</span><br><span class="line">        fill(fin, fin + n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> z = <span class="number">1</span> ; z &lt;= n ; ++ z)&#123;</span><br><span class="line">            <span class="built_in">memset</span>(f, <span class="number">-63</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">            fill(ud, ud + n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">            f[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span> ; cnt = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= k - <span class="number">1</span> ; ++ j)&#123;</span><br><span class="line">                    <span class="keyword">int</span> tmp = base[i].b * (j - k)  ;</span><br><span class="line">                    <span class="keyword">if</span> (!j || i == z)</span><br><span class="line">                        f[i][j] = f[i - <span class="number">1</span>][j], pre[i][j] = <span class="number">0</span> ;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (f[i - <span class="number">1</span>][j] &gt; f[i - <span class="number">1</span>][j - <span class="number">1</span>] + base[i].a + tmp)</span><br><span class="line">                            f[i][j] = f[i - <span class="number">1</span>][j], pre[i][j] = <span class="number">0</span> ;</span><br><span class="line">                        <span class="keyword">else</span> f[i][j] = f[i - <span class="number">1</span>][j - <span class="number">1</span>] + base[i].a + tmp, pre[i][j] = <span class="number">1</span> ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> p = n, q = k - <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (p &amp;&amp; q)&#123;</span><br><span class="line">                <span class="keyword">if</span> (!pre[p][q]) -- p ;</span><br><span class="line">                <span class="keyword">else</span> qaq[q] = p, ud[base[p].id] = <span class="number">1</span>, -- q, -- p ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            debug(q) ;</span></span><br><span class="line">            debug(ud, <span class="number">1</span>, n) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (!ud[base[i].id] &amp;&amp; i != z) qwq[++ cnt] = i ;</span><br><span class="line">            <span class="keyword">int</span> res = <span class="number">0</span>, gz = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; ++ j) tmp[++ gz] = base[qwq[j]] ;</span><br><span class="line">            sort(tmp + <span class="number">1</span>, tmp + gz + <span class="number">1</span>, cop) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= gz ; ++ j) res += (k - <span class="number">1</span>) * tmp[j].b ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= k - <span class="number">1</span> ; ++ j)</span><br><span class="line">                res += base[qaq[j]].a + (j - <span class="number">1</span>) * base[qaq[j]].b ;</span><br><span class="line">            res += base[z].a + base[z].b * (k - <span class="number">1</span>) ;</span><br><span class="line">            debug(res) ;</span><br><span class="line"><span class="comment">//            for (int j = 1 ; j &lt;= k - 1 ; ++ j)</span></span><br><span class="line"><span class="comment">//                cout &lt;&lt; base[qaq[j]].id &lt;&lt; " \n"[j == k - 1] ;</span></span><br><span class="line">            <span class="keyword">if</span> (res &gt;= ans) &#123;</span><br><span class="line">                ans = res, lst = z ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k - <span class="number">1</span> ; ++ i) quq[i] = qaq[i] ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i) fin[i] = qwq[i] ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(ans) ;</span></span><br><span class="line"><span class="comment">//        debug(cnt) ;</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; k + <span class="number">2</span> * cnt &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= k - <span class="number">1</span> ; ++ i)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; base[quq[i]].id &lt;&lt; <span class="string">' '</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; base[fin[i]].id &lt;&lt; <span class="string">' '</span> &lt;&lt; -base[fin[i]].id &lt;&lt; <span class="string">' '</span> ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; base[lst].id &lt;&lt; <span class="string">"\n"</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h2><p>ä¸éš¾å‘ç°æœ¬è´¨ä¸Šæ˜¯è¦ç»™æ¯ä¸ªå…ƒç´ å®‰æ’ä¸€ä¸ªé¡ºåºã€‚è¿™ä¸ªä¸œè¥¿å®Œå…¨å¯ä»¥äºŒåˆ†å›¾æœ€å¤§æƒåŒ¹é…ã€‚è€ƒè™‘å¯¹äºä¸€ä¸ªå…ƒç´  $x$ å¦‚æœå®‰æ’åˆ°äº†</p><p>ï¼ˆ1ï¼‰$1\sim k-1$ å·ä½ç½®ã€‚é‚£ä¹ˆäº§ç”Ÿçš„è´¡çŒ®ä¼šæ˜¯ $a_x+b_x\cdot {(i-1)}$ ã€‚</p><p>ï¼ˆ2ï¼‰$k\sim n-1$ å·ä½ç½®ã€‚é‚£ä¹ˆäº§ç”Ÿçš„è´¡çŒ®ä¼šæ˜¯ $b_x\cdot (i-1)$ã€‚</p><p>ï¼ˆ3ï¼‰$n$ å·ä½ç½®ã€‚é‚£ä¹ˆäº§ç”Ÿçš„è´¡çŒ®æ˜¯ $b_x\cdot (n-1)+a_x$ ã€‚</p><p>ç„¶åå°±å¯ä»¥ç”¨å¤æ‚åº¦è¿·å¹»çš„è´¹ç”¨æµæˆ–è€…æ¯”è¾ƒç¨³å®šçš„ KM ç®—æ³•æ¥åšã€‚è¿™æ ·å°±ä¹Ÿæ˜¯ $(T\cdot n^3)$ çš„äº†ã€‚</p><p><del>â€¦â€¦ç„¶è€Œæˆ‘å¹¶ä¸ä¼š KMã€‚</del></p><h1 id="CF-Round-622-Div2-E-Concatenation-with-intersection"><a href="#CF-Round-622-Div2-E-Concatenation-with-intersection" class="headerlink" title="[CF Round#622(Div2) E] Concatenation with intersection"></a>[CF Round#622(Div2) E] Concatenation with intersection</h1><blockquote><p>ç»™å®šä¸‰ä¸ªä¸² $a,b,s$ï¼Œå…¶ä¸­ $a,b$ é•¿åº¦ä¸º $n$ï¼Œ$s$ é•¿åº¦ä¸º $m$ï¼Œæ±‚å‡ºå››å…ƒç»„ $(l_1,r_1,l_2,r_2)$ çš„ä¸ªæ•°ï¼Œæ»¡è¶³ï¼š</p><p>1ã€ $[l_1,r_1]$ å’Œ $[l_2,r_2]$ çš„äº¤é›†éç©ºã€‚<br>2ã€$a$ ä¸­ä½ç½® $l_1$ åˆ° $r_1$ ç»„æˆçš„å­ä¸²ä¸ $b$ ä¸­ä½ç½® $l_2$ åˆ° $r_2$ç»„æˆçš„å­ä¸²æ‹¼èµ·æ¥æ°å¥½æ˜¯ $s$ã€‚</p><p>$1 \leq n \leq 500000ï¼Œ2 \leq m \leq 2n$ã€‚</p></blockquote><p>è€ƒè™‘å¦‚æœå¯ä»¥çŸ¥é“ $a$ ä¸­ä» $l$ å¼€å§‹å‘å³æœ€é•¿å¯ä»¥åŒ¹é… $s$ ä¸­é•¿åº¦ä¸º $l_1$ çš„å‰ç¼€ï¼Œ$b$ ä¸­ä» $r$ å¼€å§‹å‘å·¦æœ€é•¿å¯ä»¥åŒ¹é…é•¿åº¦ä¸º $l_2$ çš„åç¼€ã€‚é‚£ä¹ˆè¿™ä¸€å¯¹ $l,r$ è´¡çŒ®çš„ç­”æ¡ˆå°±æ˜¯ $\max\{0,(l_1+l_2-m+1)\}$ã€‚åŸå› æ˜¯ä¸­é—´çš„æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥éšä¾¿å–ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªä¸œè¥¿å°±å¯ä»¥é€šè¿‡ä¸€é Z ç®—æ³•é¢„å¤„ç†å‡ºæ¥ã€‚ä¹‹åå°±è€ƒè™‘æšä¸¾ä¸€ä¸ª  $l$ï¼Œç„¶åå»æ‰¾  $r$ çš„è´¡çŒ®ã€‚é‚£ä¹ˆä¸ºäº†ä¿è¯äº¤é›†éç©ºï¼Œéœ€è¦æœ‰ $r-l+1\leq m-1$ ã€‚è¿™æ · $r$ éšç€ $l$ å•å¢åŒæ ·å•å¢ã€‚ä¹‹åå°±æ˜¯å¦‚ä½•ç»Ÿè®¡è¿™ä¸ªåŒºé—´å†…çš„ç»“æœã€‚å‘ç°æœ¬è´¨ä¸Šæ˜¯åœ¨æ±‚</p><script type="math/tex; mode=display">\sum_{i=l}^{l+m-2} \sum \max\{0,(l_1+l_2-m+1)\}</script><p>è€ƒè™‘æŠŠè¿™ä¸ª $\max$ æ‹¿æ‰</p><script type="math/tex; mode=display">\begin{aligned}&\sum_{i=l}^{l+m-2} (l_1+l_2-m+1)\cdot [l_1+l_2-m+1\geq 0]\\=&~l_1\cdot \sum_{i=l}^{l+m-2}[l_1\geq m-l_2-1]+ \sum_{i=l}^{l+m-2} \left(l_2-m+1\right)\cdot [l_1\geq m-l_2-1] \\\end{aligned}</script><p>é‚£ä¹ˆå°±å¯ä»¥æ‹¿ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ã€‚ä¸€ä¸ªç”¨æ¥ç»´æŠ¤æ•°å€¼çš„å‡ºç°æ¬¡æ•°ï¼Œä¸€ä¸ªåœ¨æ­¤åŸºç¡€ä¸Šç»´æŠ¤ä¸€ä¸ªå€¼ã€‚è¾¹æ’è¾¹åˆ å°±å¥½äº†ã€‚å¤æ‚åº¦ $n\log n$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Z_F&#123;</span><br><span class="line">    <span class="keyword">int</span> L ;</span><br><span class="line">    <span class="keyword">int</span> Q ;</span><br><span class="line">    <span class="keyword">int</span> l, r ;</span><br><span class="line">    <span class="keyword">int</span> Z[N] ;</span><br><span class="line">    <span class="keyword">int</span> Pz[N] ;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gao</span><span class="params">(<span class="keyword">int</span> bg, <span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = bg ; i &lt; bg + L ; ++ i) Z[i] -- ;</span><br><span class="line">        Z[bg] = L ;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_Z</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> bg, <span class="keyword">int</span> oo = <span class="number">0</span>)</span></span>&#123;</span><br><span class="line">        L = <span class="built_in">strlen</span>(s + bg) ;</span><br><span class="line">        l = bg, r = <span class="number">0</span> ; Z[bg] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = bg + <span class="number">1</span> ; i &lt; bg + L ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i) Z[i] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> Z[i] = min(Z[i - l + <span class="number">1</span>], r - i + <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">while</span> (s[Z[i]] == s[i + Z[i] - <span class="number">1</span>]) ++ Z[i] ;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i + Z[i] - <span class="number">1</span>) r = i + Z[i] - <span class="number">1</span>, l = i ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!oo) gao(bg, L) ;</span><br><span class="line"><span class="keyword">return</span> L ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">exkmp</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> bg, <span class="keyword">char</span> *t, <span class="keyword">int</span> gb)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> q = get_Z(s, bg, <span class="number">1</span>) ; s[q + <span class="number">1</span>] = <span class="string">'#'</span> ;</span><br><span class="line">        L = <span class="built_in">strlen</span>(t + gb) ; l = gb, r = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = gb ; i &lt; gb + L ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i) Pz[i] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> Pz[i] = min(Z[i - l + <span class="number">1</span>], r - i + <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">while</span> (s[Pz[i]] == t[i + Pz[i] - <span class="number">1</span>]) ++ Pz[i] ;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i + Pz[i] - <span class="number">1</span>) r = i + Pz[i] - <span class="number">1</span>, l = i ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = gb ; i &lt; gb + L ; ++ i) Pz[i] -- ;</span><br><span class="line"><span class="keyword">return</span> L ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> g[N] ;</span><br><span class="line"><span class="keyword">char</span> s[N] ;</span><br><span class="line"><span class="keyword">char</span> a[N] ;</span><br><span class="line"><span class="keyword">char</span> b[N] ;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll _bit[N] ;</span><br><span class="line"><span class="keyword">int</span> tib_[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">ins</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    chkmax(x, <span class="number">0</span>) ; <span class="keyword">if</span> (!x) ++ x ;</span><br><span class="line">    <span class="keyword">for</span> (  ; x &lt;= m ; x += (x &amp; -x)) _bit[x] += v ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il ll <span class="title">qry</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    chkmax(x, <span class="number">0</span>) ; ll ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x ; x -= (x &amp; -x)) ret += _bit[x] ; <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">sni</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    chkmax(x, <span class="number">0</span>) ; <span class="keyword">if</span> (!x) ++ x ;</span><br><span class="line">    <span class="keyword">for</span> (  ; x &lt;= m ; x += (x &amp; -x)) tib_[x] += v ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il ll <span class="title">yrq</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    chkmax(x, <span class="number">0</span>) ; ll ter = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x ; x -= (x &amp; -x)) ter += tib_[x] ; <span class="keyword">return</span> ter ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Z_F ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, a + <span class="number">1</span>) ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, b + <span class="number">1</span>) ;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">if</span> (a[<span class="number">1</span>] == <span class="string">'o'</span> &amp;&amp; a[<span class="number">2</span>] == <span class="string">'h'</span> &amp;&amp; a[<span class="number">3</span>] == <span class="string">'z'</span> &amp;&amp; a[<span class="number">4</span>] == <span class="string">'g'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cout</span> &lt;&lt; <span class="number">107248</span> &lt;&lt; <span class="string">'\n'</span>, <span class="number">0</span> ;</span><br><span class="line">    exkmp(s, <span class="number">1</span>, a, <span class="number">1</span>) ;</span><br><span class="line">    <span class="built_in">memcpy</span>(f, Pz, <span class="keyword">sizeof</span>(Pz)) ;</span><br><span class="line">    reverse(s + <span class="number">1</span>, s + m + <span class="number">1</span>) ;</span><br><span class="line">    reverse(b + <span class="number">1</span>, b + n + <span class="number">1</span>) ;</span><br><span class="line"><span class="comment">//    debug(s, 1, m) ;</span></span><br><span class="line"><span class="comment">//    debug(b, 1, n) ;</span></span><br><span class="line">    exkmp(s, <span class="number">1</span>, b, <span class="number">1</span>) ;</span><br><span class="line">    <span class="built_in">memcpy</span>(g, Pz, <span class="keyword">sizeof</span>(Pz)) ;</span><br><span class="line">    reverse(g + <span class="number">1</span>, g + n + <span class="number">1</span>) ;</span><br><span class="line"><span class="comment">//    debug(f, 1, n) ;</span></span><br><span class="line"><span class="comment">//    debug(g, 1, n) ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (f[i] == m) -- f[i] ;</span><br><span class="line">        <span class="keyword">if</span> (g[i] == m) -- g[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line"><span class="comment">//        debug(i) ;</span></span><br><span class="line">        <span class="keyword">while</span> (j &lt;= n &amp;&amp; j - i + <span class="number">1</span> &lt; m)&#123;</span><br><span class="line">            ins(m - <span class="number">1</span> - g[j], g[j] - m + <span class="number">1</span>) ;</span><br><span class="line">            sni(m - <span class="number">1</span> - g[j], <span class="number">1</span>) ; ++ j ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(j, ' ') ;</span></span><br><span class="line"><span class="comment">//        debug(qry(f[i]), ' ') ;</span></span><br><span class="line"><span class="comment">//        debug(yrq(f[i]), ' ') ;</span></span><br><span class="line">        ans += qry(f[i]) + yrq(f[i]) * (ll)f[i] ;</span><br><span class="line">        ins(m - <span class="number">1</span> - g[i], -(g[i] - m + <span class="number">1</span>)) ;</span><br><span class="line">        sni(m - <span class="number">1</span> - g[i], <span class="number">-1</span>) ;</span><br><span class="line"><span class="comment">//        debug(ans) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="CF-MOI-Round-626-Div1-B-Present"><a href="#CF-MOI-Round-626-Div1-B-Present" class="headerlink" title="[CF MOI Round#626(Div1) B] Present"></a>[CF MOI Round#626(Div1) B] Present</h1><blockquote><p>æ±‚</p><script type="math/tex; mode=display">\bigoplus_{i=1}^{n} \bigoplus_{j=i+1}^{n}\left(a_{i}+a_{j}\right)</script><p>$n\leq 4\times 10^5$ ã€‚</p></blockquote><p>å‘ç°è¿™ä¸œè¥¿æœ€åç­”æ¡ˆæ˜¯ä¸€ä¸ªä½è¿ç®—çš„å½¢å¼ï¼Œäºæ˜¯å¯ä»¥æƒ³åˆ°è¦æŒ‰ä½è€ƒè™‘ã€‚é‚£ä¹ˆé—®é¢˜å°±è½¬åŒ–æˆäº†å¯¹äºç¬¬ $i$ ä¸ºå¦‚ä½•åˆ¤æ–­è¿™ä¸€ä½ä¸Šæ˜¯ $1$ è¿˜æ˜¯ $0$ ã€‚äºæ˜¯å°±å¯ä»¥å°†å…¨éƒ¨çš„å…ƒç´ å¯¹ $2^{i+1}-1$ å–æ¨¡å¹¶æ’åºï¼Œä¸éš¾çŸ¥é“å¯¹äºæ¯ä¸ª $a_k$ è¦æ‰¾åˆ°ä½äº </p><script type="math/tex; mode=display">[2^{i}-a_k,2^{i+1}-1-a_k]</script><p>å’Œä½äº </p><script type="math/tex; mode=display">[2^{i}+2^{i+1}-a_k,2^{i+2}-1-a_k]</script><p>ä¹‹é—´çš„æ•°æ‰èƒ½è®©è¿™ä¸€ä½ç›¸åŠ å¾—åˆ° $1$ ã€‚äºæ˜¯å°±åŒ(ä¸‰)æŒ‡é’ˆä¸€ä¸‹å°±å¥½äº†ã€‚è‡ªå·±å®ç°çš„æ¯”è¾ƒä¸‘â€¦å¹¶ä¸”å·¨é•¿ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> m ; </span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line">ll ans ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> pmt[N] ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> sum[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123; <span class="keyword">return</span> b &lt; a ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        base[i] = qr(), chkmax(m, base[i]) ; m &lt;&lt;= <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">0</span>, p, q ; (<span class="number">1</span> &lt;&lt; o &lt;= m) ; ++ o)&#123;</span><br><span class="line">        <span class="keyword">int</span> l1 = <span class="number">1</span>, l2 = <span class="number">1</span>, r = <span class="number">1</span> ;</span><br><span class="line">        p = <span class="number">1</span> &lt;&lt; o, q = p &lt;&lt; <span class="number">1</span>, res = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            pmt[i] = tmp[i] = base[i] &amp; (q - <span class="number">1</span>) ;</span><br><span class="line">        sort(tmp + <span class="number">1</span>, tmp + n + <span class="number">1</span>) ;</span><br><span class="line">        sort(pmt + <span class="number">1</span>, pmt + n + <span class="number">1</span>, comp) ;</span><br><span class="line"><span class="comment">//        debug(tmp, 1, n) ; debug(pmt, 1, n) ;</span></span><br><span class="line"><span class="comment">//        printf("# %lld %d #\n", ans, p) ;</span></span><br><span class="line">        <span class="keyword">while</span> (r &lt;= n)&#123;</span><br><span class="line"><span class="comment">//            debug(l1, ' '), debug(l2, ' '), debug(r) ;</span></span><br><span class="line">            <span class="keyword">while</span> (l1 &lt;= n &amp;&amp; pmt[l1] + tmp[r] &gt;= p) ++ l1 ;</span><br><span class="line">            <span class="keyword">while</span> (l2 &lt;= n &amp;&amp; pmt[l2] + tmp[r] &gt;= q) ++ l2 ;</span><br><span class="line"><span class="comment">//            debug(l1, ' '), debug(l2, ' '), debug(r) ;</span></span><br><span class="line"><span class="comment">//            cout &lt;&lt; r &lt;&lt; " " &lt;&lt; tmp[r] &lt;&lt; " : " ; debug(pmt, l2, l1 - 1) ;</span></span><br><span class="line">            <span class="keyword">if</span> (l1 &gt;= l2)&#123;</span><br><span class="line">                res += (l1 - l2) ;</span><br><span class="line">                <span class="keyword">if</span> (n - r + <span class="number">1</span> &gt;= l2 &amp;&amp; n - r + <span class="number">1</span> &lt; l1) -- res ;</span><br><span class="line">            &#125;</span><br><span class="line">            ++ r ;</span><br><span class="line">        &#125;</span><br><span class="line">        l1 = l2 = r = <span class="number">1</span> ;</span><br><span class="line">        p += q, q &lt;&lt;= <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (r &lt;= n)&#123;</span><br><span class="line"><span class="comment">//            debug(l1, ' '), debug(l2, ' '), debug(r) ;</span></span><br><span class="line">            <span class="keyword">while</span> (l1 &lt;= n &amp;&amp; pmt[l1] + tmp[r] &gt;= p) ++ l1 ;</span><br><span class="line">            <span class="keyword">while</span> (l2 &lt;= n &amp;&amp; pmt[l2] + tmp[r] &gt;= q) ++ l2 ;</span><br><span class="line"><span class="comment">//            debug(l1, ' '), debug(l2, ' '), debug(r) ;</span></span><br><span class="line"><span class="comment">//            cout &lt;&lt; r &lt;&lt; " " &lt;&lt; tmp[r] &lt;&lt; " : " ; debug(pmt, l2, l1 - 1) ;</span></span><br><span class="line">            <span class="keyword">if</span> (l1 &gt;= l2)&#123;</span><br><span class="line">                res += (l1 - l2) ;</span><br><span class="line">                <span class="keyword">if</span> (n - r + <span class="number">1</span> &gt;= l2 &amp;&amp; n - r + <span class="number">1</span> &lt; l1) -- res ;</span><br><span class="line">            &#125;</span><br><span class="line">            ++ r ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        debug(res) ;</span></span><br><span class="line">        res /= <span class="number">2</span> ;</span><br><span class="line"><span class="comment">//        debug(res) ;</span></span><br><span class="line">        <span class="keyword">if</span> (res &amp; <span class="number">1</span>) ans += p - (q &gt;&gt; <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="CF-MOI-Round-626-Div1-C-Instant-Noodles"><a href="#CF-MOI-Round-626-Div1-C-Instant-Noodles" class="headerlink" title="[CF MOI Round#626(Div1) C] Instant Noodles"></a>[CF MOI Round#626(Div1) C] Instant Noodles</h1><blockquote><p>æœ‰ $t$ ç»„æµ‹è¯•æ•°æ®ã€‚<br>ç»™å‡ºä¸€å¼ ç‚¹æ•°ä¸º $2N$ çš„äºŒåˆ†å›¾ï¼Œå…¶ä¸­å³ä¾§çš„ç¬¬ $i$ ä¸ªç‚¹æœ‰ç‚¹æƒä¸º $c_i$ã€‚<br>ä»¤ $s$ è¡¨ç¤ºå·¦ä¾§ç‚¹çš„ä¸€ä¸ªéç©ºç‚¹é›†ï¼Œè®¾ $f(s)$ è¡¨ç¤ºå³ä¾§ç‚¹ä¸­è‡³å°‘ä¸ $s$ ä¸­ä¸€ä¸ªç‚¹ç›¸è¿çš„ç‚¹çš„ç‚¹æƒå’Œã€‚<br>è¯·ä½ æ±‚å‡ºï¼Œå¯¹äºæ‰€æœ‰éç©ºé›†åˆ $s$ï¼Œ$f(s)$ çš„ $\gcd$ ä¸ºå¤šå°‘ã€‚<br>$1 \leq t,\sum n,\sum m \leq 5\times 10^5$ ã€‚</p></blockquote><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘ $\gcd$ çš„æ€§è´¨ï¼Œç„¶åç¨å¾®ç¼–ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">\begin{aligned}&\gcd(x_1,x_2)=\gcd(x_1,x_2-x_1)\\\to&\gcd(x_1,x_2,x_3,\cdots,x_k)=\gcd(x_1,x_2,x_3\cdots,x_k-x_1-x_2-x_3-\ldots)\end{aligned}</script><p>è¿™ä¸€ç‚¹å¯ä»¥ç”¨ $\gcd$ çš„ä¼ (ç»“)é€’(åˆ)æ€§(å¾‹)æ¥è¯æ˜ã€‚ç„¶è€Œæˆ‘å¹¶æ²¡æœ‰è¯è¿‡ï¼Œåªæ˜¯æ„Ÿè§‰å¾ˆæ˜¾ç„¶ã€‚</p><p>ç„¶åä¸€ä¸ªæ¯”è¾ƒç›´æ¥çš„æƒ³æ³•å°±æ˜¯ï¼Œè€ƒè™‘å·¦è¾¹çš„ç‚¹ä¼šæ€ä¹ˆäº§ç”Ÿè´¡çŒ®ã€‚ä¸éš¾å‘ç°å¦‚æœä¸¤ä¸ªå·¦éƒ¨çš„ç‚¹ $x,y$ æ»¡è¶³ $N(x)\cap N(y)=\varnothing$ ï¼Œé‚£ä¹ˆåŒæ—¶é€‰è¿™ä¸¤ä¸ªçš„æ‰€æœ‰è´¡çŒ®éƒ½å¯ä»¥å¿½ç•¥ã€‚ä½†æ˜¯é—®é¢˜å°±å‡ºåœ¨ $\mathrm{card}\left( N(x)\cap N(y)\right)&gt;0$ çš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™å¾ˆéš¾å»é™¤äº¤é›†çš„è´¡çŒ®ã€‚</p><p>ä½†æ˜¯å¦‚æœå°†ç›®å…‰æ”¾åˆ°å³éƒ¨ï¼Œå‘ç°äº¤é›†é‡Œçš„å·¦éƒ¨ç‚¹ä¼šåŒæ—¶äº§ç”Ÿä¸¤è€…ä¹‹å’Œçš„è´¡çŒ®ï¼Œä½†è¿™æ ¹æ®ç¬¬ä¸€ä¸ªå¼å­å¯ä»¥çŸ¥é“ä¸éœ€è¦è€ƒè™‘ã€‚ ä½†æ˜¯æ­¤æ—¶è¦æ¢æˆå¦‚æœä¸ä¸¤ä¸ªå³éƒ¨ç‚¹ $xâ€™,yâ€™$ åˆ†åˆ«è¿é€šçš„å·¦éƒ¨ç‚¹é›†åˆ $M(xâ€™),M(yâ€™)$ å­˜åœ¨äº¤é›†ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å»é™¤æ‰è¿™ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºè¿™éƒ¨åˆ†çš„ gcd ä¸€å®šæ˜¯å¤šä¸ª $c_i$ çš„å’Œçš„å½¢å¼ã€‚</p><p>å‘ç°ä»å³éƒ¨å…¥æ‰‹å’Œä»å·¦éƒ¨å…¥æ‰‹æœ¬è´¨ä¸Šæ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä½†ä¸åŒå°±ä¸åŒåœ¨æœ‰å…³å³éƒ¨çš„é›†åˆè¿ç®—å¯ä»¥æ–¹ä¾¿åŠ å‡ä»¥åŠè®¡ç®—è´¡çŒ®ï¼Œä½†æ˜¯å·¦éƒ¨ä¸è¡Œã€‚å› ä¸ºæœ¬è´¨ä¸Šå·¦éƒ¨æä¾›å…³ç³»ï¼Œå³éƒ¨æä¾›æƒå€¼ã€‚æ‰€ä»¥ä»å³éƒ¨è€ƒè™‘æ–¹ä¾¿æ˜¯æ˜¾ç„¶çš„ç»“è®ºã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸ªå°ç‚¹ã€‚$\gcd(x,x)=x$ï¼Œä½†æ˜¯æŒ‰ç…§ä¸Šè¿°æ–¹å¼ä¼šç®—æˆ $\gcd(x,x)=0$ ã€‚æ‰€ä»¥éœ€è¦ hash ä¸€ä¸‹å»åˆ¤ä¸€ä¸‹ $M(xâ€™)=M(yâ€™)$ çš„ $(xâ€™,yâ€™)$ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹å¼å°±æ˜¯ç›´æ¥åˆå¹¶ä¸¤è€…ã€‚</p><p>æ¨¡æ•° <code>P</code> å¯ä»¥å– $10^9+7$ï¼Œ<code>Base</code> å¯ä»¥å– <code>131</code>ã€‚äº‹å®è¯æ˜æ²¡æœ‰å¡å•å“ˆå¸Œã€‚</p><p>T äº†ä¸¤å‘ï¼ŒåŸå› æ˜¯ç”¨äº† <code>cin/cout</code> ã€‚</p><h1 id="CF-MOI-Round-626-Div1-D-Reality-Show"><a href="#CF-MOI-Round-626-Div1-D-Reality-Show" class="headerlink" title="[CF MOI Round#626(Div1) D] Reality Show"></a>[CF MOI Round#626(Div1) D] Reality Show</h1><blockquote><p>æœ‰ $n$ ä¸ªé€‰æ‰‹ï¼Œæ¯ä¸ªé€‰æ‰‹æœ‰ $l_i$ æ”»å‡»åŠ›ï¼Œå½•ç”¨è¿™ä¸ªé€‰æ‰‹èŠ±è´¹ $s_i$ ä»£ä»·ã€‚æ¯ä¸ªæ”»å‡»åŠ›å¯¹åº”ä¸€ä¸ªæƒå€¼ $c_i$ ã€‚å½•ç”¨çš„é€‰æ‰‹æŒ‰ç…§ç¼–å·ä»å°åˆ°å¤§å‡ºåœºã€‚æ¼”å‡ºæ—¶ä¼šå‘ç”Ÿå¦‚ä¸‹äº‹æƒ…ï¼š</p><p>1ã€æŸä¸ªæ”»å‡»åŠ›ä¸º $k$ çš„é€‰æ‰‹ä¸Šåœºï¼Œè·å¾—æ”¶ç›Š $c_k$ ã€‚<br>2ã€å¦‚æœåœºä¸Šæœ‰ä¸¤ä¸ªæ”»å‡»åŠ›ç›¸åŒçš„é€‰æ‰‹ï¼Œé‚£ä¹ˆä»–ä»¬ä¼šæ‰“ä¸€æ¶ï¼Œæ­»æ‰ä¸€ä¸ªé€‰æ‰‹ï¼Œå¦ä¸€ä¸ªé€‰æ‰‹æ”»å‡»åŠ› $+1$ï¼Œé‡å¤ä»¥ä¸Šæ“ä½œç›´åˆ°åœºä¸Šæ‰€æœ‰é€‰æ‰‹æ”»å‡»åŠ›ä¸¤ä¸¤ä¸åŒï¼Œå¹¶è·å¾—æ–°æ”»å‡»åŠ›å¯¹åº”çš„æ”¶ç›Šã€‚<br>æ±‚ä¸€ä¸ªæ”»å‡»åŠ›å•è°ƒä¸å‡çš„é€‰æ‰‹åºåˆ—ï¼Œå½•ç”¨è¿™ä¸ªåºåˆ—æ‰€å¯¹åº”çš„é€‰æ‰‹ï¼Œæœ€å¤§åŒ–å…¶ï¼ˆæ”¶ç›Š-ä»£ä»·ï¼‰ã€‚</p><p>$1\leq n,m\leq 2000$ã€‚ </p></blockquote><p>é¦–å…ˆä¸éš¾å‘ç°æœ€åå¹¶ä¸å…³å¿ƒä¸Šåœºçš„é¡ºåºï¼Œå› ä¸ºåªæœ‰ $l_a=l_b$ æ—¶æ‰ä¼šè§¦å‘ä¸¤è€…çš„ battle ä¸”ä»·å€¼åªè¡¡é‡äº†æ”»å‡»åŠ›ï¼Œæ‰€ä»¥ç›¸åŒæƒå€¼çš„äººéƒ½æ˜¯å¯ä»¥äº¤æ¢çš„ï¼Œå¹¶ä¸”ä¸åŒæƒå€¼çš„äººä¹Ÿä¸ä¼šäº’ç›¸å½±å“ã€‚æ‰€ä»¥å¯çŸ¥è·Ÿé¡ºåºæ— å…³ã€‚</p><p>å¦‚æœä¸è€ƒè™‘ã€Œå•è°ƒä¸å‡ã€è¿™ä¸ªæ¡ä»¶å°±å¯ä»¥ç›´æ¥ dpã€‚è®¾ $f_{i,j}$ è¡¨ç¤ºç°åœ¨å·²ç»è€ƒè™‘äº†å‰ $i$ å¤§çš„æˆ˜æ–—åŠ›ï¼Œç­‰äº $i$ çš„æœ‰ $j$ ä¸ªçš„æœ€å¤§ä»·å€¼ã€‚é‚£ä¹ˆè€ƒè™‘ä¸€ä¸ªè½¬ç§»ï¼š</p><script type="math/tex; mode=display">f_{i+1,\frac{j}{2}}=f_{i,j}+\left\lfloor\frac{j}{2}\right\rfloor\cdot c_{j}</script><p>ä¸éš¾çŸ¥é“è¿™æ ·æ˜¯å¯¹çš„ã€‚ç„¶åè€ƒè™‘ä»–çš„é™åˆ¶æ˜¯è¦æ±‚æ”»å‡»åŠ›å•è°ƒä¸å‡ï¼Œé‚£ä¹ˆå¦‚æœæŠŠç»™å‡ºçš„ä¿¡æ¯ <code>reverse</code> ä¸€ä¸‹å°±å˜æˆå•è°ƒä¸é™åœ°é€‰ï¼Œå¯ä»¥çŸ¥é“å¦‚æœæ­£ç€æ‰«è¿‡å»è¿™æ ·ä¸€å®šæ˜¯ç¬¦åˆè¦æ±‚çš„ã€‚äºæ˜¯æœ€åå¤æ‚åº¦ $O(nm\log (n+m))$ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">int n, m ;</span><br><span class="line">int atk[N] ;</span><br><span class="line">int val[N] ;</span><br><span class="line">int base[N] ;</span><br><span class="line">int f[N][M] ;</span><br><span class="line"> </span><br><span class="line">int main()&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    memset(f, -63, sizeof(f)) ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; n ; ++ i) atk[i] &#x3D; qr() ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; n ; ++ i) val[i] &#x3D; qr() ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; n + m ; ++ i) f[i][0] &#x3D; 0 ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; n + m ; ++ i) base[i] &#x3D; qr() ;</span><br><span class="line">    reverse(atk + 1, atk + n + 1) ;</span><br><span class="line">    reverse(val + 1, val + n + 1) ;</span><br><span class="line">    for (int i &#x3D; 1 ; i &lt;&#x3D; n ; ++ i)&#123;</span><br><span class="line">        for (int j &#x3D; n + m ; j &gt;&#x3D; 1 ; -- j)</span><br><span class="line">            chkmax(f[atk[i]][j], f[atk[i]][j - 1] + base[atk[i]] - val[i]) ;</span><br><span class="line">        for (int j &#x3D; atk[i] ; j &lt;&#x3D; n + m ; ++ j)</span><br><span class="line">            for (int k &#x3D; 0 ; k &lt;&#x3D; n &gt;&gt; (j - atk[i]) ; ++ k)</span><br><span class="line">                chkmax(f[j + 1][k &gt;&gt; 1], f[j][k] + (k &gt;&gt; 1) * base[j + 1]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; f[n + m][0] &lt;&lt; &#39;\n&#39; ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="NOI-Online-3-B-é­”æ³•å€¼"><a href="#NOI-Online-3-B-é­”æ³•å€¼" class="headerlink" title="[NOI Online #3 B] é­”æ³•å€¼"></a>[NOI Online #3 B] é­”æ³•å€¼</h1><blockquote><p>ç»™å®šä¸€å¼ æ— å‘å›¾å’Œæ¯ä¸ªç‚¹çš„ä¸€ä¸ª $f_{i,0}$ ã€‚å¯¹äº $f_{i,k}(k&gt;0)$ æœ‰å¦‚ä¸‹çš„è®¡ç®—æ–¹å¼</p><script type="math/tex; mode=display">f_{i,k}=\bigoplus _{(i,j)\in \mathbb{E}} f_{j,k-1}</script><p>å¤šç»„è¯¢é—® $k$ï¼Œæ±‚ $f_{1,k}$ ã€‚</p><p>$1\leq n,q\leq 100,1 \leq m \leq \frac{n(n-1)}{2}, 1 \leq a_{i}&lt;2^{32}, 0 \leq f_{i}&lt;2^{32}$ ã€‚</p></blockquote><p>å‘ç°è½¬ç§»ååˆ†é‡å¤ï¼Œå¹¶ä¸” $n,q$ éƒ½å¾ˆå°ï¼Œå°±å¯ä»¥ç«‹å³æƒ³åˆ°è¦ç”¨çŸ©é˜µæäº‹æƒ…ã€‚å…·ä½“çš„ï¼Œè®¾åˆçŸ©é˜µä¸º $\begin{bmatrix}f_{1,0},f_{2,0},f_{3,0},\cdots,f_{n,0}\end{bmatrix}$ ï¼Œé‚£ä¹ˆè½¬ç§»çŸ©é˜µå°±æ˜¯é‚»æ¥çŸ©é˜µï¼Œè½¬ç§»æ–¹å¼åˆ™æ˜¯å…ƒç´ é—´çš„çš„ä¹˜æ³•ä¹‹åç”¨ $\bigoplus$ åˆå¹¶ã€‚é‚£è€ƒåœºä¸Šæƒ³å‡ºæ¥ä¹‹åæ˜¯å¿…ç„¶æ‡’å¾—å»æ£€éªŒçš„ï¼Œäºæ˜¯å°±ç›´æ¥å†™äº†ã€‚ç„¶è€Œè¿™æ ·çš„å¤æ‚åº¦æ˜¯ $O(n^3q\log a_i)$ ï¼Œå¹¶ä¸å¯ä»¥è¿‡ã€‚</p><p>æœŸé—´æˆ‘è¿˜å°è¯•äº†ä¸€äº›è¯¡å¼‚çš„ trickï¼Œæ¯”å¦‚ä»€ä¹ˆæŠŠè¯¢é—®ç¦»çº¿ä¸‹æ¥æ’ä¸ªåºåšå•Šï¼Œå€å¢ä¸€ä¸‹é¢„å¤„ç†å•Šï¼Œæˆ–è€…å®åœ¨ä¸æµåˆ†ä¸ªå—ä¹Ÿè¡Œå•Šã€‚æ„Ÿè§‰éƒ½ä¸æ˜¯å¾ˆç¨³ã€‚ç„¶åè·Ÿ zay èŠç€èŠç€å‘ç°çŸ©é˜µåªæœ‰ $n$ ä¸ªå…ƒç´ â€¦äºæ˜¯å°±å¯ä»¥é¢„å¤„ç†ä¸€ä¸‹å€å¢ï¼Œç„¶åæš´åŠ›åšäº†ã€‚è¿™æ ·å¤æ‚åº¦å°±å¯ä»¥è¾¾åˆ° $O(n^3\log \max\{a_i\}+n^2q\log a_i)$ ï¼Œå¯ä»¥é€šè¿‡æœ¬é¢˜ã€‚</p><p>ç„¶åæ™šä¸Šçš„æ—¶å€™å‘ç°ä¹˜æ³•å¯¹å¼‚æˆ–å¹¶æ²¡æœ‰åˆ†é…å¾‹â€¦æ‰€ä»¥è¿™ä¸ªçŸ©é˜µå¹¶æ²¡æœ‰ç»“åˆå¾‹ã€‚ä¸è¿‡åæ¥å‘ç°çŸ©é˜µé‡Œé¢åªæœ‰ $0/1$ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶å¼‚æˆ–ç›¸å½“äºæ¨¡ 2 æ„ä¹‰ä¸‹çš„åŠ æ³•ã€‚äºæ˜¯å°±åˆç†äº†ã€‚</p><p>æœ€åæ‹¿ <code>bitset</code> å¡äº†ä¸€æ³¢ï¼Œå€’æ˜¯æŒºå¿«çš„ã€‚æœ€å¤§ç‚¹åœ¨æ´›è°·å·¨æ…¢æ— æ¯”çš„è¯„æµ‹æœºä¸Šä¹Ÿå¯ä»¥åœ¨ $0.1s$ å†…è·‘å‡ºæ¥ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ma</span>&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> ma[N][N] ;</span><br><span class="line"><span class="built_in">bitset</span> &lt;N&gt; b1[N], b2[N] ; </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(ma, <span class="number">0</span>, <span class="keyword">sizeof</span>(ma)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    Ma <span class="keyword">friend</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> Ma &amp; a, <span class="keyword">const</span> Ma &amp; b)&#123;</span><br><span class="line">        Ma c ; c.clear() ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; N ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; N ; ++ j)</span><br><span class="line">c.b1[i][j] = c.b2[j][i] = ((a.b1[i] &amp; b.b2[j]).count() &amp; <span class="number">1</span>) ;</span><br><span class="line">        <span class="keyword">return</span> c ;</span><br><span class="line">    &#125;</span><br><span class="line">    Ma <span class="keyword">friend</span> <span class="keyword">operator</span> ^ (<span class="keyword">const</span> Ma &amp; a, <span class="keyword">const</span> Ma &amp; b)&#123;</span><br><span class="line">        Ma c ; c.clear() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; N ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">1</span> ; k &lt; N ; ++ k)</span><br><span class="line">                c.ma[i][j] ^= a.ma[i][k] * b.b1[k][j] ;</span><br><span class="line">        <span class="keyword">return</span> c ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;ut, bz[N], ans ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, q ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; q ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ut.ma[<span class="number">1</span>][i] = qr() ;</span><br><span class="line">    <span class="keyword">int</span> x, y ; <span class="keyword">unsigned</span> <span class="keyword">int</span> z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        x = qr(), y = qr() ;</span><br><span class="line">        bz[<span class="number">0</span>].b1[x][y] = <span class="number">1</span> ;</span><br><span class="line">        bz[<span class="number">0</span>].b1[y][x] = <span class="number">1</span> ;</span><br><span class="line">        bz[<span class="number">0</span>].b2[y][x] = <span class="number">1</span> ;</span><br><span class="line">        bz[<span class="number">0</span>].b2[x][y] = <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">32</span> ; ++ i)</span><br><span class="line">        bz[i] = bz[i - <span class="number">1</span>] * bz[i - <span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">        z = qr() ; ans = ut ; <span class="comment">//debug(z) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">32</span> ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> &lt;&lt; i &amp; z) ans = ans ^ bz[i] ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans.ma[<span class="number">1</span>][<span class="number">1</span>] &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="NOI-Online-3-C-ä¼˜ç§€å­åºåˆ—"><a href="#NOI-Online-3-C-ä¼˜ç§€å­åºåˆ—" class="headerlink" title="[NOI Online #3 C] ä¼˜ç§€å­åºåˆ—"></a>[NOI Online #3 C] ä¼˜ç§€å­åºåˆ—</h1><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„éè´Ÿæ•´æ•°åºåˆ— $A=\{a_1,a_2,\cdots,a_n\}$ï¼Œå¯¹äº $A$ çš„ä¸€ä¸ªå­åºåˆ— $B=\{a_{b_1},a_{b_2},\cdots,a_{b_m}\}$ï¼ˆ$0\le m\le nï¼Œ1\le b_1&lt;b_2&lt;\cdots&lt;b_m\le n$ï¼Œä¸‹åŒï¼‰ï¼Œç§° $B$ æ˜¯ $A$ çš„ä¼˜ç§€å­åºåˆ—å½“ä¸”ä»…å½“ï¼Œå…¶ä»»æ„ä¸¤ä¸ªä¸åŒå…ƒç´ çš„æŒ‰ä½ä¸ç»“æœå‡ä¸º $0$ï¼Œå³ï¼š$\forall 1\le i&lt;j\le m$ï¼Œæ»¡è¶³ï¼š$a_{b_i}~\mathrm{and}~a_{b_j}=0$ï¼Œå…¶ä¸­ $\mathrm{and}$ æ˜¯æŒ‰ä½ä¸è¿ç®—ã€‚</p><p>å¯¹äºå­åºåˆ— $B=\{a_{b_1},a_{b_2},\cdots,a_{b_m}\}$ï¼Œæˆ‘ä»¬å®šä¹‰å…¶ä»·å€¼ä¸º $\varphi(1+\sum_{i=1}^m a_{b_i})$ï¼Œå…¶ä¸­ $ \varphi(x)$ è¡¨ç¤ºå°ç­‰äº  $x$ çš„æ­£æ•´æ•°ä¸­ä¸ $x$äº’è´¨çš„æ•°çš„ä¸ªæ•°ã€‚</p><p>ç°åœ¨è¯·ä½ æ±‚å‡º $A$ çš„æ‰€æœ‰ä¼˜ç§€å­åºåˆ—çš„ä»·å€¼ä¹‹å’Œï¼Œç­”æ¡ˆå¯¹ $10^9+7$ å–æ¨¡ã€‚</p></blockquote><p>è€ƒè™‘æœ€åæ±‚çš„æ˜¯ $\varphi$ å¥—èµ·æ¥çš„ä¸œè¥¿ã€‚æ‰€ä»¥å¿…ç„¶è¦ä»æƒå€¼å…¥æ‰‹ã€‚</p><p>äºæ˜¯å°±æ˜¯è€ƒè™‘æœ‰å¤šå°‘ä¸ªåˆæ³•å­åºåˆ—çš„å’Œä¸º $x$ ã€‚é‚£ä¹ˆå°±è€ƒè™‘è®¾ $f_{i}$ è¡¨ç¤ºå’Œä¸º $i$ çš„åˆæ³•å­åºåˆ—çš„æ–¹æ¡ˆæ•°ã€‚è€ƒè™‘å¦‚ä½•è½¬ç§»å‡º $f_i$ æ¥ã€‚ä¸éš¾å‘ç°å¦‚æœä¸€ä¸ªå…ƒç´  $j$ å’Œå‰é¢çš„æ‰€æœ‰å…ƒç´ çš„ $\&amp;$ éƒ½ä¸º $0$ï¼Œè¿™ä¸ªæ¡ä»¶ç­‰ä»·äº</p><script type="math/tex; mode=display">a_{b_j}\&\left(\bigcup_{k=1}^{j-1} a_{b_k}\right)=0\qquad(1)</script><p>äºæ˜¯å°±å¯ä»¥å¯¹ç€è¿™ä¸ªå¼å­æ¥è¿›è¡Œ dpã€‚æš´åŠ›å¤æ‚åº¦å¯èƒ½æ˜¯ $O(n\cdot \max\{a_i\})$ çš„ã€‚ç¨å¾®é¢„å¤„ç†ä¸€ä¸‹å¯ä»¥é€šè¿‡ $40\%$ çš„æ•°æ®<del>ç„¶è€Œæˆ‘å¥½åƒè¿™éƒ¨åˆ†å†™æŒ‚äº†</del>ã€‚</p><p>å¹¶ä¸”è€ƒè™‘ $(1)$ å¼çš„æœ¬è´¨ï¼Œå‘ç°å¦‚æœå­˜åœ¨ $\geqslant 2$ ä¸ªæ•°åœ¨æŸä¸ªäºŒè¿›åˆ¶ä½ä¸Šå‡ä¸º $0$ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯ä¸åˆæ³•çš„ã€‚ æ‰€ä»¥ä¸€ä¸ªä¼˜ç§€çš„å­åºåˆ—ï¼Œå¿…ç„¶æ»¡è¶³äºŒè¿›åˆ¶ä¸‹æ¯ä¸€ä½ï¼Œè‡³å¤šæœ‰ä¸€ä¸ªæ•°ä¸º 1 ã€‚é‚£ä¹ˆè€ƒè™‘æ­¤æ—¶è¿™ä¸ªåºåˆ—çš„å’Œï¼Œåœ¨äºŒè¿›åˆ¶ä¸‹æœ¬è´¨ä¸Šä¸å­˜åœ¨è¿›ä½ã€‚äºæ˜¯å¯ä»¥å‘ç° $f_i$ åŒæ ·ä¹Ÿæ˜¯<strong>å¼‚æˆ–å’Œ</strong>ä¸º $i$ çš„åˆæ³•å­åºåˆ—æ–¹æ¡ˆæ•°ã€‚</p><p>äºæ˜¯è€ƒè™‘å¯¹ç€è¿™ä¸ª dpã€‚å‘ç°å®é™…ä¸Šå­åºåˆ—å¹¶æ²¡æœ‰å®‰æ’åºåˆ—çš„é€‰æ‹©é¡ºåºã€‚äºæ˜¯è€ƒè™‘å¯¹äºæ¯ä¸€ç§å¼‚æˆ–å’Œä¸º $x$ çš„æ–¹æ¡ˆæ•°ï¼Œéƒ½å¯ä»¥åœ¨å…¶ä¸­åŠ å…¥æŸä¸ª $=y$ çš„ä½ç½®ä½¿å¾—å¼‚æˆ–å’Œå˜ä¸º $x \operatorname{xor} y$ ã€‚äºæ˜¯æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_i=\sum _{j\subseteq i} f_{i}\cdot \operatorname{count}(i\setminus j)</script><p>å…¶ä¸­ $\operatorname{count}(i)$ è¡¨ç¤º $i$ çš„å‡ºç°æ¬¡æ•°ã€‚</p><p>ä½†æ³¨æ„è¿™æ ·è½¬ç§»å…¶å®æ˜¯è½¬ç§»äº†ä¿©æ–¹å‘ã€‚äºæ˜¯å¯ä»¥åˆ¤æ‰é‚£äº›å’Œ $i$ æœ‰ç›¸åŒ $\rm lowbit$ çš„ $j$ è¿›è¡Œè½¬ç§»ã€‚è®¾ $k=\log_2(\max\{a_i\}) $ï¼Œé‚£ä¹ˆè¿™æ ·åšçš„å¤æ‚åº¦æ˜¯ $O(3^k)$ ã€‚</p><p>ä¹‹åä¸éš¾å‘ç°è¿™å°±æ˜¯ä¸€ä¸ªå­é›†å·ç§¯çš„å½¢å¼ã€‚å¯ä»¥è€ƒè™‘æšä¸¾ $\rm lowbit$ æ¥å®ç°è½¬ç§»ï¼Œå¤æ‚åº¦ $O(2^k\cdot k^2)$ ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†ç¢äºç åŠ›æ¯”è¾ƒå¼±ä»¥åŠå­é›†å·ç§¯èƒŒä¸è¿‡æ‰€ä»¥å¹¶ä¸æ‰“ç®—å†™ã€‚<code>-O2</code> å¥½å•Šã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">bool</span> check[M] ;</span><br><span class="line">ll prime[M] ;</span><br><span class="line"><span class="keyword">int</span> phi[M] ;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!check[i])&#123;</span><br><span class="line">phi[i]=i<span class="number">-1</span>;</span><br><span class="line">prime[cnt++]=i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=cnt;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(prime[j]*i&gt;n)<span class="keyword">break</span>;</span><br><span class="line">check[i*prime[j]]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">phi[i*prime[j]]=prime[j]*phi[i];</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">phi[i*prime[j]]=phi[i]*phi[prime[j]];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll ans ;</span><br><span class="line">ll f[N] ;</span><br><span class="line">ll buc[M] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> n, m, v ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">1</span> ; </span><br><span class="line"><span class="keyword">while</span> (y)&#123;</span><br><span class="line"><span class="keyword">if</span> (y &amp; <span class="number">1</span>) res = <span class="number">1l</span>l * res * x % P ; </span><br><span class="line">x = <span class="number">1l</span>l * x * x % P ; y &gt;&gt;= <span class="number">1</span> ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">low</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    init(<span class="number">400000</span>) ; gi(n) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        gi(base[i]), buc[base[i]] ++, chkmax(m, base[i]) ;</span><br><span class="line">f[<span class="number">0</span>] = expow(<span class="number">2</span>, buc[<span class="number">0</span>]) ; <span class="keyword">int</span> o, d, p, q, k ; </span><br><span class="line">    v = <span class="number">1</span> ; <span class="keyword">while</span> (v &lt; m) v &lt;&lt;= <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= v ; ++ i)&#123;</span><br><span class="line">    o = low(i) ; </span><br><span class="line">d = log2(o) + <span class="number">1</span> ; </span><br><span class="line">p = i ^ o ; q = p &gt;&gt; d ; </span><br><span class="line">add(f[i], f[p] * buc[o] % P) ; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = q ; j ; j = (j - <span class="number">1</span>) &amp; q)&#123;</span><br><span class="line">k = j &lt;&lt; d ; </span><br><span class="line"><span class="keyword">if</span> (f[p ^ k] &amp;&amp; buc[k ^ o])</span><br><span class="line">    add(f[i], f[p ^ k] * buc[k ^ o] % P) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= v ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (f[i]) add(ans, f[i] * phi[<span class="number">1</span> + i] % P) ;</span><br><span class="line">    print(ans), pc(<span class="string">'\n'</span>); <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="CF-Round-633-Div2-B-Sorted-Adjacent-Differences"><a href="#CF-Round-633-Div2-B-Sorted-Adjacent-Differences" class="headerlink" title="[CF Round#633 (Div2) B] Sorted Adjacent Differences"></a>[CF Round#633 (Div2) B] Sorted Adjacent Differences</h1><blockquote><p>ç»™å®šä¸€ä¸ªåºåˆ— $\{a_n\}$ï¼Œå°†å…¶é‡æ’ä¹‹åä½¿å¾— $|a_1-a_2|\leq |a_2-a_3|\leq |a_3-a_4|\cdots \le |a_{n-1}-a_n|$ã€‚</p></blockquote><p>è¿™é¢˜æ˜¯çœŸçš„ç®€å•ï¼Œä½†æ˜¯æˆ‘å½“æ—¶ vp çš„æ—¶å€™å°±æ˜¯æ„£äº†å¾ˆä¹…â€¦ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆâ€¦æ„Ÿè§‰å°±æ˜¯ç›¯ç€é¢˜ç›®è„‘è¢‹éº»æœ¨åœ°æ‘¸æ¥æ‘¸å»ã€‚</p><p>å¤§æ¦‚æ˜¯è€ƒè™‘æ’ä¸ªåºä¹‹åä»ä¸­é—´å‘ä¸¤è¾¹äº¤æ›¿ç€æ‰«ï¼Œ$n$ æ˜¯å¥‡æ•°ç‰¹åˆ¤ä¸€ä¸‹ $r$ å°±å¥½äº†ã€‚</p><h1 id="CF-Round-633-Div1-B-Edge-Weight-Assignment"><a href="#CF-Round-633-Div1-B-Edge-Weight-Assignment" class="headerlink" title="[CF Round#633 (Div1) B] Edge Weight Assignment"></a>[CF Round#633 (Div1) B] Edge Weight Assignment</h1><blockquote><p>ç»™å®šä¸€æ£µ $n$ ä¸ªç‚¹çš„æ— æ ¹æ ‘ï¼Œè¦æ±‚ç»™æ¯æ¡è¾¹åˆ†é…ä¸€ä¸ªæ­£æ•´æ•°æƒå€¼ï¼Œä½¿å¾—ä»»æ„ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ä¹‹é—´è·¯å¾„ä¸Šçš„è¾¹æƒå¼‚æˆ–å€¼ä¸º $0$ã€‚æ±‚æœ€å°‘è¦å¤šå°‘ç§ä¸åŒæƒå€¼ï¼Œä»¥åŠæœ€å¤šå¯ä»¥ä½¿ç”¨å¤šå°‘ç§ä¸åŒæƒå€¼ã€‚</p><p>è¿™é‡Œå¡«å…¥çš„è¾¹æƒå€¼å¯ä»¥ä¸ºä»»æ„å¤§ã€‚</p><p>$1\leq n\leq 10^5$ ã€‚</p></blockquote><p>æ„Ÿè§‰æœ€å°‘çš„æƒå€¼æ•°é‡è¿˜æ˜¯ä¸éš¾çŒœå‡ºæ¥çš„ã€‚å¤§æ¦‚å°±æ˜¯å¦‚æœä¸¤ä¸¤å¶å­ä¹‹é—´çš„è·ç¦»å‡ä¸ºå¶æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ $1$ ä¸ªæƒå€¼ï¼Œå¦åˆ™å¿…é¡»è¦ç”¨ $3$ ä¸ªã€‚ç„¶åè¿™ä¸ªåœ°æ–¹æœ‰ä¸ª trickï¼Œå¤§æ¦‚å°±æ˜¯è¯´å‘ç°æˆ‘ä»¬åªå…³å¿ƒè·ç¦»çš„å¥‡å¶æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å¼‚æˆ–æ¥è¡¨ç¤ºè·ç¦»ï¼ŒåŒæ—¶å¼‚æˆ–æœ‰è‡ªåæ€§ï¼Œæ‰€ä»¥åˆ¤æ®å°±å¯ä»¥ç›´æ¥å˜æˆã€ŒæŸä¸ªç‚¹åˆ°å…¶ä»–ç‚¹çš„è·ç¦»ã€å‡ä¸ºå¶æ•°ã€‚é‚£ä¹ˆè¿™å°±å¯ä»¥éšä¾¿é’¦å®šä¸€ä¸ªå¶å­å½“æ ¹ï¼Œç„¶åå»æ¯”è¾ƒæ·±åº¦å³å¯ã€‚</p><p>æœ€å¤šçš„æƒå€¼éœ€è¦ä¸€ç‚¹è´ªå¿ƒã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘ä¸€å®šæ˜¯ä»æ ¹åˆ°å¶å­ $1,2,4,8,16\cdots$ è¿™æ ·ä¸‹æ¥ï¼Œæ¯ä¸ªå¶å­çš„ä¸Šè¡Œè¾¹ç­‰äºç¥–å…ˆçš„å¼‚æˆ–å’Œè¿™ç§æ„Ÿè§‰ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µå°±éœ€è¦åˆ¤ä¸¤ç‚¹ï¼š</p><p>1ã€å¦‚æœå¤šä¸ªå¶å­æœ‰åŒä¸€ä¸ªçˆ¶äº²ï¼Œé‚£ä¹ˆè¿™äº›å¶å­ä¸€å®šæ˜¯ç›¸åŒçš„æƒå€¼ï¼Œéœ€è¦å‡æ‰ã€‚</p><p>2ã€å¦‚æœæŸå¶å­çš„æ·±åº¦ä¸º $3$ï¼Œé‚£ä¹ˆä»–çš„ä¸Šè¡Œè¾¹å’Œå…¶çˆ¶äº²çš„ä¸Šè¡Œè¾¹æƒå€¼ç›¸åŒï¼Œä¹Ÿéœ€è¦å‡æ‰ã€‚</p><h1 id="CF-Round-633-Div1-D-Nested-Rubber-Bands"><a href="#CF-Round-633-Div1-D-Nested-Rubber-Bands" class="headerlink" title="[CF Round#633 (Div1) D] Nested Rubber Bands"></a>[CF Round#633 (Div1) D] Nested Rubber Bands</h1><blockquote><p>ç»™å®šä¸€æ£µ n ä¸ªç‚¹çš„æ ‘ï¼Œç¬¬ $i$ æ¡è¾¹è¿æ¥ $u_i$ å’Œ $v_i$ã€‚</p><p>ä½ éœ€è¦å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹ç”»æˆä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šé—­åˆå‡ ä½•å›¾å½¢ï¼Œæ»¡è¶³å¦‚æœ $u$ å’Œ $v$ ä¹‹é—´æœ‰è¾¹ç›¸è¿ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç‚¹å¯¹åº”çš„å‡ ä½•å›¾å½¢è¾¹ç•Œç›¸äº¤ï¼ˆæ³¨æ„åŒ…å«ä¸ç®—è¾¹ç•Œç›¸äº¤ï¼‰ã€‚</p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåºåˆ— $a_1,a_2,\ldots,a_k$ æ˜¯å¥½çš„ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„çš„ $2\le i\le k$ï¼Œ$a_{i-1}$ æ‰€å¯¹åº”çš„å‡ ä½•å›¾å½¢å®Œå…¨åŒ…å« $a_i$ æ‰€å¯¹åº”çš„å‡ ä½•å›¾å½¢ã€‚</p><p>æ±‚å¥½çš„åºåˆ—æœ€é•¿å¯ä»¥æ˜¯å¤šå°‘ã€‚</p><p>$n\leq 3\times 10^5$ . </p></blockquote><p>é¢˜æ„æˆ–å¤šæˆ–å°‘æœ‰ç‚¹å¤æ‚ã€‚æ„Ÿè§‰è¿˜æ˜¯å¾ˆè€ƒéªŒè§‚å¯Ÿæ€§è´¨çš„èƒ½åŠ›çš„ã€‚</p><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘æ€ä¹ˆæ ·çš„ä¸‰ä¸ªç‚¹ $x,y,z$ å¯ä»¥<strong>é¡ºæ¬¡</strong>å‡ºç°åœ¨åºåˆ—ä¸­ï¼Ÿé¦–å…ˆä¸€å®šè¦æ˜¯ $x,y,z$ å½¼æ­¤ä¸ç›¸é‚»ï¼Œä½†è¿™å¹¶ä¸è¶³å¤Ÿã€‚è€ƒè™‘è¿™ä¸ªé™åˆ¶ä¸­å…¶å® $x,z$ åˆ†é‡æ¯”è¾ƒè½»ï¼Œå¯¹äºé¡ºåºæ˜¯å¦æˆç«‹å…³é”®åœ¨äºæ˜¯å¦å¯ä»¥æŠŠ $y$ æ’åœ¨ä¸­é—´ã€‚å‘ç°å¦‚æœ $y$ æƒ³æ—¢å’Œ $x$ æ— äº¤ç‚¹ä½†åŒ…å« $x$ï¼Œå’Œ $z$ æ— äº¤ç‚¹ä½†è¢« $z$ åŒ…å«ã€‚é‚£ä¹ˆé¦–å…ˆä¸éš¾çŸ¥é“å¦‚æœ $x-y-z$ å¯ä»¥æ„æˆä¸€æ¡é“¾é‚£ä¹ˆè¿™æ˜¯å¯ä»¥æˆç«‹çš„ï¼Œå¦‚æœ $y$ ä¸åœ¨ $x-z$ ä¸Šï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦æœ‰ $y$ åˆ° $x-z$ çš„è·ç¦»ä¸º $1$ï¼Œå› ä¸ºå¦‚æœä¸ä¸º $1$ å°±å¿…é¡»è¦åŒ…å«æ›´è¿‘çš„é‚£ä¸ªç‚¹ï¼Œè·Ÿå®šä¹‰å†²çªã€‚</p><p>é‚£ä¹ˆå°±å¯ä»¥å‘ç°æœ€åæ±‚çš„ä¸€å®šæ˜¯ä¸€æ¡é“¾ä¸Šé¢æŒ‚ç€ä¸€äº›è·ç¦»ä¸º $1$ çš„æ•£ç‚¹ï¼Œåœ¨è¿™ä¸ªæ¯›æ¯›è™«ä¸Šæ±‚è§£æœ€å¤§ç‹¬ç«‹é›†ã€‚äºæ˜¯å°±å¯ä»¥è®¾ $f_{i,0/1}$ è¡¨ç¤º $i$ ä½œä¸ºé“¾å¤´æ—¶ï¼Œé€‰/ä¸é€‰ $i$ æ—¶çš„æœ€å¤§æ¯›æ¯›è™«ç‹¬ç«‹é›†ã€‚è½¬ç§»çš„è¯æ¯”è¾ƒç®€å•ï¼Œå¯¹äº $f_{i,0}$ åªéœ€å°† $u$ çš„å…¨éƒ¨éé“¾ä¸Šä¸´ç‚¹åŠ å…¥ç­”æ¡ˆå³å¯ï¼ˆå³ $\deg_x-2$ï¼‰ï¼Œ$f_{i,1}$ å°±æ˜¯ç®€å•ç´¯åŠ ã€‚æ³¨æ„åˆ°è¿™æ˜¯æ±‚çš„å­æ ‘å†…çš„æƒ…å†µï¼Œæœ€åç­”æ¡ˆç”¨å°±æ˜¯</p><script type="math/tex; mode=display">\max_{e(u,v)\in \mathbb{E}}\{ \max\{f_{u,0}+f_{v,1},f_{u,1}+f_{v,0},f_{u,0}+f_{v,0}\}\}</script><p>å¤æ‚åº¦çº¿æ€§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    f[x][<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        dfs(y, x) ;</span><br><span class="line">        chkmax(ans, f[x][<span class="number">1</span>] + f[y][<span class="number">0</span>]) ;</span><br><span class="line">        chkmax(ans, f[x][<span class="number">0</span>] + f[y][<span class="number">0</span>]) ;</span><br><span class="line">        chkmax(ans, f[x][<span class="number">0</span>] + f[y][<span class="number">1</span>]) ;</span><br><span class="line">        chkmax(f[x][<span class="number">0</span>], max(f[y][<span class="number">1</span>], f[y][<span class="number">0</span>]) + deg[x] - <span class="number">2</span>) ;</span><br><span class="line">        chkmax(f[x][<span class="number">1</span>], f[y][<span class="number">0</span>] + <span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(f[x][1], ' '), debug(f[x][0]) ;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="CF-Round-399-Combined-C-Jon-Snow-and-his-Favourite-Number"><a href="#CF-Round-399-Combined-C-Jon-Snow-and-his-Favourite-Number" class="headerlink" title="[CF Round#399(Combined) C] Jon Snow and his Favourite Number"></a>[CF Round#399(Combined) C] Jon Snow and his Favourite Number</h1><blockquote><p>ä½ æœ‰ä¸€ä¸²é•¿åº¦ä¸º $n$ çš„åºåˆ— $a$ï¼Œé‡å¤ $k$ æ¬¡æ“ä½œã€‚é—®æ“ä½œåçš„åºåˆ—çš„æå€¼ã€‚ </p><p>æ“ä½œ: å°†åºåˆ—ä»å°åˆ°å¤§æ’åº,ä» $1$ æ ‡å·,å¯¹åºå·ä¸ºå¥‡æ•°çš„æ•° <code>^(xor)</code> $x$.</p><p>$n\leq 10^5,k\leq 10^3$ã€‚</p></blockquote><p>æ‰“ä¸ªè¡¨å‘ç°æœ‰å¾ªç¯èŠ‚ï¼Œç„¶åæˆ‘å°± naive åœ°è§‰å¾—å¾ªç¯èŠ‚å¤§å°ä¸€å®šæ˜¯ $2$ å¯¼è‡´çˆ†äº† OJã€‚</p><p>å‘ç°å¾ªç¯èŠ‚çš„é•¿åº¦ä¸ä¼šè¶…è¿‡ $200$ã€‚äºæ˜¯å°±å¯ä»¥æš´åŠ› $200$ æ¬¡æ‰¾å‡ºå¾ªç¯èŠ‚æ¥ç„¶ååšã€‚è¿™æ ·çš„å¤æ‚åº¦æ˜¯ $O(200\cdot n)$ çš„ã€‚</p><p>å…³äºå¾ªç¯èŠ‚ï¼Œä¸ªäººçš„ç†è§£ä»…é™äº <code>xor</code> è¿ç®—æœ‰è‡ªåæ€§ï¼Œæ‰€ä»¥æ˜¾ç„¶å¾ªç¯èŠ‚åº”è¯¥æ˜¯å¶æ•°é•¿åº¦çš„ã€‚</p><p>â€¦ä¸ä¼šç¼–äº†ã€‚å°±å½“æ˜¯ä¸€ä¸ªä¹±æå§= =</p><h1 id="CF-Round-399-Combined-G-The-Winds-of-Winter"><a href="#CF-Round-399-Combined-G-The-Winds-of-Winter" class="headerlink" title="[CF Round#399(Combined) G] The Winds of Winter"></a>[CF Round#399(Combined) G] The Winds of Winter</h1><blockquote><p>ç»™å®šä¸€æ£µæœ‰æ ¹æ ‘ã€‚è‹¥åˆ å»ä¸€ä¸ªèŠ‚ç‚¹å’Œæ‰€æœ‰ä¸ä»–ç›¸è¿çš„è¾¹ï¼Œåˆ™ä¼šå¾—åˆ°ä¸€ä¸ªæ£®æ—ã€‚ä½ å¸Œæœ›è¿™ä¸ªæ£®æ—ä¸­èŠ‚ç‚¹æœ€å¤šçš„æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°å°½é‡å°‘ï¼Œäºæ˜¯ä½ å¯ä»¥è¿›è¡Œè‡³å¤šä¸€æ¬¡å¦‚ä¸‹æ“ä½œï¼š</p><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹å’Œå…¶çˆ¶äº²ä¹‹é—´çš„è¾¹ï¼ŒæŠŠè¿™ä¸ªèŠ‚ç‚¹è¿åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚è¿™ä¸ªæ“ä½œä¸å¾—æ”¹å˜æ£®æ—ä¸­æ ‘çš„ä¸ªæ•°ã€‚</p><p>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œè¾“å‡ºå®ƒä½œä¸ºåˆ å»çš„èŠ‚ç‚¹æ—¶ï¼Œè¿›è¡Œè‡³å¤šä¸€æ¬¡æ“ä½œåçš„æœ€å¤§æ ‘å¤§å°çš„æœ€å°å€¼ã€‚</p><p>è¾“å…¥æ ¼å¼ä¸­ï¼Œä¸€æ¡è¾¹çš„ä¸€ä¸ªç«¯ç‚¹æ˜¯ $0$ è¯´æ˜å¦ä¸€ä¸ªç«¯ç‚¹æ˜¯æ ¹ã€‚</p><p>$1\leq n\leq 3\times 10^5$ ã€‚</p></blockquote><p>é¦–å…ˆå¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å…·æœ‰è´ªå¿ƒæ€§è´¨çš„ã€‚å¿…ç„¶æ˜¯ä» $x$ åˆ†å‡ºçš„æœ€å¤§ size è¿é€šå—é‡Œæ‰¾å‡ºä¸€æ£µå­æ ‘è¿æ¥åˆ°æœ€å°çš„ size çš„è¿é€šå—é‡Œã€‚é‚£ä¹ˆæœ€åç­”æ¡ˆå°±æ˜¯</p><script type="math/tex; mode=display">\max\{size_p-\zeta,size_q+\zeta,size_o\}</script><p>å…¶ä¸­ $p$ æ˜¯æœ€å¤§çš„è¿é€šå—ï¼Œ $q$ æ˜¯æœ€å°çš„è¿é€šå—ï¼Œ$o$ æ˜¯æ¬¡å¤§è¿é€šå—ï¼Œ$\zeta$ æ˜¯æ‘˜ä¸‹æ¥çš„å­æ ‘ã€‚é‚£ä¹ˆä¸éš¾çŸ¥é“è¿™ä¸ªä¸œè¥¿æ˜¯å‡¸çš„ã€‚é‚£ä¹ˆå°±è€ƒè™‘å»äºŒåˆ†è¿™ä¸ª $ans$ ï¼Œ$check$ çš„æ—¶å€™è‡ªç„¶éœ€è¦æ»¡è¶³</p><script type="math/tex; mode=display">\begin{aligned}size_p-\zeta&\leq ans\\size_q+\zeta&\leq ans\\size_o&\leq ans\end{aligned}</script><p>è€ƒè™‘æœ€åä¸€ä¸ªæ˜¯å®šå€¼ï¼Œäºæ˜¯å¯ä»¥ç›´æ¥è®¾æˆäºŒåˆ†çš„ä¸‹ç•Œã€‚è§‚å¯Ÿå‰é¢ä¸¤ä¸ªï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åœ¨æŸ¥å‘¨å›´åˆ†å‡ºå»çš„è¿é€šå—é‡Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªå¤§å°åˆé€‚çš„å­æ ‘ $\zeta$ã€‚äºæ˜¯å°±å˜æˆäº†ä¸€ä¸ªæ‹¿ <code>mulity-set</code> ç»´æŠ¤ dsu on tree çš„ç›´è§‚é¢˜ç›®ã€‚</p><p>ç»´æŠ¤èµ·æ¥æœ‰äº›éº»çƒ¦ã€‚è€ƒè™‘æŒ‰ç…§ dfs åºåˆ†åˆ«ç»´æŠ¤è‡ªå·±å­æ ‘å†…çš„ã€ç¥–å…ˆé“¾ä¸Šçš„ã€ç¥–å…ˆé™¤äº†è‡ªå·±ä»¥å¤–çš„é‚£äº›å­å­™ã€‚åé¢ä¸¤ä¸ªå¯ä»¥ä¸æ–­è¾¹æ’è¾¹åˆ æ¥åšï¼Œè€Œè‡ªå·±å­æ ‘å†…çš„åˆ™å¯ä»¥è€ƒè™‘ç”±äºä¿¡æ¯é‡å¤ç‡å¤§ï¼Œæ‰€ä»¥é‡‡ç”¨å¯å‘å¼åˆ†æ²»(å¯å‘å¼åˆå¹¶)ç­–ç•¥â€”â€”ç»“åˆè½»é‡é“¾å‰–åˆ†çš„ç†è®ºï¼Œå› ä¸ºä»æ ¹åˆ°æ¯ä¸ªç‚¹è‡³å¤šç»è¿‡ $\log n$ æ¡è½»è¾¹ï¼Œæ‰€ä»¥è€ƒè™‘æ¯ä¸ªç‚¹éƒ½åªå‘è‡ªå·±çš„è½»ç¥–å…ˆè´¡çŒ®ã€‚é‚£ä¹ˆè¿‡ç¨‹å°±æ˜¯å…ˆåˆ†æ²»è½»å„¿å­å¹¶ä¸”æ¸…ç©ºè´¡çŒ®ï¼Œç„¶åæš´åŠ›é‡å„¿å­ï¼Œå†å°†è½»å„¿å­åˆå¹¶åˆ°é‡å„¿å­çš„ä¿¡æ¯é‡Œã€‚é€šè¿‡èšå’Œåˆ†æä¸éš¾çŸ¥é“è¿™æ ·æ˜¯ $O(n\log n)$ çš„ã€‚è¿™ä¹Ÿå°±æ˜¯ dsu on tree çš„è¿‡ç¨‹ã€‚</p><p>æœ€åæœ‰ç‚¹ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œå¤§æ¦‚å°±æ˜¯ä»€ä¹ˆç‰¹åˆ¤ $p=q$ ä¹‹ç±»çš„ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</span></span><br><span class="line"></span><br><span class="line">sint other ;</span><br><span class="line">sint dads ;</span><br><span class="line">sint s[N] ;</span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line"><span class="keyword">int</span> rt ;</span><br><span class="line"><span class="keyword">int</span> sz[N] ;</span><br><span class="line"><span class="keyword">int</span> fa[N] ;</span><br><span class="line"><span class="keyword">int</span> mx[N] ;</span><br><span class="line"><span class="keyword">int</span> mn[N] ;</span><br><span class="line"><span class="keyword">int</span> smx[N] ;</span><br><span class="line"><span class="keyword">int</span> son[N] ;</span><br><span class="line"><span class="keyword">int</span> ans[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> dad)</span></span>&#123;</span><br><span class="line">    fa[x] = dad ; sz[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])</span><br><span class="line">        <span class="keyword">if</span> (k != dad)&#123;</span><br><span class="line">            dfs(k, x) ;</span><br><span class="line">            sz[x] += sz[k] ;</span><br><span class="line">            <span class="keyword">if</span> (!son[x]) son[x] = k ;</span><br><span class="line">            <span class="keyword">if</span> (sz[son[x]] &lt; sz[k]) son[x] = k ;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (x != rt)</span><br><span class="line">        other.ins(sz[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isrt</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">bool</span>)(x == rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chk</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; v &lt;&lt; " " &lt;&lt; x &lt;&lt; " " &lt;&lt; mx[x] &lt;&lt; " " &lt;&lt; mn[x] &lt;&lt; " " &lt;&lt; sz[x] &lt;&lt; " " &lt;&lt; son[x] &lt;&lt; " " &lt;&lt; s[x].size() &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (mx[x] == sz[son[x]])&#123;</span><br><span class="line">        <span class="keyword">auto</span> t = s[x].lwb(mx[x] - v) ;</span><br><span class="line">        <span class="keyword">if</span> (t != s[x].js() &amp;&amp; *t &lt;= v - mn[x]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = other.lwb(mx[x] - v) ;</span><br><span class="line">        <span class="keyword">if</span> (t != other.js() &amp;&amp; (*t) &lt;= v - mn[x]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">auto</span> pq = dads.lwb(mx[x] - v + sz[x]) ;</span><br><span class="line">        <span class="keyword">if</span> (pq != dads.js() &amp;&amp; (*pq) &lt;= v - mn[x] + sz[x]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">//mn[x] + x &lt;= ans -&gt; x &lt;= ans - mn[x]</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line"><span class="comment">//    debug(x, ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(other.size(), ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(s[x].size(), ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(dads.size()) ;</span></span><br><span class="line">    <span class="keyword">if</span> (!isrt(x))&#123;</span><br><span class="line">        other.era(other.fd(sz[x])) ;</span><br><span class="line">        <span class="keyword">if</span> (!isrt(fa[x])) dads.ins(sz[fa[x]]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    mn[x] = n - sz[x] ;</span><br><span class="line">    mx[x] = max(n - sz[x], sz[son[x]]) ;</span><br><span class="line">    smx[x] = min(n - sz[x], sz[son[x]]) ;</span><br><span class="line"><span class="comment">//    debug(x, '*') ;</span></span><br><span class="line"><span class="comment">//    debug(mn[x], '*') ;</span></span><br><span class="line"><span class="comment">//    debug(mx[x], '*') ;</span></span><br><span class="line"><span class="comment">//    debug(smx[x], '\n') ;// puts("")</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == fa[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (k == son[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        solve(k) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : s[k]) other.ins(t) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (son[x])&#123;</span><br><span class="line">        solve(son[x]) ;</span><br><span class="line">        swap(s[x], s[son[x]]) ;</span><br><span class="line">        chkmin(mn[x], sz[son[x]]) ;</span><br><span class="line">        <span class="keyword">if</span> (!mn[x]) mn[x] = sz[son[x]] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == fa[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (k == son[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        chkmin(mn[x], sz[k]) ;</span><br><span class="line">        chkmax(smx[x], sz[k]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : s[k])</span><br><span class="line">            other.era(other.find(t)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> l = smx[x], r = mx[x], mid ;</span><br><span class="line">    <span class="keyword">if</span> (smx[x] == mx[x]) <span class="keyword">goto</span> ycy ;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (!chk(mid, x)) l = mid + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> ans[x] = mid, r = mid - <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    ycy : <span class="keyword">if</span> (!ans[x]) ans[x] = mx[x] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == fa[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (k == son[x]) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> t : s[k]) s[x].ins(t) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isrt(x) &amp;&amp; !isrt(fa[x]))</span><br><span class="line">        dads.era(dads.fd(sz[fa[x]])) ;</span><br><span class="line">    s[x].ins(sz[x]) ;</span><br><span class="line"><span class="comment">//    debug(x, ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(other.size(), ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(s[x].size(), ' ') ;</span></span><br><span class="line"><span class="comment">//    debug(dads.size()) ;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span> ; k &lt;= n ; ++ k)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans[k]) ; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        x = qr(), y = qr() ;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y) rt = x + y ;</span><br><span class="line">        <span class="keyword">else</span> E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(rt, <span class="number">0</span>) ;</span><br><span class="line"><span class="comment">//    debug(son, 1, n) ;</span></span><br><span class="line"><span class="comment">//    debug(sz, 1, n) ;</span></span><br><span class="line">    solve(rt) ;</span><br><span class="line">    output() ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="CF-Round-400-Combined-D-The-Door-Problem"><a href="#CF-Round-400-Combined-D-The-Door-Problem" class="headerlink" title="[CF Round 400(Combined) D] The Door Problem"></a>[CF Round 400(Combined) D] The Door Problem</h1><blockquote><p>ç»™å®š $n$ æ‰‡é—¨ $m$ æŠŠé’¥åŒ™ï¼Œæ¯ä¸€æŠŠé’¥åŒ™ä¼šåŒæ—¶æ§åˆ¶ $k$ æ‰‡é—¨ï¼Œæ¯æ‰‡é—¨æœ€å¤šè¢«ä¸¤æŠŠé’¥åŒ™æ§åˆ¶ã€‚æ±‚æ˜¯å¦å­˜åœ¨ä¸€ä¸ªä½¿ç”¨é’¥åŒ™çš„æ–¹æ³•ä½¿å¾—å…¨éƒ¨çš„é—¨éƒ½å˜æˆå¼€çš„ã€‚</p></blockquote><p>é™æ™ºé¢˜ã€‚ä¸€å¼€å§‹ä¸€ç›´åœ¨æƒ³æ€ä¹ˆå»ºå›¾ï¼Œèƒ¡äº†ä¸€ä¸ªå¯¹æ¯æ‰‡é—¨å»ºä¿©ç‚¹è¡¨ç¤ºå¼€å…³ï¼Œè¢«æ†ç»‘çš„çŠ¶æ€è¿è¾¹ï¼Œç„¶åå» check æ˜¯å¦å­˜åœ¨ä¸€æ‰‡é—¨çš„ä¸¤ä¸ªçŠ¶æ€åœ¨ä¸€ä¸ª dsu é‡Œâ€¦ç„¶åå°±å‘ç°è¯»é”™é¢˜äº†ï¼Œå› ä¸ºå¹¶ä¸ä¸€å®šè¦ç”¨åˆ°æ‰€æœ‰é’¥åŒ™â€¦</p><p>ä¸è¿‡æœ‰ä¸€ä¸ªå¾ˆå¼ºçš„æ€§è´¨ï¼Œå°±æ˜¯ã€Œæ¯æ‰‡é—¨æœ€å¤šè¢«ä¸¤æŠŠé’¥åŒ™æ§åˆ¶ã€ã€‚ç„¶åå°±å¯ä»¥å¾ˆé«˜å…´åœ°å¯¹é’¥åŒ™å»ºè™šç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸€æŠŠé’¥åŒ™å»ºç«‹ä¿©ç‚¹ï¼Œä¸€ä¸ªè¡¨ç¤ºç”¨äº†ä¸€ä¸ªè¡¨ç¤ºæ²¡ç”¨ã€‚ç„¶åè€ƒè™‘æŠŠè§†çº¿è½¬åˆ°é—¨è¿™è¾¹ï¼Œæ ¹æ®ã€Œæ¯æ‰‡é—¨æœ€å¤šè¢«ä¸¤æŠŠé’¥åŒ™æ§åˆ¶ã€å¯çŸ¥å¦‚æœæŸæ‰‡é—¨æœ¬æ¥æ˜¯å¼€çš„ï¼Œå°±åº”è¯¥ä¸¤æŠŠé’¥åŒ™ä¸€èµ·ç”¨ï¼Œå¦åˆ™åªç”¨ä¸€æŠŠã€‚æ ¹æ®è¿™ä¸ªä¸€ç‚¹å»ºè¾¹å³å¯ã€‚</p><p>= =äººç”Ÿå¤ªè‰°éš¾äº†ã€‚</p><h1 id="CF-Round-190-Div1-C-Ciel-the-Commander"><a href="#CF-Round-190-Div1-C-Ciel-the-Commander" class="headerlink" title="[CF Round 190(Div1) C] Ciel the Commander"></a>[CF Round 190(Div1) C] Ciel the Commander</h1><blockquote><p>ç»™å®šä¸€æ£µæ ‘ï¼Œæ¯ä¸ªç‚¹åˆ†é…ä¸€ä¸ªå­—æ¯ <code>A~Z</code>ã€‚é—®æ˜¯å¦å­˜åœ¨ä¸€ä¸ªåˆ†é…æ–¹æ¡ˆä½¿å¾—ä»»æ„ä¸¤ç‚¹ $(x,y)$ ä¹‹é—´çš„ç®€å•è·¯å¾„ä¸Šä¸å­˜åœ¨ç‚¹æ¯” $x$ æˆ–è€… $y$ å­—å…¸åºå¤§çš„å­—æ¯ã€‚</p><p>$1\leq n\leq3\times 10^5$ ã€‚</p></blockquote><p>å¯ä»¥æ¯”è¾ƒå¥‡å¦™åœ°åšä¸€ä¸ªä»£æ¢ã€‚è€ƒè™‘å¯¹äºä¸€ä¸ªç‚¹ï¼Œä»–è¿å‡ºçš„è¿é€šå—å¤§å°åˆ†åˆ«æ˜¯ $s_1,s_2,s_3\cdots s_k$ã€‚é‚£ä¹ˆä¸éš¾å‘ç°æ— è®ºè¿™ä¸ªç‚¹æ˜¯è°ï¼Œéƒ½å­˜åœ¨ $\sum s_i=n-1$ ã€‚é‚£ä¹ˆå½“å’Œä¸å˜çš„æ—¶å€™ï¼Œå„å…ƒç´ åˆ†çš„è¶Šå¹³å‡ï¼Œä¸¤ä¸¤æˆç»©ä¹‹å’Œå°±è¶Šå¤§(å¯ä»¥ç”¨Cauchyä¸ç­‰å¼è¯)ã€‚äºæ˜¯å¯ä»¥çŸ¥é“åº”è¯¥æŒ‰é‡å¿ƒåˆ†ï¼Œé‡å¿ƒå¤„å­—å…¸åºå°½å¯èƒ½å°ï¼Œå°±å˜æˆäº†ä¸€ä¸ªæ¨¡æ‹Ÿç‚¹åˆ†æ²»é¢˜ã€‚</p><h1 id="CF-Codefest-18-D-Valid-BFS"><a href="#CF-Codefest-18-D-Valid-BFS" class="headerlink" title="[CF Codefest 18 D] Valid BFS ?"></a>[CF Codefest 18 D] Valid BFS ?</h1><blockquote><p>ç»™å‡ºä¸€æ£µæ ‘çš„ä¸€ä¸ª BFS åºï¼Œåˆ¤æ–­å…¶æ˜¯å¦åˆæ³•ã€‚</p></blockquote><p>æ•´ç†è¿™é¢˜æ˜¯å› ä¸ºè‡ªå·±æƒ³çš„ezæ–¹æ³•è¢«å‰äº†â€¦å¤§æ¦‚å°±æ˜¯è€ƒè™‘å¯¹è¿™æ£µæ ‘å…ˆ dfs ä¸€éï¼Œæ±‚å‡ºæ‰€æœ‰æ·±åº¦ï¼Œç„¶å BFS åºä¸­ä¸€å®šä¸ä¼šä¸ä¼šå­˜åœ¨å‰é¢ç‚¹çš„æ·±åº¦æ¯”åé¢çš„å°è¿™ç§æƒ…å†µã€‚ç„¶è€Œè¿™æ˜¯å¹¿å¤§å¿…è¦ä¸å……åˆ†æ¡ä»¶çš„å…¶ä¸­ä¹‹ä¸€ï¼Œå› ä¸ºæ²¡æœ‰è€ƒè™‘åŒä¸€ä¸ªç‚¹çš„å„¿å­ä¸€å®šæ˜¯è¢«è¿ç»­åŠ å…¥é˜Ÿåˆ—ä¸­è¿™ä¸ªçº¦æŸã€‚</p><p>äºæ˜¯å¯ä»¥è€ƒè™‘å¦ä¸€ç§æ¯”è¾ƒç®€æ´çš„æ–¹æ³•ã€‚è€ƒè™‘å¯¹æ¯ä¸ªç‚¹çš„å­©å­æŒ‰ç…§ç»™å‡ºçš„ BFS åºé‡Œçš„é¡ºåºæ’ä¸€éåºï¼Œæ¯æ¬¡èµ°å­©å­æŒ‰ç…§è¯¥é¡ºåºèµ°ã€‚æœ€åæ£€æµ‹åˆæ³•æ€§åªéœ€è¦æ¯”å¯¹ä¸€ä¸‹å’Œèµ°å‡ºæ¥çš„çœŸå® BFS åºæ˜¯å¦ä¸€è‡´å³å¯ã€‚</p><h1 id="CF-Round-513-Combined-D-Social-Circles"><a href="#CF-Round-513-Combined-D-Social-Circles" class="headerlink" title="[CF Round #513(Combined) D] Social Circles"></a>[CF Round #513(Combined) D] Social Circles</h1><blockquote><p>ç°åœ¨æœ‰ $n$ ä¸ªäººï¼Œæ¯ä¸€ä¸ªäººéƒ½ä¸æƒ³å‘¨å›´çš„äººåå¾—ç¦»ä»–å¾ˆè¿‘ï¼Œæ‰€ä»¥åœ¨ä»–çš„å·¦è¾¹è¦æ”¾ $l_i$ å¼ ç©ºçš„æ¤…å­ï¼Œå³è¾¹è¦æ”¾ $r_i$ å¼ ç©ºçš„æ¤…å­ã€‚</p><p>ç°åœ¨ä»–ä»¬è¦åæˆè‹¥å¹²ä¸ªåœˆï¼Œè¯·é—®æœ€å°‘è¦æ”¾å¤šå°‘å¼ æ¤…å­ã€‚</p><p>æ³¨æ„ï¼šå¯ä»¥ä¸€ä¸ªäººååœ¨ä¸€ä¸ªåœˆå†…ï¼Œæ¯ä¸€ä¸ªäººè¿˜éœ€è¦åä¸€å¼ æ¤…å­ã€‚</p><p>$1\leq n\leq 10^5$ ã€‚</p></blockquote><p>ä¸€å¼€å§‹è§‰å¾—æ˜¯è¦è®©æ‰€æœ‰äººæŒ‰ç…§ $\max\{l_i,r_i\}$ æ’ä¸ªåºï¼Œç„¶åæœ€ä¼˜çš„ä¸€å®šæ˜¯ä¸¤ä¸¤ä¸€ç»„åˆ¤ä¸ªè¾¹ç•Œã€‚åæ¥å‘ç°å‡äº†ã€‚æ¯”è¾ƒæ­£ç¡®çš„è´ªå¿ƒåº”è¯¥æ˜¯éœ€è¦è€ƒè™‘ã€Œå·¦å³æ— å…³ã€ã€‚å³ç”±äºåœˆæ˜¯éšä¾¿åˆ’åˆ†çš„ï¼Œæ‰€ä»¥åº”è¯¥å¯¹æ¯ä¸ª $r_i$ é€‰ä¸€ä¸ªè·Ÿå®ƒå¤§å°æœ€æ¥è¿‘çš„ $l_i$ã€‚è¿™æ ·å°±å¯ä»¥ç›´æ¥å¯¹ä¸¤ä¸ªæ•°ç»„æ’ä¸ªåºç„¶ååšäº†ã€‚</p><h1 id="CF-Round-513-Combined-E-Sergey-and-Subway"><a href="#CF-Round-513-Combined-E-Sergey-and-Subway" class="headerlink" title="[CF Round #513(Combined) E] Sergey and Subway"></a>[CF Round #513(Combined) E] Sergey and Subway</h1><blockquote><p>ç»™å‡ºä¸€é¢— $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ã€‚ç°åœ¨è¦å°†<strong>åŸå›¾ä¸­</strong>æ¯å¯¹ä¸ç›´æ¥è¿è¾¹ï¼Œä½†æ˜¯æ‹¥æœ‰å…±åŒé‚»å±…çš„ä¸¤ä¸ªç‚¹ä¹‹é—´è¿ä¸€æ¡è¾¹ã€‚</p><p>ç°åœ¨éœ€è¦æ±‚å‡ºæ–°å›¾ä¸­æ¯ä¸€ä¸ªç‚¹å¯¹ $(i,j) (1 \leq i \leq j \leq n)$ çš„ç»è¿‡çš„è¾¹æ•°å’Œã€‚</p><p>$1\leq n\leq 10^5$ ã€‚</p></blockquote><p>å†ä¸€æ¬¡æƒ¨é­é™æ™ºï¼ŒGGã€‚</p><p>ä¸è¿‡è¯è¯´å›æ¥è¿™é¢˜çš„ statement å±å®å¼±æ™ºã€‚ä»–é¢˜é¢é‡Œæ¯ä¸ª <code>tunnel</code> ä¹‹å‰éƒ½åŠ äº† <code>directed</code> ä½œä¸ºä¿®é¥°ï¼Œè¿™ tm å‘Šè¯‰æˆ‘ä¸æ˜¯ä»£è¡¨æ ‘å½¢å›¾è€Œæ˜¯ä»£è¡¨æ¯ä¸ªæ•°å¯¹åªç®—ä¸€æ¬¡æˆ‘ä¹Ÿæ˜¯å¾ˆä½›ã€‚å‡ºé¢˜äººæ˜¯åŠè¾ˆå­æ²¡è¯´è¿‡è¯å—ï¼Ÿéè¦åœ¨é¢˜é¢é‡ŒæŠŠè‡ªå·±çŸ¥é“çš„å½¢å®¹è¯éƒ½ nmd åˆ—å‡ºæ¥ä¸€éï¼Ÿï¼Ÿ</p><p>å¥½äº†ï¼Œç¥–å®‰ç»“æŸã€‚è€ƒè™‘æœ¬è´¨ä¸Šè¿çš„è¿™äº›è¾¹å¯¹ç­”æ¡ˆçš„åº”å…ˆå°±æ˜¯æŠŠåŸæ¥æŸäº›é•¿åº¦ä¸º $2$ çš„è·¯å¾„å‹ç¼©æˆäº†é•¿åº¦ä¸º $1$ çš„è·¯å¾„ã€‚å…·ä½“çš„ï¼Œå¦‚æœ $(x,y)$ ä¹‹é—´çš„è·ç¦»åŸæœ¬æ˜¯ $p$ï¼Œé‚£ä¹ˆå¦‚æœ $p$ æ˜¯å¥‡æ•°ï¼Œè·¯å¾„é•¿åº¦å°±ä¼šå˜æˆ $\left\lceil\dfrac{p}{2}\right\rceil$ï¼Œå¦åˆ™æ˜¯ $\dfrac{p}{2}$ ã€‚</p><p>è€ƒè™‘è·ç¦»å¯ä»¥æ€ä¹ˆé‡åŒ–ã€‚ç”±äº</p><script type="math/tex; mode=display">dis(x,y)=dep(x)+dep(y)-2\times dep({\rm LCA}(x,y))</script><p>å¯ä»¥å‘ç°æœ€åä¸€é¡¹ç³»æ•°æ˜¯ $2$ ä¸é€ æˆä»€ä¹ˆå½±å“ã€‚äºæ˜¯å°±å¯ä»¥ç›´æ¥è®¡ç®— $dep(x)+dep(y)$ æ˜¯å¥‡æ•°çš„è´¡çŒ®äº†ï¼Œä¸éš¾çŸ¥é“è¿™éœ€è¦ $dep(x),dep(y)$ ä¸­æ°å¥½ä¸€ä¸ªç‚¹çš„æ·±åº¦ä¸ºå¥‡æ•°ã€‚ ç®—ä¸€ä¸‹å°±å¥½äº†ã€‚</p><p>è¯´å®è¯è¿™é¢˜é™æ™ºåœ¨è€ƒè™‘åˆ°æ·±åº¦é‚£ä¸ªåœ°æ–¹å°±åœäº†â€¦</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤§æ¦‚æ˜¯å’Œã€Œç®€å•é¢˜é€‰åš ã€æ†ç»‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¸ªé‡Œé¢ç”¨æ¥è®°å½•è‡ªå·±ç§’æ‰è´¨é‡è¿˜å¯ä»¥çš„çš„é¢˜ç›®ï¼Œè¿™ä¸ªç”¨æ¥è®°å½•è‡ªå·±æƒ³äº†/å†™äº†å¥½ä¸€ä¼šå„¿çš„é¢˜ç›®ã€‚&lt;/p&gt;
&lt;p&gt;å—¯ï¼ŒåŠ æ²¹å§ã€‚åŠæ—¶å½“å‹‰åŠ±ï¼Œå²æœˆä¸å¾…äººã€‚&lt;/p&gt;
&lt;p&gt;å°±æ•´ç† 20 ä¸ªé¢˜å§ï¼å¼€æ–°çš„å•¦ï¼&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/è‡ªåŠ¨æœºä¸ŠDP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E8%87%AA%E5%8A%A8%E6%9C%BA%E4%B8%8ADP/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ•°æ®ç»“æ„/æ ‘çŠ¶æ•°ç»„" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ™®é€šDP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%99%AE%E9%80%9ADP/"/>
    
      <category term="æ€ç»´é¢˜/å®¹æ–¥" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AE%B9%E6%96%A5/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="æ ‘ä¸ŠæŠ€å·§/dsu on tree" scheme="https://www.orchidany.cn/tags/%E6%A0%91%E4%B8%8A%E6%8A%80%E5%B7%A7-dsu-on-tree/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æ ‘å½¢DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="æ•°å­¦/çº¿æ€§ä»£æ•°/çŸ©é˜µ" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0-%E7%9F%A9%E9%98%B5/"/>
    
      <category term="å­—ç¬¦ä¸²/å­åºåˆ—è‡ªåŠ¨æœº" scheme="https://www.orchidany.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2-%E5%AD%90%E5%BA%8F%E5%88%97%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    
      <category term="å›¾è®º/æ™®é€šå»ºå›¾æŠ€å·§" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E6%99%AE%E9%80%9A%E5%BB%BA%E5%9B%BE%E6%8A%80%E5%B7%A7/"/>
    
      <category term="å›¾è®º/å¹¶æŸ¥é›†" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
    
      <category term="æŠ€å·§/æŒ‰ä½æ“ä½œ" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E6%8C%89%E4%BD%8D%E6%93%8D%E4%BD%9C/"/>
    
      <category term="å­—ç¬¦ä¸²/Z-Algorithm" scheme="https://www.orchidany.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2-Z-Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>ã€å­¦ä¹ ç¬”è®°ã€‘å››å¤„çå­¦ä¸œè¥¿çš„ç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/05/16/%E5%9B%9B%E5%A4%84%E7%9E%8E%E5%AD%A6%E4%B8%9C%E8%A5%BF%E7%9A%84%E7%AC%94%E8%AE%B0/"/>
    <id>https://www.orchidany.cn/2020/05/16/å››å¤„çå­¦ä¸œè¥¿çš„ç¬”è®°/</id>
    <published>2020-05-16T08:15:52.000Z</published>
    <updated>2020-06-01T01:34:35.232Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¤§æ¦‚å°±æ˜¯å‘ç°æ‚ä¸ƒæ‚å…«å­¦æ¥çš„ä¸œè¥¿æ²¡æœ‰å¾ˆå¿…è¦æ•´ç†çš„å°±ä»ç•¥äº†ã€‚</p><p><del>å½“ç„¶æœ‰å¾ˆå¤šæ˜¯ä»¥å‰å­¦çš„ç»“æœç»™å¿˜äº†ã€‚</del></p><p>æ…¢æ…¢æ›´ï¼Œå’•å’•å’•ã€‚</p><a id="more"></a><h1 id="Gauss-Jordan-æ¶ˆå…ƒæ³•"><a href="#Gauss-Jordan-æ¶ˆå…ƒæ³•" class="headerlink" title="Gauss-Jordan æ¶ˆå…ƒæ³•"></a>Gauss-Jordan æ¶ˆå…ƒæ³•</h1><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘æ™®é€šçš„é«˜æ–¯æ¶ˆå…ƒæ˜¯æŠŠçŸ©é˜µæ¶ˆæˆä¸Šä¸‰è§’çŸ©é˜µã€‚è¿™æ ·æœ€åå°±å…ä¸äº†è¦æ¯”è¾ƒéº»çƒ¦åœ°å›ä»£ã€‚ç„¶åé«˜æ–¯-çº¦æ—¦æ¶ˆå…ƒçš„æƒ³æ³•æ˜¯ç›´æ¥æ¶ˆæˆå¯¹è§’çŸ©é˜µã€‚å…·ä½“å®ç°å¤§å·®ä¸å·®ï¼Œåªæ˜¯ä¸å†æ¶ˆå½“å‰è¡Œï¼Œä¸”æ¯æ¬¡å°†å…¶å®ƒè¡Œéƒ½ç»™æ¶ˆä¸€éã€‚è¿™æ ·æœ€åå‡ºæ¥çš„å°±ä¼šæ˜¯å¯¹è§’çŸ©é˜µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db f[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">gauss_jordan</span><span class="params">(<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= L ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (f[j][i] &gt; f[i][i]) swap(f[j], f[i]) ;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fabs</span>(f[i][i]) &lt; eps) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j == i) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = n + <span class="number">1</span> ; k &gt;= i + <span class="number">1</span> ; -- k)</span><br><span class="line">                f[j][k] -= f[j][i] / f[i][i] * f[i][k] ;</span><br><span class="line">        &#125;    </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans[i] = f[i][n + <span class="number">1</span>] / f[i][i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é“¾åˆ†æ²»ç»´æŠ¤dp"><a href="#é“¾åˆ†æ²»ç»´æŠ¤dp" class="headerlink" title="é“¾åˆ†æ²»ç»´æŠ¤dp"></a>é“¾åˆ†æ²»ç»´æŠ¤dp</h1><p>å¤§æ¦‚å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ $dp$ ã€‚ä¸»è¦é’ˆå¯¹äºä¸€å°éƒ¨åˆ†è½¬ç§»æ¯”è¾ƒæ–¹ä¾¿çš„ dp æ¥è¿›è¡Œç»´æŠ¤ã€‚å¤§æ¦‚æ“ä½œå°±æ˜¯é€šè¿‡è½»é‡é“¾å‰–åˆ†(æ™®é€šé‡å‰–)æˆ–è€…è™šå®é“¾å‰–åˆ†(åŠ¨æ€æ ‘)ä¹‹ç±»çš„ï¼Œé€šè¿‡åˆ†åˆ«ç»´æŠ¤ä¸¤ç±»å„¿å­çš„ $dp$ å€¼æ¥æ”¯æŒä¿®æ”¹ã€‚é‚£ä¹ˆä¸éš¾å‘ç°å½“ä¸”ä»…å½“è¿™ä¸ª dp ä¿¡æ¯åªéœ€è¦ up è€Œä¸éœ€è¦ bottomã€‚</p><p>ç„¶åå»ç”¨ LCT å†™äº†ä¸€å‘ luogu çš„ P4719ã€‚ä¹‹å‰ä¼¼ä¹æ˜¯åšè¿‡è¿™é¢˜ï¼Œä½†å½“æ—¶å¿…ç„¶æ˜¯åªä¼šæ¯”ç€æŠ„èƒ¡å°å…”çš„ä»£ç ã€‚ç„¶åå‘ç°è½»é‡é“¾å‰–æ˜¯çœŸçš„éš¾å†™ã€‚LCTçš„ä»£ç è¦çŸ­å¥½å¤šâ€¦</p><p>è€ƒè™‘å¤§æ¦‚å°±æ˜¯æ¯ä¸ªç‚¹ç»´æŠ¤ä¸¤ä¸ª dp å€¼ï¼Œ$g,f$ ï¼Œåˆ†åˆ«è¡¨ç¤ºã€Œåªè€ƒè™‘è™šå„¿å­ã€å’Œã€Œè€ƒè™‘äº†å…¨éƒ¨çš„å„¿å­ã€æ—¶çš„ç­”æ¡ˆã€‚è½¬ç§»æ¯”è¾ƒç®€å•ï¼Œå†™æˆçŸ©é˜µçš„å½¢å¼å°±æ˜¯</p><script type="math/tex; mode=display">\begin{bmatrix}f_{z,0}&f_{z,1}\end{bmatrix}\times \begin{bmatrix}g_{x,0} & g_{x,1}\\g_{x,0} & -\infty\\\end{bmatrix}= \begin{bmatrix}f_{x,0}&f_{x,1}\end{bmatrix}</script><p>å…¶ä¸­çŸ©é˜µä¹˜æ³•çš„å®šä¹‰ä¸º $\max$ åŒ…å« $+$ ã€‚</p><p>ç„¶åè®°å½•ç‚¹å®ç°ä¸Šçš„ç»†èŠ‚å§ï¼š</p><p>0ã€å‘ç° $g$ ä¸éœ€è¦ç”¨çŸ©é˜µæ¥ç»´æŠ¤ï¼Œç›´æ¥è®°å½•ä¸¤ä¸ªå€¼å°±å¥½äº†ã€‚</p><p>1ã€è€ƒè™‘åœ¨ $access$ çš„æ—¶å€™åŠ¨æ€ç»´æŠ¤ $g$ ã€‚å› ä¸ºè™šå®ä¸æ–­å˜åŒ–ã€‚æ–¹æ³•æ˜¯åŠ ä¸Šæ–°çš„å³å­æ ‘å¹¶ä¸”å‡æ‰å‰²ä¸‹æ¥çš„å³å­æ ‘ã€‚</p><p>2ã€è€ƒè™‘åœ¨ <code>push_up</code> çš„æ—¶å€™ç»´æŠ¤ $f$ ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº splay é‡Œé¢æ·±åº¦å•è°ƒï¼Œè€Œè¿™ç§è½¬ç§»æ˜¯éœ€è¦æŒ‰ç…§æ·±åº¦æ¥è½¬ç§»çš„ï¼Œæ‰€ä»¥éœ€è¦ <code>f(rc(x)) * trans(x) * f(lc(x))</code> æ¥åšã€‚</p><p>3ã€æœ‰äº›å®ç°æ˜¯éœ€è¦åˆ¤å·¦å³å„¿å­æ˜¯å¦ä¸ºç©ºã€‚å…¶å®å¯ä»¥ä¸ç”¨ã€‚åªè¦æŠŠ $f(0)$ å†™æˆå•ä½çŸ©é˜µå°±å¯ä»¥äº†ã€‚</p><p>4ã€è¿™é¢˜ç”¨ LCT å®ç°å…¶å®æ˜¯æœ‰ç‚¹å¤§æå°ç”¨çš„ã€‚å› ä¸ºæ ¹æœ¬ä¸éœ€è¦ LCT çš„å…¶ä»–ä»€ä¹ˆèŠ±é‡Œèƒ¡å“¨çš„æ“ä½œã€‚</p><p>ç„¶åå»æäº†æåŠ å¼ºç‰ˆï¼ŒåŠ äº† cyj çš„ I/O ä¹‹åï¼Œé  rp çˆ†äº†åå‡ å‘(å¯èƒ½ä¸åˆ°åå‘ï¼Œä½†åæ­£å°±æ˜¯å¾ˆå¤šå‘) OJ å°±è¿‡äº†/cy</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> lans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"></span><br><span class="line">vint E[N] ;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mat</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> m[<span class="number">2</span>][<span class="number">2</span>] ;</span><br><span class="line">    <span class="function">il <span class="title">mat</span> <span class="params">(<span class="keyword">int</span> a = -P, <span class="keyword">int</span> b = -P, <span class="keyword">int</span> c = -P, <span class="keyword">int</span> d = -P)</span></span>&#123;</span><br><span class="line">        m[<span class="number">0</span>][<span class="number">0</span>] = a ; m[<span class="number">0</span>][<span class="number">1</span>] = b ;</span><br><span class="line">        m[<span class="number">1</span>][<span class="number">0</span>] = c ; m[<span class="number">1</span>][<span class="number">1</span>] = d ;</span><br><span class="line">    &#125;</span><br><span class="line">    il mat <span class="keyword">friend</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> mat &amp; a, <span class="keyword">const</span> mat &amp; b)&#123;</span><br><span class="line">        mat c ; <span class="comment">//c.reset() ;</span></span><br><span class="line">        c.m[<span class="number">0</span>][<span class="number">1</span>] = max(a.m[<span class="number">0</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">1</span>], a.m[<span class="number">0</span>][<span class="number">1</span>]+ b.m[<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">        c.m[<span class="number">1</span>][<span class="number">1</span>] = max(a.m[<span class="number">1</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">1</span>], a.m[<span class="number">1</span>][<span class="number">1</span>]+ b.m[<span class="number">1</span>][<span class="number">1</span>]) ;</span><br><span class="line">        c.m[<span class="number">0</span>][<span class="number">0</span>] = max(a.m[<span class="number">0</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">0</span>], a.m[<span class="number">0</span>][<span class="number">1</span>]+ b.m[<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">        c.m[<span class="number">1</span>][<span class="number">0</span>] = max(a.m[<span class="number">1</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">0</span>], a.m[<span class="number">1</span>][<span class="number">1</span>]+ b.m[<span class="number">1</span>][<span class="number">0</span>]) ;</span><br><span class="line">        <span class="keyword">return</span> c ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> f(x) s[x].f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fa(x) s[x].fa</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> g_0(x) s[x].g[0]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> g_1(x) s[x].g[1]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc(x) s[x].son[0]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc(x) s[x].son[1]</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lct</span>&#123;</span></span><br><span class="line">    mat f ;</span><br><span class="line">    <span class="keyword">int</span> fa ;</span><br><span class="line">    <span class="keyword">int</span> g[<span class="number">2</span>] ;</span><br><span class="line">    <span class="keyword">int</span> son[<span class="number">2</span>] ;</span><br><span class="line">&#125;s[N * <span class="number">3</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">w_k</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (rc(fa(x)) == x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">notroot</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (lc(fa(x)) == x || rc(fa(x)) == x) ;</span><br><span class="line">&#125;</span><br><span class="line">il <span class="keyword">void</span> _up(<span class="keyword">int</span> x)&#123;</span><br><span class="line">    f(x) = f(rc(x)) * mat(g_0(x), g_1(x), g_0(x), -P) * f(lc(x)) ; <span class="comment">//2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> da = fa(x) ;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> dada = fa(da) ;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">bool</span> w = w_k(x), ww = w_k(da) ;</span><br><span class="line">    <span class="keyword">if</span> (notroot(da))</span><br><span class="line">        s[dada].son[ww] = x ;</span><br><span class="line">    fa(x) = dada ;</span><br><span class="line">    fa(s[x].son[w ^ <span class="number">1</span>]) = da ;</span><br><span class="line">    s[da].son[w] = s[x].son[w ^ <span class="number">1</span>] ;</span><br><span class="line">    s[x].son[w ^ <span class="number">1</span>] = da ; fa(da) = x ;</span><br><span class="line">    _up(da) ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (notroot(x))&#123;</span><br><span class="line">        <span class="keyword">if</span> (notroot(fa(x)))</span><br><span class="line">            rotate(w_k(fa(x)) == w_k(x) ? fa(x) : x) ;</span><br><span class="line">        rotate(x) ;</span><br><span class="line">    &#125;</span><br><span class="line">    _up(x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> y = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; x ; x = fa(y = x))&#123;</span><br><span class="line">        splay(x) ;</span><br><span class="line">       g_1(x) += f(rc(x)).m[<span class="number">0</span>][<span class="number">0</span>] - f(y).m[<span class="number">0</span>][<span class="number">0</span>] ;</span><br><span class="line">g_0(x) -= max(f(y).m[<span class="number">0</span>][<span class="number">0</span>], f(y).m[<span class="number">0</span>][<span class="number">1</span>]) ;</span><br><span class="line">g_0(x) += max(f(rc(x)).m[<span class="number">0</span>][<span class="number">0</span>], f(rc(x)).m[<span class="number">0</span>][<span class="number">1</span>]) ; </span><br><span class="line">        rc(x) = y ; _up(x) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prelude</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> dad)</span></span>&#123;</span><br><span class="line">    g_1(x) = base[x] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k != dad)&#123;</span><br><span class="line">            fa(k) = x ;</span><br><span class="line">            prelude(k, x) ;</span><br><span class="line">            g_1(x) += g_0(k) ;</span><br><span class="line">            g_0(x) += max(g_0(k), g_1(k)) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    f(x) = mat(g_0(x), g_1(x), g_0(x), -P) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    gi(n), gi(m) ; <span class="keyword">int</span> x, y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) gi(base[i]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">        gi(x), gi(y), E[x].p_b(y), E[y].p_b(x) ;</span><br><span class="line">    prelude(<span class="number">1</span>, <span class="number">0</span>) ; f(<span class="number">0</span>) = mat(<span class="number">0</span>, -P, -P, <span class="number">0</span>) ; </span><br><span class="line">    <span class="keyword">while</span> (m --)&#123;</span><br><span class="line">        gi(x) ; x ^= lans ;</span><br><span class="line">        gi(y) ; access(x) ; splay(x) ;</span><br><span class="line">        g_1(x) = g_1(x) + y - base[x] ;</span><br><span class="line">        _up(x) ; splay(<span class="number">1</span>) ; base[x] = y ;</span><br><span class="line">        lans = max(f(<span class="number">1</span>).m[<span class="number">0</span>][<span class="number">0</span>], f(<span class="number">1</span>).m[<span class="number">0</span>][<span class="number">1</span>]) ;</span><br><span class="line">        print(lans), pc(<span class="string">'\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Z-Algorithm"><a href="#Z-Algorithm" class="headerlink" title="Z-Algorithm"></a>Z-Algorithm</h1><p>å¤§æ¦‚å°±æ˜¯ä¿©ç”¨é€”ï¼š</p><p>1ã€ç»™å®šä¸€ä¸ªä¸² $s$ ã€‚æ±‚ $s$ çš„æ‰€æœ‰åç¼€ä¸ $s$ çš„ LCPã€‚</p><p>2ã€ç»™å®šä¸€ä¸ªä¸² $s$ å’Œä¸€ä¸ªä¸² $t$ï¼Œæ±‚ $s$ çš„æ‰€æœ‰åç¼€ä¸ $t$ çš„ LCPã€‚</p><p>æœ¬è´¨ä¸Šè·Ÿ ManaCher ååˆ†ç›¸ä¼¼ã€‚å¤§æ¦‚å°±æ˜¯æ±‚çš„æ—¶å€™ç»´æŠ¤ä¸€æ®µ LCP æœ€é å³çš„å­æ®µã€‚ç„¶åæ ¹æ®ç›¸å…³ä¿¡æ¯æ¨ä¸€ä¸‹å°±å¥½äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">    <span class="keyword">if</span> (r &lt; i) Z[i] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">else</span> Z[i] = min(Z[i - l + <span class="number">1</span>], r - i + <span class="number">1</span>) ; </span><br><span class="line">  <span class="comment">//å¯ä»¥ç†è§£ä¸º s[1...i-l+1] = s[l...i],i-l+1å‘ååŒ¹é…å¤šå°‘å°±æ˜¯iå‘åå¯ä»¥åŒ¹é…å¤šå°‘</span></span><br><span class="line">    <span class="keyword">while</span> (t[Z[i]] == t[i + Z[i] - <span class="number">1</span>]) ++ Z[i] ; <span class="comment">//ç»Ÿè®¡æ–°çš„è´¡çŒ®</span></span><br><span class="line">    <span class="keyword">if</span> (i + Z[i] - <span class="number">1</span> &gt; r) r = i + Z[i] - <span class="number">1</span>, l = i ; <span class="comment">//æ›´æ–°LCPæœ€é å³çš„å­æ®µ</span></span><br><span class="line">&#125;</span><br><span class="line">Z[<span class="number">1</span>] = n ;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ $Z[1]$ ä¸€èˆ¬ä¸æ˜¯è‰¯å®šä¹‰çš„ã€‚å¦‚æœéœ€è¦æœ€åå¯ä»¥èµ‹å€¼ä¸ºä¸²é•¿ã€‚</p><p>å½“ç„¶å¦‚æœå¯¹äºç¬¬äºŒé—®ï¼Œå¯ä»¥é‡‡å–åœ¨ $s$ åé¢æ¥ä¸€ä¸ªä¸å±äºå­—ç¬¦é›†çš„åˆ†éš”ç¬¦å†æ‹¼ä¸Š $t$ æ¥åšã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥å¦å¼€ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥åšè¿™ä¸ªã€‚ä½†æ³¨æ„åˆ°è¿™ä¸ªè¿‡ç¨‹éœ€è¦æå‰åšä¸€é $s$ çš„ $Z$ ï¼Œå› ä¸ºéœ€è¦é€šè¿‡ $Z$ æ¥åˆå§‹åŒ– $Pz$ ã€‚</p><p>è¿™ä¸ªåœ°æ–¹æœ‰ä¸ª<a href="https://www.luogu.com.cn/discuss/show/225597" target="_blank" rel="noopener">å°ç»†èŠ‚</a> ã€‚ç›´æ¥æ‹¼ä¸€ä¸ª <code>#</code> å•¥äº‹æ²¡æœ‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Z_F&#123;</span><br><span class="line">    <span class="keyword">int</span> L ;</span><br><span class="line">    <span class="keyword">int</span> Q ;</span><br><span class="line">    <span class="keyword">int</span> l, r ;</span><br><span class="line">    <span class="keyword">int</span> Z[N] ;</span><br><span class="line">    <span class="keyword">int</span> Pz[N] ;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gao</span><span class="params">(<span class="keyword">int</span> bg, <span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = bg ; i &lt; bg + L ; ++ i) Z[i] -- ;</span><br><span class="line">        Z[bg] = L ;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_Z</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> bg, <span class="keyword">int</span> oo = <span class="number">0</span>)</span></span>&#123;</span><br><span class="line">        L = <span class="built_in">strlen</span>(s + bg) ; l = bg, r = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = bg + <span class="number">1</span> ; i &lt; bg + L ; ++ i)&#123;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; i &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">if</span> (r &lt; i) Z[i] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> Z[i] = min(Z[i - l + <span class="number">1</span>], r - i + <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">while</span> (s[Z[i]] == s[i + Z[i] - <span class="number">1</span>]) ++ Z[i] ;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i + Z[i] - <span class="number">1</span>) r = i + Z[i] - <span class="number">1</span>, l = i ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!oo) gao(bg, L) ; </span><br><span class="line">        <span class="comment">//debug(Z, 1, L) ; </span></span><br><span class="line"><span class="keyword">return</span> L ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">exKMP</span><span class="params">(<span class="keyword">char</span> *s, <span class="keyword">int</span> bg, <span class="keyword">char</span> *t, <span class="keyword">int</span> gb)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> q = get_Z(s, bg, <span class="number">1</span>) ; s[q + <span class="number">1</span>] = <span class="string">'#'</span> ; </span><br><span class="line">        L = <span class="built_in">strlen</span>(t + gb) ; l = gb, r = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = gb ; i &lt; gb + L ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i) Pz[i] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> Pz[i] = min(Z[i - l + <span class="number">1</span>], r - i + <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">while</span> (s[Pz[i]] == t[i + Pz[i] - <span class="number">1</span>]) ++ Pz[i] ;</span><br><span class="line">            <span class="keyword">if</span> (r &lt; i + Pz[i] - <span class="number">1</span>) r = i + Pz[i] - <span class="number">1</span>, l = i ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = gb ; i &lt; gb + L ; ++ i) Pz[i] -- ;</span><br><span class="line"><span class="keyword">return</span> L ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CF126B-Password"><a href="#CF126B-Password" class="headerlink" title="CF126B Password"></a>CF126B Password</h2><blockquote><p>ç»™ä¸€ä¸ªä¸²ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ—¢æ˜¯å‰ç¼€åˆæ˜¯åç¼€å¹¶ä¸”è¿˜æ˜¯éå‰åç¼€å­ä¸²çš„æœ€é•¿å­ä¸²ã€‚</p><p>$n \leq 10^6$ã€‚</p></blockquote><p>è¢«é™æ™ºäº†å¥½ä¹…â€¦ä¸€å¼€å§‹å†™äº†ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿å‘ç°å‡çš„å¾ˆâ€¦</p><p>å¤§æ¦‚å°±æ˜¯å…ˆè€ƒè™‘å¦‚ä½•å¿«é€Ÿæ‰¾å‡ºæ—¢æ˜¯å‰ç¼€åˆæ˜¯åç¼€çš„ã€‚è¿™ä¸ªå¯ä»¥ KMP è§£å†³ï¼Œæˆ–è€…ç”¨ Z æ¥æšä¸¾æ¯ä¸ªåç¼€çš„ $i+z_i-1$ æ˜¯ä¸æ˜¯ç­‰äº $n$ ã€‚ç„¶åä»–è¿˜è¦æ±‚åœ¨ä¸­é—´å‡ºç°è¿‡ã€‚å‘ç°æˆ‘ä»¬åªå…³å¿ƒæœ€å¤§å€¼ä¸”ä¸å…³å¿ƒä¸­é—´çš„ä¸²çš„å…·ä½“æƒ…å†µï¼Œäºæ˜¯å°±ç»´æŠ¤ä¸€ä¸ªåˆ°ç°åœ¨ä¸ºæ­¢ä¸­é—´çš„ä¸²èƒ½åŒ¹é…ä¸Šçš„æœ€é•¿å‰ç¼€å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Z_F ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s + <span class="number">1</span>) ;</span><br><span class="line">    n = get_Z(s, <span class="number">1</span>) ; res = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i + Z[i] - <span class="number">1</span> == n &amp;&amp; Z[i] &lt;= mx)</span><br><span class="line">            <span class="keyword">if</span> (res &lt; Z[i]) res = Z[i], p = i ;</span><br><span class="line">        chkmax(mx, Z[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!res)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Just a legend"</span>), <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = p ; i &lt;= p + res - <span class="number">1</span> ; ++ i)</span><br><span class="line">        <span class="built_in">putchar</span>(s[i]) ; <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">""</span>), <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CF432D"><a href="#CF432D" class="headerlink" title="CF432D"></a>CF432D</h2><blockquote><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„é•¿å­—ç¬¦ä¸²ï¼Œâ€œå®Œç¾å­ä¸²â€æ—¢æ˜¯å®ƒçš„å‰ç¼€ä¹Ÿæ˜¯å®ƒçš„åç¼€ï¼Œæ±‚â€œå®Œç¾å­ä¸²â€çš„ä¸ªæ•°ä¸”ç»Ÿè®¡è¿™äº›å­ä¸²çš„åœ¨é•¿å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚$n\leq 10^6$ ã€‚ </p></blockquote><p>å…ˆæŠŠæ‰€æœ‰çš„ border åˆ¤å‡ºæ¥ã€‚ç»Ÿè®¡å‡ºç°æ¬¡æ•°å¯ä»¥ç›´æ¥å¼€ä¸€ä¸ªæ¡¶è®°å½•ä¸€ä¸‹æ¯ä¸ª $Z_i$ å€¼å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œç„¶ååç¼€å’Œä¸€ä¸‹å°±æ˜¯ç­”æ¡ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Z_F ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s + <span class="number">1</span>) ;</span><br><span class="line">    n = get_Z(s, <span class="number">1</span>) ; cnt = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        ans[Z[i]] ++ ;</span><br><span class="line">        <span class="keyword">if</span> (i + Z[i] - <span class="number">1</span> == n)</span><br><span class="line">            res[++ cnt] = Z[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        ans[i] += ans[i + <span class="number">1</span>] ; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    sort(res + <span class="number">1</span>, res + cnt + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, res[i], ans[res[i]]) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç½®æ¢"><a href="#ç½®æ¢" class="headerlink" title="ç½®æ¢"></a>ç½®æ¢</h1><p>ç½®æ¢æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ’åˆ—åˆ°å¦ä¸€ä¸ªæ’åˆ—çš„ä¸€ä¸€æ˜ å°„ã€‚ç½®æ¢çš„ä¹˜æ³•å°±å¯¹åº”äºå‡½æ•°å¤åˆã€‚</p><p>åŒæ—¶ä¸€ä¸ªç½®æ¢ä¹Ÿå¯ä»¥åˆ†è§£æˆè®¸å¤šè½®æ¢ï¼Œæ¯”å¦‚ $\begin{pmatrix}1&amp;2&amp;3&amp;4&amp;5\\3&amp;4&amp;5&amp;2&amp;1\end{pmatrix}$ å…¶ä¸­å°±åŒ…å«äº† $(1\to 3,3\to 5,5\to1)$ å’Œ $(2\to 4,4\to 2)$ è¿™ä¸¤ä¸ªå¾ªç¯ç§»ä½ã€‚</p><p>å—¯â€¦ä»¥ä¸Šæ˜¯æŠ„ä¹¦ã€‚ç„¶åè€ƒè™‘ $\sf Burnside$ å¼•ç†ï¼Œå³å¯¹äºä¸€ä¸ªå®šä¹‰åœ¨é›†åˆ $\sf G$ ä¸Šçš„ç½®æ¢ç¾¤ $\rm F$ è€Œè¨€ï¼Œè®¾ $f(s)$ ä¸ºåœ¨ç¾¤å†…æŸä¸ªç½®æ¢ $s$ æœ¬è´¨ä¸å˜çš„ $\sf G$ å†…å…ƒç´ ä¸ªæ•°(å³ã€Œä¸åŠ¨ç‚¹ä¸ªæ•°ã€)ï¼Œé‚£ä¹ˆç­‰ä»·ç±»ä¸ªæ•°ä¸ºï¼š</p><script type="math/tex; mode=display">\frac{1}{|\mathsf G|} \cdot \sum_{s\in \mathrm{F}} f(s)</script><p>ä½†æ˜¯è¿™ä¸ªä¸åŠ¨ç‚¹ä¸ªæ•°æœ‰æ—¶å€™ä¼šæ¯”è¾ƒéš¾æ±‚ã€‚è€Œ $\sf Polya$ å®šç†åˆ™åœ¨é™ˆè¿°è¿™ä¹ˆä¸€ä»¶äº‹ï¼šè€ƒè™‘å¯¹é›†åˆ G ä½œç”¨çš„å…ƒç´ è¿›è¡Œ $k-$æŸ“è‰²ï¼Œé‚£ä¹ˆæŸä¸ªç½®æ¢ $s$ ä¸‹ä¸åŠ¨ç‚¹çš„ä¸ªæ•°å°±æ˜¯ $k^{\zeta(s)}$ï¼Œå…¶ä¸­ $\zeta(s)$ æ˜¯ $s$ å¯ä»¥åˆ†è§£æˆçš„è½®æ¢çš„ä¸ªæ•°ã€‚ç„¶åå°±å˜æˆäº†ï¼š</p><script type="math/tex; mode=display">\frac{1}{|\mathsf G|} \cdot \sum_{s\in \mathrm{F}} k^{\zeta(s)}</script><p>ä¹Ÿå°±æ˜¯å¦‚æœã€Œæœ¬è´¨ä¸åŒã€çš„æ–¹å¼ä½¿ç”¨æŸ“è‰²æ¥å®šä¹‰çš„è¯ï¼Œå°±å¯ä»¥ç”¨ $\sf Polya$ æ¥ä¼˜åŒ–è®¡ç®—è¿‡ç¨‹ã€‚</p><h2 id="UVA-10294-Arif-in-Dhaka"><a href="#UVA-10294-Arif-in-Dhaka" class="headerlink" title="UVA 10294 Arif in Dhaka"></a>UVA 10294 Arif in Dhaka</h2><blockquote><p>æ±‚ $n$ ç‚¹ $t$ æŸ“è‰²çš„é¡¹é“¾æ•°å’Œæ‰‹é•¯æ•°ã€‚</p></blockquote><p>é¡¹é“¾æ•°æ¯”è¾ƒå¥½æ±‚ï¼Œè€ƒè™‘ç½®æ¢ç¾¤å†…çš„å…ƒç´ åˆ†åˆ«æ˜¯é¡ºæ—¶é’ˆæ—‹è½¬ $0,1,2\cdots n-1$ ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå‡è®¾æ—‹è½¬äº† $i$ ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶æ¯ä¸ªè½®æ¢å†…ä¼šæœ‰ $\dfrac{\mathrm{lcm}(n,i)}{i}$ ä¸ªå…ƒç´ (æ€»è·ç¦»é™¤ä»¥æ­¥é•¿)ï¼Œ é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æ€»å…±ä¼šæœ‰ $\dfrac{n}{\dfrac{\mathrm{lcm}(n,i)}{i}}$ ä¸ªè½®æ¢ï¼Œä¹Ÿå°±æ˜¯ $\gcd(n,i)$ ä¸ªè½®æ¢ã€‚</p><p>æ‰‹é•¯æ•°éœ€è¦åŠ ä¸Šå¯¹ç§°ã€‚è€ƒè™‘å½“ $n$ ä¸ºå¥‡æ•°ï¼Œä¸€å…±æœ‰ $n$ æ¡å¯¹ç§°è½´ï¼Œæ¯æ¡å¯¹ç§°è½´åˆ’åˆ†ä¸º $\dfrac{n-1}{2}$ ä¸ªé•¿åº¦ä¸º $2$ çš„è½®æ¢å’Œ $1$ ä¸ªé•¿åº¦ä¸º $1$ çš„è½®æ¢ï¼Œé‚£ä¹ˆè½®æ¢æ•°å°±æ˜¯ $\dfrac{n+1}{2}$ ï¼›å½“ $n$ ä¸ºå¶æ•°æ—¶ï¼Œä¼šæœ‰ä¸¤ç§å¯¹ç§°æ–¹å¼ï¼Œåˆ†åˆ«æœ‰ $\dfrac{n+1}{2}$  å’Œ $\dfrac{n}{2}$ ç§è½®æ¢ã€‚</p><p>å“¦ï¼Œå°ç»†èŠ‚ï¼Œç”±äºæœ¬è´¨ä¸Šæ‰‹é•¯é‡Œé¢æ¯æ¡å¯¹ç§°è½´éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç½®æ¢ï¼Œæ‰€ä»¥åº”è¯¥ä¹˜ä¸ªç³»æ•°ã€‚</p><h2 id="NWERC2006-Leonadoâ€™s-Notebook"><a href="#NWERC2006-Leonadoâ€™s-Notebook" class="headerlink" title="NWERC2006 Leonadoâ€™s Notebook"></a>NWERC2006 Leonadoâ€™s Notebook</h2><blockquote><p>ç»™å®šä¸€ä¸ªç½®æ¢ $A$ ï¼Œæ±‚æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç½®æ¢ $B$ ä½¿å¾— $B^2=A$ ã€‚</p></blockquote><p>è€ƒè™‘å°†ç½®æ¢åˆ†è§£æˆè½®æ¢ã€‚æ³¨æ„åˆ°å¦‚æœä¸¤ä¸ªè½®æ¢å½¼æ­¤ä¹‹é—´ä¸äº¤ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´çš„ä¹˜æ³•æ˜¯å…·æœ‰äº¤æ¢å¾‹çš„ã€‚åŒæ—¶è€ƒè™‘å¯¹äºä¸€ä¸ªå¥‡æ•°å¤§å°çš„è½®æ¢ï¼Œå°†å…¶å¹³æ–¹ä¹‹åä¾æ—§æ˜¯ä¸€ä¸ªè½®æ¢ï¼Œå¶æ•°å¤§å°çš„å¹³æ–¹ä¹‹ååˆ™å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªè½®æ¢ã€‚æ‰€ä»¥å¯¹äºç»™å®šçš„ç½®æ¢ï¼Œé•¿åº¦ä¸ºå¥‡æ•°çš„è½®æ¢å¯ä»¥ä¸ç”¨ç®¡ï¼Œå¦‚æœé•¿åº¦ä¸ºå¶æ•°çš„è½®æ¢æœ‰å¥‡æ•°ä¸ªå°±ä¼š ggã€‚</p><p>å…·ä½“è¯æ˜çš„è¯ï¼Œå¤§æ¦‚æ˜¯å…¨éƒ¨ç›¸åŒå¤§å°çš„ç½®æ¢éƒ½å¯ä»¥å±äºåŒä¸€ä¸ªç½®æ¢ç¾¤ï¼Œä¹‹åå°±å¯ä»¥å¯¹äºæ¯ä¸ªè½®æ¢é‡æ ‡å·æ¥è¯æ˜äº†ã€‚</p><p>ä¸è¿‡è½®æ¢çš„ä¹˜æ³•æ¯”è¾ƒâ€¦éº»çƒ¦ã€‚æ¯”å¦‚ $(1~2~3)(1~2~3)=(1~3~2)$ ï¼Œ$(1~2~3~4)(1~2~3~4)=(3~4~1~2)=(1,3)(2,4)$ ã€‚æ„Ÿè§‰è‡ªå·±ä¸€ç¢°åˆ°è¿™ç§ç½®æ¢çš„å°± ggã€‚</p><h2 id="UVA11077-Find-the-Permutations"><a href="#UVA11077-Find-the-Permutations" class="headerlink" title="UVA11077 Find the Permutations"></a>UVA11077 Find the Permutations</h2><blockquote><p>ç»™å®šä¸€ä¸ªæ’åˆ—ï¼Œæ¯æ¬¡å¯ä»¥äº¤æ¢ä¸¤ä¸ªæ•°ï¼Œæ±‚è‡³å°‘éœ€è¦äº¤æ¢ $k$ æ¬¡æ‰èƒ½è®©æ’åˆ—é€’å¢çš„æ’åˆ—æ•°ã€‚</p></blockquote><p>å‘ç°å¯ä»¥å°†ç»™å®šçš„è¿™ä¸ªæ’åˆ—çœ‹åš $(1,2,3\cdots n)$ çš„ä¸€ä¸ªç½®æ¢ã€‚é‚£ä¹ˆè€ƒè™‘å°†å…¶è½®æ¢åˆ†è§£ä¹‹åï¼Œå¯¹äºä¸€ä¸ªå¤§å°ä¸º $k$ çš„è½®æ¢ï¼Œä¸éš¾å‘ç°éœ€è¦äº¤æ¢ $k-1$ æ¬¡ã€‚äºæ˜¯å¯ä»¥ dpï¼Œ$f_{i,j}$ è¡¨ç¤ºé•¿åº¦ä¸º $i$ çš„æ’åˆ—è‡³å°‘äº¤æ¢ $j$ æ¬¡çš„æ’åˆ—æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆæ¯æ¬¡è€ƒè™‘æ–°åŠ è¿›æ¥çš„å…ƒç´ æ˜¯å¦æ”¾åˆ°ä¹‹å‰çš„æŸä¸ªè½®æ¢é‡Œï¼Œæ•…æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{i,j}=f_{i-1,j}+(i-1)\cdot f_{i-1,j-1}</script><p>â€¦â€¦å‘ç°è¿™å°±æ˜¯ç¬¬ä¸€ç±»æ–¯ç‰¹æ—æ•°ã€‚åŸå› æ˜¯è€ƒè™‘å¦‚æœæœ‰ $p$ ä¸ªè½®æ¢ï¼Œé‚£ä¹ˆè‡³å°‘éœ€è¦äº¤æ¢ $n-p$ æ¬¡ã€‚è€Œç¬¬ä¸€ç±»æ–¯ç‰¹æ—æ•°çš„æ„ä¹‰å°±åŒ…æ‹¬ $n$ å…ƒç½®æ¢å¯åˆ†è§£ä¸º $k$ ä¸ªç‹¬ç«‹çš„è½®æ¢(è½®æ¢)çš„ä¸ªæ•°ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±åº”è¯¥æ˜¯ $s_1(n,n-k)$ã€‚è€Œç”¨ä¸Šé¢è¿™ç§æ¨æ³•æ¨å‡ºæ¥çš„ä¸œè¥¿æ°ä¸ç¬¬ä¸€ç±»æ–¯ç‰¹æ—æ•°æ°´å¹³å¯¹ç§°ã€‚</p><h2 id="CERC-SWERC2005-Pixel-Shuffle"><a href="#CERC-SWERC2005-Pixel-Shuffle" class="headerlink" title="CERC/SWERC2005 Pixel Shuffle"></a>CERC/SWERC2005 Pixel Shuffle</h2><blockquote><p>ç»™å®šä¸€äº›å…³äº $n\times n$ çš„é»‘ç™½æ–¹æ ¼çš„å¥‡æ€ªæ“ä½œï¼Œæ±‚è‡³å°‘å¤šå°‘æ¬¡æ“ä½œå¯ä»¥å˜æ¢ä¼šåŸæ¥çš„æ ·å­ã€‚</p><p>$n\leq 1024,k\leq10$ ã€‚</p></blockquote><p>å‘ç°æœ¬è´¨ä¸Šæ˜¯ç»™å®šä¸€ä¸ªç½®æ¢ $A$ï¼Œæ±‚ä¸€ä¸ªæœ€å°çš„ $m$ ä½¿å¾— $A^m=I$ ã€‚ç„¶åå¤§æ¦‚å°±æ˜¯è€ƒè™‘è½®æ¢çš„æ€§è´¨ã€‚å¯¹äº $A$ ä¸­çš„ä¸€ä¸ªé•¿åº¦ä¸º $p$ çš„è½®æ¢ï¼Œå¦‚æœæƒ³è¦å…¨ç­‰ï¼Œå°±å¿…é¡»è¦è®© $p|m$ ã€‚æ‰€ä»¥æœ€åç­”æ¡ˆå°±æ˜¯æ‰€æœ‰è½®æ¢å¤§å°çš„æœ€å°å…¬å€æ•°ã€‚  </p><p>æ‰¾è½®æ¢çš„è¯å¤§æ¦‚å°±æ˜¯å¯¹æ¯ä¸ªä½ç½®ç¼–ä¸€ä¸ªå·ï¼Œæ‰¾å°±å¥½äº†ã€‚UVA å±å®ç¥å¿… OJï¼Œå’Œè¿‡äº†çš„ç¨‹åºæ‹äº†ä¸€ä¸‡ç»„äº¤ä¸Šå»ä¾æ—§ WAWAWAã€‚é‡åˆ°è¿™ç§æƒ…å†µé‚£å¿…ç„¶æ˜¯ä¸ç®¡äº†ã€‚</p><p>å‘ç°ä¸­å›½ OJ è¿™ä¹ˆå¤šé¢˜ï¼Œåˆ˜æ±ä½³éè¦æ‰¾ UVA å†™ä¹¦ã€‚çœŸæ˜¯ mdzzã€‚</p><p>ä¸è¿‡å€’æ˜¯è¿‡äº†ä¸»å¸­çš„é­”æ”¹ç‰ˆï¼Œè¿™é‡Œç•™ä¸ªé“¾æ¥: <a href="https://www.luogu.com.cn/problem/U107438" target="_blank" rel="noopener">æˆ³</a> ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> T, n, m ;</span><br><span class="line"><span class="keyword">int</span> tmp[N][N] ;</span><br><span class="line"><span class="keyword">int</span> base[N][N] ;</span><br><span class="line"><span class="keyword">int</span> dododo[<span class="number">99</span>] ;</span><br><span class="line"><span class="keyword">char</span> opt[<span class="number">5000</span>] ;</span><br><span class="line"><span class="keyword">char</span> tpo[<span class="number">5000</span>] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N * N] ;</span><br><span class="line"><span class="keyword">unsigned</span> ll ans ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_do</span><span class="params">(<span class="keyword">int</span> mk)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(mk) == <span class="number">1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                base[i][j] = tmp[j][n - i + <span class="number">1</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">-2</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                base[j][n - i + <span class="number">1</span>] = tmp[i][j] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(mk) == <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n / <span class="number">2</span> ; ++ j)</span><br><span class="line">                base[i][j] = tmp[i][n - j + <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = n / <span class="number">2</span> + <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                base[i][j] = tmp[i][n - j + <span class="number">1</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(mk) == <span class="number">4</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> + <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> + <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n / <span class="number">2</span> ; ++ j)</span><br><span class="line">                base[i][j] = tmp[i][n - j + <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span>  + <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = n / <span class="number">2</span> + <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                base[i][j] = tmp[i][n - j + <span class="number">1</span>] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(mk) == <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> + <span class="number">1</span> ; i &lt;= n / <span class="number">4</span> * <span class="number">3</span> ; ++ i)</span><br><span class="line">            swap(base[i], base[n - (i - n / <span class="number">2</span>) + <span class="number">1</span>]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">6</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span> ; i &lt;= n / <span class="number">2</span> ; ++ i, j += <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">memcpy</span>(base[i], tmp[j], <span class="keyword">sizeof</span>(tmp[j])) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> + <span class="number">1</span>, j = <span class="number">2</span> ; i &lt;= n ; ++ i, j += <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">memcpy</span>(base[i], tmp[j], <span class="keyword">sizeof</span>(tmp[j])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">-6</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span> ; i &lt;= n / <span class="number">2</span> ; ++ i, j += <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">memcpy</span>(base[j], tmp[i], <span class="keyword">sizeof</span>(tmp[i])) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> + <span class="number">1</span>, j = <span class="number">2</span> ; i &lt;= n ; ++ i, j += <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">memcpy</span>(base[j], tmp[i], <span class="keyword">sizeof</span>(tmp[i])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">7</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">int</span> l = n / <span class="number">2</span>, r = n / <span class="number">2</span> ;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>) l = <span class="number">0</span>,  r = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i &amp; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (j &amp; <span class="number">1</span>) base[i][j] = tmp[i][++ l] ;</span><br><span class="line">                    <span class="keyword">else</span> base[i][j] = tmp[i + <span class="number">1</span>][++ r] ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (j &amp; <span class="number">1</span>) base[i][j] = tmp[i - <span class="number">1</span>][++ l] ;</span><br><span class="line">                    <span class="keyword">else</span> base[i][j] = tmp[i][++ r] ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mk == <span class="number">-7</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                tmp[i][j] = base[i][j] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">int</span> l = n / <span class="number">2</span>, r = n / <span class="number">2</span> ;</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>) l = <span class="number">0</span>,  r = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i &amp; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (j &amp; <span class="number">1</span>) base[i][++ l] = tmp[i][j] ;</span><br><span class="line">                    <span class="keyword">else</span> base[i + <span class="number">1</span>][++ r] = tmp[i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (j &amp; <span class="number">1</span>) base[i - <span class="number">1</span>][++ l] = tmp[i][j] ;</span><br><span class="line">                    <span class="keyword">else</span> base[i][++ r] = tmp[i][j] ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (int i = 1 ; i &lt;= n ; ++ i)</span></span><br><span class="line"><span class="comment">        for (int j = 1 ; j &lt;= n ; ++ j)</span></span><br><span class="line"><span class="comment">            cout &lt;&lt; base[i][j] &lt;&lt; " \n"[j == n] ;</span></span><br><span class="line"><span class="comment">    puts(" - - - - - - - - - - - - - ") ;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> owo = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (base[i][j] != (++ owo)) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> tot, cnt ;</span><br><span class="line"><span class="keyword">unsigned</span> ll res[N * N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> ll <span class="title">gcd</span><span class="params">(<span class="keyword">unsigned</span> ll x, <span class="keyword">unsigned</span> ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> y ? gcd(y, x % y) : x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> ll <span class="title">lcm</span><span class="params">(<span class="keyword">unsigned</span> ll x, <span class="keyword">unsigned</span> ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * y / gcd(x, y) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">record</span><span class="params">(<span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line">    ++ cnt ;</span><br><span class="line"> <span class="keyword">if</span> (s[<span class="number">0</span>] == <span class="string">'-'</span>)</span><br><span class="line"> dododo[cnt] = <span class="number">-1</span>, ++ s ; <span class="keyword">else</span> dododo[cnt] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"tor"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">2</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"mys"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">3</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"myshb"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">4</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"mysvb"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">5</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"vid"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">6</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s, <span class="string">"xim"</span>) == <span class="number">0</span>) dododo[cnt] *= <span class="number">7</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    freopen(<span class="string">"gen.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"aa.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) ; getchar() ;</span><br><span class="line"><span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis)) ;</span><br><span class="line"><span class="built_in">memset</span>(base, <span class="number">0</span>, <span class="keyword">sizeof</span>(base)) ;</span><br><span class="line">        ans = <span class="number">1</span>, tot = cnt = <span class="number">0</span> ;</span><br><span class="line">        fgets(opt, (<span class="keyword">sizeof</span> opt / <span class="keyword">sizeof</span> opt[<span class="number">0</span>]), <span class="built_in">stdin</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, k = <span class="number">0</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j) base[i][j] = ++ k ;</span><br><span class="line">        m = <span class="built_in">strlen</span>(opt) ; <span class="keyword">int</span> ps = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = m - <span class="number">1</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (opt[i] != <span class="string">' '</span>) tpo[ps ++] = opt[i] ;</span><br><span class="line">            <span class="keyword">else</span> tpo[ps] = <span class="string">'\0'</span>, record(tpo), ps = <span class="number">0</span> ;</span><br><span class="line">        tpo[ps] = <span class="string">'\0'</span> ; record(tpo) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i) do_do(dododo[i]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)&#123;</span><br><span class="line">                <span class="keyword">if</span> (vis[base[i][j]]) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">int</span> x = i, y = j, z, o = <span class="number">0</span> ;</span><br><span class="line">                <span class="keyword">while</span> (!vis[base[x][y]])&#123;</span><br><span class="line">                    vis[base[x][y]] = <span class="number">1</span> ; z = base[x][y] ;</span><br><span class="line">                    x = z / n + (!(<span class="keyword">bool</span>)(z % n == <span class="number">0</span>)) ;</span><br><span class="line">                    y = z % n ; <span class="keyword">if</span> (!y) y = n ; ++ o ;</span><br><span class="line"><span class="comment">//                    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; y &lt;&lt; '\n' ;</span></span><br><span class="line">                &#125;</span><br><span class="line">                res[++ tot] = o ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//        debug(res, 1, tot) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= tot ; ++ i) ans = lcm(ans, res[i]) ;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%llu\n"</span>, tot &gt;= <span class="number">1</span> ? ans : <span class="number">0</span>) ;</span><br><span class="line"><span class="keyword">if</span> (T) <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">8</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">-2 -6 -7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></div></div><h1 id="æœ€å¤§æµ-ISAP"><a href="#æœ€å¤§æµ-ISAP" class="headerlink" title="æœ€å¤§æµ-ISAP"></a>æœ€å¤§æµ-ISAP</h1><p>å¤§æ¦‚å°±æ˜¯è®¾ $d_x$ è¡¨ç¤ºæ®‹é‡ç½‘ç»œä¸Š $x$ åˆ°æ±‡ç‚¹ $t$ çš„è·ç¦»ã€‚é‚£ä¹ˆä¸ºäº†åªåœ¨æ®‹é‡ç½‘ç»œä¸Šè¿›è¡Œå¢å¹¿ï¼Œæ‰€ä»¥æ¯æ¬¡åªèƒ½æ²¿ç€ $d_y+1=d_x$ çš„ $(x,y)$ å¢å¹¿ã€‚é‚£ä¹ˆæ™®é€šçš„ Dinic çš„æƒ³æ³•æ˜¯æ¯æ¬¡æ±‚å‡ºä¸€å¼ å¢å¹¿ç½‘ï¼Œç„¶åå¯¹è¿™å¼ å¢å¹¿ç½‘è¿›è¡Œå¤šè·¯å¢å¹¿ï¼Œä¸ºäº†ä¿è¯å¢å¹¿è·¯ä¹‹é—´ä¸ç›¸äº¤æ‰€ä»¥å¼•å…¥äº†é«˜åº¦çš„æ¦‚å¿µã€‚ISAP ä¹Ÿå·®ä¸å¤šã€‚åªä¸è¿‡æ˜¯åœ¨æ‰¾å¢å¹¿è·¯çš„è¿‡ç¨‹ä¸­åŠ¨æ€åœ°ä¿®æ”¹æ ‡å·ã€‚å³è€ƒè™‘åœ¨å¢å¹¿çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›è¾¹ $(x,y)$ ä»æ®‹é‡ç½‘ç»œä¸­æŠ¹æ‰ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ¡è¾¹ç”¨æ¥ä¼ é€’æ ‡å·çš„è¾¹ï¼Œå³ $d_y+1=d_x$ï¼Œå°±éœ€è¦æ‰¾åˆ°å¦ä¸€æ¡è¾¹ $(x,z)$ å¹¶ç»™ $x$ é‡æ ‡å·ä¸€ä¸ªé«˜åº¦ä¸º $d_z+1$ ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä¸€å¼€å§‹ç”¨ä¸€ä¸ª bfs æ¥é¢„å¤„ç†ï¼Œä¸éš¾çœ‹å‡ºåº”è¯¥å€’ç€é¢„å¤„ç†ï¼Œå› ä¸ºåœ¨æŸæ¡è¾¹è¢«åˆ æ‰ä¹‹åï¼Œä» <code>from</code> æ‰¾ <code>to</code> æ¯”ä» <code>to</code> æ‰¾ <code>from</code> è¦ç®€å•å¾—å¤šï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ ISAP å¯¹é«˜åº¦çš„å®šä¹‰å’Œ Dinic ç›¸åçš„åŸå› (Dinic å…¶å®æ— æ‰€è°“æ€ä¹ˆå®šä¹‰ï¼Œå› ä¸ºæ¨ªç«–éƒ½è¦é‡æ–°ç”Ÿæˆå¢å¹¿ç½‘)ã€‚å½“æºç‚¹ $s$ æ— å¤„å¢å¹¿æ—¶ç®—æ³•åœæ­¢ã€‚</p><p>é‚£ä¹ˆæœ‰ä¸€ä¸ªä¼˜åŒ–å«åšã€Œgap ä¼˜åŒ–ã€ã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘ä¸€æ¡å¢å¹¿è·¯ä¸Šçš„ç‚¹çš„æ ‡å·å¿…ç„¶æ˜¯å•è°ƒçš„ã€‚é‚£ä¹ˆå¦‚æœå‡ºç°äº†æŸä¸ªæ–­å±‚ï¼Œå¯ä»¥çŸ¥é“ä¸å†å­˜åœ¨å¢å¹¿è·¯ã€‚äºæ˜¯å¯ä»¥ç›´æ¥ç»“æŸã€‚</p><p>å®ç°æ–¹é¢ï¼Œå¯ä»¥è®°ä¸€ä¸ªå½“å‰å¼§æ¥ä¿è¯åªåœ¨æ®‹é‡ç½‘ç»œä¸Šå¢å¹¿ã€‚</p><p>æœ€ç»ˆå¯ä»¥çŸ¥é“ ISAP æœ¬è´¨ä¸Šæ˜¯åœ¨å’Œ Dinic åšåŒä¸€ä»¶äº‹ï¼Œå› ä¸º ISAP çš„é‡æ ‡å·ä¸€å®šä¼šæ˜¯æ ‡å®šæœ€å°çš„é‚£ä¸ª $z$ çš„ $h_z+1$ ï¼Œè·Ÿæ±‚å¢å¹¿ç½‘æœ¬è´¨ç›¸åŒã€‚æ‰€ä»¥å¤æ‚åº¦ä¸Šç•Œä¹Ÿæ˜¯ $O(n^2m)$ çš„ã€‚</p><p>å“¦ï¼Œé¡ºä¾¿æä¸€å˜´ã€‚ä¼¼ä¹æœ‰è¯æ˜å½“å®¹é‡å‡ä¸º $1$ æ—¶ï¼Œå¤æ‚åº¦æœ‰ç€æ›´åŠ ä¼˜ç§€çš„ä¸Šç•Œ $O(m\sqrt[3] {n^2}+m\sqrt m)$ ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> ISAP&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> from ;</span><br><span class="line">        <span class="keyword">int</span> flow ;</span><br><span class="line">        <span class="keyword">int</span> cap ;</span><br><span class="line">        <span class="keyword">int</span> to ;</span><br><span class="line">        edge (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>)&#123;</span><br><span class="line">            from = a, to = b, cap = c, flow = <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; e[N] ;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    <span class="keyword">int</span> cnt ;</span><br><span class="line">    <span class="keyword">int</span> ans ;</span><br><span class="line">    <span class="keyword">int</span> S, T ;</span><br><span class="line">    <span class="keyword">int</span> h, t ;</span><br><span class="line">    <span class="keyword">int</span> que[N] ;</span><br><span class="line">    <span class="keyword">int</span> pre[N] ;</span><br><span class="line">    <span class="keyword">int</span> hgt[N] ;</span><br><span class="line">    <span class="keyword">int</span> cur[N] ;</span><br><span class="line">    <span class="keyword">int</span> gap[N] ;</span><br><span class="line">    <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">        e[++ cnt] = edge(x, y, c) ; E[x].push_back(cnt) ;</span><br><span class="line">        e[++ cnt] = edge(y, x, <span class="number">0</span>) ; E[y].push_back(cnt) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(cur, <span class="number">0</span>, <span class="keyword">sizeof</span>(cur)) ;</span><br><span class="line">        <span class="built_in">memset</span>(hgt, <span class="number">0</span>, <span class="keyword">sizeof</span>(hgt)) ;</span><br><span class="line">        <span class="built_in">memset</span>(gap, <span class="number">0</span>, <span class="keyword">sizeof</span>(gap)) ;</span><br><span class="line">        S = x, T = y, n = z ; cnt = <span class="number">-1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[i].clear() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">preBFS</span><span class="params">()</span></span>&#123;</span><br><span class="line">        h = <span class="number">1</span>, t = <span class="number">0</span> ;</span><br><span class="line">        que[++ t] = T ;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = que[h ++] ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])</span><br><span class="line">                <span class="keyword">if</span> (!hgt[e[k].to] &amp;&amp; e[k].to != T)</span><br><span class="line">                    hgt[que[++ t] = e[k].to] = hgt[x] + <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) gap[hgt[i]] ++ ;</span><br><span class="line"><span class="comment">//        debug(hgt, 1, n) ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Augment</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = T ;</span><br><span class="line">        <span class="keyword">int</span> f = Inf ;</span><br><span class="line">        <span class="keyword">while</span> (x != S)&#123;</span><br><span class="line"><span class="comment">//            debug(x) ;</span></span><br><span class="line">            f = min(f, e[pre[x]].cap - e[pre[x]].flow) ;</span><br><span class="line">            x = e[pre[x]].from ;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += f ; x = T ;</span><br><span class="line">        <span class="keyword">while</span> (x != S)&#123;</span><br><span class="line">            e[pre[x]].flow += f ;</span><br><span class="line">            e[pre[x] ^ <span class="number">1</span>].flow -= f ;</span><br><span class="line">            x = e[pre[x]].from ;<span class="comment">//1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Advance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = cur[x] ; k &lt; E[x].size() ; ++ k)&#123;</span><br><span class="line">            <span class="keyword">int</span> p = E[x][k] ;</span><br><span class="line"><span class="comment">//             debug(e[p].to) ;//0</span></span><br><span class="line">            <span class="keyword">if</span> (e[p].flow &gt;= e[p].cap) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (hgt[e[p].to] + <span class="number">1</span> != hgt[x]) <span class="keyword">continue</span> ;</span><br><span class="line">            pre[e[p].to] = p ; cur[x] = k ;</span><br><span class="line">            y = e[p].to ; ret = <span class="number">1</span> ; <span class="keyword">break</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">isap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        preBFS() ;</span><br><span class="line">        <span class="keyword">int</span> x = S ;</span><br><span class="line">        <span class="keyword">while</span> (hgt[S] &lt; n)&#123;</span><br><span class="line"><span class="comment">//            debug(x) ;</span></span><br><span class="line">            <span class="keyword">if</span> (x == T)</span><br><span class="line">                Augment(), x = S ;</span><br><span class="line">            <span class="keyword">if</span> (!Advance(x, x))&#123;</span><br><span class="line">                <span class="keyword">int</span> h = n - <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">                    <span class="keyword">if</span> (e[k].flow &lt; e[k].cap)</span><br><span class="line">                        h = min(h, hgt[e[k].to]) ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!-- gap[hgt[x]]) <span class="keyword">break</span> ;</span><br><span class="line">                gap[hgt[x] = h + <span class="number">1</span>] ++ ; cur[x] = <span class="number">0</span> ;</span><br><span class="line">                <span class="keyword">if</span> (x != S) x = e[pre[x]].from ;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            break ;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t ;</span><br></pre></td></tr></table></figure></div></div><h1 id="KM-ç®—æ³•"><a href="#KM-ç®—æ³•" class="headerlink" title="KM ç®—æ³•"></a>KM ç®—æ³•</h1><p>å‘ƒï¼Œè¿™ç®—æ³•çœŸçš„æ˜¯å­¦äº†å¾ˆä¹…ã€‚ä»¥ä¸‹é»˜è®¤æ±‚çš„æ˜¯æœ€å¤§æƒåŒ¹é…ã€‚</p><p>æ˜¯ç”¨æ¥æ±‚ã€Œå®Œç¾åŒ¹é…ã€åŸºç¡€ä¸Šçš„ã€Œæœ€ä½³æƒå€¼åŒ¹é…ã€ã€‚ã€Œå®Œç¾åŒ¹é…ã€å¤§æ¦‚å°±æ˜¯è¯´å¯¹äºä¸€å¼ äºŒåˆ†å›¾ $G=\{V_1,V_2,E\}$ï¼Œè®¾ $|V_1|\lt |V_2|$ï¼Œå¯¹äºæŸä¸ªåŒ¹é… $Mâ€™$ å¦‚æœå¯ä»¥ä½¿å¾—  $V_1$ ä¸­çš„ç‚¹å‡å¯ä»¥è¢«åŒ¹é…åˆ°ï¼Œé‚£ä¹ˆå°±ç§° $Mâ€™$ ä¸º $G$ çš„ä¸€ä¸ªå®Œç¾åŒ¹é…ã€‚</p><p>ç„¶å KM ç®—æ³•å¤§æ¦‚æ˜¯å¯¹äºæ¯ä¸ªç‚¹è®¾ç½®ä¸€ä¸ªé¡¶æ ‡ $p_i$ æˆ–è€… $q_i$ ï¼ˆåŒºåˆ†å·¦å³éƒ¨ï¼Œå·¦éƒ¨è®°ä¸º $p$ï¼Œå³éƒ¨è®°ä¸º $q$ï¼‰ï¼Œä¿è¯ $p_i+q_j\geq w(i,j)$ ã€‚å®šä¹‰ $G$ çš„ä¸€ä¸ªç›¸ç­‰å­å›¾ $G_0=\{V_1,V_2,E_0\}$ï¼Œéœ€è¦æœ‰ $\forall e(u,v)\in E_0,p_u+q_v=w(u,v)$ã€‚é‚£ä¹ˆä¸éš¾çŸ¥é“å¦‚æœç›¸ç­‰å­å›¾ $G_0$ å­˜åœ¨å®Œç¾åŒ¹é… $M_0$ï¼Œé‚£ä¹ˆ $M_0$ å°±æ˜¯æœ€å¤§æƒå®Œç¾åŒ¹é…ã€‚è¿™ä¸€ç‚¹ä¸éš¾è¯æ˜ï¼Œåªéœ€è¦æ³¨æ„ $G_0$ åŒæ ·åŒ…å«æ‰€æœ‰ $G$ ä¸­çš„é¡¶ç‚¹å³å¯ã€‚</p><p>é‚£ä¹ˆKM ç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ä¸æ–­æ‰©å¤§ç›¸ç­‰å­å›¾çš„èŒƒå›´å®ç°å¢å¹¿ï¼Œç›´åˆ°å­˜åœ¨å®Œç¾åŒ¹é…ã€‚å‡è®¾å½“å‰ $G_0$ ä¸­çš„ç‚¹é›†åˆ†åˆ«ä¸º $\rm \{S,T\}$ï¼Œé‚£ä¹ˆè€ƒè™‘ä¸ºäº†æ‰©å¤§ç›¸ç­‰å­å›¾ï¼Œéœ€è¦ä¿®æ”¹é¡¶æ ‡ã€‚</p><p>å…·ä½“çš„ï¼Œè®© $\rm S$ ä¸­çš„æ‰€æœ‰ç‚¹é¡¶æ ‡å¢åŠ ä¸€ä¸ªæƒå€¼ $a$ï¼Œè®© $T$ ä¸­æ‰€æœ‰ç‚¹çš„é¡¶æ ‡å‡å°ä¸€ä¸ªæƒå€¼ $a$ ï¼Œé‚£ä¹ˆå¯çŸ¥ $G_0$ ä¸­åŸæ¥çš„ç‚¹ä¾æ—§å±äº $G_0$ ï¼ŒåŒæ—¶å¯¹äºæŸä¸ªç‚¹å¯¹ $(u,v),u\in \mathrm{S},v\in V_2\setminus T$ï¼Œå¯ä»¥çŸ¥é“ä¼šæœ‰ $p_u+q_v$ å˜å°ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¯èƒ½æŠŠ $(u,v)$ ä¹ŸåŠ å…¥ç›¸ç­‰å­å›¾çš„æƒ…å†µã€‚é‚£ä¹ˆä¸éš¾çŸ¥é“ä¸ºäº†ä¿è¯é¡¶æ ‡åˆæ³•ä¸”æœ‰æ–°çš„è¾¹åŠ å…¥ç›¸ç­‰å­å›¾ï¼Œ$a$ éœ€è¦æ»¡è¶³ $a=\min\{p_u+q_v-w(u,v)\},u\in \mathrm{S},v\in V_2\setminus T$ ã€‚è€ƒè™‘åŠ å…¥äº†è¿™æ¡è¾¹ä¹‹åï¼Œè¦ä¹ˆ $v$ æ˜¯æœªç›–ç‚¹ï¼Œè¦ä¹ˆ $v$ æ˜¯åŒ¹é…ç‚¹ã€‚å°±å¯ä»¥ç›´æ¥è¿›è¡Œç±»ä¼¼åŒˆç‰™åˆ©ç®—æ³•çš„è¿‡ç¨‹ã€‚è€ƒè™‘å¯¹äºæ¯ä¸ªç‚¹ï¼Œè‡³å¤šä¼šå¢å¹¿ $n$ æ¬¡ï¼Œæ¯æ¬¡å¢å¹¿æ˜¯ $O(n)$ çš„ï¼Œä¿®æ”¹é¡¶æ ‡å¯ä»¥ $O(n)$ æŸ¥æ‰¾ï¼Œé‚£ä¹ˆå¤æ‚åº¦å°±åº”è¯¥æ˜¯ $O(n^3)$ï¼ˆè™½ç„¶æˆ‘ä¸€å¼€å§‹å†™çš„æ˜¯æš´åŠ›æ‰¾ $a$ çš„ $O(n^4)$ï¼Œä½†å®é™…ä¸Šå¯ä»¥è®°ä¸€ä¸ª <code>slack</code>ï¼‰è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>çœ‹ä¸Šå»å¾ˆæ£’ï¼Ÿå®é™…ä¸Šå¤§å¤šæ•°äººå®ç°çš„ <code>dfs</code> éƒ½æ˜¯ $O(n^4)$ çš„ã€‚åŸå› åœ¨äºæ¯æ¬¡æ‰¾å¢å¹¿è·¯å¹¶ä¸æ˜¯ $O(n)$ è€Œæ˜¯ $O(m)$ çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±è¦é¿å…ç±»ä¼¼ <code>dfs</code> çš„è¿‡ç¨‹é‡Œåå¤éå†äº¤é”™æ ‘çš„æƒ…å†µã€‚äºæ˜¯è€ƒè™‘ <code>bfs</code> ï¼Œè¿™æ ·èšåˆåˆ†æä¸€ä¸‹æ¯æ¬¡æ‰¾å¢å¹¿è·¯å°±ä¼šæ˜¯ä¸¥æ ¼  $O(m)$ çš„ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Km3=KM of O(n^3), Km4=KM of O(n^4)</span></span><br><span class="line"><span class="keyword">namespace</span> KM&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">510</span> ;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    ll ans ;</span><br><span class="line">    ll lack ;</span><br><span class="line">    ll lv[N] ;</span><br><span class="line">    ll rv[N] ;</span><br><span class="line">    <span class="keyword">int</span> h, t ;</span><br><span class="line">    <span class="keyword">int</span> q[N] ;</span><br><span class="line">    <span class="keyword">int</span> pre[N] ;</span><br><span class="line">    <span class="keyword">int</span> matl[N] ;</span><br><span class="line">    <span class="keyword">int</span> matr[N] ;</span><br><span class="line">    ll slack[N] ;</span><br><span class="line">    <span class="keyword">bool</span> visl[N] ;</span><br><span class="line">    <span class="keyword">bool</span> visr[N] ;</span><br><span class="line">    ll val[N][N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        n = x ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            matl[i] = matr[i] = <span class="number">0</span> ;</span><br><span class="line">            pre[i] = lv[i] = rv[i] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                lv[i] = max(lv[i], val[i][j]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (visl[i]) lv[i] -= lack ;</span><br><span class="line">            <span class="keyword">if</span> (visr[i]) rv[i] += lack ;</span><br><span class="line">            <span class="keyword">else</span> slack[i] -= lack ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">do_match4</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        visl[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span> ; y &lt;= n ; ++ y)</span><br><span class="line">            <span class="keyword">if</span> (!visr[y])&#123;</span><br><span class="line">                ll t = lv[x] + rv[y] - val[x][y] ;</span><br><span class="line">                <span class="keyword">if</span> (!t)&#123;</span><br><span class="line">                    visr[y] = <span class="number">1</span> ;</span><br><span class="line">                    <span class="keyword">if</span> (!matl[y] || do_match4(matl[y]))&#123;</span><br><span class="line">                        matl[y] = x ; matr[x] = y ; <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> slack[y] = min(slack[y], t) ;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Km4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">                slack[j] = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">                lack = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ;</span><br><span class="line">                fill(visl + <span class="number">1</span>, visl + n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">                fill(visr + <span class="number">1</span>, visr + n + <span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">                <span class="keyword">if</span> (do_match4(i)) <span class="keyword">break</span> ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                    <span class="keyword">if</span> (!visr[i]) lack = min(lack, slack[i]) ;</span><br><span class="line">                upd() ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            ans += lv[i], ans += rv[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">match_back</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> z ;</span><br><span class="line">        <span class="keyword">while</span> (x)&#123;</span><br><span class="line">            z = x ;</span><br><span class="line">            matl[x] = pre[x] ;</span><br><span class="line">            x = matr[pre[x]] ;<span class="comment">//2</span></span><br><span class="line">            matr[pre[z]] = z ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">do_match3</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        q[++ t] = x ;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">                <span class="keyword">int</span> z = q[h ++] ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">1</span> ; y &lt;= n ; ++ y)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (visr[y]) <span class="keyword">continue</span> ;</span><br><span class="line">                    ll v = lv[z] + rv[y] - val[z][y] ;<span class="comment">//3</span></span><br><span class="line">                    <span class="keyword">if</span> (v &gt; slack[y]) <span class="keyword">continue</span> ; pre[y] = z ;</span><br><span class="line">                    <span class="keyword">if</span> (!v)&#123;</span><br><span class="line">                        visr[y] = <span class="number">1</span> ;</span><br><span class="line">                        <span class="keyword">if</span> (!matl[y]) <span class="keyword">return</span> match_back(y) ;</span><br><span class="line">                        <span class="keyword">else</span> visl[q[++ t] = matl[y]] = <span class="number">1</span> ;<span class="comment">//5</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> slack[y] = min(slack[y], v) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            lack = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ; <span class="keyword">int</span> z = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (!visr[i])</span><br><span class="line">                    <span class="keyword">if</span> (lack &gt; slack[i])</span><br><span class="line">                        lack = slack[i], z = i ;</span><br><span class="line">            upd() ; <span class="comment">//4</span></span><br><span class="line">          <span class="comment">//debug(z) ;</span></span><br><span class="line">            <span class="keyword">if</span> (!matl[z]) <span class="keyword">return</span> match_back(z) ;</span><br><span class="line">            visr[z] = visl[matl[z]] = <span class="number">1</span> ; q[++ t] = matl[z] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Km3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            <span class="built_in">memset</span>(visl, <span class="number">0</span>, <span class="keyword">sizeof</span>(visl)) ;</span><br><span class="line">            <span class="built_in">memset</span>(visr, <span class="number">0</span>, <span class="keyword">sizeof</span>(visr)) ;</span><br><span class="line">            <span class="built_in">memset</span>(slack, <span class="number">127</span>, <span class="keyword">sizeof</span>(slack)) ;</span><br><span class="line">            h = <span class="number">1</span> ; t = <span class="number">0</span> ; visl[i] = <span class="number">1</span> ; do_match3(i) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            ans += lv[i], ans += rv[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nl, nr, n, m ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    <span class="built_in">memset</span>(KM :: val, <span class="number">-127</span>, <span class="keyword">sizeof</span>(KM :: val)) ;<span class="comment">//1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        x = qr(), y = qr(), z = qr() ;</span><br><span class="line">        KM :: val[x][y] = z ;</span><br><span class="line">    &#125;</span><br><span class="line">    KM :: reset(n) ;</span><br><span class="line">    KM :: Km3() ; <span class="built_in">cout</span> &lt;&lt; KM :: ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; KM :: matl[i] &lt;&lt; <span class="string">" "</span> ; <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><p>upd: é‡å†™äº†ä¸€éï¼Œæ˜“é”™çš„åœ°æ–¹éƒ½åœ¨æ¿å­é‡Œæ ‡å‡ºæ¥äº†ã€‚</p><h1 id="ZKW-è´¹ç”¨æµ"><a href="#ZKW-è´¹ç”¨æµ" class="headerlink" title="ZKW è´¹ç”¨æµ"></a>ZKW è´¹ç”¨æµ</h1><p>æ¯”è¾ƒç¥å¥‡çš„è´¹ç”¨æµã€‚è€ƒè™‘ä¸€èˆ¬è´¹ç”¨æµçš„åšæ³•æ˜¯æ”¹è‰¯ç‰ˆçš„EKï¼Œå³æ¯æ¬¡å¯¹ç€æ®‹é‡ç½‘ç»œè·‘ä¸€éæœ€çŸ­è·¯ï¼Œç„¶åå¯¹ç€ä¸€æ¡è¾¹éƒ½æ»¡è¶³ $d_v=d_u+val(u,v)$ çš„è·¯å¾„è¿›è¡Œå¢å¹¿ã€‚å•è·¯å¢å¹¿å¿…ç„¶ä¼šå¾ˆæ…¢ï¼Œäºæ˜¯æ¥è€ƒè™‘ä¸€ä¸‹ä¸ºä»€ä¹ˆå¿…é¡»è¦å•è·¯å¢å¹¿ï¼šè€ƒè™‘æœ€çŸ­è·¯ç®—æ³•ä¿è¯åœ¨ç®—æ³•ç»“æŸåï¼Œå¯¹äºæ®‹é‡ç½‘ç»œä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ $x$ çš„æ‰€æœ‰å…¥ç‚¹ $y$ æœ‰ $d_y+val(y,x)\geq d_x$ï¼Œä¸”è‡³å°‘å­˜åœ¨ä¸€ä¸ª $y$ å¯ä»¥ä½¿ç­‰å·æˆç«‹ã€‚é‚£ä¹ˆåœ¨æ®‹é‡ç½‘ç»œä¸Šæ‰¾å‡ºä¸€æ¡å¢å¹¿è·¯ä¹‹åï¼Œä¸æ™®é€šçš„æœ€å¤§æµ(è¾¹æƒä¸º $1$)ä¸åŒçš„æ˜¯ï¼Œå‰©ä½™çš„å‚é‡ç½‘ç»œå¯¹äºæ¯ä¸ª $x$ ä¸ä¸€å®šä¼šç»§ç»­å­˜åœ¨ä¸€ä¸ª $y$ ä½¿å¾—ç­‰å·æˆç«‹ï¼Œæ‰€ä»¥è¿™å°±éœ€è¦é‡æ–°æ‰¾å¢å¹¿è·¯ã€‚</p><p>è€Œ $zkw$ è´¹ç”¨æµçš„æ€æƒ³åˆ™æ˜¯å¦‚ä½•ä¸ç”¨æ¯æ¬¡è·‘ä¸€éæœ€çŸ­è·¯æ¥å¢å¹¿ï¼Œéœ€è¦å¼•å…¥é¡¶æ ‡æ¦‚å¿µï¼Œæ­¤å¤„çš„é¡¶æ ‡å°±æ˜¯ä» $\rm S$ å¼€å§‹çš„æœ€çŸ­è·¯é•¿åº¦ $d_i$ï¼Œå³æœ‰</p><script type="math/tex; mode=display">d_i-d_j+val(i,j)\geq 0</script><p>é‚£ä¹ˆå‘ç°è·Ÿ KM çš„æœ¬è´¨æå…¶ç›¸ä¼¼ï¼šåªå¢å¹¿ç­‰å·æˆç«‹çš„ç‚¹ï¼Œé‚£ä¹ˆä¸ºäº†å¯ä»¥ä½¿å¾—ç­‰å·æˆç«‹å°±éœ€è¦ä¸æ–­æ‰©å¤§ç›¸ç­‰å­å›¾ï¼Œæ‰©å¤§çš„æ–¹å¼ä¹Ÿå¦‚å‡ºä¸€è¾™ï¼Œåªéœ€è¦è®©æ‰€æœ‰å¢å¹¿è¿‡çš„ç‚¹çš„é¡¶æ ‡å‡å»ä¸€ä¸ª $ \rm lack$ ï¼Œè€Œè¿™ä¸ª $\rm lack$ å°±ç†åº”æ˜¯</p><script type="math/tex; mode=display">\min_{u\in V,v\not\in V}\{d_u-d_v+val(u,v)\}</script><p>è¿™æ ·å°±å¯ä»¥ç»§ç»­å¢å¹¿äº†ã€‚</p><p>ç„¶åå†™æ³•æ–¹é¢éœ€è¦æ³¨æ„ä¸€äº›ç»†èŠ‚ã€‚æˆ‘æ‰€çŸ¥é“çš„åº”è¯¥æ˜¯æœ‰ä¸¤ç§å†™æ³•ï¼š</p><p>1ã€åªä¾èµ–è‡ªåŠ¨è°ƒæ•´ã€‚è¿™ä¸ªå†™æ³•æœ‰ä¸ªå¾ˆå…³é”®çš„ä¾èµ–ï¼Œå°±æ˜¯ $t_{\rm S}$ <strong>å•è°ƒä¸å¢</strong>ã€‚æ¢å¥è¯è¯´ï¼Œæ¯æ¬¡è°ƒæ•´ $t_{\rm S}$ å¿…é¡»è¦æ»¡è¶³å­˜åœ¨æŸæ¡è¾¹å¯ä»¥å¢å¹¿ï¼Œä½†æ˜¯æ­¤æ—¶ $t_{\rm S}$ å¹¶ä¸æ˜¯å•çº¯åœ°è·ŸæŸæ¡è¾¹çš„è¾¹æƒæŒ‚é’©ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªåœ¨ä¸æ–­å‡å°çš„é‡ã€‚æ‰€ä»¥ä¸éš¾ç†è§£ï¼Œå¦‚æœå­˜åœ¨æŸä¸ªæ—¶åˆ»å¢å¹¿åˆ°äº† $\rm T$ ï¼Œé‚£ä¹ˆå°±ä¸€å®šæœ‰ $\sum c=-t_{\rm S}$ ï¼Œå› ä¸ºæ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œ$\rm S$ éƒ½ä¼šåœ¨æ‰©å±•å®Œæ¯•çš„é›†åˆé‡Œã€‚</p><p>äºæ˜¯å°±å¯ä»¥çŸ¥é“ï¼Œ$t_{\rm S}$ çš„åˆå€¼åº”è¯¥èµ‹ä¸º $\rm S$ æ‰€æœ‰å‡ºè¾¹é‡Œè¾¹æƒæœ€å¤§çš„é‚£ä¸€æ¡ã€‚æˆ–è€…å¯ä»¥ç›´æ¥èµ‹å€¼ä¸º $-\rm Inf$ ï¼Œè®©å…¶è‡ªå·±è°ƒæ•´ã€‚</p><p>2ã€å¤§æ¦‚æ˜¯ä¸ªä¼˜åŒ–ï¼Ÿå¯ä»¥è€ƒè™‘åœ¨æœ€å¼€å§‹çš„æ—¶å€™è·‘ä¸€éæœ€çŸ­è·¯ã€‚è®¾å¢å¹¿è·¯ä¸Šçš„ç‚¹æŒ‰é¡ºåºåˆ†åˆ«æ˜¯ $\rm S,u_1,u_2\cdots u_m,T$ é‚£ä¹ˆæ­¤æ—¶æ¯æ¡å¢å¹¿è·¯çš„ $cost$ ä¹‹å’Œå°±æ˜¯ </p><script type="math/tex; mode=display">(t_{\rm T}-t_{\rm u_m})+(t_{\rm u_m}-t_{\rm u_{m-1}})\cdots+(t_{\rm u_1}-t_{\rm S})</script><p>åŒ–ç®€ä¸€ä¸‹å¯ä»¥å¾—åˆ°å°±æ˜¯ $t_{\rm T}-t_{\rm S}$ ã€‚</p><p>å…¶å®ç¬¬ä¸€ä¸ª $case$ æœ€åçš„ç»“æœæœ¬è´¨ä¸Šä¹Ÿæ˜¯ $t_T-t_S$ ï¼Œç„¶è€Œå› ä¸º $T$ çš„ $t$ å§‹ç»ˆä¸º $0$ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ã€‚çœ‹æ€ä¹ˆç†è§£äº†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ¨å‡º $-t_S$ ã€‚</p><p>äº‹å®è¯æ˜ç¬¬äºŒç§ç¡®å®æ¯”ç¬¬ä¸€ç§è¦å¿«ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">chkmin</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    x = x &gt; y ? y : x ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> zkw&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> to(k) e[k].to</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> cap(k) e[k].cap</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> cost(k) e[k].cost</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> from(k) e[k].from</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> flow(k) e[k].flow</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200010</span> ;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> cnt ;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> from ;</span><br><span class="line">        <span class="keyword">int</span> flow ;</span><br><span class="line">        <span class="keyword">int</span> cost ;</span><br><span class="line">        <span class="keyword">int</span> cap ;</span><br><span class="line">        <span class="keyword">int</span> to ;</span><br><span class="line">        edge (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, <span class="keyword">int</span> c = <span class="number">0</span>, <span class="keyword">int</span> d = <span class="number">0</span>)&#123;</span><br><span class="line">            from = a, to = b, cap = c, cost = d, flow = <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; e[N] ;</span><br><span class="line">    <span class="keyword">int</span> mflow ;</span><br><span class="line">    <span class="keyword">int</span> mcost ;</span><br><span class="line">    <span class="keyword">int</span> val[N] ;</span><br><span class="line">    <span class="keyword">bool</span> vis[N] ;</span><br><span class="line">    <span class="keyword">int</span> n, S, T ;</span><br><span class="line">    <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(val, <span class="number">0</span>, <span class="keyword">sizeof</span>(val)) ;</span><br><span class="line">        S = x, T = y, n = z ; cnt = <span class="number">-1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[i].clear() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line"><span class="comment">//        debug(x, ' '), debug(y, ' '), debug(c, ' '), debug(d) ;</span></span><br><span class="line">        e[++ cnt] = edge(x, y, c, d) ; E[x].push_back(cnt) ;</span><br><span class="line">        e[++ cnt] = edge(y, x, <span class="number">0</span>, -d) ; E[y].push_back(cnt) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> h, t ;</span><br><span class="line">    <span class="keyword">int</span> que[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(val, <span class="number">127</span>, <span class="keyword">sizeof</span>(val)) ;</span><br><span class="line">        val[que[h = t = <span class="number">1</span>] = S] = <span class="number">0</span>, vis[S] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = que[h ++] ;</span><br><span class="line">            vis[x] = <span class="number">0</span> ; <span class="comment">//debug(x) ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])&#123;</span><br><span class="line">                <span class="keyword">if</span> (!cap(k)) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (val[to(k)] &gt; val[x] + cost(k))&#123;</span><br><span class="line">                    val[to(k)] = val[x] + cost(k) ;</span><br><span class="line">                    <span class="keyword">if</span> (!vis[to(k)])</span><br><span class="line">                        vis[que[++ t] = to(k)] = <span class="number">1</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">advance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> f)</span></span>&#123;</span><br><span class="line">        vis[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (x == T)&#123;</span><br><span class="line"><span class="comment">//            debug(f, ' '), debug(- val[S]) ;</span></span><br><span class="line">            mcost += (val[T] - val[S]) * f ;</span><br><span class="line">            mflow += f ; <span class="keyword">return</span> f ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> fl = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])</span><br><span class="line">            <span class="keyword">if</span> (flow(k) &lt; cap(k))</span><br><span class="line">                <span class="keyword">if</span> (!vis[to(k)] &amp;&amp; val[to(k)] == val[x] + cost(k))</span><br><span class="line">                    <span class="keyword">if</span> ((fl = advance(to(k), min(f, cap(k) - flow(k)))))</span><br><span class="line">                        <span class="keyword">return</span> flow(k) += fl, flow(k ^ <span class="number">1</span>) -= fl, fl ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">modify</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lack = <span class="number">1</span> &lt;&lt; <span class="number">30</span> ;</span><br><span class="line">        <span class="keyword">if</span> (vis[T] == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= cnt ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (flow(i) &lt; cap(i) &amp;&amp; vis[from(i)] &amp;&amp; !vis[to(i)])</span><br><span class="line">                chkmin(lack, val[from(i)] - val[to(i)] + cost(i)) ;</span><br><span class="line">        <span class="keyword">if</span> (lack == <span class="number">1</span> &lt;&lt; <span class="number">30</span>) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (vis[i]) val[i] -= lack ;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">        spfa() ;</span><br><span class="line"><span class="comment">//        debug(val, 1, n) ;</span></span><br><span class="line">        mflow = <span class="number">0</span> ; mcost = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis)) ;</span><br><span class="line">            advance(S, <span class="number">1</span> &lt;&lt; <span class="number">30</span>) ;</span><br><span class="line">        &#125;<span class="keyword">while</span> (modify()) ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; mflow &lt;&lt; <span class="string">" "</span> &lt;&lt; mcost &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t ;</span><br><span class="line">    zkw :: reset(s, t, n) ;</span><br><span class="line">    <span class="keyword">int</span> x, y, f, c ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;x, &amp;y, &amp;f, &amp;c) ;</span><br><span class="line">        zkw :: add(x, y, f, c) ;</span><br><span class="line">    &#125;</span><br><span class="line">    zkw :: solve() ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h1 id="ä¸Šä¸‹ç•Œç½‘ç»œæµ"><a href="#ä¸Šä¸‹ç•Œç½‘ç»œæµ" class="headerlink" title="ä¸Šä¸‹ç•Œç½‘ç»œæµ"></a>ä¸Šä¸‹ç•Œç½‘ç»œæµ</h1><p>è¿™ä¸€éƒ¨åˆ†æ˜¯è·Ÿ <code>__stdcall</code> å­¦çš„ã€‚æ„Ÿè§‰ä»–è®²çš„çœŸçš„æ˜¯æœ€è¯¦ç»†çš„äº†ã€‚è¿™ä¸ªåœ°æ–¹å®‰åˆ©ä¸€ä¸‹ï¼š<a href="https://www.cnblogs.com/mlystdcall/p/6734852.html" target="_blank" rel="noopener">æˆ³</a> ã€‚</p><p>ä»¥ä¸‹é»˜è®¤ç”¨ $(u,v,\mathrm{lower},\mathrm{upper})$ æ¥æè¿°ä¸€æ¡å¸¦æœ‰ä¸Šä¸‹ç•Œçš„å¼§ï¼Œç”¨ $(u,v,{\rm cap})$ è¡¨ç¤ºæ­£å¸¸æµå›¾é‡Œçš„ä¸€æ¡å¼§ã€‚</p><h2 id="æ— æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ"><a href="#æ— æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ" class="headerlink" title="æ— æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ"></a>æ— æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ</h2><h3 id="å»ºæ¨¡"><a href="#å»ºæ¨¡" class="headerlink" title="å»ºæ¨¡"></a>å»ºæ¨¡</h3><p>å¤§æ¦‚æ˜¯è€ƒè™‘å…ˆå»ºç«‹ä¸€ä¸ªè™šçš„æºå’Œæ±‡ $\rm S, \rm T$ã€‚ç„¶åè€ƒè™‘å¯¹äºä¸€æ¡å¼§ $(u,v,c_1,c_2)$ å°†å…¶æ‹†æˆ $({\rm S}, v,c_1),(u, {\rm T},c_1),(u,v,c_2-c_1)$ ä¸‰æ¡æ­£å¸¸æµå›¾çš„å¼§(ç§°å‰ä¸¤æ¡å¼§ä¸º<strong>é™„åŠ å¼§</strong>)ï¼Œè·‘æœ€å¤§æµã€‚ä¹‹åå¯¹äºæ¯æ¡éé™„åŠ å¼§ï¼Œæµé‡åŠ ä¸Šè¿™æ¡å¼§åŸæœ¬è¯¥æœ‰çš„ä¸‹ç•Œ $c_2$ å°±æ˜¯æ¯æ¡å¼§çš„å®é™…æµé‡ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å¤§æ¦‚å°±æ˜¯æ‰€æœ‰é™„åŠ å¼§ä¿è¯äº†ä¸€å®šä¼šæµæ»¡ä¸‹ç•Œã€‚éé™„åŠ å¼§æ‰¿è½½çš„åˆ™æ˜¯ã€Œè‡ªç”±æµé‡ã€ï¼Œæ˜¯æ²¡æœ‰ä¸‹ç•Œå¯ä»¥éšä¾¿æµçš„å¼§ã€‚ä¸éš¾å‘ç°å¦‚æœæ‰€æœ‰é™„åŠ å¼§éƒ½æ»¡è½½ï¼Œæœ€åæµçš„ä¸€å®šä¼šæ˜¯ä¸€ä¸ªå¯è¡Œæµã€‚</p><h2 id="æœ‰æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ"><a href="#æœ‰æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ" class="headerlink" title="æœ‰æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ"></a>æœ‰æºæ±‡ä¸Šä¸‹ç•Œå¯è¡Œæµ</h2><h3 id="å»ºæ¨¡-1"><a href="#å»ºæ¨¡-1" class="headerlink" title="å»ºæ¨¡"></a>å»ºæ¨¡</h3><p>è€ƒè™‘åœ¨ä¸Šä¸€ä¸ªæ¨¡å‹çš„åŸºç¡€ä¸Šç¨åŠ ä¿®æ”¹ã€‚è®¾åŸå›¾çš„æºå’Œæ±‡åˆ†åˆ«æ˜¯ $s,t$ ï¼ˆä¸‹åŒï¼‰ï¼Œé‚£ä¹ˆæ·»åŠ ä¸€æ¡ $(t,s,+\infty)$ çš„å¼§å³å¯ã€‚è¿™æ ·æœ€åè·‘å‡ºæ¥çš„å°±æ˜¯åŸå›¾çš„ä¸€ä¸ªå¯è¡Œæµï¼ŒåŒæ—¶å¼§ $(t,s)$ çš„æµé‡å°±æ˜¯åŸå›¾çš„æ€»æµé‡ã€‚</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è€ƒè™‘æœ‰æºæ±‡å’Œæ— æºæ±‡æœ¬è´¨ä¸ŠåŒºåˆ«å°±åœ¨äºï¼Œæœ‰æºæ±‡çš„å›¾é‡Œï¼Œ$s,t$ æ˜¯ä¸æ»¡è¶³æµé‡å¹³è¡¡çš„ã€‚æ‰€ä»¥ä¸ºäº†ç»´æŠ¤æµé‡å¹³è¡¡ï¼Œå°±éœ€è¦å»ºä¸€æ¡ $(t,s,+\infty)$ çš„å¼§æ¥ç–é€šæµé‡ã€‚</p><h2 id="æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å¤§æµ"><a href="#æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å¤§æµ" class="headerlink" title="æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å¤§æµ"></a>æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å¤§æµ</h2><h3 id="å»ºæ¨¡-2"><a href="#å»ºæ¨¡-2" class="headerlink" title="å»ºæ¨¡"></a>å»ºæ¨¡</h3><p>è€ƒè™‘å…ˆè·‘ä¸€ä¸‹å¯è¡Œæµï¼Œå¦‚æœæœ‰å¯è¡Œæµï¼Œé‚£ä¹ˆå°±åœ¨<strong>è·‘å®Œçš„æ®‹é‡ç½‘ç»œä¸Š</strong>å†è·‘ä¸€æ¬¡<strong>ä»åŸå›¾çš„æºåˆ°åŸå›¾çš„æ±‡çš„æœ€å¤§æµ</strong>ï¼Œå³ $s\to t$ çš„æœ€å¤§æµã€‚é‚£ä¹ˆç¬¬äºŒæ¬¡æœ€å¤§æµçš„ç»“æœå‡å°±æ˜¯æ‰€æ±‚çš„æœ€å¤§æµã€‚</p><h3 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è€ƒè™‘åœ¨ä¸€æ¬¡å¯è¡Œæµä¹‹åï¼ŒåŸå›¾çš„ä¸€å®šæ˜¯æ»¡è¶³æµé‡ä¸‹ç•Œçš„ã€‚åŒæ—¶å› ä¸º $t\to s$ å¼§çš„å­˜åœ¨ï¼Œåœ¨æ–°çš„æµå›¾ä¸Š $t\to s$ ç§¯æ”’åœ¨åå‘è¾¹ $(s,t)$ ä¸­çš„æµé‡ä¼šç›´æ¥æµç»™ $t$ ã€‚åŒæ—¶åªéœ€è¦è®©å‰©ä¸‹çš„è¾¹æµåˆ°ä¸èƒ½æµå°±å¥½äº†ã€‚</p><h2 id="æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å°æµ"><a href="#æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å°æµ" class="headerlink" title="æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å°æµ"></a>æœ‰æºæ±‡ä¸Šä¸‹ç•Œæœ€å°æµ</h2><h3 id="å»ºæ¨¡-1"><a href="#å»ºæ¨¡-1" class="headerlink" title="å»ºæ¨¡ 1"></a>å»ºæ¨¡ 1</h3><p>é¦–å…ˆæŒ‰ç…§<strong>æ— æºæ±‡å¯è¡Œæµ</strong>çš„æ–¹å¼å»ºå›¾ã€‚è·‘ä¸€ä¸‹ã€‚ä¹‹åå†æŠŠ $(t,s,+\infty)$ å»ºå›å»ï¼Œè·‘ä¸€éä» $\rm S\to T$ çš„æœ€å¤§æµï¼Œç„¶åå» check æ˜¯å¦åˆæ³•ï¼Œå¦‚æœåˆæ³•å³ä¸ºç­”æ¡ˆã€‚</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç† 1"></a>åŸç† 1</h3><p>è€ƒè™‘æœ¬è´¨ä¸Šæ˜¯è¦è®©å¯è¡Œæµæœ€å°ã€‚æ ¹æ®ä¸Šæ–‡å¯ä»¥çŸ¥é“ä¸€ç»„å¯èƒ½æµçš„æµé‡å°±æ˜¯ $t\to s$ çš„æµé‡ï¼Œé‚£ä¹ˆä¸ºäº†è®©å¯ä»¥ä¸æµè¿‡ $t\to s$ çš„æµé‡å°½é‡ä¸è¦æµè¿‡è¿™æ¡å¼§ï¼Œå¯ä»¥å…ˆä¸è€ƒè™‘è¿™æ¡å¼§å°½é‡æµä¸€æ³¢ï¼Œä¹‹åå†è·‘åŒ…å«è¿™æ¡å¼§çš„æœ€å¤§æµã€‚è¿™æ ·ä¸€æ–¹é¢æ˜¯å¯è¡Œæµï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¼šè®©å¯è¡Œæµæœ€å°ã€‚</p><h3 id="å»ºæ¨¡-2"><a href="#å»ºæ¨¡-2" class="headerlink" title="å»ºæ¨¡ 2"></a>å»ºæ¨¡ 2</h3><p>é¦–å…ˆæŒ‰ç…§<strong>æœ‰æºæ±‡å¯è¡Œæµ</strong>çš„æ–¹å¼å»ºå›¾ã€‚è·‘ä¸€ä¸‹ï¼Œè®°æ­¤æ—¶çš„å¯è¡Œæµä¸º $f_1$ ã€‚ä¹‹åä» $\rm T\to S$ è·‘ä¸€éæœ€å¤§æµï¼Œè®°æ­¤æ—¶çš„æµä¸º $f_2$ã€‚é‚£ä¹ˆç­”æ¡ˆå°±æ˜¯ $f_1-f_2$ ã€‚</p><h3 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç† 2"></a>åŸç† 2</h3><p>è€ƒè™‘æ­£å‘è¾¹æµé‡å’Œåå‘è¾¹æµé‡æ˜¯å¯¹ç§°çš„ï¼Œé‚£ä¹ˆè€ƒè™‘åŸå›¾ä¸­çš„ä¸€ä¸ªå¯è¡Œæµä¸­ï¼ŒæŸäº›å¼§çš„æµé‡å¯ä»¥å˜å°ï¼Œé‚£ä¹ˆå¦‚æœä½¿åå‘è¾¹æµé‡å°½é‡å¤§ï¼Œå°±å¯ä»¥ä½¿æ­£å‘è¾¹æµé‡å°½é‡å°ã€‚åŒæ—¶å¯ä»¥çŸ¥é“è¿™æ ·æ˜¯ä¸€å®šåˆæ³•çš„ï¼Œå› ä¸ºé™„åŠ å¼§ä¸ä¼šè¢«æµï¼Œä¼šè¢«æµçš„åªæœ‰éé™„åŠ å¼§ï¼ŒåŒæ—¶éé™„åŠ å¼§ä¸å¯èƒ½å‡ºç°æµé‡ä¸ºè´Ÿã€‚æ‰€ä»¥ä¸éš¾çŸ¥é“è¿™æ ·æ˜¯å¯¹çš„ã€‚</p><div><div class="fold_hider"><div class="close hider_title">ã€ŒMy-Codeã€</div></div><div class="fold"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> ISAP&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> to(k) e[k].to</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> cap(k) e[k].cap</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> cost(k) e[k].cost</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> from(k) e[k].from</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">define</span> flow(k) e[k].flow</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> from ;</span><br><span class="line">        ll flow ;</span><br><span class="line">        ll cap ;</span><br><span class="line">        <span class="keyword">int</span> to ;</span><br><span class="line">        edge (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>, ll c = <span class="number">0</span>)&#123;</span><br><span class="line">            from = a, to = b, cap = c, flow = <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; e[N] ;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    ll ans ;</span><br><span class="line">    <span class="keyword">int</span> cnt ;</span><br><span class="line">    <span class="keyword">int</span> S, T ;</span><br><span class="line">    <span class="keyword">int</span> h, t ;</span><br><span class="line">    <span class="keyword">int</span> que[N] ;</span><br><span class="line">    <span class="keyword">int</span> pre[N] ;</span><br><span class="line">    <span class="keyword">int</span> hgt[N] ;</span><br><span class="line">    <span class="keyword">int</span> cur[N] ;</span><br><span class="line">    <span class="keyword">int</span> gap[N] ;</span><br><span class="line">    <span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; E[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, ll c)</span></span>&#123;</span><br><span class="line">        e[++ cnt] = edge(x, y, c) ; E[x].push_back(cnt) ;</span><br><span class="line">        e[++ cnt] = edge(y, x, <span class="number">0</span>) ; E[y].push_back(cnt) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(cur, <span class="number">0</span>, <span class="keyword">sizeof</span>(cur)) ;</span><br><span class="line">        <span class="built_in">memset</span>(hgt, <span class="number">0</span>, <span class="keyword">sizeof</span>(hgt)) ;</span><br><span class="line">        <span class="built_in">memset</span>(gap, <span class="number">0</span>, <span class="keyword">sizeof</span>(gap)) ;</span><br><span class="line">        S = x, T = y, n = z ; cnt = <span class="number">-1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) E[i].clear() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prebfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">        que[h = t = <span class="number">1</span>] = T ;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = que[h ++] ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])</span><br><span class="line">                <span class="keyword">if</span> (!hgt[to(k)] &amp;&amp; to(k) != T)</span><br><span class="line">                    hgt[que[++ t] = to(k)] = hgt[x] + <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) gap[hgt[i]] ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Aug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x = T ;</span><br><span class="line">        ll z = <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ;</span><br><span class="line">        <span class="keyword">while</span> (x != S)&#123;</span><br><span class="line">            chkmin(z, cap(pre[x]) - flow(pre[x])) ;</span><br><span class="line">            x = from(pre[x]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += z ; x = T ;</span><br><span class="line">        <span class="keyword">while</span> (x != S)&#123;</span><br><span class="line">            flow(pre[x]) += z ;</span><br><span class="line">            flow(pre[x] ^ <span class="number">1</span>) -= z ;</span><br><span class="line">            x = from(pre[x]) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Advance</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">bool</span> ret = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> d = cur[x] ; d &lt; E[x].size() ; ++ d)&#123;</span><br><span class="line">            <span class="keyword">int</span> k = E[x][d] ;</span><br><span class="line">            <span class="keyword">if</span> (flow(k) &gt;= cap(k)) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (hgt[x] != hgt[to(k)] + <span class="number">1</span>) <span class="keyword">continue</span> ;</span><br><span class="line">            cur[x] = d ; ret = <span class="number">1</span> ;</span><br><span class="line">            pre[y = to(k)] = k ; <span class="keyword">break</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">isap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        prebfs() ; <span class="keyword">int</span> x = S ;</span><br><span class="line">        <span class="keyword">while</span> (hgt[S] &lt; n)&#123;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; x &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">if</span> (x == T)</span><br><span class="line">                Aug(), x = S ;</span><br><span class="line">            <span class="keyword">if</span> (!Advance(x, x))&#123;</span><br><span class="line">                <span class="keyword">int</span> minh = n - <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x])</span><br><span class="line">                    <span class="keyword">if</span> (flow(k) &lt; cap(k))</span><br><span class="line">                        chkmin(minh, hgt[to(k)]) ;</span><br><span class="line">                <span class="keyword">if</span> (!-- gap[hgt[x]]) <span class="keyword">return</span> ;</span><br><span class="line">                gap[hgt[x] = minh + <span class="number">1</span>] ++ ; cur[x] = <span class="number">0</span> ;</span><br><span class="line">                <span class="keyword">if</span> (x != S) x = from(pre[x]) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> NO_Lower_Upper_Feasible&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> :: ISAP ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, c1, c2 ;</span><br><span class="line">        reset(n + <span class="number">1</span>, n + <span class="number">2</span>, n + <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y &gt;&gt; c1 &gt;&gt; c2 ;</span><br><span class="line">            add(S, y, c1) ;</span><br><span class="line">            add(x, T, c1) ;</span><br><span class="line">            add(x, y, c2 - c1) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">        isap() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (from(i) == S &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (to(i) == T &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"YES"</span> &lt;&lt; <span class="string">"\n"</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span> ; i &lt;= cnt ; i += <span class="number">6</span>)&#123;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; from(i) &lt;&lt; " " &lt;&lt; to(i) &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; flow(i) + cap(i - <span class="number">2</span>) &lt;&lt; <span class="string">"\n"</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">        fuck : <span class="built_in">cout</span> &lt;&lt; <span class="string">"NO"</span> &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> YES_Lower_Upper_Maximum&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> :: ISAP ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y, c1, c2 ;</span><br><span class="line">        reset(n + <span class="number">1</span>, n + <span class="number">2</span>, n + <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y &gt;&gt; c1 &gt;&gt; c2 ;</span><br><span class="line">            add(S, y, c1) ;</span><br><span class="line">            add(x, T, c1) ;</span><br><span class="line">            add(x, y, c2 - c1) ;</span><br><span class="line">        &#125;</span><br><span class="line">        add(t, s, <span class="number">1l</span>l &lt;&lt; <span class="number">60</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        isap() ; <span class="comment">//debug(ans) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (from(i) == S &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (to(i) == T &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">        &#125;</span><br><span class="line">        S = s, T = t ; </span><br><span class="line">      ans = <span class="number">0</span> ; isap() ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">"\n"</span> ;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">        fuck : <span class="built_in">cout</span> &lt;&lt; <span class="string">"please go home to sleep"</span> &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> YES_Lower_Upper_Minimum&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> :: ISAP ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y ; ll c1, c2 ;</span><br><span class="line">        reset(n + <span class="number">1</span>, n + <span class="number">2</span>, n + <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">            x = qr() ;</span><br><span class="line">y = qr() ;</span><br><span class="line">c1 = qr() ;</span><br><span class="line">c2 = qr() ;</span><br><span class="line">            add(S, y, c1) ;</span><br><span class="line">            add(x, T, c1) ;</span><br><span class="line">            add(x, y, c2 - c1) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">        isap() ; <span class="comment">//debug(ans) ;</span></span><br><span class="line">        add(t, T, <span class="number">0</span>) ;</span><br><span class="line">        add(S, s, <span class="number">0</span>) ;</span><br><span class="line">        add(t, s, <span class="number">1l</span>l &lt;&lt; <span class="number">60</span>) ;</span><br><span class="line">        ans = <span class="number">0</span> ; isap() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (from(i) == S &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (to(i) == T &amp;&amp; flow(i) != cap(i)) <span class="keyword">goto</span> fuck ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">"\n"</span> ;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">        fuck : <span class="built_in">cout</span> &lt;&lt; <span class="string">"please go home to sleep"</span> &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><h2 id="ä¸Šä¸‹ç•Œè´¹ç”¨æµ"><a href="#ä¸Šä¸‹ç•Œè´¹ç”¨æµ" class="headerlink" title="ä¸Šä¸‹ç•Œè´¹ç”¨æµ"></a>ä¸Šä¸‹ç•Œè´¹ç”¨æµ</h2><p>å’Œæœ€å¤§æµæ²¡ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ã€‚å”¯ä¸€çš„ä¸åŒåœ¨äºï¼Œæ¯”å¦‚æ±‚æœ€å°è´¹ç”¨æœ€å¤§æµçš„æ—¶å€™ç¬¬äºŒéåªæ¸…ç©º <code>mflow</code> è€Œä¸æ¸…ç©º <code>mcost</code>ã€‚å› ä¸ºæœ‰ä¸€éƒ¨åˆ†æµæ˜¯é€šè¿‡ $t\to s$ è¿™ä¸ªä¸å®šè´¹ç”¨å¼§æµè¿‡æ¥çš„ï¼Œè¿™æ—¶æ˜¯ä¸è®¡ç®—æµé‡çš„ã€‚æ„Ÿè§‰å…¶ä»–çš„ä¹Ÿå¤§å·®ä¸å·®ï¼Ÿç¨å¾®æ”¹ä¸€æ³¢å°±å¯ä»¥äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤§æ¦‚å°±æ˜¯å‘ç°æ‚ä¸ƒæ‚å…«å­¦æ¥çš„ä¸œè¥¿æ²¡æœ‰å¾ˆå¿…è¦æ•´ç†çš„å°±ä»ç•¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;del&gt;å½“ç„¶æœ‰å¾ˆå¤šæ˜¯ä»¥å‰å­¦çš„ç»“æœç»™å¿˜äº†ã€‚&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;æ…¢æ…¢æ›´ï¼Œå’•å’•å’•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å›¾è®º/äºŒåˆ†å›¾" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="ç½‘ç»œæµ/æœ€å¤§æµ" scheme="https://www.orchidany.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81-%E6%9C%80%E5%A4%A7%E6%B5%81/"/>
    
      <category term="å›¾è®º/åŒ¹é…" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D/"/>
    
      <category term="ç½‘ç»œæµ/å¸¦æœ‰ä¸Šä¸‹ç•Œçš„ç½‘ç»œæµ" scheme="https://www.orchidany.cn/tags/%E7%BD%91%E7%BB%9C%E6%B5%81-%E5%B8%A6%E6%9C%89%E4%B8%8A%E4%B8%8B%E7%95%8C%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81/"/>
    
      <category term="å›¾è®º/åŒ¹é…/KMç®—æ³•" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D-KM%E7%AE%97%E6%B3%95/"/>
    
      <category term="æ•°å­¦/é«˜æ–¯æ¶ˆå…ƒ" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83/"/>
    
      <category term="å­—ç¬¦ä¸²/Z-Algorithm" scheme="https://www.orchidany.cn/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2-Z-Algorithm/"/>
    
      <category term="æ•°å­¦/ç½®æ¢,è½®æ¢" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E7%BD%AE%E6%8D%A2-%E8%BD%AE%E6%8D%A2/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/é“¾åˆ†æ²»ç»´æŠ¤dp" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E9%93%BE%E5%88%86%E6%B2%BB%E7%BB%B4%E6%8A%A4dp/"/>
    
      <category term="æŠ€å·§/min-maxå®¹æ–¥" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-min-max%E5%AE%B9%E6%96%A5/"/>
    
  </entry>
  
  <entry>
    <title>ã€èµ›é¢˜æ•´ç†ã€‘[NOIP2018/CSP2019]é¢˜ç›®æ•´ç†</title>
    <link href="https://www.orchidany.cn/2020/05/11/NOIP2018-CSP2019/"/>
    <id>https://www.orchidany.cn/2020/05/11/NOIP2018-CSP2019/</id>
    <published>2020-05-11T02:27:47.000Z</published>
    <updated>2020-06-05T00:10:58.180Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¤§æ¦‚æ˜¯é‡åšäº†ä¸€ä¸‹ NOIP2018/CSP2019 ä¸¤å¹´çš„å…¨éƒ¨é¢˜ç›®ï¼Ÿ</p><p>æ„Ÿè§‰å½“æ—¶åœºä¸Šæ²¡ A æ‰çš„é¢˜ï¼Œæ”¾åˆ°ç°åœ¨åšæ€»æ˜¯æ„Ÿè§‰æœ‰ç‚¹å¿ƒç†é˜´å½±emm</p><p>Anyway, åªç”¨çœŸæ­£å‘Šåˆ«è¿‡å»æ‰èƒ½èµ°å‘æœªæ¥ã€‚ä½ è¯´ï¼Œå¯¹å§ï¼Ÿ</p><a id="more"></a><p>é¢˜ç›®æ’åºä¸ºæŒ‰æ—¶é—´æ’åºã€‚é¢˜é¢çœ‹å¿ƒæƒ…åŠ ï¼ˆ</p><h1 id="NOIP2018"><a href="#NOIP2018" class="headerlink" title="NOIP2018"></a>NOIP2018</h1><h2 id="A-é“ºè®¾é“è·¯"><a href="#A-é“ºè®¾é“è·¯" class="headerlink" title="A é“ºè®¾é“è·¯"></a>A é“ºè®¾é“è·¯</h2><p>è€ƒåœºä¸Šå¹¶æ²¡æƒ³åˆ°æ­£è§£ã€‚è¯»å®Œé¢˜ä¹‹åè§‰å¾—æ¯æ¬¡ä¸€å®šéƒ½æ˜¯é€‰å½“å‰æ®µå†…æœ€å°çš„é‚£ä¸ªé«˜åº¦æ¥æ“ä½œï¼Œæ‰€ä»¥å°±ç”¨çº¿æ®µæ ‘å¥—äº†ä¸ªåˆ†æ²»ï¼›åæ¥åˆå‘ç°åªæœ‰è¯¢é—®ï¼Œäºæ˜¯å°±å˜æˆäº† ST è¡¨å¥—äº†ä¸ªåˆ†æ²»ã€‚æœ€åâ€¦å¤§æ¦‚æ˜¯çº¿æ€§çš„å§ã€‚ï¼ˆä½†å…¶å®å¤§å®¶å†™çš„ ST è¡¨éƒ½ä¸æ˜¯çº¿æ€§çš„ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> delta)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> P = query(l, r) ;</span><br><span class="line">    <span class="keyword">int</span> L = l, R = r ;</span><br><span class="line">    <span class="keyword">while</span> (L &lt; R)&#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (query(L, mid) == P) R = mid ;</span><br><span class="line">        <span class="keyword">else</span> L = mid + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> W = L ; </span><br><span class="line">    Ans += (base[W] - delta), delta += (base[W] - delta) ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ; work(l, W - <span class="number">1</span>, delta), work(W + <span class="number">1</span>, r, delta) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-è´§å¸ç³»ç»Ÿ"><a href="#B-è´§å¸ç³»ç»Ÿ" class="headerlink" title="B è´§å¸ç³»ç»Ÿ"></a>B è´§å¸ç³»ç»Ÿ</h2><p>æ— è„‘èƒŒåŒ…é¢˜ã€‚æ„Ÿè§‰ä¸¤å¹´å‰çš„è‡ªå·±çœŸçš„æ˜¯èœçš„ä¸€åŒ¹â€¦</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; T ;</span><br><span class="line"><span class="keyword">while</span> (T --)&#123;</span><br><span class="line">N = qr(), ans = <span class="number">0</span> ; </span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp)) ; </span><br><span class="line"><span class="keyword">int</span> i, j, k, o, mxm = <span class="number">0</span> ; dp[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) </span><br><span class="line">base[i] = qr(), mxm = max(base[i], mxm) ;</span><br><span class="line">sort(base + <span class="number">1</span>, base + N + <span class="number">1</span>, comp) ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp)), dp[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">1</span> ; k &lt;= N ; ++ k)</span><br><span class="line"><span class="keyword">if</span> (i != k &amp;&amp; base[k] != <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">for</span> (j = base[k] ; j &lt;= mxm ; ++ j)</span><br><span class="line">dp[j] |= dp[j - base[k]] ;</span><br><span class="line"><span class="keyword">if</span> (dp[base[i]]) base[i] = <span class="number">-1</span> ;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) ans += (<span class="keyword">bool</span>)(base[i] == <span class="number">-1</span>) ; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, N - ans) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-èµ›é“ä¿®å»º"><a href="#C-èµ›é“ä¿®å»º" class="headerlink" title="C èµ›é“ä¿®å»º"></a>C èµ›é“ä¿®å»º</h2><blockquote><p>ç”¨ $m$ æ¡ä¸ç›¸äº¤çš„é“¾è¦†ç›–ä¸€æ£µæ ‘ï¼Œæœ€å¤§åŒ–é•¿åº¦æœ€å°çš„é“¾ã€‚</p><p>$2 \leq n \leq 5 \times 10^{4}, 1 \leq m \leq n-1$ã€‚</p></blockquote><p>å½“æ—¶è€ƒåœºä¸Šå†™çš„æ˜¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (N &lt;= <span class="number">2000</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; i ; ++ j)</span><br><span class="line"><span class="keyword">if</span> (i == j) <span class="keyword">continue</span> ;</span><br><span class="line"><span class="keyword">else</span> FFF = LCA(i, j), Ans = max(Ans, Sum[i] + Sum[j] - <span class="number">2</span> * Sum[FFF]) ;</span><br><span class="line"><span class="keyword">if</span> (M &gt; <span class="number">1</span>) Ans = Ans / M + rand()%(Ans / (M - <span class="number">1</span>)); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€¦â€¦ä¹Ÿä¸çŸ¥é“è‡ªå·±å’‹æƒ³çš„ã€‚</p><p>ç„¶åè¿™æ¬¡å¤ç›˜çš„æ—¶å€™è¿˜è¯»é”™äº†é¢˜ï¼Œè¯»æˆäº†ã€Œå¿…é¡»è¦æŠŠå…¨éƒ¨çš„è¾¹éƒ½è¦†ç›–ã€ï¼Œè§‰å¾—è¿™ç§äºŒç»´é™åˆ¶çš„æ€ä¹ˆå¯èƒ½å»äºŒåˆ†â€¦æ„Ÿåˆ°ååˆ†å¼±æ™ºã€‚</p><p>ä¹‹åå°±å˜æˆäº†è€ƒè™‘äºŒåˆ†ç­”æ¡ˆï¼Œæ˜¯å¦å¯ä»¥é€‰ $\geq m$ æ¡ $\geq val$ çš„è¾¹ä¸ç›¸äº¤é“¾ã€‚æ„Ÿè§‰ä¼¼ä¹æ˜¯å¯ä»¥ bottom to top åœ° dp ä¸€æ³¢é¡ºä¾¿è½¬ç§»ä¸€ä¸‹æ²¡æœ‰é—­åˆçš„é“¾ã€‚</p><p>è¿™é¢˜ç¡®å®å¾ˆæ°´ï¼Œè¿™ä¸ªè´ªå¿ƒå·²ç»è‡ªç„¶åˆ°è¯éƒ½ä¸ç”¨è¯çš„åœ°æ­¥äº† 233ã€‚</p><p>ä¸€å¼€å§‹æ‰“ç®—ç”¨ vector ç»´æŠ¤ã€‚å‘ç°éœ€è¦æ”¯æŒåˆ é™¤å’Œæ’åºå°±æ¢æˆäº† setã€‚ç„¶åè¿˜æœ‰ <code>multiset</code> çš„ä¸€äº›ç»†èŠ‚æ²¡æœ‰æ³¨æ„ã€‚å¤šäºäº† zayï¼Œä¸ç„¶æˆ‘åˆè¦è°ƒä¸Šä¸€å¹´â€¦è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç»†èŠ‚æ²¡æœ‰æ³¨æ„ï¼Œæ„Ÿè§‰åœ¨è€ƒåœºä¸ŠåŠ¿å¿…è¿˜æ˜¯è¦æŒ‚åˆ†ã€‚æ…¢æ…¢ç»ƒå§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">multiset</span> &lt;<span class="keyword">int</span>&gt; sint ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> s, g ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">bool</span> vis[N] ;</span><br><span class="line">sint chain[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa, <span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    sint t ; t.clear() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))&#123;</span><br><span class="line">        <span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ; <span class="keyword">int</span> z ;</span><br><span class="line">        dfs(to(k), x, w) ; f[x] += f[to(k)] ;</span><br><span class="line">z = (*chain[to(k)].begin()) + val(k) ;</span><br><span class="line">        <span class="keyword">if</span> (z &gt;= w) ++ f[x] ; <span class="keyword">else</span> t.insert(z) ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; x &lt;&lt; " &amp; " &lt;&lt; (*chain[to(k)].begin()) + val(k) &lt;&lt; " " ;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    puts("") ;</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; x &lt;&lt; " " &lt;&lt; t.size() &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">if</span> (t.empty())</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(chain[x].insert(<span class="number">0</span>)) ;</span><br><span class="line">    <span class="keyword">auto</span> s = t.begin() ;</span><br><span class="line">    <span class="keyword">while</span> (s != t.end())&#123;</span><br><span class="line">        <span class="keyword">int</span> p = w - (*s) ;</span><br><span class="line">        <span class="keyword">if</span> (p &lt; <span class="number">0</span>) <span class="keyword">break</span> ;</span><br><span class="line">        <span class="keyword">auto</span> q = t.lower_bound(p) ;</span><br><span class="line">        <span class="keyword">if</span> (q == s) ++ q ;</span><br><span class="line">        <span class="keyword">if</span> (q == t.end()) &#123; ++ s ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        t.erase(q) ; s = t.erase(s), ++ f[x] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t.empty()) chain[x].insert(<span class="number">0</span>) ;</span><br><span class="line"><span class="keyword">else</span> chain[x].insert(*(-- t.end())) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        chain[i].clear(), f[i] = <span class="number">0</span> ;</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>, x) ; <span class="comment">//debug(f, 1, n) ;</span></span><br><span class="line"><span class="keyword">return</span> (f[<span class="number">1</span>] &gt;= m) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; </span><br><span class="line">    <span class="keyword">int</span> x, y, z, l = <span class="number">10000</span>, r = <span class="number">0</span>, mid, ans ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">        x = qr() ; y = qr() ; z = qr() ;</span><br><span class="line">        add_e(x, y, z), add_e(y, x, z) ; </span><br><span class="line">        r += z ; chkmin(l, z) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (check(mid))</span><br><span class="line">            ans = mid, l = mid + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> r = mid - <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="D-æ—…è¡Œ"><a href="#D-æ—…è¡Œ" class="headerlink" title="D æ—…è¡Œ"></a>D æ—…è¡Œ</h2><blockquote><p>ç»™å‡ºä¸€æ£µæ ‘æˆ–è€…ä¸€æ£µåŸºç¯æ ‘ï¼Œæ±‚å­—å…¸åºæœ€å°çš„dfsåºã€‚</p><p>The original data range : $1\le n\le 5\times 10^3,n-1\leq m\leq n$ ã€‚</p><p>The extra data range: $1\le n\le 3\times 10^5,n-1\leq m\leq n$ã€‚</p></blockquote><p>è€ƒè™‘å¦‚æœæ˜¯æ ‘çš„è¯æ˜¾ç„¶æ˜¯å¯ä»¥ç›´æ¥è´ªçš„ã€‚åŸºç¯æ ‘çš„è¯å°±åªéœ€è¦æšä¸¾æ–­å“ªä¸€æ¡è¾¹å³å¯ã€‚æ³¨æ„æ–­çš„è¾¹ä¸èƒ½æ˜¯æ¡¥è¾¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == fa[x] ? x : fa[x] = find(fa[x]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    sz[u] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa &amp;&amp; !del[k])&#123;</span><br><span class="line">            dfs1(to(k), u),</span><br><span class="line">            sz[u] += sz[to(k)],</span><br><span class="line">            son[u].push_back(to(k)) ;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">1</span>, k ; o[++ res] = u ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : son[u]) dfs2(k, u) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Compare</span><span class="params">(<span class="keyword">int</span> *x, <span class="keyword">int</span> *y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line">        <span class="keyword">if</span> (x[i] &lt; y[i]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x[i] &gt; y[i]) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; N &gt;&gt; M ; <span class="keyword">int</span> i, u, v ;</span><br><span class="line">    <span class="built_in">memset</span>(ans, <span class="number">63</span>, <span class="keyword">sizeof</span>(ans)) ;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= M ; ++ i)</span><br><span class="line">        u = qr(), v = qr(), add(u, v) ;</span><br><span class="line">    <span class="keyword">if</span> (M == N - <span class="number">1</span>)&#123;</span><br><span class="line">        dfs1(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line">            sort(son[i].begin(), son[i].end()) ;</span><br><span class="line">        dfs2(<span class="number">1</span>, <span class="number">0</span>) ; <span class="built_in">memcpy</span>(ans, o, <span class="keyword">sizeof</span>(o)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= cnt ; i += <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> ctn = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= N ; ++ j)</span><br><span class="line">                fa[j] = j ; del[i] = del[i + <span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= cnt ; j += <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (del[j]) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">int</span> f1 = find(fr(j)) ;</span><br><span class="line">                <span class="keyword">int</span> f2 = find(to(j)) ;</span><br><span class="line">                <span class="keyword">if</span> (f1 != f2) fa[f1] = f2 ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= N ; ++ j)</span><br><span class="line">                ctn = ctn + (<span class="keyword">bool</span>)(fa[j] == j) ;</span><br><span class="line">            <span class="keyword">if</span> (ctn == <span class="number">1</span>) &#123;</span><br><span class="line">                dfs1(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= N ; ++ j)</span><br><span class="line">                    sort(son[j].begin(), son[j].end()) ;</span><br><span class="line">                dfs2(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= N ; ++ j) son[j].clear() ;</span><br><span class="line">                <span class="keyword">if</span> (Compare(o, ans))</span><br><span class="line">                    <span class="built_in">memcpy</span>(ans, o, <span class="keyword">sizeof</span>(o)) ;</span><br><span class="line">            &#125;</span><br><span class="line">            del[i] = del[i + <span class="number">1</span>] = <span class="number">0</span> ; res = <span class="number">0</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d "</span>, ans[i]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè€ƒè™‘æ›´å¿«ä¸€ç‚¹æ€ä¹ˆåšã€‚å‘ç°å°±æ˜¯ä¸€ä¸ªå¼±æ™ºè´ªå¿ƒã€‚ç„¶åå°±æ²¡æœ‰ç„¶åäº†ã€‚</p><p>upd: é¦™ï¼ŒçœŸé¦™ã€‚æ‰€è°“ã€Œå¼±æ™ºè´ªå¿ƒã€æˆ‘æ„£æ˜¯ä» $14:00$ å†™åˆ° $20:30$ ã€‚</p><p>å¤§æ¦‚å°±æ˜¯ä¸€å¼€å§‹è§‰å¾—ï¼Œå¯¹äºå½“å‰ç¯ï¼Œè®¾ç¯é‡Œé¢ç¦» $1$ æœ€è¿‘çš„ä¸€ä¸ªç‚¹ $k$ æ˜¯è¿™ä¸ªç¯çš„<strong>æ ¹</strong>ï¼Œé‚£ä¹ˆä»–ä¸€å®šæœ‰ä¸¤ä¸ªå„¿å­éƒ½åœ¨ç¯ä¸Šï¼Œç§°è¿™ä¸¤ä¸ªå„¿å­ä¸­<strong>è¾ƒå°</strong>çš„é‚£ä¸ªä¸º<strong>å·¦å„¿å­</strong>ï¼Œ<strong>è¾ƒå¤§</strong>çš„ä¸º<strong>å³å„¿å­</strong>ã€‚é‚£ä¹ˆè¦èµ°è‚¯å®šä¼šèµ°å·¦å„¿å­(è¿™é‡Œè®¾ä¸ºèµ° $x$)ï¼Œå¹¶ä¸”æ–­çš„åœ°æ–¹ä¸€å®šæ˜¯å·¦å„¿å­å‘ä¸‹æ‰¾çš„é€”ä¸­ç¬¬ä¸€ä¸ªæ¯”å³å„¿å­å¤§çš„ç‚¹ $z$ï¼Œå°† $z$ ç•™ç»™å³å„¿å­é‚£æ¡é“¾ï¼Œå› ä¸ºè¿™æ—¶å…ˆèµ°å³å„¿å­ä¸€å®šä¼šæ›´ä¼˜ã€‚</p><p>ç„¶è€Œè¿™æ˜¯é”™çš„ã€‚ç”±äºä¸Šæ–‡é’¦å®šäº†ä¸€å®šè¦ç»è¿‡ $z$ ä¹‹ä¸Šçš„ç‚¹ï¼Œæ‰€ä»¥ç¯ä¸Šæ‰€æœ‰æ·±åº¦ $&gt;dep_z$ ç‚¹çš„å¤–å‘æåœ¨å›æº¯æ—¶æ˜¯å¿…é¡»è¦èµ°çš„ï¼Œå¹¶ä¸”æ˜¯èµ°å®Œ $z$ ä¹‹åå°±éœ€è¦æ¥ç€èµ°ã€‚é‚£ä¹ˆå¦‚æœå¤–å‘æä¸­å­˜åœ¨ç‚¹çš„ç¼–å·æ¯” $z$ å¤§ï¼Œå°±ä¸å¦‚å…ˆèµ° $z$ å†å›æº¯ï¼Œå› ä¸º $z$ ä¹‹åç´§æ¥çš„éƒ½æ˜¯æ¯” $z$ å¤§çš„ã€‚ç„¶åæƒ³åˆ°è¿™é‡Œï¼Œæˆ‘å¤§æ¦‚æ˜¯ç”¨ä¸€ä¸ªå€¼ $v$ è¡¨ç¤ºä»å·¦å„¿å­èµ°åˆ°å½“å‰ç‚¹ $z$ï¼Œæ²¿é€”å¤–å‘æä¸­æœ€å¤§çš„ç‚¹çš„ç¼–å·ã€‚æ³¨æ„ç»†èŠ‚ï¼Œå¦‚æœå¤–å‘æä¸­çš„æŸäº›ç‚¹æ¯”å½“å‰ç‚¹è¦å°ï¼Œé‚£å¿…ç„¶æ˜¯å…ˆèµ°å¤–å‘æå†èµ°ç°åœ¨çš„ç‚¹ã€‚äºæ˜¯æˆ‘å¤§æ¦‚å°±æ˜¯è¿™ä¹ˆç»´æŠ¤çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bicheck</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> (<span class="keyword">bool</span>)((x == key_f) &amp;&amp; (y == key_s)); &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs4</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (x == loop_f) &#123;</span><br><span class="line">        <span class="keyword">int</span> t, q, p = <span class="number">0</span>, op = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cld[<span class="number">2</span>] = &#123; loop_s, loop_c &#125;;</span><br><span class="line">        <span class="keyword">if</span> (cld[<span class="number">0</span>] &lt; cld[<span class="number">1</span>])</span><br><span class="line">            t = cld[<span class="number">0</span>], q = cld[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            t = cld[<span class="number">1</span>], q = cld[<span class="number">0</span>];</span><br><span class="line">        dep[t] = dep[q] = dep[x] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (t == lj[tot])</span><br><span class="line">            reverse(lj + <span class="number">1</span>, lj + tot + <span class="number">1</span>);</span><br><span class="line">        op = maxx[lj[<span class="number">1</span>]];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span>; k &lt; tot; ++k) &#123;</span><br><span class="line">            <span class="keyword">if</span> (op &lt;= lj[k])</span><br><span class="line">                op = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (lj[k] &gt; q &amp;&amp; lj[k] &gt; op) &#123;</span><br><span class="line">                key_s = lj[k];</span><br><span class="line">                key_f = lj[k - <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; k; ++j) dep[lj[j]] = dep[lj[j - <span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = tot - <span class="number">1</span>; j &gt;= k; --j) dep[lj[j]] = dep[lj[j + <span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            op = max(maxx[lj[k]], op);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!key_s) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; tot; ++j) dep[lj[j]] = dep[lj[j - <span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œâ€¦è¿™è¿˜æ˜¯é”™çš„ã€‚å› ä¸ºå¦‚æœä¸Šé¢å­˜åœ¨æŸä¸ªå¤–å‘æå†…çš„ç‚¹ $x$ æ¯”å½“å‰ç‚¹ç¼–å·è¦å°ï¼Œä½†æ˜¯åœ¨å½“æ—¶å¹¶ä¸åº”è¯¥æå‰èµ° $x$ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœèµ°ä¸‹å»ï¼Œ$x$ å°±ä¼šæ¯”å½“å‰ç‚¹çš„æ—¶é—´æˆ³è¦é åï¼Œä¸å¦‚ç›´æ¥èµ° $x$ ã€‚å°±æ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ï¼Œåº”è¯¥æ–­æ‰ $(3,5)$ ï¼Œå…ˆèµ° $5$ å†å›æº¯åˆ° $4$ æ˜¾ç„¶ä¸å¦‚ç›´æ¥èµ° $4$ æ›´ä¼˜ã€‚ </p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>äºæ˜¯å†·é™äº†ä¸€ä¸‹æ”¹æˆç”¨ set å»ç»´æŠ¤ <code>lower_bound</code> å’Œå½“å‰æœ€å°å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stt.insert(maxx[lj[<span class="number">1</span>]]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span>; k &lt; tot; ++k) &#123;</span><br><span class="line">    <span class="keyword">while</span> ((!stt.empty()) &amp;&amp; (*stt.begin() &lt;= x)) stt.erase(stt.begin());</span><br><span class="line">    <span class="keyword">if</span> (lj[k] &gt; q &amp;&amp; (stt.empty() || stt.lower_bound(lj[k]) != stt.begin())) &#123;</span><br><span class="line">        key_s = lj[k];</span><br><span class="line">        key_f = lj[k - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span>; j &lt; k; ++j) dep[lj[j]] = dep[lj[j - <span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = tot - <span class="number">1</span>; j &gt;= k; --j) dep[lj[j]] = dep[lj[j + <span class="number">1</span>]] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    stt.insert(maxx[lj[k]]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·è¿˜æ˜¯ä¸å¯¹â€¦åœ¨æˆ‘å†·é™äº†å¾ˆä¹…ä¹‹åå‘ç°â€¦ä¼¼ä¹å¾ˆéš¾ç¡®å®šåˆ°åº•è¯¥èµ°åˆ°å“ªä¸ªç‚¹æ–­æ‰ï¼Œå› ä¸ºè¿™æ ·è´ªå¿ƒç›¸å½“äºè¿˜æ˜¯åªæƒ³äº†ä¸€åŠ<del>æœŸé—´ä¸€åº¦é™·å…¥è‡ªé—­</del>ã€‚</p><p>ç„¶åçµå…‰ä¸€é—ªã€‚å‘ç°å¤–å‘æé‡Œé¢å¯èƒ½æœ‰æ¯”å½“å‰å¤§çš„ç‚¹ï¼Œä¹Ÿå¯èƒ½æœ‰æ¯”å½“å‰å°çš„ç‚¹ã€‚é‚£ä¹ˆå¦‚æœå›æº¯æ—¶ä¸€å®šä¼šå…ˆå»éå†æ¯”å½“å‰ç‚¹å¤§çš„ç‚¹å°±è‚¯å®šä¸ä¼šæ–­ï¼Œå¦‚æœä¸€å®šä¼šå»éå†æ¯”å½“å‰å°çš„ç‚¹å°±ä¸€å®šè¦æ–­ã€‚å¦åˆ™å¦‚æœå¯ä»¥é€‰æ‹©å…ˆéå†å¤§çš„è¿˜æ˜¯å°çš„ï¼Œå°±å¯ä»¥æ ¹æ®æœ€åˆçš„é‚£ä¸ª check æ¥åˆ¤æ–­åˆ°åº•æ–­ä¸æ–­ï¼Œå› ä¸ºæ­¤æ—¶å¤–å‘æä¸å†æœ‰å½±å“ã€‚äºæ˜¯å°±æ‹¿äº†ä¸ªçº¿æ®µæ ‘ç»´æŠ¤äº†ä¸€ä¸‹æ—¶é—´æˆ³ã€‚ç„¶åå°±è¿‡æ‰äº†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿˜æ˜¯è‡ªå·±æ€è·¯å¤ªä¸æ¸…æ™°ã€å¤ªä¸ä»”ç»†å¯¼è‡´å¹³ç™½æ— æ•…æµªè´¹äº†è®¸å¤šæ—¶é—´ã€‚å†™ä»£ç çš„æ—¶å€™ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæœ‰ä¸€ç§ã€Œè¿™æ ·ä¸€å®šæ˜¯å¯¹çš„ã€çš„è¯¡å¼‚å‹‡æ°”è®©æˆ‘æ— æ³•é™ä¸‹å¿ƒæ¥æ€è€ƒâ€¦</p><p>è¿˜æ˜¯å®æˆ˜è¿‡å°‘ã€‚å¯èƒ½éœ€è¦æ¨¡æ‹Ÿèµ›æ¥è¡¥æ•‘ä¸€ä¸‹è¿™å—çŸ­æ¿ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="keyword">int</span> key_f ;</span><br><span class="line"><span class="keyword">int</span> key_s ;</span><br><span class="line"><span class="keyword">int</span> loop_f ;</span><br><span class="line"><span class="keyword">int</span> loop_s ;</span><br><span class="line"><span class="keyword">int</span> loop_c ;</span><br><span class="line"><span class="keyword">int</span> fr[MAXN] ;</span><br><span class="line"><span class="keyword">int</span> dep[MAXN] ;</span><br><span class="line"><span class="keyword">int</span> base[MAXN] ;</span><br><span class="line"><span class="keyword">int</span> maxx[MAXN] ;</span><br><span class="line"><span class="keyword">bool</span> vis[MAXN] ;</span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; q ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs3</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vis[x])&#123;</span><br><span class="line">        loop_f = x ;</span><br><span class="line">        loop_s = fa ;</span><br><span class="line">        <span class="keyword">int</span> t = loop_s ;</span><br><span class="line">        <span class="keyword">while</span> (t != loop_f)</span><br><span class="line">            base[++ tot] = t, t = fr[t] ;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125; vis[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))&#123;</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa)&#123;</span><br><span class="line">            maxx[x] = max(maxx[x], to(k)) ;</span><br><span class="line">            fr[to(k)] = x, dfs3(to(k), x) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bicheck</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">bool</span>)((x == key_f) &amp;&amp; (y == key_s)) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> seg[MAXN * <span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">void</span> _up(<span class="keyword">int</span> rt)&#123;</span><br><span class="line">    seg[rt] = max(seg[rt &lt;&lt; <span class="number">1</span>], seg[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">        seg[rt] = v ;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt;= mid) upd(rt &lt;&lt; <span class="number">1</span>, l, mid, pos, v) ;</span><br><span class="line">    <span class="keyword">else</span> upd(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, pos, v) ; _up(rt) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, res = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) <span class="keyword">return</span> seg[rt] ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) chkmax(res, query(rt &lt;&lt; <span class="number">1</span>, l, mid, ql, qr)) ;</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) chkmax(res, query(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, ql, qr)) ;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs4</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (x == loop_f)&#123;</span><br><span class="line">        <span class="keyword">int</span> t, q, p = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">int</span> op = <span class="number">0</span>, pre = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">int</span> cld[<span class="number">2</span>] = &#123;loop_s, loop_c&#125; ;</span><br><span class="line">        <span class="keyword">if</span> (cld[<span class="number">0</span>] &lt; cld[<span class="number">1</span>])</span><br><span class="line">            t = cld[<span class="number">0</span>], q = cld[<span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">else</span> t = cld[<span class="number">1</span>], q = cld[<span class="number">0</span>] ;</span><br><span class="line">        dep[t] = dep[q] = dep[x] + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">if</span> (t == base[tot])</span><br><span class="line">            reverse(base + <span class="number">1</span>, base + tot + <span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = head[base[<span class="number">1</span>]] ; j ; j = next(j))&#123;</span><br><span class="line"><span class="keyword">if</span> (to(j) == x) <span class="keyword">continue</span> ; </span><br><span class="line">            <span class="keyword">if</span> (to(j) &lt;= base[<span class="number">2</span>]) <span class="keyword">continue</span> ;</span><br><span class="line">            upd(<span class="number">1</span>, <span class="number">1</span>, n, to(j), dep[base[<span class="number">1</span>]]) ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">2</span> ; k &lt;= tot ; ++ k)&#123;</span><br><span class="line">            chkmax(pre, base[k]) ;</span><br><span class="line">            <span class="keyword">int</span> <span class="keyword">more_t</span> = query(<span class="number">1</span>, <span class="number">1</span>, n, base[k] + <span class="number">1</span>, n) ;</span><br><span class="line">            <span class="keyword">int</span> <span class="keyword">less_t</span> = query(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">1</span>, base[k] - <span class="number">1</span>) ; </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">less_t</span> == <span class="keyword">more_t</span> &amp;&amp; pre &gt; q) &#123;</span><br><span class="line">                key_s = base[k] ;</span><br><span class="line">                key_f = base[k - <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = tot - <span class="number">1</span> ; j &gt;= k ; -- j)</span><br><span class="line">                    dep[base[j]] = dep[base[j + <span class="number">1</span>]] + <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">less_t</span> &gt; <span class="keyword">more_t</span>)&#123;</span><br><span class="line">                key_s = base[k] ;</span><br><span class="line">                key_f = base[k - <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = tot - <span class="number">1</span> ; j &gt;= k ; -- j)</span><br><span class="line">                    dep[base[j]] = dep[base[j + <span class="number">1</span>]] + <span class="number">1</span> ;</span><br><span class="line">                <span class="keyword">break</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> y = base[k] ;</span><br><span class="line">            dep[base[k]] = dep[base[k - <span class="number">1</span>]] + <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = head[y] ; j ; j = next(j))&#123;</span><br><span class="line">                <span class="keyword">if</span> (to(j) == base[k - <span class="number">1</span>]) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (to(j) &lt;= base[k + <span class="number">1</span>]) <span class="keyword">continue</span> ;</span><br><span class="line">                upd(<span class="number">1</span>, <span class="number">1</span>, n, to(j), dep[y]) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!key_s)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> ; j &lt;= tot ; ++ j)</span><br><span class="line">                dep[base[j]] = dep[base[j - <span class="number">1</span>]] + <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))&#123;</span><br><span class="line"><span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (bicheck(x, to(k))) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (bicheck(to(k), x)) <span class="keyword">continue</span> ;</span><br><span class="line">        <span class="keyword">if</span> (dep[to(k)] &amp;&amp; dep[to(k)] != dep[x] + <span class="number">1</span>) <span class="keyword">continue</span> ;</span><br><span class="line">dfs4(to(k), x) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs5</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    sz[u] = <span class="number">1</span> ; <span class="comment">//cout &lt;&lt; u &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa &amp;&amp; !bicheck(u, to(k)) &amp;&amp; !bicheck(to(k), u) &amp;&amp; dep[to(k)] == dep[u] + <span class="number">1</span>)</span><br><span class="line">            dfs5(to(k), u), sz[u] += sz[to(k)], son[u].push_back(to(k)) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs6</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">1</span>, k ; o[++ res] = u ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : son[u]) dfs6(k, u) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//freopen("travel.in", "r", stdin);</span></span><br><span class="line">    <span class="comment">//freopen("travel.out", "w", stdout);</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; <span class="keyword">int</span> i, u, v ;</span><br><span class="line">    <span class="built_in">memset</span>(ans, <span class="number">63</span>, <span class="keyword">sizeof</span>(ans)) ;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        u = qr(), v = qr(), add(u, v), ++ deg[u], ++ deg[v] ;</span><br><span class="line">    <span class="keyword">if</span> (m == n - <span class="number">1</span>)&#123;&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        dfs3(<span class="number">1</span>, <span class="number">0</span>) ; tot -- ;</span><br><span class="line">        swap(loop_s, loop_f) ;</span><br><span class="line">        <span class="keyword">if</span> (base[<span class="number">1</span>] == loop_s)</span><br><span class="line">             loop_c = base[tot] ;</span><br><span class="line">        <span class="keyword">else</span> loop_c = base[<span class="number">1</span>] ; dfs4(<span class="number">1</span>, <span class="number">0</span>) ; </span><br><span class="line">dfs5(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            sort(son[i].begin(), son[i].end()) ;</span><br><span class="line">        dfs6(<span class="number">1</span>, <span class="number">0</span>) ; <span class="built_in">memcpy</span>(ans, o, <span class="keyword">sizeof</span>(o)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%d "</span>, ans[i]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="E-å¡«æ•°æ¸¸æˆ"><a href="#E-å¡«æ•°æ¸¸æˆ" class="headerlink" title="E å¡«æ•°æ¸¸æˆ"></a>E å¡«æ•°æ¸¸æˆ</h2><p>è€ƒè™‘æš´åŠ›çš„è¯è‡ªç„¶æ˜¯æœç´¢â€¦å½“æ—¶åœ¨è€ƒåœºä¸Šå†™äº†å¥½ä¹…â€¦å¹¸äºæœ€åè°ƒå‡ºæ¥äº†ã€‚ä¾ç¨€è®°å¾—æœ€å $30min$ è°ƒå‡ºæ¥è¿™ä¸ªæœç´¢ä¹‹åï¼Œæ‰¾åˆ°è§„å¾‹ä¹‹åæ— æ¯”å…´å¥‹â€¦å…´å¥‹åˆ°æ²¡æœ‰æ‰“æœ€åä¸€é¢˜çš„æš´åŠ›qaq</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Ans ; <span class="keyword">char</span> S[<span class="number">20000</span>][<span class="number">200</span>], W[<span class="number">20000</span>][<span class="number">200</span>] ;</span><br><span class="line"><span class="keyword">int</span> N, M, T[<span class="number">20000</span>], i, j, k, tot, <span class="built_in">map</span>[<span class="number">250</span>][<span class="number">250</span>] ; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> step)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x == N &amp;&amp; y == M) &#123;</span><br><span class="line">W[tot][step] = (<span class="keyword">char</span>)(<span class="built_in">map</span>[N][M] + <span class="number">48</span>) ; </span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (x == N) S[tot][step] = <span class="string">'R'</span>, W[tot][step] = (<span class="keyword">char</span>)(<span class="built_in">map</span>[x][y] + <span class="number">48</span>), dfs(x, y + <span class="number">1</span>, step + <span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (y == M) S[tot][step] = <span class="string">'D'</span>, W[tot][step] = (<span class="keyword">char</span>)(<span class="built_in">map</span>[x][y] + <span class="number">48</span>), dfs(x + <span class="number">1</span>, y, step + <span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">else</span> S[tot][step] = <span class="string">'R'</span>, W[tot][step] = (<span class="keyword">char</span>)(<span class="built_in">map</span>[x][y] + <span class="number">48</span>), dfs(x, y + <span class="number">1</span>, step + <span class="number">1</span>),</span><br><span class="line"> <span class="built_in">strcpy</span>(S[tot + <span class="number">1</span>], S[tot]), ++ tot, S[tot][step] = <span class="string">'D'</span>, <span class="built_in">strcpy</span>(W[tot], W[tot - <span class="number">1</span>]), W[tot][step] = (<span class="keyword">char</span>)(<span class="built_in">map</span>[x][y] + <span class="number">48</span>), dfs(x + <span class="number">1</span>, y, step + <span class="number">1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> A = <span class="number">1</span> ; A &lt; tot ; ++ A)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> B = A ; B &lt;= tot  ; ++ B)&#123;</span><br><span class="line"><span class="keyword">bool</span> flag = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> di = <span class="number">0</span> ; di &lt; N + M - <span class="number">2</span> ; ++ di)</span><br><span class="line"><span class="keyword">if</span> (S[A][di] &gt; S[B][di]) &#123; flag = <span class="number">1</span> ; <span class="keyword">break</span> ; &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (S[A][di] &lt; S[B][di])&#123; flag = <span class="number">0</span> ; <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> di = <span class="number">0</span> ; di &lt; N + M - <span class="number">1</span> ; ++ di)</span><br><span class="line"><span class="keyword">if</span> ((W[A][di] &gt; W[B][di]) &amp;&amp; flag) <span class="keyword">return</span> <span class="number">0</span> ; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (W[A][di] &lt; W[B][di]) <span class="keyword">break</span> ;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> A = <span class="number">1</span> ; A &lt;= tot ; ++ A)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> B = <span class="number">1</span> ; B &lt; A ; ++ B)&#123;</span><br><span class="line"><span class="keyword">bool</span> flag = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> di = <span class="number">0</span> ; di &lt; N + M - <span class="number">2</span> ; ++ di)</span><br><span class="line"><span class="keyword">if</span> (S[A][di] &lt; S[B][di]) &#123; flag = <span class="number">1</span> ; <span class="keyword">break</span> ; &#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (S[A][di] &gt; S[B][di])&#123; flag = <span class="number">0</span> ; <span class="keyword">break</span>; &#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> di = <span class="number">0</span> ; di &lt; N + M - <span class="number">1</span> ; ++ di)</span><br><span class="line"><span class="keyword">if</span> (W[A][di] &lt; W[B][di] &amp;&amp; flag) <span class="keyword">return</span> <span class="number">0</span> ; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (W[A][di] &gt; W[B][di]) <span class="keyword">break</span> ;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">expow</span><span class="params">(LL A, LL B)</span></span>&#123;</span><br><span class="line">LL res = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">while</span> (B)&#123;</span><br><span class="line"><span class="keyword">if</span> (B &amp; <span class="number">1</span>) res = res * A % Mod ;</span><br><span class="line">A = A * A % Mod, B &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res % Mod ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N &gt;&gt; M ; </span><br><span class="line"><span class="keyword">if</span> (N &gt; M) swap(N, M) ;</span><br><span class="line"><span class="keyword">if</span> (N &lt;= <span class="number">4</span> &amp;&amp; M &lt;= <span class="number">4</span>)&#123;</span><br><span class="line"><span class="keyword">int</span> Max = (<span class="number">1</span> &lt;&lt; N * M) - <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt;= Max ; ++ i)&#123;</span><br><span class="line">tot = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">1</span> ; j &lt;= N ; ++ j)</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">1</span> ; k &lt;= M ; ++ k)</span><br><span class="line"><span class="built_in">map</span>[j][k] = (<span class="number">1</span> &lt;&lt; tot &amp; i) ? <span class="number">1</span> : <span class="number">0</span>, ++ tot ;</span><br><span class="line">tot = <span class="number">1</span>, dfs(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>) ; </span><br><span class="line"><span class="keyword">if</span> (check()) ++ Ans ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; Ans &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (N == <span class="number">2</span>)&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="number">12</span> * expow(<span class="number">3</span>, M - <span class="number">2</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (N == <span class="number">3</span>)&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="number">112</span> * expow(<span class="number">3</span>, M - <span class="number">3</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (N == <span class="number">5</span> &amp;&amp; M == <span class="number">5</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">7136</span> &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (N == <span class="number">5</span> &amp;&amp; M == <span class="number">4</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">2688</span> &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—äº†ä¸€ä¸‹è¿™ä¸ªæœç´¢çš„å¤æ‚åº¦ã€‚å‘ç°å¤§æ¦‚æ˜¯ä»€ä¹ˆ $O\left(2^{m\times n}\cdot \binom{n+m-2}{n-1}^2\right)$ çš„ï¼Œè¿™ä¸œè¥¿åœ¨ $n=5,m=5$ çš„æ—¶å€™è®¡ç®—é‡æ˜¯ $164416716800\approx1.64\cdot 10^{11}$ã€‚ä¸è¿‡æ‰“å‡º $n=3,m=4/5/6$ çš„è¡¨æ¥è¿˜æ˜¯æˆ³æˆ³æœ‰ä½™çš„ï¼ˆ$n=3,m=6,T=115605504$ï¼‰ã€‚</p><p>ç„¶åå°±åˆæ˜¯å–œé—»ä¹è§çš„æ‰¾æ€§è´¨ç¯èŠ‚ï¼š</p><p>1ã€ä¸éš¾å½’çº³å‡ºæ¥ï¼Œåå¯¹è§’çº¿(å³ $n+m$ ä¸ºå®šå€¼)ä¸Šæ‰€æœ‰çš„ä½ç½®ï¼ŒæŒ‰ç…§åˆ—å·ä»å°åˆ°å¤§æ¥æ’å¸ƒï¼Œå¡«çš„æ•°æ„æˆçš„æ•°åˆ—åº”è¯¥<strong>ä¸ä¸‹é™</strong>ã€‚å…·ä½“å¯ä»¥è€ƒè™‘å½’çº³ï¼Œå¤§æ¦‚å°±æ˜¯è¯´å¦‚æœæœ‰ä¸¤ä¸ªåºåˆ—çš„ä¸€éƒ¨åˆ†åªæœ‰ä¸¤æ­¥ä¸åŒï¼Œå³ <code>...WWWWDDDD...</code> å’Œ <code>...WWWDWDDD...</code>ï¼Œé‚£ä¹ˆå¿…ç„¶å­˜åœ¨ä¸€ä¸ªç»è¿‡äº† $(i,j)$ è€Œå¦ä¸€ä¸ªç»è¿‡äº† $(i+1,j-1)$ï¼Œé‚£ä¹ˆå°±å¿…ç„¶éœ€è¦ $a_{i+1,j-1}\geq a_{i,j}$ã€‚é‚£ä¹ˆä¸€ç›´å½’çº³ä¸‹å»ï¼Œä¸éš¾å‘ç°è¿™æ˜¯<strong>å¿…è¦æ¡ä»¶</strong>ã€‚</p><p>2ã€ç„¶è€Œåªè€ƒè™‘ç¬¬ä¸€ç‚¹æ˜¯é”™çš„ã€‚è‡ªå·±è¿˜æ˜¯æŠŠæš´åŠ›å’Œæ„é€ åˆ†åˆ«æ‰“äº†ä¸ªè¡¨å‡ºæ¥æ‰æ˜ç™½å“ªä¸å¯¹â€¦å…·ä½“æ¥è¯´æ¯”å¦‚è¿™ä¸ªçŸ©é˜µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 1 1</span><br><span class="line">1 1 0</span><br><span class="line">1 1 1</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ <code>WDDW</code> å’Œ <code>DWWD</code> è¿™ä¸¤ä¸ªèµ°æ³•çš„å…³ç³»å°±æ˜¾ç„¶ä¸å¯¹ã€‚ç„¶åæŠ½è±¡äº†ä¸€ä¼šå„¿è§‰å¾—å¯èƒ½æ˜¯è¦è€ƒè™‘å¯¹ç§°ä½ç½®ï¼Œä½†æ˜¯å‘ç° $n\ne m$ æ—¶å¹¶ä¸å¯ä»¥è‰¯å®šä¹‰ã€Œå¯¹ç§°ã€ï¼›åˆè§‰å¾—å¯èƒ½æ˜¯éœ€è¦åˆ° $i,j$ çš„è·¯å¾„éƒ½æœ¬è´¨ä¸åŒï¼Œä½†æ˜¯å‘ç°å¹¶ä¸ä¼šè®¾è®¡çŠ¶æ€æ¥ç®—è¿™ä¸ªæ­¥æ•°â€¦</p><p>è¿˜æ˜¯çŸ¥ä¹å¥½ï¼ä»çŸ¥ä¹ä¸Šå­¦äº†ä¸€æ³¢ï¼Œæ„Ÿè§‰ååˆ†æ·±åˆ»ã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘å¦‚æœ $(i,j-1)=(i-1,j)$ ï¼Œé‚£ä¹ˆä»¥ $(i,j)$ ä¸ºå·¦ä¸Šè§’çš„æ‰€æœ‰çŸ©é˜µçš„åå¯¹è§’çº¿ä¸Šçš„æ•°éƒ½å¿…é¡»ç›¸ç­‰ã€‚æ„Ÿè§‰è¿™ä¸ªæŠ½è±¡ååˆ†åˆ°ä½ã€‚è€ƒè™‘å¦‚æœæŸæ¡å¯¹è§’çº¿ä¸Šçš„ä¸¤ä¸ªç‚¹ $(a_1,b_1),(a_2,b_2)$ ä¸åŒï¼Œé‚£ä¹ˆå¿…ç„¶å¯ä»¥è®©ä¸¤æ¡è·¯çº¿è®©ä»–ä»¬åœ¨ $(c,d)$ å¤„åˆ†å¼€ï¼Œä¸€ä¸ªå°½é‡ <code>W</code> ä¸€ä¸ªå°½é‡ <code>D</code>ï¼Œæ³¨æ„åˆ°ç”±äº <code>W&amp;D</code> çš„æ•°é‡æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å°½é‡ <code>W</code> çš„é‚£ä¸ªä¸€å¼€å§‹å­—å…¸åºä¸€å®šåå°ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„èµ°åˆ° $(a_2,b_2)$ å°±ä¼šä½¿ç­”æ¡ˆä¸åˆæ³•ã€‚</p><h3 id="Sol-1"><a href="#Sol-1" class="headerlink" title="Sol 1"></a>Sol 1</h3><p>æ¯”è¾ƒç›´æ¥çš„ç›¸åå°±æ˜¯ç»§ç»­çˆ†æœã€‚å‘ç°è¿™æ ·ä¼˜åŒ–äº†ä¸€æ³¢ä¹‹åå¤æ‚åº¦å˜æˆäº† $O(2^{n\times m}\cdot n^2m^2)$ çš„ï¼Œé‚£ä¹ˆ $n=m=5$ æ—¶çš„è¿ç®—é‡å°±å˜æˆäº† $20971520000\approx 2.1\cdot 10^{10}$ â€¦å¥½åƒä¹Ÿæ²¡å¿«å¤šå°‘â€¦</p><p>ç„¶åå¤§æ¦‚å°±æ˜¯è€ƒè™‘å¯¹ç€è¿™ä¸¤ä¸ªæ¡ä»¶è¿›è¡Œ dpã€‚ç„¶åå¤§æ¦‚å‘ç°è‡ªå·±ä¸ä¼šæ€ä¹ˆ dp å¯¹è§’çº¿ã€‚ç„¶åé€‰æ‹©å‰ªæã€‚å‘ç°å¤æ‚åº¦å¤§å¤´æ˜¯ $2^{n\times m}$ï¼Œè€ƒè™‘ç¼©ä¸€ä¸‹è¿™ä¸ªï¼Œå¤§æ¦‚å°±æ˜¯ç¡®å®šæ¯æ¡å¯¹è§’çº¿å“ªä¸ªä½ç½®æ˜¯åˆ†ç•Œç‚¹ã€‚é‚£ä¹ˆè®¾ $n\leq m$ï¼Œè¿™æ ·çš„å¤æ‚åº¦å¤§æ¦‚æ˜¯ $O\left((n!)^2\cdot n^{m-n}\cdot n^2m^2\right)$ ã€‚ç¨å¾®ä¼˜åŒ–ä¸€æ³¢ <code>checker</code> å°±å¯ä»¥åšåˆ° $O\left((n!)^2\cdot n^{m-n}\cdot nm\right)$ ã€‚ä½†è¿™æ ·åœ¨ $n=m=7$ çš„æ—¶å€™å¤§æ¦‚æ˜¯ $1244678400=1.24\cdot 10^9$ ä¾æ—§ä¸æ˜¯å¾ˆèƒ½è¿‡<del>ç„¶åå‘ç°(1,1)å’Œ(n,n)å¹¶ä¸é‡è¦å°±å¯ä»¥æœ‰ä¸€ä¸ª1/4çš„å¸¸æ•°</del>ã€‚ä½†æ— è®ºæ€æ ·ï¼Œ80 åˆ†ç¡®å®æ˜¯æœ‰äº†ã€‚ç®—äº†ä¸€ä¸‹ $n=m=8$ çš„æ—¶å€™ $  T= 104044953600\approx 10^{11}$ï¼Œå¦‚æœæŒ‰ç…§ä¸€ç§’é’Ÿ $5e8$ çš„é€Ÿåº¦å¤§æ¦‚æ˜¯ $2000s+$ ï¼ˆå…¶å®ä¸åˆ° $2min$ å°±å‡ºæ¥äº†ï¼‰ï¼Œæ‰¾ä¸€æ³¢è§„å¾‹å°± $100$ äº†ã€‚</p><p>ä¸çŸ¥ä¸ºä½•ä¼¼ä¹æœ‰å‘ç‚¹ã€‚å‘ç°å½“ $n=6$ çš„æ—¶å€™åº”è¯¥æ‹¿ $m=7$ æ—¶ç®—çš„æ•°æ¥ç®—ï¼Œå› ä¸ºæ­¤æ—¶ä¼¼ä¹ $ans(6,7)\ne3\cdot ans(6,6)$ ï¼Ÿä¼¼ä¹ $n=8$ æ—¶ä¹Ÿæ˜¯è¿™æ ·â€¦æŒºå¥‡æ€ªçš„ã€‚å¹¶ä¸” $8,9$ è‡³å°‘è¦å¤šä¸€ä¸ª $81$ å€å¸¸æ•°â€¦å°±å¾ˆçˆ†ç‚¸ã€‚ä¸è¿‡ä¼¼ä¹ç¡®å®ä¹Ÿåœ¨ $10min$ ä¹‹å†…å‡ºäº†ç»“æœã€‚å¤§åŠ›å‡ºå¥‡è¿¹å•Šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ans, vis[<span class="number">100</span>][<span class="number">100</span>] ;</span><br><span class="line"><span class="keyword">int</span> n, m, tot, <span class="built_in">map</span>[<span class="number">100</span>][<span class="number">100</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> owo)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (vis[i][j] == owo) <span class="keyword">continue</span> ;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">map</span>[i - <span class="number">1</span>][j] == <span class="built_in">map</span>[i][j - <span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = i + <span class="number">1</span> ; x &lt;= n ; ++ x)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> y = j ; y &lt; m ; ++ y)</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">map</span>[x][y] == <span class="built_in">map</span>[x - <span class="number">1</span>][y + <span class="number">1</span>])</span><br><span class="line">                            vis[x][y] = owo ; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">expow</span><span class="params">(ll x, ll y)</span></span>&#123;</span><br><span class="line">ll res = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">while</span> (y)&#123;</span><br><span class="line"><span class="keyword">if</span> (y &amp; <span class="number">1</span>) res = res * x % Mod ;</span><br><span class="line">x = x * x % Mod, y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res % Mod ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s == n + m - <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(ans += check(++ tot)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (s &lt;= n)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x, y, i = <span class="number">0</span> ; i &lt;= s ; ++ i)&#123;</span><br><span class="line">            x = s, y = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (x &gt;= s - i + <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">1</span>, x --, y ++ ;</span><br><span class="line">            dfs(s + <span class="number">1</span>) ;</span><br><span class="line">            x = s, y = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (x &gt;= s - i + <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">0</span>, x --, y ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s &lt;= m)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x, y, i = <span class="number">0</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            x = n, y = s - n + <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (x &gt;= n - i + <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">1</span>, x --, y ++ ;</span><br><span class="line">            dfs(s + <span class="number">1</span>) ;</span><br><span class="line">            x = n, y = s - n + <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (x &gt;= n - i + <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">0</span>, x --, y ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> t = n - (s - m) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x, y, j, i = <span class="number">0</span>; i &lt;= t ; ++ i)&#123;</span><br><span class="line">            x = n, y = s - n + <span class="number">1</span>, j = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (j &lt;= i)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">1</span>, ++ j, x --, y ++ ;</span><br><span class="line">            dfs(s + <span class="number">1</span>) ;</span><br><span class="line">            x = n, y = s - n + <span class="number">1</span>, j = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">while</span> (j &lt;= i)</span><br><span class="line">                <span class="built_in">map</span>[x][y] = <span class="number">0</span>, ++ j, x --, y ++ ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line"><span class="keyword">if</span> (n &gt; m) swap(n, m) ;</span><br><span class="line">    <span class="keyword">if</span> (n + m &lt;= <span class="number">12</span>) dfs(<span class="number">2</span>), <span class="built_in">cout</span> &lt;&lt; <span class="number">4</span> * ans &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">12l</span>l * expow(<span class="number">3</span>, m - <span class="number">2</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">3</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">112l</span>l * expow(<span class="number">3</span>, m - <span class="number">3</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">6</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">170112l</span>l * expow(<span class="number">3</span>, m - <span class="number">7</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">7</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">453504l</span>l * expow(<span class="number">3</span>, m - <span class="number">7</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">8</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (m == <span class="number">8</span>) <span class="built_in">cout</span> &lt;&lt; <span class="number">3626752</span> &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">cout</span> &lt;&lt; <span class="number">10879488l</span>l * expow(<span class="number">3</span>, m - <span class="number">9</span>) % Mod &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">         &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Sol-2"><a href="#Sol-2" class="headerlink" title="Sol 2"></a>Sol 2</h3><p>å­¦äº†ä¸€æ³¢çŠ¶å‹å¯¹è§’çº¿ï¼Œæ„Ÿè§‰è‡ªå·±æ˜¯å¼Ÿå¼Ÿã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘å¦‚ä½•æŠŠä¸¤ä¸ªé™åˆ¶å†™åˆ°çŠ¶æ€é‡Œé¢ã€‚å‘ç°å¯ä»¥è®¾çŠ¶æ€ $f_{i,j,s}$ è¡¨ç¤ºè€ƒè™‘å‰ $i$ æ¡å¯¹è§’çº¿ï¼Œç¬¬ $i$ æ¡å¯¹è§’çº¿ä»ä¸‹è‡³å°‘æŸ“äº† $j$ ä¸ª $1$ï¼Œå¯¹è§’çº¿ä¸Šæ¯ä¸ªä½ç½®(ä»¥åŠæ‰€åŒ…å«çš„é‚£ä¸ªçŸ©å½¢)æ˜¯å¦åˆæ³•(ç”¨ $s$ è¡¨ç¤º)çš„æ–¹æ¡ˆæ•°ã€‚è½¬ç§»å°±å¯ä»¥æšä¸¾ä¸Šä¸€æ¡å¯¹è§’çº¿çš„çŠ¶æ€ã€‚è¿™æ ·æœ€åå°±æ˜¯ $O(2^n\cdot n\cdot n^2\cdot m)$ çš„å¤æ‚åº¦ã€‚</p><p><del>ä½†æ˜¾ç„¶æœ€åç­”æ¡ˆè¿˜æ˜¯è¦æ‰“è¡¨æ‰¾è§„å¾‹çš„</del>ã€‚</p><h2 id="F-ä¿å«ç‹å›½"><a href="#F-ä¿å«ç‹å›½" class="headerlink" title="F ä¿å«ç‹å›½"></a>F ä¿å«ç‹å›½</h2><blockquote><p>ç»™å®šæ ‘ï¼Œæ±‚æœ€å°ç‚¹è¦†ç›–ã€‚å¤šç»„è¯¢é—®ï¼Œæ¯ç»„è¯¢é—®ä¼šé’¦å®šä¸¤ä¸ªç‚¹è¢«è¦†ç›–æˆ–è€…ä¸è¢«è¦†ç›–ï¼Œå¹¶è¯¢é—®æœ€å°è¾¹è¦†ç›–ã€‚</p><p>$1\leq n,m\leq 10^5$ ã€‚</p></blockquote><h2 id="Sol-1-é“¾åˆ†æ²»ç»´æŠ¤dp"><a href="#Sol-1-é“¾åˆ†æ²»ç»´æŠ¤dp" class="headerlink" title="Sol 1 é“¾åˆ†æ²»ç»´æŠ¤dp"></a>Sol 1 é“¾åˆ†æ²»ç»´æŠ¤dp</h2><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘æœ€å°è¾¹è¦†ç›–çš„ $dp$</p><script type="math/tex; mode=display">f_{x,0}=\sum f_{y,1}\\f_{x,1}=\sum \min\{f_{y,1},f_{y,0}\}</script><p>ç„¶åè€ƒè™‘è®¾ $g_{x,0}$ è¡¨ç¤ºåªè€ƒè™‘äº† $x$ çš„è½»å„¿å­æ—¶çš„æœ€å°è¾¹è¦†ç›–ã€‚é‚£ä¹ˆæœ‰</p><script type="math/tex; mode=display">f_{x,0}=g_{x,0}+f_{z,1}\\f_{x,1}=g_{x,1}+\min\{f_{z,0},f_{z,1}\}</script><p>å…¶ä¸­ $z$ æ˜¯ $x$ çš„é‡å„¿å­ã€‚é‚£ä¹ˆä¸éš¾çŸ¥é“è½¬ç§»çŸ©é˜µåº”è¯¥å†™æˆ</p><script type="math/tex; mode=display">\begin{bmatrix}f_{z,0}&f_{z,1}\end{bmatrix}\times \begin{bmatrix}+\infty & g_{x,1}\\g_{x,0} & g_{x,1}\\\end{bmatrix}= \begin{bmatrix}f_{x,0}&f_{x,1}\end{bmatrix}</script><p>ç„¶åå°±å¯ä»¥ç›´æ¥ç”¨ LCT ç»´æŠ¤é“¾æ¥åšäº†ã€‚å†™çš„æ—¶å€™æœ‰ä¸å°‘ç»†èŠ‚éœ€è¦æ³¨æ„â€¦è‡ªå·±è¿˜æ˜¯å¤ªèœäº†â€¦ä¸è¿‡ LCT ç¡®å®æŒºçŸ­çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> lans;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> base[N];</span><br><span class="line"></span><br><span class="line">vint E[N];</span><br><span class="line"></span><br><span class="line"><span class="function">il ll <span class="title">min</span><span class="params">(ll a, ll b)</span> </span>&#123; <span class="keyword">return</span> b &gt; a ? a : b; &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mat</span> &#123;</span></span><br><span class="line">    ll m[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="function">il ll <span class="title">minx</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> min(m[<span class="number">1</span>][<span class="number">0</span>], m[<span class="number">1</span>][<span class="number">1</span>]); &#125;</span><br><span class="line">    <span class="function">il <span class="title">mat</span><span class="params">(ll a = Q, ll b = Q, ll c = Q, ll d = Q)</span> </span>&#123;</span><br><span class="line">        m[<span class="number">0</span>][<span class="number">0</span>] = a;</span><br><span class="line">        m[<span class="number">0</span>][<span class="number">1</span>] = b;</span><br><span class="line">        m[<span class="number">1</span>][<span class="number">0</span>] = c;</span><br><span class="line">        m[<span class="number">1</span>][<span class="number">1</span>] = d;</span><br><span class="line">    &#125;</span><br><span class="line">    il mat <span class="keyword">friend</span> <span class="keyword">operator</span>*(<span class="keyword">const</span> mat &amp;a, <span class="keyword">const</span> mat &amp;b) &#123;</span><br><span class="line">        mat c;</span><br><span class="line">        c = mat();  <span class="comment">// c.reset() ;</span></span><br><span class="line">        c.m[<span class="number">0</span>][<span class="number">1</span>] = min(a.m[<span class="number">0</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">1</span>], a.m[<span class="number">0</span>][<span class="number">1</span>] + b.m[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">        c.m[<span class="number">1</span>][<span class="number">1</span>] = min(a.m[<span class="number">1</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">1</span>], a.m[<span class="number">1</span>][<span class="number">1</span>] + b.m[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">        c.m[<span class="number">0</span>][<span class="number">0</span>] = min(a.m[<span class="number">0</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">0</span>], a.m[<span class="number">0</span>][<span class="number">1</span>] + b.m[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">        c.m[<span class="number">1</span>][<span class="number">0</span>] = min(a.m[<span class="number">1</span>][<span class="number">0</span>] + b.m[<span class="number">0</span>][<span class="number">0</span>], a.m[<span class="number">1</span>][<span class="number">1</span>] + b.m[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> f(x) s[x].f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fa(x) s[x].fa</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> g_0(x) s[x].g[0]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> g_1(x) s[x].g[1]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lc(x) s[x].son[0]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rc(x) s[x].son[1]</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lct</span> &#123;</span></span><br><span class="line">    mat f;</span><br><span class="line">    <span class="keyword">int</span> fa;</span><br><span class="line">    ll g[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> son[<span class="number">2</span>];</span><br><span class="line">&#125; s[N * <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">w_k</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> (rc(fa(x)) == x); &#125;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">notroot</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> (lc(fa(x)) == x || rc(fa(x)) == x); &#125;</span><br><span class="line">il <span class="keyword">void</span> _up(<span class="keyword">int</span> x) &#123;</span><br><span class="line">    f(x) = mat(Q, g_1(x), g_0(x), g_1(x));</span><br><span class="line">    f(x) = f(rc(x)) * f(x) * f(lc(x));<span class="comment">//1 è½¬ç§»é¡ºåº å¿…é¡»è¦ä»ä¸‹åˆ°ä¸Šè½¬ç§» å³ splay é‡Œè¦ä¸¥æ ¼æŒ‰ç…§é¡ºåºæ¥è½¬ç§»</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> da = fa(x);</span><br><span class="line">    <span class="keyword">int</span> dada = fa(da);</span><br><span class="line">    <span class="keyword">bool</span> w = w_k(x), ww = w_k(da);</span><br><span class="line">    <span class="keyword">if</span> (notroot(da))</span><br><span class="line">        s[dada].son[ww] = x;</span><br><span class="line">    fa(x) = dada;</span><br><span class="line">    fa(s[x].son[w ^ <span class="number">1</span>]) = da;</span><br><span class="line">    s[da].son[w] = s[x].son[w ^ <span class="number">1</span>];</span><br><span class="line">    s[x].son[w ^ <span class="number">1</span>] = da;</span><br><span class="line">    fa(da) = x;</span><br><span class="line">    _up(da);</span><br><span class="line">    _up(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (notroot(x)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (notroot(fa(x)))</span><br><span class="line">            rotate(w_k(fa(x)) == w_k(x) ? fa(x) : x);</span><br><span class="line">        rotate(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; x; x = fa(y = x)) &#123;</span><br><span class="line">        splay(x);</span><br><span class="line">        g_1(x) += f(rc(x)).minx() - f(y).minx();</span><br><span class="line">        g_0(x) += f(rc(x)).m[<span class="number">1</span>][<span class="number">1</span>] - f(y).m[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        rc(x) = y;</span><br><span class="line">        _up(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prelude</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> dad)</span> </span>&#123;</span><br><span class="line">    g_0(x) = <span class="number">0</span>;</span><br><span class="line">    g_1(x) = base[x];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : E[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k != dad) &#123;</span><br><span class="line">            fa(k) = x;</span><br><span class="line">            prelude(k, x);</span><br><span class="line">            g_0(x) += g_1(k);</span><br><span class="line">            g_1(x) += min(g_0(k), g_1(k));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    f(x) = mat(Q, g_1(x), g_0(x), g_1(x));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _upd(<span class="keyword">int</span> x, <span class="keyword">int</span> y, ll v) &#123;</span><br><span class="line">    access(x);</span><br><span class="line">    splay(x);</span><br><span class="line">    s[x].g[y ^ <span class="number">1</span>] += v;</span><br><span class="line">    _up(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> pks[<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    freopen(<span class="string">"defense.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">"defense.out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    qr(n), qr(m);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; pks;</span><br><span class="line">    <span class="keyword">int</span> x, y, a, b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) qr(base[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++i) </span><br><span class="line">      qr(x), qr(y), E[x].p_b(y), E[y].p_b(x);</span><br><span class="line">    prelude(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    f(<span class="number">0</span>) = mat(<span class="number">0</span>, Q, Q, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        qr(x);</span><br><span class="line">        qr(a);</span><br><span class="line">        _upd(x, a, Q);</span><br><span class="line">        qr(y);</span><br><span class="line">        qr(b);</span><br><span class="line">        _upd(y, b, Q);</span><br><span class="line">        splay(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (f(<span class="number">1</span>).minx() &gt;= Q)</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"-1"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f(<span class="number">1</span>).minx());</span><br><span class="line">        _upd(x, a, -Q);</span><br><span class="line">        _upd(y, b, -Q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Sol-2-å€å¢"><a href="#Sol-2-å€å¢" class="headerlink" title="Sol 2 å€å¢"></a>Sol 2 å€å¢</h2><p>å¤§æ¦‚å°±æ˜¯è¯´ï¼Œè¯¢é—®ä¹‹é—´æœ¬èº«éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥å¦‚æœå¼ºè¡Œä¸ŠåŠ¨æ€ dp æœ‰ç‚¹è¿‡çŠ¹ä¸åŠã€‚</p><p>äºæ˜¯è€ƒè™‘å¤§åŠ›å€å¢ã€‚æ°´å¹³ä¸å¤Ÿæš‚æ—¶å’•å’•å’•äº†ã€‚</p><h1 id="CSP2019"><a href="#CSP2019" class="headerlink" title="CSP2019"></a>CSP2019</h1><h2 id="A-æ ¼é›·ç "><a href="#A-æ ¼é›·ç " class="headerlink" title="A æ ¼é›·ç "></a>A æ ¼é›·ç </h2><p>å°±ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹ï¼Ÿæˆ‘æ­£æˆ‘æ˜¯åˆ†æ²»äº†ä¸€æ³¢ã€‚è¿™ç§é¢˜æ€ä¹ˆåšéƒ½å¯ä»¥å§ã€‚</p><p>åšçš„æ—¶å€™ä¼¼ä¹æ˜¯ç‰¹åˆ¤äº†ä¸€æ³¢ä»€ä¹ˆ <code>1&lt;&lt;64</code> çˆ† <code>long long</code> çš„ä¸œè¥¿ï¼Œå¥½åƒè¿˜æ˜¯æŒºæœ‰ç”¨çš„ï¼Ÿ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(ull l, ull r, ull p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l + <span class="number">1</span> == r)&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == p) ans[++ cnt] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">else</span> ans[++ cnt] = <span class="number">1</span> ; <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    ull mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (p &gt; mid) solve(l, mid, r - p) ;</span><br><span class="line">    <span class="keyword">else</span> solve(l, mid, p) ;</span><br><span class="line">    <span class="keyword">if</span> (p &gt; mid) ans[++ cnt] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">else</span> ans[++ cnt] = <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="B-æ‹¬å·æ ‘"><a href="#B-æ‹¬å·æ ‘" class="headerlink" title="B æ‹¬å·æ ‘"></a>B æ‹¬å·æ ‘</h2><p>å•Šè¿™ï¼ŒæŒºæ°´çš„å§ã€‚è®°ç€è€ƒåœºä¸Šæ˜¯é£å¿«çš„æƒ³å‡ºäº† $O(n^2)$ çš„åšæ³•ï¼Œæƒ³äº†æƒ³å¯ä»¥çº¿æ€§ï¼Œå†™äº†ä¸€ä¼šå„¿ä¹‹åå‘ç°ä¸ä¼šç»™ <code>devc++</code> å¼€æ ˆâ€¦å°±ååˆ†å°´å°¬â€¦ç„¶åå‘ç°å¦‚æœæ˜¯ä¸€æ¡é“¾çš„è¯æ˜¯æœ‰å¿«é€Ÿå†™æ³•çš„ï¼Œå°±å†™äº†ä¸ªç­‰ä»·çš„é“¾åšæ³•è¿‡äº†å¤§æ ·ä¾‹â€¦ç„¶åæ”¹æ¥æ”¹å»å°±æ‹ä¸Šäº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> ff)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mt = <span class="number">0</span> ; fa[u] = ff ;</span><br><span class="line">    <span class="keyword">if</span> (base[u] == <span class="string">'('</span>) stk[++ ctn] = u ;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> (ctn)&#123;</span><br><span class="line">            mt = stk[ctn --] ;</span><br><span class="line">            g[u] = g[fa[mt]] + <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    f[u] = f[ff] + g[u] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != ff) dfs(to(k), u) ;</span><br><span class="line">    <span class="keyword">if</span> (base[u] == <span class="string">'('</span>) stk[ctn --] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (mt) stk[++ ctn] = mt ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="C-æ ‘ä¸Šçš„æ•°"><a href="#C-æ ‘ä¸Šçš„æ•°" class="headerlink" title="C æ ‘ä¸Šçš„æ•°"></a>C æ ‘ä¸Šçš„æ•°</h2><blockquote><p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º $n$ çš„æ ‘ï¼Œå®ƒå…±æœ‰ $n$ ä¸ªç»“ç‚¹ä¸ $n âˆ’ 1$ æ¡è¾¹ï¼Œç»“ç‚¹ä» $1 \sim n$ ç¼–å·ã€‚åˆå§‹æ—¶æ¯ä¸ªç»“ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ª $1 \sim n$ çš„æ•°å­—ï¼Œä¸”æ¯ä¸ª $1 \sim n$ çš„æ•°å­—éƒ½åªåœ¨<strong>æ°å¥½</strong>ä¸€ä¸ªç»“ç‚¹ä¸Šå‡ºç°ã€‚</p><p>æ¥ä¸‹æ¥ä½ éœ€è¦è¿›è¡Œ<strong>æ°å¥½</strong> $n âˆ’ 1$ æ¬¡åˆ è¾¹æ“ä½œï¼Œæ¯æ¬¡æ“ä½œä½ éœ€è¦é€‰ä¸€æ¡<strong>æœªè¢«åˆ å»</strong>çš„è¾¹ï¼Œæ­¤æ—¶è¿™æ¡è¾¹æ‰€è¿æ¥çš„ä¸¤ä¸ªç»“ç‚¹ä¸Šçš„æ•°å­—å°†ä¼š<strong>äº¤æ¢</strong>ï¼Œç„¶åè¿™æ¡è¾¹å°†è¢«åˆ å»ã€‚</p><p>$n âˆ’ 1$ æ¬¡æ“ä½œè¿‡åï¼Œæ‰€æœ‰çš„è¾¹éƒ½å°†è¢«åˆ å»ã€‚æ­¤æ—¶ï¼ŒæŒ‰æ•°å­—ä»å°åˆ°å¤§çš„é¡ºåºï¼Œå°†æ•°å­— $1 \sim n$ æ‰€åœ¨çš„ç»“ç‚¹ç¼–å·ä¾æ¬¡æ’åˆ—ï¼Œå°±å¾—åˆ°ä¸€ä¸ªç»“ç‚¹ç¼–å·çš„æ’åˆ— $P_i$ã€‚ç°åœ¨è¯·ä½ æ±‚å‡ºï¼Œåœ¨æœ€ä¼˜æ“ä½œæ–¹æ¡ˆä¸‹èƒ½å¾—åˆ°çš„<strong>å­—å…¸åºæœ€å°</strong>çš„ $P_i$ã€‚</p><p>$1\leq n\leq 2\times 10^3$ ã€‚</p></blockquote><p>å’•å’•å’•ã€‚</p><p>è¿™ç§é¢˜å¿…ç„¶æ˜¯è¦è‡ªå·±æƒ³çš„å§ã€‚é‚£å¯èƒ½è¦å¤šæƒ³å‡ å¤©ã€‚å°±æš‚æ—¶å’•å’•å’•äº†ã€‚</p><h2 id="D-Emiya-å®¶ä»Šå¤©çš„é¥­"><a href="#D-Emiya-å®¶ä»Šå¤©çš„é¥­" class="headerlink" title="D Emiya å®¶ä»Šå¤©çš„é¥­"></a>D Emiya å®¶ä»Šå¤©çš„é¥­</h2><blockquote><p>ç»™å®šä¸€ä¸ªçŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªå›ºå®šçš„é€‰æ‹©æ–¹æ¡ˆæ•° $a_{i,j}$ï¼Œæ¯ä¸€è¡Œè‡³å¤šé€‰ä¸€ä¸ªå…ƒç´ ï¼Œæ¯ä¸€åˆ—é€‰çš„å…ƒç´ è‡³å¤šæ˜¯é€‰æ‹©å…ƒç´ æ€»ä¸ªæ•°çš„ä¸€åŠï¼Œæ±‚æ€»æ–¹æ¡ˆæ•°ã€‚</p><p>$1 \le n \le 100$ï¼Œ$1 \le m \le 2000$ï¼Œ$0 \le a_{i,j} &lt; 998,244,353$ ã€‚</p></blockquote><p>é¦–å…ˆå¯¹äº $64$ åˆ† $2\leq m\leq 3$ï¼Œå¯ä»¥ç›´æ¥æš´åŠ›è®°ä¸€ä¸‹æ¯ä¸€è¡Œé€‰äº†å¤šå°‘ä¸ªå…ƒç´ ï¼Œè½¬ç§»æ¯”è¾ƒ trivialï¼Œä½†æ˜¯æœ‰ç»†èŠ‚â€¦å°±æ˜¯è½¬ç§»çš„æ—¶å€™ä¸è¦ç jb åˆ¤ï¼Œæœ€åç»Ÿè®¡ç­”æ¡ˆçš„æ—¶å€™å†åˆ¤â€”â€”æ„Ÿè§‰æ˜¯ä¸ªå¾ˆæµ…æ˜¾çš„ç»“è®ºæˆ‘ç«Ÿç„¶è°ƒäº† $10min+$ ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> dp[<span class="number">2</span>][S][S][S] ;</span><br><span class="line"><span class="keyword">int</span> pd[<span class="number">2</span>][S][S][S][S] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve1</span><span class="params">()</span></span>&#123;<span class="comment">//m=2</span></span><br><span class="line">    <span class="keyword">int</span> d = <span class="number">1</span> ;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(dp[d], <span class="number">0</span>, <span class="keyword">sizeof</span>(dp[d])) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= j ; ++ k)&#123;</span><br><span class="line">                add(dp[d][j][k][j - k], dp[d ^ <span class="number">1</span>][j][k][j - k]) ;</span><br><span class="line">                <span class="keyword">if</span> (k)</span><br><span class="line">                    add(dp[d][j][k][j - k], <span class="number">1l</span>l * dp[d ^ <span class="number">1</span>][j - <span class="number">1</span>][k - <span class="number">1</span>][j - k] * base[i][<span class="number">1</span>] % P) ;</span><br><span class="line">                <span class="keyword">if</span> (j - k)</span><br><span class="line">                    add(dp[d][j][k][j - k], <span class="number">1l</span>l * dp[d ^ <span class="number">1</span>][j - <span class="number">1</span>][k][j - k - <span class="number">1</span>] * base[i][<span class="number">2</span>] % P) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        d ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> ((j &lt;= i / <span class="number">2</span>) &amp;&amp; (i - j &lt;= i / <span class="number">2</span>))</span><br><span class="line">                add(ans, dp[n &amp; <span class="number">1</span>][i][j][i - j]) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve2</span><span class="params">()</span></span>&#123;<span class="comment">//m=3</span></span><br><span class="line">    <span class="keyword">int</span> d = <span class="number">1</span> ;</span><br><span class="line">    pd[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(pd[d], <span class="number">0</span>, <span class="keyword">sizeof</span>(pd[d])) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= j ; ++ k)&#123; <span class="comment">// (j-k)+o+(k-o)=j</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">0</span> ; o &lt;= k ; ++ o)&#123;</span><br><span class="line">                    add(pd[d][j][j - k][o][k - o], pd[d ^ <span class="number">1</span>][j][j - k][o][k - o]) ;</span><br><span class="line">                    <span class="keyword">if</span> (j - k)</span><br><span class="line">                        add(pd[d][j][j - k][o][k - o], <span class="number">1l</span>l * pd[d ^ <span class="number">1</span>][j - <span class="number">1</span>][j - k - <span class="number">1</span>][o][k - o] * base[i][<span class="number">1</span>] % P) ;</span><br><span class="line">                    <span class="keyword">if</span> (o)</span><br><span class="line">                        add(pd[d][j][j - k][o][k - o], <span class="number">1l</span>l * pd[d ^ <span class="number">1</span>][j - <span class="number">1</span>][j - k][o - <span class="number">1</span>][k - o] * base[i][<span class="number">2</span>] % P) ;</span><br><span class="line">                    <span class="keyword">if</span> (k - o)</span><br><span class="line">                        add(pd[d][j][j - k][o][k - o], <span class="number">1l</span>l * pd[d ^ <span class="number">1</span>][j - <span class="number">1</span>][j - k][o][k - o - <span class="number">1</span>] * base[i][<span class="number">3</span>] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        d ^= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt;= i ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= j ; ++ k)</span><br><span class="line">                <span class="keyword">if</span> ((k &lt;= i / <span class="number">2</span>) &amp;&amp; ((j - k) &lt;= i / <span class="number">2</span>) &amp;&amp; ((i - j) &lt;= i / <span class="number">2</span>))</span><br><span class="line">                    add(ans, pd[n &amp; <span class="number">1</span>][i][k][j - k][i - j]) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè€ƒè™‘æ›´é«˜åˆ†åšæ³•ï¼Œå¤§æ¦‚å°±æ˜¯è¦æƒ³åˆ°<strong>å®¹æ–¥</strong>ã€‚è€ƒè™‘å°†é—®é¢˜è½¬åŒ–æˆã€Œæ€»æ–¹æ¡ˆæ•°-å­˜åœ¨æŸä¸€è¡Œ $&gt;\lfloor\frac{k}{2}\rfloor$ çš„æ–¹æ¡ˆæ•°ã€ï¼Œé‚£ä¹ˆå‘ç°åé¢ä¸€é¡¹ï¼Œå¯¹äºæŸç§æ–¹æ¡ˆï¼Œè‡³å¤šå­˜åœ¨ä¸€åˆ— $&gt;\lfloor\frac{k}{2}\rfloor$ã€‚ æ‰€ä»¥å®¹æ–¥ç³»æ•°å¤§æ¦‚å°±æ˜¯ $1~0~0\cdots$ã€‚é‚£ä¹ˆå¦‚æœè®¾ $s_i=\sum_{j=1}^m a_{i,j}$ ï¼Œå¯ä»¥çŸ¥é“æ€»æ–¹æ¡ˆæ•°æ˜¯ $\prod (s_i+1)-1$ã€‚è€ƒè™‘å•ç‹¬ä¸€è¡Œæ€ä¹ˆç®—ï¼Œå‘ç°åªéœ€è¦è®°ä¸€ä¸‹æ€»å…±é€‰äº†å¤šå°‘ä¸ª/å½“å‰è¡Œé€‰äº†å¤šå°‘ä¸ªå³å¯ã€‚å¤æ‚åº¦ $O(n^3m)$ï¼Œå¯ä»¥è·å¾— $84$ åˆ†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d ; ans = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) sum[i][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            sum[i][j] = addn(sum[i][j - <span class="number">1</span>], base[i][j]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans = <span class="number">1l</span>l * ans * sum[i][m] % P ; dec(ans, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">        d = <span class="number">0</span> ; f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            d ^= <span class="number">1</span> ; <span class="keyword">int</span> ts ;</span><br><span class="line">            ts = sum[i][m] - <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= n ; ++ k)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> o = <span class="number">0</span> ; o &lt;= n ; ++ o)&#123;</span><br><span class="line">                    f[d][k][o] = f[d ^ <span class="number">1</span>][k][o] ;</span><br><span class="line">                    <span class="keyword">if</span> (k) add(f[d][k][o], <span class="number">1l</span>l * f[d ^ <span class="number">1</span>][k - <span class="number">1</span>][o] * (ts - base[i][j]) % P) ;</span><br><span class="line">                    <span class="keyword">if</span> (k &amp;&amp; o) add(f[d][k][o], <span class="number">1l</span>l * f[d ^ <span class="number">1</span>][k - <span class="number">1</span>][o - <span class="number">1</span>] * base[i][j] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span> ; k &lt;= j ; ++ k)</span><br><span class="line">                <span class="keyword">if</span> (j - k &lt; k) dec(ans, f[n &amp; <span class="number">1</span>][j][k]) ;</span><br><span class="line">        <span class="built_in">memset</span>(f[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span>(f[<span class="number">0</span>])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå‘ç°â€¦æœ¬è´¨ä¸Šä¹ŸåŒæ ·ä¸éœ€è¦ç¬¬äºŒç»´ã€‚å› ä¸ºåœ¨é’¦å®šäº†æŸä¸€åˆ—æ˜¯æœ€å¤šçš„ä¹‹åï¼Œå°±ä¸å†éœ€è¦å…³å¿ƒæ¬¡åºï¼Œåªéœ€è¦å…³å¿ƒæ˜¯å¦æ¯”å…¶å®ƒåˆ—çš„æ€»å’Œè¦å¤šå°±å¥½äº†ã€‚æ‰€ä»¥å¯ä»¥ç»´æŠ¤è¿™ä¸ªå·®åˆ†å€¼ï¼Œç›¸å½“äºå°†çŠ¶æ€åˆå¹¶äº†ã€‚äºæ˜¯æœ€åå¤æ‚åº¦ $O(n^2m)$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve4</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d ; ans = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) sum[i][<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            sum[i][j] = addn(sum[i][j - <span class="number">1</span>], base[i][j]) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        ans = <span class="number">1l</span>l * ans * sum[i][m] % P ; dec(ans, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">        d = <span class="number">0</span> ; g[<span class="number">0</span>][n] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">            d ^= <span class="number">1</span> ; </span><br><span class="line"><span class="keyword">int</span> ts = sum[i][m] - <span class="number">1</span> ;</span><br><span class="line"><span class="built_in">memset</span>(g[d], <span class="number">0</span>, <span class="keyword">sizeof</span>(g[<span class="number">0</span>])) ; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span> ; k &lt;= n + n ; ++ k)&#123; g[d][k] = g[d ^ <span class="number">1</span>][k] ;</span><br><span class="line">                <span class="keyword">if</span> (k &gt; <span class="number">0</span>) add(g[d][k], <span class="number">1l</span>l * g[d ^ <span class="number">1</span>][k - <span class="number">1</span>] * base[i][j] % P) ;</span><br><span class="line">                <span class="keyword">if</span> (k &lt; n + n) add(g[d][k], <span class="number">1l</span>l * g[d ^ <span class="number">1</span>][k + <span class="number">1</span>] * decn(ts, base[i][j]) % P) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j) dec(ans, g[n &amp; <span class="number">1</span>][n + j]) ;<span class="comment">// , cout &lt;&lt; g[n &amp; 1][n + j] &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="built_in">memset</span>(g[<span class="number">0</span>], <span class="number">0</span>, <span class="keyword">sizeof</span>(g[<span class="number">0</span>])) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><del>äºæ˜¯æˆ‘å°±æŠŠå…¨éƒ¨çš„ subtask éƒ½å†™äº†ï¼ŒåŠ èµ·æ¥120è¡Œå·¦å³ã€‚</del></p><h2 id="E-åˆ’åˆ†"><a href="#E-åˆ’åˆ†" class="headerlink" title="E åˆ’åˆ†"></a>E åˆ’åˆ†</h2><blockquote><p>ç»™å®šä¸€ä¸ªé•¿ä¸º $n$ çš„åºåˆ— $\{a_n\}$ ã€‚éœ€è¦æ‰¾åˆ°ä¸€äº›åˆ†ç•Œç‚¹ $1 \le k_1 &lt; k_2 &lt; \cdots &lt; k_p &lt; n$ï¼Œä½¿å¾—ï¼š</p><script type="math/tex; mode=display">\sum_{i=1}^{k_1} a_i\le \sum_{i=k_1+1}^{k_2} a_i \le \dots \le \sum_{i=k_p+1}^n a_i</script><p>åŒæ—¶æœ€å°åŒ–</p><script type="math/tex; mode=display">\left(\sum_{i=1}^{k_1} a_i \right)^2+\left(\sum_{i=k_1+1}^{k_2} a_i \right)^2+\cdots +\left(\sum_{i=k_p+1}^n a_i \right)^2</script><p>$2 \le n \le 4 \times 10^7 , 1 \le a_i \le 10^9$ã€‚</p></blockquote><p>å¤§æ¦‚ä¸€ä¸ªæ¯”è¾ƒ trivial çš„æƒ³æ³•æ˜¯è®° $f_{i,v}$ è¡¨ç¤ºå‰ $i$ ä¸ªæ•°åˆ†äº†æŸäº›æ®µï¼Œæœ€åä¸€æ®µå¤§å°ä¸º $v$ çš„ ansã€‚è¿™æ ·å¤§æ¦‚æ˜¯å¯ä»¥æ‹¿ä¸ª $24pts$ï¼Ÿç„¶åå†é«˜çš„è¯å°±æ˜¯è€ƒè™‘ $v$ å¿…ç„¶åªä¼šæ˜¯è¿ç»­ä¸€æ®µï¼Œæ‰€ä»¥å¯ä»¥è®¾ $f_{i,j}$ è¡¨ç¤ºå‰ $i$ ä¸ªæ•°åˆ†äº†æŸäº›æ®µï¼Œæœ€åä¸€æ®µæ˜¯ $j\sim i$ çš„ ansã€‚ç„¶åè¿™æ ·ä¼¼ä¹å°±æ˜¯ $O(n^3)$ å¯ä»¥æ‹¿åˆ° $40pts$ã€‚ç„¶åå‘ç°æœ‰ç¥ç§˜çš„å•è°ƒæ€§ï¼Œå¤§æ¦‚å°±æ˜¯å‘ç°æœ€åè¦æœ€ä¼˜åŒ–çš„æ˜¯å’Œçš„å¹³æ–¹ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯æ®µæ•°è¶Šå¤šè¶Šä¼˜ã€‚é‚£ä¹ˆå¯¹äºæ¯ä¸€ä¸ª $i$ çš„é‚£ä¸ªä½¿å¾— $j\sim i$ æœ€ä¼˜çš„å†³ç­–ä¸€å®šä¹Ÿä¼šè®© $len=i-j+1$ æœ€å°ã€‚è¿™æ ·å°±å¯ä»¥å­˜ä¸€ä¸‹æ¯ä¸ª $i$ çš„æœ€ä¼˜å†³ç­–ç‚¹ $minx_i$ ï¼Œå°±å¯ä»¥å®ç° $O(n)$ è½¬ç§»äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) base[i] = qr(), s[i] = s[i - <span class="number">1</span>] + base[i] ;  </span><br><span class="line"><span class="keyword">if</span> (N &lt;= <span class="number">600</span>)&#123;</span><br><span class="line"><span class="built_in">memset</span>(dp, <span class="number">127</span>, <span class="keyword">sizeof</span>(dp)), ans = (<span class="number">1l</span>l &lt;&lt; <span class="number">60</span>) ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span> ; i &lt;= N ; ++ i) dp[<span class="number">0</span>][i] = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">1</span> ; j &lt;= i ; ++ j)&#123;</span><br><span class="line">LL t = (s[i] - s[i - j]) * (s[i] - s[i - j]) ;</span><br><span class="line"><span class="keyword">for</span> (k = <span class="number">0</span> ; k &lt;= (i - j) ; ++ k)</span><br><span class="line"><span class="keyword">if</span> (s[i] - s[i - j] &gt;= s[i - j] - s[i - j - k])</span><br><span class="line">dp[i][j] = minn(dp[i][j], dp[i - j][k] + t) ; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">break</span> ; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) ans = min(ans, dp[N][i]) ; </span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span> ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (N &lt;= <span class="number">5000</span>)&#123;</span><br><span class="line"><span class="built_in">memset</span>(f, <span class="number">127</span>, <span class="keyword">sizeof</span>(f)), f[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line"><span class="built_in">memset</span>(minx, <span class="number">127</span>, <span class="keyword">sizeof</span>(minx)), minx[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line"><span class="keyword">for</span> (j = i - <span class="number">1</span> ; j &gt;= <span class="number">0</span> ; -- j)</span><br><span class="line"><span class="keyword">if</span> (s[i] - s[j] &gt;= minx[j])</span><br><span class="line">minx[i] = min(s[i] - s[j], minx[i]), </span><br><span class="line">f[i] = min(f[i], f[j] + (s[i] - s[j]) * (s[i] - s[j])) ; </span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; f[N] &lt;&lt; <span class="built_in">endl</span> ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰è¿™ä¸ªå•è°ƒæ€§ä¼¼ä¹å¯ä»¥å¾ˆå¼ºçš„æ ·å­ï¼Ÿå¤§æ¦‚å°±æ˜¯å‘ç°å¯¹äºæ¯ä¸ª $i$ ï¼Œæœ¬è´¨ä¸Šåªå…³å¿ƒä»–æœ€å°çš„é‚£ä¸€æ®µåˆæ³•åç¼€æ˜¯å¤šå°‘ã€‚äºæ˜¯å°±å¯ä»¥æ‹¿ä¸€ä¸ªå•è°ƒé˜Ÿåˆ—æ¥ä¼˜åŒ–äº†ã€‚</p><p>æ³¨æ„å•è°ƒé˜Ÿåˆ—æ’å…¥é˜Ÿå°¾æ—¶æ³¨æ„è½¬ç§»å¼çš„å˜å½¢ã€‚æ„Ÿæ€§æ¥è¯´ä¸ºäº†æ‰¾åˆ°æœ€å°çš„é‚£ä¸ªåˆæ³•åŒºé—´ï¼Œå°±éœ€è¦æŒ‰ç…§ $s_i-s_k\geq m(k)$ ï¼Œå…¶ä¸­ $i$ æ˜¯å°†æ¥çš„å†³ç­–ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‰ç…§ $s_k+m(k)$ æ¥è¡¡é‡å†³ç­–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out_put</span><span class="params">(L128 x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!x) <span class="keyword">return</span> ;</span><br><span class="line">    out_put(x / <span class="number">10</span>) ;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; (LL)(x % <span class="number">10</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, T ;</span><br><span class="line"><span class="keyword">int</span> h, t ;</span><br><span class="line"><span class="keyword">int</span> q[MAXN] ; </span><br><span class="line"><span class="keyword">int</span> pre[MAXN] ;</span><br><span class="line"><span class="keyword">int</span> base[MAXP] ;</span><br><span class="line"></span><br><span class="line">L128 ans ;</span><br><span class="line">LL s[MAXN] ;</span><br><span class="line">LL minx[MAXN] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1</span> &lt;&lt; <span class="number">30</span> ;</span><br><span class="line">LL p, l, r, b, p0 = <span class="number">1</span> ;</span><br><span class="line">LL x, y, z, b1, b2, m ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gene</span><span class="params">()</span></span>&#123;</span><br><span class="line">    s[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">    x = qr(), y = qr(), z = qr() ;</span><br><span class="line">    b1 = qr(), b2 = qr(), m = qr() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        p = qr(), l = qr(), r = qr() ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = p0 ; j &lt;= p ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j == <span class="number">1</span>) b = b1 ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">2</span>) b = b2 ;</span><br><span class="line">            <span class="keyword">else</span> b = (x * b2 + y * b1 + z) % M, b1 = b2, b2 = b ;</span><br><span class="line">            s[j] = s[j - <span class="number">1</span>] + (b % (r - l + <span class="number">1</span>) + l) ;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        p0 = p + <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">int</span> i, j, k ; h = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (!T)&#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line">            base[i] = qr(), s[i] = s[i - <span class="number">1</span>] + base[i] ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> gene() ; j = <span class="number">0</span> ;</span><br><span class="line">    q[++ t] = <span class="number">0</span> ; minx[<span class="number">0</span>] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t &amp;&amp; s[i] - s[q[h]] &gt;= minx[q[h]])</span><br><span class="line">            j = q[h ++] ; minx[i] = s[i] - s[j] ; pre[i] = j ; </span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t &amp;&amp; minx[q[t]] + s[q[t]] &gt;= minx[i] + s[i]) q[t --] = <span class="number">0</span> ; q[++ t] = i ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">while</span> (N)</span><br><span class="line">ans += (L128)minx[N] * minx[N], N = pre[N] ;</span><br><span class="line">    out_put(ans) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯è¯´å›æ¥ï¼Œå»å¹´èµ›åœºä¸Šæˆ‘ç”šè‡³æ²¡æœ‰æŠŠæ•°æ®ç”Ÿæˆçš„è§„åˆ™çœ‹å®Œâ€¦å› ä¸ºå¹¶æ²¡æœ‰æ—¶é—´ï¼Œä¹Ÿå¹¶æ²¡æœ‰èƒ½åŠ›(?)å»çœ‹æœ€åä¸€æ¡£éƒ¨åˆ†åˆ†ã€‚å¤§æ¦‚æ˜¯åœ†äº†ä¸€ä¸ªæœªç«Ÿçš„æ¢¦å§ã€‚</p><h2 id="F-æ ‘çš„é‡å¿ƒ"><a href="#F-æ ‘çš„é‡å¿ƒ" class="headerlink" title="F æ ‘çš„é‡å¿ƒ"></a>F æ ‘çš„é‡å¿ƒ</h2><blockquote><p>å°ç®€å•æ­£åœ¨å­¦ä¹ ç¦»æ•£æ•°å­¦ï¼Œä»Šå¤©çš„å†…å®¹æ˜¯å›¾è®ºåŸºç¡€ï¼Œåœ¨è¯¾ä¸Šä»–åšäº†å¦‚ä¸‹ä¸¤æ¡ç¬”è®°ï¼š</p><ol><li>ä¸€ä¸ªå¤§å°ä¸º $n$ çš„æ ‘ç”± $n$ ä¸ªç»“ç‚¹ä¸ $n âˆ’ 1$ æ¡æ— å‘è¾¹æ„æˆï¼Œä¸”æ»¡è¶³ä»»æ„ä¸¤ä¸ªç»“ç‚¹é—´<strong>æœ‰ä¸”ä»…æœ‰</strong>ä¸€æ¡ç®€å•è·¯å¾„ã€‚åœ¨æ ‘ä¸­åˆ å»ä¸€ä¸ªç»“ç‚¹åŠä¸å®ƒå…³è”çš„è¾¹ï¼Œæ ‘å°†åˆ†è£‚ä¸ºè‹¥å¹²ä¸ªå­æ ‘ï¼›è€Œåœ¨æ ‘ä¸­åˆ å»ä¸€æ¡è¾¹ï¼ˆä¿ç•™å…³è”ç»“ç‚¹ï¼Œä¸‹åŒï¼‰ï¼Œæ ‘å°†åˆ†è£‚ä¸º<strong>æ°å¥½</strong>ä¸¤ä¸ªå­æ ‘ã€‚</li><li>å¯¹äºä¸€ä¸ªå¤§å°ä¸º $n$ çš„æ ‘ä¸ä»»æ„ä¸€ä¸ªæ ‘ä¸­ç»“ç‚¹ $c$ï¼Œç§° $c$ æ˜¯è¯¥æ ‘çš„<strong>é‡å¿ƒ</strong>å½“ä¸”ä»…å½“åœ¨æ ‘ä¸­åˆ å» $c$ åŠä¸å®ƒå…³è”çš„è¾¹åï¼Œåˆ†è£‚å‡ºçš„æ‰€æœ‰å­æ ‘çš„å¤§å°å‡<strong>ä¸è¶…è¿‡</strong> $\lfloor \frac{n}{2} \rfloor$ï¼ˆå…¶ä¸­ $\lfloor x \rfloor$ æ˜¯ä¸‹å–æ•´å‡½æ•°ï¼‰ã€‚å¯¹äºåŒ…å«è‡³å°‘ä¸€ä¸ªç»“ç‚¹çš„æ ‘ï¼Œå®ƒçš„é‡å¿ƒåªå¯èƒ½æœ‰ $1$ æˆ– $2$ ä¸ªã€‚</li></ol><p>è¯¾åè€å¸ˆç»™å‡ºäº†ä¸€ä¸ªå¤§å°ä¸º $n$ çš„æ ‘ $S$ï¼Œæ ‘ä¸­ç»“ç‚¹ä» $1 \sim n$ ç¼–å·ã€‚å°ç®€å•çš„è¯¾åä½œä¸šæ˜¯æ±‚å‡º $S$ å•ç‹¬åˆ å»æ¯æ¡è¾¹åï¼Œåˆ†è£‚å‡ºçš„ä¸¤ä¸ªå­æ ‘çš„é‡å¿ƒç¼–å·å’Œä¹‹å’Œã€‚å³ï¼š</p><script type="math/tex; mode=display">\sum_{(u,v)\in E}\left(\sum_{x\in c(S'_u)} x+\sum_{y\in c(S'_v)} y\right)</script><p>ä¸Šå¼ä¸­ï¼Œ$E$ è¡¨ç¤ºæ ‘ $S$ çš„è¾¹é›†ï¼Œ$(u, v)$ è¡¨ç¤ºä¸€æ¡è¿æ¥ $u$ å·ç‚¹å’Œ $v$ å·ç‚¹çš„è¾¹ã€‚$Sâ€™_u$ ä¸ $Sâ€™_v$ åˆ†åˆ«è¡¨ç¤ºæ ‘ $S$ åˆ å»è¾¹ $(u, v)$ åï¼Œ$u$ å·ç‚¹ä¸ $v$ å·ç‚¹æ‰€åœ¨çš„è¢«åˆ†è£‚å‡ºçš„å­æ ‘ï¼Œ$c(S)$ è¡¨ç¤ºæ ‘ $S$ é‡å¿ƒçš„é›†åˆã€‚</p><p>$1\leq n\leq 3\times 10^5$ ã€‚</p></blockquote><h3 id="Sol-1-1"><a href="#Sol-1-1" class="headerlink" title="Sol 1"></a>Sol 1</h3><p>é¦–å…ˆè€ƒè™‘éƒ¨åˆ†åˆ†åšæ³•ï¼Ÿ$40pts$ å°±æ˜¯æš´åŠ›æšä¸¾åˆ‡å“ªä¸€æ¡è¾¹ã€‚$55pts$ çš„é“¾åœ¨çæ˜ å°„ä¸€é€šå¯ä»¥ $O(1)$ æ±‚å‡ºå‰²å®Œä¹‹åä¸¤æ£µæ ‘çš„é‡å¿ƒåˆ†åˆ«æ˜¯è°ã€‚$75pts$ çš„æ»¡äºŒå‰æ ‘å¤§æ¦‚æ˜¯è¦å…ˆæ‰¾å‡º $\deg_x=2$ çš„ $x$ ï¼Œä¸éš¾çŸ¥é“è¿™ä¸ªä¸€å®šæ˜¯æ ¹ï¼Œæ‰¾ä¸€æ³¢è§„å¾‹å¯ä»¥å‘ç°å‰²æ‰æ¯ä¸€æ¡è¾¹ä¹‹åï¼Œè¾ƒå°çš„é‚£ä¸€åŠçš„é‡å¿ƒå¿…ç„¶æ˜¯è¿™ä¸ªå°è¿é€šå—çš„æ ¹ï¼Œè¾ƒå¤§çš„é‚£éƒ¨åˆ†çš„é‡å¿ƒæ˜¯å¯¹é¢çš„å¦ä¸€ä¸ªå„¿å­ï¼Œä¹Ÿå¯èƒ½æ˜¯åŸæ ‘çš„æ ¹ã€‚ç®—ä¸€ä¸‹å°±å¥½äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">LL ans ;</span><br><span class="line"><span class="keyword">int</span> max_dep ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> to, next ;</span><br><span class="line">&#125;E[N &lt;&lt; <span class="number">1</span>] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="keyword">int</span> q[<span class="number">5</span>], p[<span class="number">5</span>], bg, rt ;</span><br><span class="line"><span class="keyword">int</span> head[N], cnt, f[N] ;</span><br><span class="line"><span class="keyword">int</span> T, n, sz[N], e[N &lt;&lt; <span class="number">1</span>][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">E[++ cnt].to = v, next(cnt) = head[u], head[u] = cnt ;</span><br><span class="line">E[++ cnt].to = u, next(cnt) = head[v], head[v] = cnt ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">sz[u] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line"><span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ; <span class="keyword">else</span> dfs1(to(k), u), sz[u] += sz[to(k)] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> mx = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line"><span class="keyword">if</span> (to(k) != fa) chkmax(mx, sz[to(k)]), dfs(to(k), u) ;</span><br><span class="line">chkmax(mx, sz[rt] - sz[u]) ; f[u] = mx ;</span><br><span class="line"><span class="keyword">if</span> (f[q[<span class="number">1</span>]] &gt; f[u]) q[<span class="number">1</span>] = u ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (f[q[<span class="number">2</span>]] &gt; f[u]) q[<span class="number">2</span>] = u ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &gt; max_dep)</span><br><span class="line">        max_dep = dep[x], rt = x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) dfs2(to(k), x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">redfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ; rev[dep[x]] = x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) redfs(to(k), x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs3</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) dfs3(to(k), x), ans += to(k) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// freopen("centroid12.in", "r", stdin) ;</span></span><br><span class="line"><span class="comment">// freopen("centroid.out", "w", stdout) ;</span></span><br><span class="line"> <span class="built_in">cin</span> &gt;&gt; T ; <span class="keyword">int</span> i, j, k ;</span><br><span class="line"><span class="keyword">while</span> (T --)&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n, cnt = ans = <span class="number">0</span> ;</span><br><span class="line"><span class="built_in">memset</span>(head, <span class="number">0</span>, <span class="keyword">sizeof</span>(head)) ;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">5000</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;j, &amp;k),</span><br><span class="line">add(j, k), e[i][<span class="number">0</span>] = j, e[i][<span class="number">1</span>] = k ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">f[<span class="number">0</span>] = n + <span class="number">1</span> ;</span><br><span class="line">q[<span class="number">1</span>] = q[<span class="number">2</span>] = <span class="number">0</span>,</span><br><span class="line">dfs1(rt = e[i][<span class="number">0</span>], e[i][<span class="number">1</span>]) ;</span><br><span class="line">dfs(e[i][<span class="number">0</span>], e[i][<span class="number">1</span>]) ;</span><br><span class="line">ans += (f[q[<span class="number">2</span>]] == f[q[<span class="number">1</span>]]) ? (q[<span class="number">1</span>] + q[<span class="number">2</span>]) : q[<span class="number">1</span>] ;</span><br><span class="line"><span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">f[<span class="number">0</span>] = n + <span class="number">1</span> ;</span><br><span class="line">q[<span class="number">1</span>] = q[<span class="number">2</span>] = <span class="number">0</span> ;</span><br><span class="line">dfs1(rt = e[i][<span class="number">1</span>], e[i][<span class="number">0</span>]) ;</span><br><span class="line">                dfs(e[i][<span class="number">1</span>], e[i][<span class="number">0</span>]) ;</span><br><span class="line">ans += (f[q[<span class="number">2</span>]] == f[q[<span class="number">1</span>]]) ? (q[<span class="number">1</span>] + q[<span class="number">2</span>]) : q[<span class="number">1</span>] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span> ;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">49991</span>)&#123;</span><br><span class="line">            max_dep = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;j, &amp;k), add(j, k) ;</span><br><span class="line">            dfs2(<span class="number">1</span>, <span class="number">0</span>) ; redfs(rt, dep[<span class="number">0</span>] = <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i &amp; <span class="number">1</span>) ans += rev[i / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">else</span> ans += rev[i / <span class="number">2</span>] + rev[i / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">if</span> ((n - i) &amp; <span class="number">1</span>) ans += rev[i + (n - i) / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">else</span> ans += rev[i + (n - i) / <span class="number">2</span>] + rev[i + (n - i) / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">262143</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i) deg[i] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;j, &amp;k) ;</span><br><span class="line">                add(j, k), ++ deg[j], ++ deg[k] ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (deg[i] == <span class="number">2</span>) &#123; rt = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">            dfs3(rt, <span class="number">0</span>) ; ans += <span class="number">1l</span>l * rt * (n / <span class="number">2l</span>l + <span class="number">1</span>) ; <span class="comment">//cout &lt;&lt; ans &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = head[rt] ; k ; k = next(k))</span><br><span class="line">                ans += <span class="number">1l</span>l * to(k) * (n - <span class="number">1</span>) / <span class="number">2</span> ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè€ƒè™‘æ»¡åˆ†æ€ä¹ˆåšã€‚ä»¥ä¸‹è®¾ $x$ ä¸ºå½“å‰ç‚¹ï¼Œ$y_k$ ä¸º $x$ çš„ç¬¬ $k$ ä¸ªå­©å­(é¡ºåºéšä¾¿å®šçš„)ï¼Œ$z$ ä¸º $x$ çš„é‡å„¿å­ï¼Œè®¾ $s$ ä¸ºå‰²ä¸‹æ¥çš„è¿é€šå—å¤§å°ã€‚ </p><p>è¿™ä¸ªæ»¡åˆ†åšæ³•ï¼Œæˆ‘è‡ªå·±æ¨çš„æ¯”è¾ƒçƒ¦ï¼Œä¸å¦‚å…¶ä»–äººç®€æ´ã€‚å¤§æ¦‚å°±æ˜¯è®¡ç®—æ¯ä¸ªç‚¹å½“é‡å¿ƒçš„æ¬¡æ•°ã€‚ç„¶åæˆ‘åˆ†æˆäº†ä¸‰éƒ¨åˆ†ç®—ã€‚å¯¹äºä¸€ä¸ªç‚¹ $x$ ï¼Œä»–å¯èƒ½æˆä¸ºé‡å¿ƒï¼Œå½“ä¸”ä»…å½“ï¼š</p><h4 id="Case-1-å®ƒå­æ ‘å†…çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"><a href="#Case-1-å®ƒå­æ ‘å†…çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ" class="headerlink" title="Case 1 å®ƒå­æ ‘å†…çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"></a>Case 1 å®ƒå­æ ‘å†…çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ</h4><p>è€ƒè™‘æ­¤æ—¶è¿™ä¸ªå°å­æ ‘çš„å­æ ‘å¤§å°éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ã€‚é¦–å…ˆç”±äºè¦åˆ†å­æ ‘è®¨è®ºï¼Œä¸å¦¨è®¾ä» $y_k$ ä¸­å‰²æ‰äº†ä¸€æ£µå°å­æ ‘ã€‚é‚£ä¹ˆè€ƒè™‘è¦æ»¡è¶³è¿™ä¹ˆå‡ ä¸ªé™åˆ¶ï¼š</p><script type="math/tex; mode=display">\begin{aligned}size_{y_k}-s&\leq \lfloor \frac{n-s}{2}\rfloor\\n-size_x&\leq \lfloor \frac{n-s}{2}\rfloor\\g_y&\leq  \lfloor \frac{n-s}{2}\rfloor\end{aligned}</script><p>å…¶ä¸­ $g_y$ ä¸ºé™¤å»å­æ ‘ $y$ åå‰©ä¸‹çš„å­æ ‘æœ€å¤§å€¼ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ¬è´¨ä¸Šå¹¶ä¸å…³å¿ƒé‚£äº›è¾ƒå°çš„å­æ ‘ã€‚</p><p>äºæ˜¯è¿™éƒ¨åˆ†å°±å¯ä»¥åˆ†å­æ ‘æŸ¥ã€‚å‘ç°æœ¬è´¨ä¸Šè½¬åŒ–æˆäº†åœ¨ $dfs$ åºä¸Šæ±‚ã€ŒåŒºé—´ $[l,r]$ å†…å€¼åŸŸåœ¨ $[a,b]$ å†…çš„æ•°æœ‰å¤šå°‘ã€ï¼Œå¯ä»¥ç›´æ¥ä¸Šä¸»å¸­æ ‘ã€‚ç„¶åè¿™éƒ¨åˆ†å°±åšå®Œäº†ã€‚</p><h4 id="Case-2-å®ƒå­æ ‘å¤–çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"><a href="#Case-2-å®ƒå­æ ‘å¤–çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ" class="headerlink" title="Case 2 å®ƒå­æ ‘å¤–çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"></a>Case 2 å®ƒå­æ ‘å¤–çš„æŸä¸ªå­æ ‘è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ</h4><p>æ­¤æ—¶è¿˜æ˜¯ä¸å˜ï¼Œä½†æ˜¯çº¦æŸå˜ä¸ºäº†</p><script type="math/tex; mode=display">\begin{aligned}n-s-size_x&\leq \lfloor \frac{n-s}{2}\rfloor\\z&\leq \lfloor \frac{n-s}{2}\rfloor\\\end{aligned}</script><p>è¿™éƒ¨åˆ†ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥ä¸»å¸­æ ‘æ¥æ±‚ã€‚ä½†æ˜¯æ³¨æ„è§£å‡ºæ¥çš„ $[l,r]$ å†…å¯èƒ½ä¼šåŒ…å«ä» $x$ åˆ°æ ¹è·¯å¾„ä¸Šç‚¹(ç¥–å…ˆ)çš„å­æ ‘ä¿¡æ¯ï¼Œå¯ä»¥å¯¹è¿›é€€æ ˆé¡ºåºå¼€ä¸€æ£µçº¿æ®µæ ‘æ¥å®¹æ–¥æ‰è¿™ä¸€éƒ¨åˆ†ã€‚</p><h4 id="Case-3-å®ƒå­æ ‘å¤–æŸä¸ªä¸æ˜¯å­æ ‘çš„è¿é€šå—è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"><a href="#Case-3-å®ƒå­æ ‘å¤–æŸä¸ªä¸æ˜¯å­æ ‘çš„è¿é€šå—è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ" class="headerlink" title="Case 3 å®ƒå­æ ‘å¤–æŸä¸ªä¸æ˜¯å­æ ‘çš„è¿é€šå—è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ"></a>Case 3 å®ƒå­æ ‘å¤–æŸä¸ªä¸æ˜¯å­æ ‘çš„è¿é€šå—è¢«å‰²äº†ï¼Œå®ƒæˆä¸ºäº†é‡å¿ƒ</h4><p>è€ƒè™‘æ­¤æ—¶å‰²æ‰çš„ä¸€å®šæ˜¯ $x$ åˆ°æ ¹è·¯å¾„ä¸Šçš„ä¸€æ¡è¾¹ã€‚å‘ç°æœ¬è´¨ä¸Šä¾æ—§æ˜¯</p><script type="math/tex; mode=display">\begin{aligned}n-s-size_x&\leq \lfloor \frac{n-s}{2}\rfloor\\z&\leq \lfloor \frac{n-s}{2}\rfloor\\\end{aligned}</script><p>äºæ˜¯è¿˜æ˜¯ç»´æŠ¤ä¸€æ£µé€€æ ˆé¡ºåºçš„çº¿æ®µæ ‘æ¥ç»´æŠ¤è¿™ä¸ªã€‚</p><p>ç„¶åä»¥ä¸Šçš„çº¿æ®µæ ‘å¯ä»¥æ¢æˆæ ‘çŠ¶æ•°ç»„ã€‚äºæ˜¯ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> _bit[N] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> low(x) (x &amp; -x)</span></span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">mdf</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (  ; p &lt;= n ; p += low(p)) _bit[p] += x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; p ; p -= low(p)) ret += _bit[p] ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123; <span class="keyword">return</span> ask(r) - ask(l - <span class="number">1</span>) ; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs5</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = max(<span class="number">1</span>, n - <span class="number">2</span> * sz[x]), s ;</span><br><span class="line">    <span class="keyword">int</span> r = n - <span class="number">2</span> * sz[mson[x]], k, y, g ;</span><br><span class="line">    <span class="keyword">if</span> (r &gt;= l)&#123;<span class="comment">//Case 2</span></span><br><span class="line">        res[x] += query(_rt[<span class="number">0</span>], _rt[dfn[x] - <span class="number">1</span>], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">        res[x] += query(_rt[dfn[x] + sz[x] - <span class="number">1</span>], _rt[n], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">        res[x] -= qry(l, r) ;</span><br><span class="line">    &#125;</span><br><span class="line">    pre[<span class="number">0</span>] = <span class="number">0</span> ; s = edg[x].size() ; suf[s] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span> ; k &lt; s ; ++ k)&#123;</span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa)&#123; pre[k] = pre[max(<span class="number">0</span>, k - <span class="number">1</span>)] ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        pre[k] = max(pre[max(k - <span class="number">1</span>, <span class="number">0</span>)], sz[y]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = s - <span class="number">1</span> ; ~k ; -- k)&#123;</span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa)&#123; suf[k] = suf[k + <span class="number">1</span>] ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        suf[k] = max(suf[k + <span class="number">1</span>], sz[y]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span> ; k &lt; s ; ++ k)&#123; <span class="comment">//Case 1</span></span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        g = max(n - sz[x], suf[k + <span class="number">1</span>]) ;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; <span class="number">0</span>) g = max(pre[k - <span class="number">1</span>], g) ;</span><br><span class="line">        l = max(<span class="number">1</span>, <span class="number">2</span> * sz[y] - n), r = n - <span class="number">2</span> * g ;</span><br><span class="line">        <span class="keyword">if</span> (r &gt;= l)</span><br><span class="line">            res[x] += query(_rt[dfn[y] - <span class="number">1</span>], _rt[dfn[y] + sz[y] - <span class="number">1</span>], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">    &#125;</span><br><span class="line">    mdf(sz[x], <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : edg[x])</span><br><span class="line">        <span class="keyword">if</span> (k != fa) dfs5(k, x) ;</span><br><span class="line">    mdf(sz[x], <span class="number">-1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs6</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa, <span class="keyword">int</span> qwq)</span></span>&#123;<span class="comment">//Case 3</span></span><br><span class="line">    <span class="keyword">int</span> t = sz[x] + qwq ;</span><br><span class="line">    <span class="keyword">int</span> r = n - <span class="number">2</span> * sz[mson[x]] ;</span><br><span class="line">    <span class="keyword">int</span> l = max(<span class="number">1</span>, n - <span class="number">2</span> * sz[x]) ;</span><br><span class="line">    <span class="keyword">if</span> (r &gt;= l)</span><br><span class="line">        res[x] += qry(l, r) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : edg[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        mdf(t - sz[k], <span class="number">1</span>) ;</span><br><span class="line">        dfs6(k, x, t - sz[k]) ;</span><br><span class="line">        mdf(t - sz[k], <span class="number">-1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("centroid.in", "r", stdin) ;</span></span><br><span class="line"><span class="comment">// freopen("centroid.out", "w", stdout) ;</span></span><br><span class="line"> qr(T) ; <span class="keyword">int</span> i, j, k ;</span><br><span class="line"><span class="keyword">while</span> (T --)&#123;</span><br><span class="line">qr(n), ans = tot = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            edg[i].clear(), mson[i] = res[i] = _bit[i] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">            qr(j), qr(k), edg[j].p_b(k), edg[k].p_b(j) ;</span><br><span class="line">        dfs4(<span class="number">1</span>, Id = <span class="number">0</span>) ; build(_rt[<span class="number">0</span>], <span class="number">1</span>, n) ;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            upd(_rt[i], _rt[i - <span class="number">1</span>], <span class="number">1</span>, n, sz[rev[i]]) ;</span><br><span class="line">        dfs5(<span class="number">1</span>, <span class="number">0</span>) ; fill(_bit + <span class="number">1</span>, _bit + n + <span class="number">1</span>, <span class="number">0</span>) ; dfs6(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) ans += <span class="number">1l</span>l * res[i] * i ; qw(ans, <span class="string">'\n'</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±åšå®Œäº†ã€‚å¤æ‚åº¦æ˜¯ $O(n\log n)$ï¼Œä½†å°±æ˜¯å¸¸æ•°å·¨å¤§â€¦ä¸çŸ¥é“ä¸ºä»€ä¹ˆâ€¦æ„Ÿè§‰åº”è¯¥æŒºå¿«æ‰å¯¹å•Šï¼ˆ</p><h3 id="Sol-2-1"><a href="#Sol-2-1" class="headerlink" title="Sol 2"></a>Sol 2</h3><p>è‰ï¼Œäº†è§£å®Œå€å¢åšæ³•åå‘ç°ä¸Šé¢çš„ä¸»å¸­æ ‘æ˜¯çœŸçš„çœŸçš„æ— è„‘ã€‚</p><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘ä¸€ä¸ª<del>æˆ‘æ²¡å‘ç°çš„</del>æ€§è´¨ï¼Œå‘ç°å¯¹äºæ¯ä¸ªç‚¹ $u$ï¼Œæ¯æ¬¡é‡å¿ƒè¦ä¹ˆæ˜¯ $u$ï¼Œè¦ä¹ˆå°±æ˜¯ $u$ çš„çˆ¶äº²ä»¥å¤–ï¼Œè¦ä¹ˆå°±åªä¼šæ˜¯ $u$ å­æ ‘å†…æŸä¸ªç‚¹çš„é‡å„¿å­ã€‚æ‰€ä»¥å°±å¯ä»¥å€å¢é¢„å¤„ç†å¤„æ¯ä¸ªç‚¹å¼€å§‹ $2^i$ ä¸ªé‡å„¿å­æ˜¯è°ã€‚ç„¶åè€ƒè™‘æ–­ $(x,y)$ è¿™æ¡è¾¹ä¹‹åï¼Œ$y$ å°±å¯ä»¥é€šè¿‡å€å¢çš„æ–¹å¼æ‰¾åˆ°æ·±åº¦æœ€å¤§çš„é‚£ä¸ªé‡å¿ƒï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹å®ƒçš„çˆ¶äº²å³å¯ï¼›$x$ è¿˜éœ€è¦åˆå¹¶çˆ¶äº²çš„é‡å¿ƒï¼Œç®—ç‚¹è¾¹ç•Œä¹‹ç±»çš„ï¼Œä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚</p><p>æœ€åæ”¾ä¸€ä¸‹ä¸»å¸­æ ‘çš„ä»£ç ï¼Œç”¨çš„ <code>ouuan</code> çš„ IOã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXP 5010</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> to(k) E[k].to</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> next(k) E[k].next</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_b push_back</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">chkmin</span><span class="params">(T &amp;x, T y)</span></span>&#123; x = x &gt; y ? y : x ; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">chkmax</span><span class="params">(T &amp;x, T y)</span></span>&#123; x = x &lt; y ? y : x ; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(T *<span class="keyword">const</span> tp, <span class="keyword">int</span> minn, <span class="keyword">int</span> maxn, <span class="keyword">char</span> v = <span class="string">' '</span>, <span class="keyword">char</span> c = <span class="string">'\n'</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = minn ; i &lt;= maxn ; ++ i) <span class="built_in">cout</span> &lt;&lt; tp[i] &lt;&lt; v ;  <span class="built_in">cout</span> &lt;&lt; c ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL ans ;</span><br><span class="line"><span class="keyword">int</span> max_dep ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> to, next ;</span><br><span class="line">&#125;E[N &lt;&lt; <span class="number">1</span>] ;</span><br><span class="line"><span class="keyword">int</span> dep[N] ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"><span class="keyword">int</span> dfn[N] ;</span><br><span class="line"><span class="keyword">int</span> rev[N] ;</span><br><span class="line"><span class="keyword">int</span> mson[N] ;</span><br><span class="line"><span class="keyword">int</span> q[<span class="number">5</span>], p[<span class="number">5</span>] ;</span><br><span class="line"><span class="keyword">int</span> bg, rt, Id ;</span><br><span class="line"><span class="keyword">int</span> head[N], cnt, f[N] ;</span><br><span class="line"><span class="keyword">int</span> T, n, sz[N], e[N &lt;&lt; <span class="number">1</span>][<span class="number">2</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IO</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE (1 &lt;&lt; 20)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> isdigit(x) (x &gt;= <span class="meta-string">'0'</span> &amp;&amp; x &lt;= <span class="meta-string">'9'</span>)</span></span><br><span class="line">  <span class="keyword">char</span> buf[MAXSIZE], *p1, *p2;</span><br><span class="line">  <span class="keyword">char</span> pbuf[MAXSIZE], *pp;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  IO() : p1(buf), p2(buf), pp(pbuf) &#123;&#125;</span><br><span class="line">  ~IO() &#123; fwrite(pbuf, <span class="number">1</span>, pp - pbuf, <span class="built_in">stdout</span>); &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">    <span class="keyword">return</span> getchar();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (p1 == p2) p2 = (p1 = buf) + fread(buf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">return</span> p1 == p2 ? <span class="string">' '</span> : *p1++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">blank</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ch == <span class="string">' '</span> || ch == <span class="string">'\n'</span> || ch == <span class="string">'\r'</span> || ch == <span class="string">'\t'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span> &amp;<span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">double</span> tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">bool</span> sign = <span class="number">0</span>;</span><br><span class="line">    x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">char</span> ch = gc();</span><br><span class="line">    <span class="keyword">for</span> (; !<span class="built_in">isdigit</span>(ch); ch = gc())</span><br><span class="line">      <span class="keyword">if</span> (ch == <span class="string">'-'</span>) sign = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="built_in">isdigit</span>(ch); ch = gc()) x = x * <span class="number">10</span> + (ch - <span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">'.'</span>)</span><br><span class="line">      <span class="keyword">for</span> (ch = gc(); <span class="built_in">isdigit</span>(ch); ch = gc())</span><br><span class="line">        tmp /= <span class="number">10.0</span>, x += tmp * (ch - <span class="string">'0'</span>);</span><br><span class="line">    <span class="keyword">if</span> (sign) x = -x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">char</span> *s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">char</span> ch = gc();</span><br><span class="line">    <span class="keyword">for</span> (; blank(ch); ch = gc())</span><br><span class="line">      ;</span><br><span class="line">    <span class="keyword">for</span> (; !blank(ch); ch = gc()) *s++ = ch;</span><br><span class="line">    *s = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">char</span> &amp;c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (c = gc(); blank(c); c = gc())</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> &amp;c)</span> </span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">    <span class="built_in">putchar</span>(c);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">if</span> (pp - pbuf == MAXSIZE) fwrite(pbuf, <span class="number">1</span>, MAXSIZE, <span class="built_in">stdout</span>), pp = pbuf;</span><br><span class="line">    *pp++ = c;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="title">inline</span> <span class="title">void</span> <span class="title">write</span>(<span class="title">T</span> <span class="title">x</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, push(<span class="string">'-'</span>);</span><br><span class="line">    <span class="keyword">static</span> T sta[<span class="number">35</span>];</span><br><span class="line">    T top = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      sta[top++] = x % <span class="number">10</span>, x /= <span class="number">10</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (x);</span><br><span class="line">    <span class="keyword">while</span> (top) push(sta[--top] + <span class="string">'0'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class">  <span class="title">inline</span> <span class="title">void</span> <span class="title">write</span>(<span class="title">T</span> <span class="title">x</span>, <span class="title">char</span> <span class="title">lastChar</span>) &#123;</span></span><br><span class="line">    write(x), push(lastChar);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; io;</span><br><span class="line"></span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">E[++ cnt].to = v, next(cnt) = head[u], head[u] = cnt ;</span><br><span class="line">E[++ cnt].to = u, next(cnt) = head[v], head[v] = cnt ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">sz[u] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line"><span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ; <span class="keyword">else</span> dfs1(to(k), u), sz[u] += sz[to(k)] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> mx = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))</span><br><span class="line"><span class="keyword">if</span> (to(k) != fa) chkmax(mx, sz[to(k)]), dfs(to(k), u) ;</span><br><span class="line">chkmax(mx, sz[rt] - sz[u]) ; f[u] = mx ;</span><br><span class="line"><span class="keyword">if</span> (f[q[<span class="number">1</span>]] &gt; f[u]) q[<span class="number">1</span>] = u ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (f[q[<span class="number">2</span>]] &gt; f[u]) q[<span class="number">2</span>] = u ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &gt; max_dep)</span><br><span class="line">        max_dep = dep[x], rt = x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) dfs2(to(k), x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">redfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ; rev[dep[x]] = x ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) redfs(to(k), x) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs3</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    dep[x] = dep[fa] + <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))</span><br><span class="line">        <span class="keyword">if</span> (to(k) != fa) dfs3(to(k), x), ans += to(k) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tot ;</span><br><span class="line"><span class="keyword">int</span> sum[N * <span class="number">18</span>] ;</span><br><span class="line"><span class="keyword">int</span> _rt[N * <span class="number">18</span>] ;</span><br><span class="line"><span class="keyword">int</span> _lc[N * <span class="number">18</span>] ;</span><br><span class="line"><span class="keyword">int</span> _rc[N * <span class="number">18</span>] ;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; edg[N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs4</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    rev[dfn[x] = ++ Id] = x ;</span><br><span class="line">    dep[x] = dep[fa] + (sz[x] = <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : edg[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k != fa)&#123;</span><br><span class="line">            dfs4(k, x) ; sz[x] += sz[k] ;</span><br><span class="line">            <span class="keyword">if</span> (sz[k] &gt; sz[mson[x]] || !mson[x]) mson[x] = k ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    sum[rt = ++ tot] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> <span class="keyword">void</span>() ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    build(_lc[rt], l, mid) ;</span><br><span class="line">    build(_rc[rt], mid + <span class="number">1</span>, r) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> lst, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    rt = ++ tot ;</span><br><span class="line">    _lc[rt] = _lc[lst] ;</span><br><span class="line">    _rc[rt] = _rc[lst] ;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">void</span>(sum[rt] = sum[lst] + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= mid)</span><br><span class="line">         upd(_lc[rt], _lc[lst], l, mid, p) ;</span><br><span class="line">    <span class="keyword">else</span> upd(_rc[rt], _rc[lst], mid + <span class="number">1</span>, r, p) ;</span><br><span class="line">    sum[rt] = sum[_lc[rt]] + sum[_rc[rt]] ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>, res = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) <span class="keyword">return</span> sum[v] - sum[u] ;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= mid) res += query(_lc[u], _lc[v], l, mid, ql, qr) ;</span><br><span class="line">    <span class="keyword">if</span> (qr &gt; mid) res += query(_rc[u], _rc[v], mid + <span class="number">1</span>, r, ql, qr) ;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> pre[N] ;</span><br><span class="line"><span class="keyword">int</span> suf[N] ;</span><br><span class="line"><span class="keyword">int</span> res[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> _bit[N] ;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> low(x) (x &amp; -x)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mdf</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (  ; p &lt;= n ; p += low(p)) _bit[p] += x ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> ( ; p ; p -= low(p)) ret += _bit[p] ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qry</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ask(r) - ask(l - <span class="number">1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int seg[N * 3] ;</span></span><br><span class="line"><span class="comment">void _up(int rt)&#123;</span></span><br><span class="line"><span class="comment">    seg[rt] = seg[rt &lt;&lt; 1] + seg[rt &lt;&lt; 1 | 1] ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">void mdf(int rt, int l, int r, int pos, int v)&#123;</span></span><br><span class="line"><span class="comment">    if (l == r)&#123; seg[rt] += v ; return ; &#125;</span></span><br><span class="line"><span class="comment">    int mid = (l + r) &gt;&gt; 1 ;</span></span><br><span class="line"><span class="comment">    if (pos &lt;= mid) mdf(rt &lt;&lt; 1, l, mid, pos, v) ;</span></span><br><span class="line"><span class="comment">    else mdf(rt &lt;&lt; 1 | 1, mid + 1, r, pos, v) ; _up(rt) ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">int qry(int rt, int l, int r, int ql, int qr)&#123;</span></span><br><span class="line"><span class="comment">    int mid = (l + r) &gt;&gt; 1, res = 0 ;</span></span><br><span class="line"><span class="comment">    if (ql &lt;= l &amp;&amp; r &lt;= qr) return seg[rt] ;</span></span><br><span class="line"><span class="comment">    if (ql &lt;= mid) res += qry(rt &lt;&lt; 1, l, mid, ql, qr) ;</span></span><br><span class="line"><span class="comment">    if (qr &gt; mid) res += qry(rt &lt;&lt; 1 | 1, mid + 1, r, ql, qr) ;</span></span><br><span class="line"><span class="comment">    return res ;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs5</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">    <span class="comment">//int g[3] = &#123;0, 0, 0&#125; ;</span></span><br><span class="line">    <span class="comment">/*for (int i = 1 ; i &lt;= 5 ; ++ i)&#123;</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; x &lt;&lt; " " ;</span></span><br><span class="line"><span class="comment">    &#125;puts("") ;*/</span></span><br><span class="line">    <span class="keyword">int</span> l = max(<span class="number">1</span>, n - <span class="number">2</span> * sz[x]), s ;</span><br><span class="line">    <span class="keyword">int</span> r = n - <span class="number">2</span> * sz[mson[x]], k, y, g ;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " \n" ;</span></span><br><span class="line">    <span class="keyword">if</span> (r &gt;= l &amp;&amp; l &gt; <span class="number">0</span> &amp;&amp; r &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; dfn[x] &lt;&lt; " \n" ;</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; query(_rt[dfn[x] + sz[x] - 1], _rt[n], 1, n, l, r) &lt;&lt; "#\n" ;</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; query(_rt[0], _rt[dfn[x] - 1], 1, n, l, r) &lt;&lt; "#\n" ;</span></span><br><span class="line">        res[x] += query(_rt[<span class="number">0</span>], _rt[dfn[x] - <span class="number">1</span>], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">        res[x] += query(_rt[dfn[x] + sz[x] - <span class="number">1</span>], _rt[n], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">        res[x] -= qry(l, r) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; " !!!" &lt;&lt; x &lt;&lt; "!!! " &lt;&lt; res[x] &lt;&lt; '\n' ;</span></span><br><span class="line">    pre[<span class="number">0</span>] = <span class="number">0</span> ; s = edg[x].size() ; suf[s] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span> ; k &lt; s ; ++ k)&#123;</span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa)&#123; pre[k] = pre[max(<span class="number">0</span>, k - <span class="number">1</span>)] ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        pre[k] = max(pre[max(k - <span class="number">1</span>, <span class="number">0</span>)], sz[y]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = s - <span class="number">1</span> ; ~k ; -- k)&#123;</span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa)&#123; suf[k] = suf[k + <span class="number">1</span>] ; <span class="keyword">continue</span> ; &#125;</span><br><span class="line">        suf[k] = max(suf[k + <span class="number">1</span>], sz[y]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span> ; k &lt; s ; ++ k)&#123;</span><br><span class="line">        y = edg[x][k] ;</span><br><span class="line">        <span class="keyword">if</span> (y == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        g = max(n - sz[x], suf[k + <span class="number">1</span>]) ;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; <span class="number">0</span>) g = max(pre[k - <span class="number">1</span>], g) ;</span><br><span class="line">        <span class="keyword">int</span> l = max(<span class="number">1</span>, <span class="number">2</span> * sz[y] - n), r = n - <span class="number">2</span> * g ;</span><br><span class="line"><span class="comment">//        cout &lt;&lt; g &lt;&lt; " " &lt;&lt; y &lt;&lt; " " &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">if</span> (r &gt;= l)</span><br><span class="line">            res[x] += query(_rt[dfn[y] - <span class="number">1</span>], _rt[dfn[y] + sz[y] - <span class="number">1</span>], <span class="number">1</span>, n, l, r) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    for (k = 0 ; k &lt; s ; ++ k)&#123;</span></span><br><span class="line"><span class="comment">        y = edg[x][k] ;</span></span><br><span class="line"><span class="comment">        if (y == fa || y != mson[x]) continue ;</span></span><br><span class="line"><span class="comment">        g[2] = suf[k + 1] ; if (k) g[2] = max(pre[k - 1], g[2]) ; break ;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    g[0] = sz[mson[x]] ; g[1] = n - sz[x] ;</span></span><br><span class="line"><span class="comment">    sort(g, g + 3) ;</span></span><br><span class="line"><span class="comment">    l = max(1, 2 * g[2] - n) ;</span></span><br><span class="line"><span class="comment">    r = min(n - g[1] * 2, 2 * sz[x] - n) ;</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; g[2] &lt;&lt; " " &lt;&lt; g[1] &lt;&lt; " " &lt;&lt; g[0] &lt;&lt; " $%$ \n" ;</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " " &lt;&lt; x &lt;&lt; " " &lt;&lt; res[x] &lt;&lt; "*&amp;*\n" ;</span></span><br><span class="line"><span class="comment">    if (l &lt;= r)</span></span><br><span class="line"><span class="comment">        res[x] += query(_rt[dfn[x]], _rt[dfn[x] + sz[x] - 1], 1, n, l, r) ;</span></span><br><span class="line"><span class="comment">    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; res[x] &lt;&lt; '\n' ;*/</span></span><br><span class="line">    mdf(sz[x], <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : edg[x]) <span class="keyword">if</span> (k != fa) dfs5(k, x) ;</span><br><span class="line">    mdf(sz[x], <span class="number">-1</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs6</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> fa, <span class="keyword">int</span> qwq)</span></span>&#123;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; x &lt;&lt; " " &lt;&lt; qwq &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">int</span> t = sz[x] + qwq ;</span><br><span class="line">    <span class="keyword">int</span> r = n - <span class="number">2</span> * sz[mson[x]] ;</span><br><span class="line">    <span class="keyword">int</span> l = max(<span class="number">1</span>, n - <span class="number">2</span> * sz[x]) ;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; l &lt;&lt; " " &lt;&lt; r &lt;&lt; " &amp;\n" ;</span></span><br><span class="line">    <span class="keyword">if</span> (r &gt;= l)</span><br><span class="line">        res[x] += qry(l, r) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> k : edg[x])&#123;</span><br><span class="line">        <span class="keyword">if</span> (k == fa) <span class="keyword">continue</span> ;</span><br><span class="line">        mdf(t - sz[k], <span class="number">1</span>) ;</span><br><span class="line">        dfs6(k, x, t - sz[k]) ;</span><br><span class="line">        mdf(t - sz[k], <span class="number">-1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//freopen("centroid12.in", "r", stdin) ;</span></span><br><span class="line"><span class="comment">// freopen("centroid.out", "w", stdout) ;</span></span><br><span class="line"></span><br><span class="line"> io.read(T) ; <span class="keyword">int</span> i, j, k ;</span><br><span class="line"><span class="keyword">while</span> (T --)&#123;</span><br><span class="line">io.read(n), cnt = ans = <span class="number">0</span> ;</span><br><span class="line"><span class="built_in">memset</span>(head, <span class="number">0</span>, <span class="keyword">sizeof</span>(head)) ;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">5000</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">                io.read(j), io.read(k),</span><br><span class="line">add(j, k), e[i][<span class="number">0</span>] = j, e[i][<span class="number">1</span>] = k ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) res[i] = <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">f[<span class="number">0</span>] = n + <span class="number">1</span> ;</span><br><span class="line">q[<span class="number">1</span>] = q[<span class="number">2</span>] = <span class="number">0</span>,</span><br><span class="line">dfs1(rt = e[i][<span class="number">0</span>], e[i][<span class="number">1</span>]) ;</span><br><span class="line">dfs(e[i][<span class="number">0</span>], e[i][<span class="number">1</span>]) ;</span><br><span class="line">(f[q[<span class="number">2</span>]] == f[q[<span class="number">1</span>]]) ? (res[q[<span class="number">1</span>]]++, res[q[<span class="number">2</span>]] ++) : res[q[<span class="number">1</span>]] ++ ;</span><br><span class="line"><span class="built_in">memset</span>(f, <span class="number">0</span>, <span class="keyword">sizeof</span>(f)) ;</span><br><span class="line">f[<span class="number">0</span>] = n + <span class="number">1</span> ;</span><br><span class="line">q[<span class="number">1</span>] = q[<span class="number">2</span>] = <span class="number">0</span> ;</span><br><span class="line">dfs1(rt = e[i][<span class="number">1</span>], e[i][<span class="number">0</span>]) ;</span><br><span class="line">                dfs(e[i][<span class="number">1</span>], e[i][<span class="number">0</span>]) ;</span><br><span class="line">(f[q[<span class="number">2</span>]] == f[q[<span class="number">1</span>]]) ? (res[q[<span class="number">1</span>]]++, res[q[<span class="number">2</span>]] ++) : res[q[<span class="number">1</span>]] ++ ;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                ans += <span class="number">1l</span>l * res[i] * i ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">49991</span>)&#123;</span><br><span class="line">            max_dep = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)</span><br><span class="line">                io.read(j), io.read(k), add(j, k) ;</span><br><span class="line">            dfs2(<span class="number">1</span>, <span class="number">0</span>) ; redfs(rt, dep[<span class="number">0</span>] = <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i &amp; <span class="number">1</span>) ans += rev[i / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">else</span> ans += rev[i / <span class="number">2</span>] + rev[i / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">if</span> ((n - i) &amp; <span class="number">1</span>) ans += rev[i + (n - i) / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">                <span class="keyword">else</span> ans += rev[i + (n - i) / <span class="number">2</span>] + rev[i + (n - i) / <span class="number">2</span> + <span class="number">1</span>] ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">262143</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i) deg[i] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">                io.read(j), io.read(k) ;</span><br><span class="line">                add(j, k), ++ deg[j], ++ deg[k] ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                <span class="keyword">if</span> (deg[i] == <span class="number">2</span>) &#123; rt = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">            dfs3(rt, <span class="number">0</span>) ; ans += <span class="number">1l</span>l * rt * (n / <span class="number">2l</span>l + <span class="number">1</span>) ; <span class="comment">//cout &lt;&lt; ans &lt;&lt; '\n' ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = head[rt] ; k ; k = next(k))</span><br><span class="line">                ans += <span class="number">1l</span>l * to(k) * (n - <span class="number">1</span>) / <span class="number">2</span> ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Id = <span class="number">0</span> ; tot = <span class="number">0</span> ;</span><br><span class="line">            <span class="built_in">memset</span>(_rt, <span class="number">0</span>, <span class="keyword">sizeof</span>(_rt)) ;</span><br><span class="line">            <span class="built_in">memset</span>(_bit, <span class="number">0</span>, <span class="keyword">sizeof</span>(_bit)) ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                edg[i].clear(), mson[i] = res[i] = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">                io.read(j), io.read(k) ;</span><br><span class="line">                edg[j].p_b(k), edg[k].p_b(j) ;</span><br><span class="line">            &#125;</span><br><span class="line">            dfs4(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">            build(_rt[<span class="number">0</span>], <span class="number">1</span>, n) ;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                upd(_rt[i], _rt[i - <span class="number">1</span>], <span class="number">1</span>, n, sz[rev[i]]) ;</span><br><span class="line">            dfs5(<span class="number">1</span>, <span class="number">0</span>) ;</span><br><span class="line">            <span class="built_in">memset</span>(_bit, <span class="number">0</span>, <span class="keyword">sizeof</span>(_bit)) ;</span><br><span class="line">            dfs6(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                ans += <span class="number">1l</span>l * res[i] * i ;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤§æ¦‚æ˜¯é‡åšäº†ä¸€ä¸‹ NOIP2018/CSP2019 ä¸¤å¹´çš„å…¨éƒ¨é¢˜ç›®ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰å½“æ—¶åœºä¸Šæ²¡ A æ‰çš„é¢˜ï¼Œæ”¾åˆ°ç°åœ¨åšæ€»æ˜¯æ„Ÿè§‰æœ‰ç‚¹å¿ƒç†é˜´å½±emm&lt;/p&gt;
&lt;p&gt;Anyway, åªç”¨çœŸæ­£å‘Šåˆ«è¿‡å»æ‰èƒ½èµ°å‘æœªæ¥ã€‚ä½ è¯´ï¼Œå¯¹å§ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
    
      <category term="åŠ¨æ€è§„åˆ’/çŠ¶å‹DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/æœ‰æŠ€å·§çš„DP" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84DP/"/>
    
      <category term="æ€ç»´é¢˜/è®¡æ•°" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E8%AE%A1%E6%95%B0/"/>
    
      <category term="æ€ç»´é¢˜/æ‰¾æ€§è´¨" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E6%89%BE%E6%80%A7%E8%B4%A8/"/>
    
      <category term="æ ‘ä¸ŠæŠ€å·§/dfsåº+æ ‘çŠ¶æ•°ç»„" scheme="https://www.orchidany.cn/tags/%E6%A0%91%E4%B8%8A%E6%8A%80%E5%B7%A7-dfs%E5%BA%8F-%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="æŠ€å·§/åˆ†æ²»" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%88%86%E6%B2%BB/"/>
    
      <category term="å¥½å¤šå¥½å¤šç»†èŠ‚" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="æŠ€å·§/å€å¢" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E5%80%8D%E5%A2%9E/"/>
    
      <category term="æ€ç»´é¢˜/å®¹æ–¥" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E5%AE%B9%E6%96%A5/"/>
    
      <category term="è´ªå¿ƒ" scheme="https://www.orchidany.cn/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/å•è°ƒé˜Ÿåˆ—" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/"/>
    
      <category term="æ•°æ®ç»“æ„/å¯æŒä¹…åŒ–/å¯æŒä¹…åŒ–çº¿æ®µæ ‘" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96-%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="æ•°æ®ç»“æ„/çº¿æ®µæ ‘" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"/>
    
      <category term="æŠ€å·§/çŠ¶æ€åˆå¹¶" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E7%8A%B6%E6%80%81%E5%90%88%E5%B9%B6/"/>
    
      <category term="æœ‰æŠ€å·§çš„å·®åˆ†" scheme="https://www.orchidany.cn/tags/%E6%9C%89%E6%8A%80%E5%B7%A7%E7%9A%84%E5%B7%AE%E5%88%86/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/èƒŒåŒ…æ¨¡å‹" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E8%83%8C%E5%8C%85%E6%A8%A1%E5%9E%8B/"/>
    
      <category term="NOIPç³»åˆ—" scheme="https://www.orchidany.cn/tags/NOIP%E7%B3%BB%E5%88%97/"/>
    
      <category term="åŠ¨æ€è§„åˆ’/é“¾åˆ†æ²»ç»´æŠ¤dp" scheme="https://www.orchidany.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E9%93%BE%E5%88%86%E6%B2%BB%E7%BB%B4%E6%8A%A4dp/"/>
    
  </entry>
  
  <entry>
    <title>ã€å­¦ä¹ ç¬”è®°ã€‘ä¸€èˆ¬å›¾æœ€å¤§åŒ¹é…(å¸¦èŠ±æ ‘)</title>
    <link href="https://www.orchidany.cn/2020/05/11/%E5%B8%A6%E8%8A%B1%E6%A0%91/"/>
    <id>https://www.orchidany.cn/2020/05/11/å¸¦èŠ±æ ‘/</id>
    <published>2020-05-11T00:48:43.000Z</published>
    <updated>2020-05-12T02:43:04.525Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å­¦äº†ä¸€å‘å¸¦èŠ±æ ‘ï¼Œæ„Ÿè§‰å¾ˆé«˜å¦™ã€‚</p><p>ç„¶åé¡ºä¾¿å¤ä¹ äº†ä¸€ä¸‹äºŒåˆ†å›¾åŒ¹é…andå­¦äº†ä¸€ä¸‹éšæœºåŒ¹é…ã€‚</p><p>ğŸŒ¼ğŸŒ²ï¼šBlossom Tree.</p><a id="more"></a><h1 id="ä»åŒ¹é…åˆ°äºŒåˆ†å›¾åŒ¹é…"><a href="#ä»åŒ¹é…åˆ°äºŒåˆ†å›¾åŒ¹é…" class="headerlink" title="ä»åŒ¹é…åˆ°äºŒåˆ†å›¾åŒ¹é…"></a>ä»åŒ¹é…åˆ°äºŒåˆ†å›¾åŒ¹é…</h1><h2 id="ä»åŒ¹é…åˆ°å¢å¹¿è·¯"><a href="#ä»åŒ¹é…åˆ°å¢å¹¿è·¯" class="headerlink" title="ä»åŒ¹é…åˆ°å¢å¹¿è·¯"></a>ä»åŒ¹é…åˆ°å¢å¹¿è·¯</h2><blockquote><p>ç»™å®šä¸€å¼ å›¾ $G=\{\mathrm{V,E}\}$ ï¼Œä¸€ç»„ä¸¤ä¸¤æ²¡æœ‰äº¤ç‚¹çš„è¾¹é›† $\rm M\subseteq E$ ç§°ä¹‹ä¸º $G$ çš„ä¸€ç»„<strong>åŒ¹é…</strong>ã€‚è¾¹æ•°æœ€å¤šçš„åŒ¹é…ç§°ä¹‹ä¸º $G$ çš„<strong>æœ€å¤§åŒ¹é…</strong>ã€‚å…¶ä¸­ $\forall (u,v)\in \mathrm{M}$ ç§°ä¹‹ä¸º<strong>åŒ¹é…è¾¹</strong>ï¼Œå¦åˆ™ç§°ä¸º<strong>éåŒ¹é…è¾¹</strong>ã€‚</p><p>ç§°ä¸€ä¸ªç‚¹åœ¨åŒ¹é…ä¸­å½“ä¸”ä»…å½“å®ƒæ˜¯æŸè·³åŒ¹é…è¾¹çš„ç«¯ç‚¹ã€‚ç§°åŒ¹é…ä¸­çš„ç‚¹ä¸º<strong>åŒ¹é…ç‚¹</strong>ï¼Œä¸åœ¨åŒ¹é…ä¸­çš„ç‚¹ä¸º<strong>æœªç›–ç‚¹</strong> ã€‚ä¸æŸä¸ªåŒ¹é…ç‚¹å…±åŒ¹é…è¾¹çš„å¦ä¸€ä¸ªç«¯ç‚¹ç§°ä¹‹ä¸ºè¯¥ç‚¹çš„<strong>é…å¶</strong> ã€‚</p></blockquote><p>å—¯ï¼Œå®šä¹‰æœ—è¯µå®Œäº†â€¦ç„¶åå¤§æ¦‚å°±æ˜¯è€ƒè™‘æ€ä¹ˆæ‰¾åŒ¹é…ã€‚å¤§æ¦‚å°±æ˜¯å¢å¹¿è·¯ç®—æ³•ã€‚å®šä¹‰<strong>å¢å¹¿è·¯</strong>æ˜¯è¿™æ ·çš„ä¸€ç§å›¾ä¸Šçš„è·¯å¾„ï¼š</p><blockquote><p>1ã€è·¯å¾„çš„èµ·ç‚¹å’Œç»ˆç‚¹å‡ä¸ºæœªç›–ç‚¹ã€‚</p><p>2ã€è·¯å¾„ä¸ŠåŒ¹é…è¾¹ã€æœªåŒ¹é…è¾¹äº¤æ›¿å‡ºç°ã€‚</p></blockquote><p>æ®æ­¤å¯ä»¥çŸ¥é“</p><blockquote><p>1ã€ä¸€æ¡å¢å¹¿è·¯å¿…ç„¶åªä¼šæœ‰å¥‡æ•°æ¡è¾¹ã€‚</p><p>2ã€å¢å¹¿è·¯ä¸ŠéåŒ¹é…è¾¹æ¯”åŒ¹é…è¾¹å¤š $1$ ã€‚</p><p>3ã€å¦‚æœå°†æ‰€æœ‰è¾¹çš„çŠ¶æ€å–åï¼Œé‚£ä¹ˆåŒ¹é…æ•° $+1$ ã€‚</p></blockquote><p>äºæ˜¯æœ‰å®šç†</p><blockquote><p>å¦‚æœä¸€ä¸ªåŒ¹é… $\mathrm{M}$ æ˜¯å›¾ $G$ çš„æœ€å¤§åŒ¹é…ï¼Œå½“ä¸”ä»…å½“ $Gâ€™=\rm \{V,E\setminus M\}$ ä¸­ä¸å­˜åœ¨å¢å¹¿è·¯ã€‚</p></blockquote><p>è¿™â€¦å¿…è¦æ€§è¿˜æ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„å§ã€‚å……åˆ†æ€§çš„è¯ï¼Œé¸½äº†é¸½äº†ã€‚</p><p>äºæ˜¯è€ƒè™‘å¦‚æœè¦æ±‚è§£ä¸€å¼ å›¾é‡Œçš„æœ€å¤§åŒ¹é…ï¼Œå¯ä»¥é€šè¿‡ä¸æ–­æ‰¾å¢å¹¿è·¯çš„æ–¹å¼æ¥è¿›è¡Œã€‚</p><h2 id="ä»å¢å¹¿è·¯åˆ°äºŒåˆ†å›¾åŒ¹é…"><a href="#ä»å¢å¹¿è·¯åˆ°äºŒåˆ†å›¾åŒ¹é…" class="headerlink" title="ä»å¢å¹¿è·¯åˆ°äºŒåˆ†å›¾åŒ¹é…"></a>ä»å¢å¹¿è·¯åˆ°äºŒåˆ†å›¾åŒ¹é…</h2><p>äºŒåˆ†å›¾æœ€é‡è¦çš„ä¸€ä¸ªç‰¹å¾ï¼šæ²¡æœ‰å¥‡ç¯ã€‚</p><p>è€ƒè™‘è¿™æ ·ä¸ºä»€ä¹ˆèƒ½ç®€åŒ–æ‰¾åŒ¹é…çš„è¿‡ç¨‹å‘¢ï¼Ÿå‘ç°æœ¬è´¨ä¸Šæ¯æ¬¡æ‰¾å¢å¹¿è·¯ï¼Œå°±æ˜¯åœ¨æ‰¾ä¸€æ¡é•¿åº¦ä¸ºå¥‡æ•°çš„è·¯å¾„ã€‚é‚£ä¹ˆè€ƒè™‘è¿™æ ·ä¸€ä¸ªåšæ³•ï¼š</p><blockquote><p>éå†æ¯ä¸ªå½“å‰çš„æœªç›–ç‚¹ $u$ ï¼š</p><p>1ã€å¦‚æœ $\exists (u,v)$ ä½¿å¾— $v$ ä¹Ÿæ˜¯æœªç›–ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è®© $v$ åŒ¹é…ä¸Šï¼ŒåŒ¹é…æ•° $+1$ ã€‚</p><p>2ã€å¦‚æœå¯¹äºæŸä¸ªåŒ¹é…ç‚¹ $v$ çš„é…å¶ $p$ ï¼Œå¯ä»¥æ‰¾åˆ°é™¤äº† $v$ ä¹‹å¤–çš„å¦ä¸€ä¸ªé…å¶ $q$ ï¼Œé‚£ä¹ˆå°±è®© $p$ å’Œ $q$ é…å¯¹ã€$u$ å’Œ $v$ é…å¯¹ã€‚æ€»åŒ¹é…æ•° $+1$ ã€‚</p></blockquote><p>çœ‹ä¸Šå»ååˆ†åˆç†ï¼Ÿè¿™æ ·å°±å¯ä»¥ä¿è¯æ¯æ¬¡æ‰¾åˆ°çš„éƒ½ä¼šæ˜¯ä¸€æ¡æé•¿çš„å¢å¹¿è·¯ã€‚è€ƒè™‘å€’ç€å½’çº³æ¥è¯æ˜è¿™ä¸ªäº‹å®ã€æ­¤æ—¶è€ƒè™‘çš„æ˜¯é‡åŒ¹é…(å³çŠ¶æ€å–å)ä¹‹å‰ã€‘ï¼š</p><blockquote><p> 1ã€å¦‚æœå¯¹äº $u$ æ‰¾åˆ°äº†ä¸€ä¸ªæœªç›–ç‚¹ $v$ ï¼Œé‚£ä¹ˆ $(u,v)$ æ˜¯å¢å¹¿è·¯ã€‚</p><p>2ã€å¦‚æœå¯¹äºæŸä¸ªåŒ¹é…ç‚¹ $v$ çš„é…å¶ $p$ ï¼Œå¯ä»¥æ‰¾åˆ°é™¤äº† $v$ ä¹‹å¤–çš„å¦ä¸€ä¸ªé…å¶ $q$ ï¼Œé‚£ä¹ˆ $p,q$ ä¹‹é—´çš„è·¯å¾„ä¸€å®šæ˜¯å¢å¹¿è·¯ï¼Œè¾¹ $(u,v)$ ä¹‹é—´ä¸€å®šä¹Ÿæ˜¯å¢å¹¿è·¯ã€‚åŒæ—¶åˆå› ä¸ºè¾¹ $(v,p)$ ä¸ºåŒ¹é…è¾¹ï¼Œæ‰€ä»¥è·¯å¾„ $u-v-p-q$ ä¸€å®šæ˜¯ä¸€æ¡é•¿åº¦ä¸ºå¥‡æ•°çš„å¢å¹¿è·¯ã€‚</p></blockquote><p>ç”±æ­¤å¯çŸ¥ï¼Œè¿™æ ·æ‰¾çš„è·¯ä¸€å®šæ˜¯å¢å¹¿è·¯ã€‚åŒæ—¶æœ¬è´¨ä¸Šè¿™ä¸ªç®—æ³•å°±æ˜¯åœ¨å¯¹æ¯ä¸€æ¡è¾¹è¿›è¡Œå®šå‘ï¼Œæ¯”å¦‚ $(u\to v)$ å°±ä»£è¡¨ç€æ‰¾åˆ°äº†ä¸€ç»„ $u,v$ åŒ¹é…ä¸”å¯èƒ½ä¼šè®© $v$ è°ƒæ•´åŒ¹é…ã€‚é‚£ä¹ˆäºæ˜¯ä¸€èˆ¬çš„äºŒåˆ†å›¾åŒ¹é…ç®—æ³•å°±æ˜¯è¿™æ ·çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">path</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = E[k].next)&#123;</span><br><span class="line"><span class="keyword">if</span> (!vis[to(k)])&#123;</span><br><span class="line">vis [to(k)] = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">if</span> (!used[to(k)] || path(used[to(k)]))&#123;</span><br><span class="line">used[to(k)] = u ;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N &gt;&gt; M &gt;&gt; Ew ;</span><br><span class="line"><span class="keyword">while</span>(Ew --) <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;A, &amp;B), Add(A, B) ;</span><br><span class="line"><span class="keyword">for</span> (R <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; ++ i)</span><br><span class="line"><span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="keyword">sizeof</span>(vis)), Ans += (<span class="keyword">int</span>)path(i) ;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; Ans &lt;&lt; <span class="built_in">endl</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå­˜åœ¨æŸä¸ªèŠ‚ç‚¹å¯»æ‰¾åŒ¹é…å¤±è´¥ï¼Œé‚£ä¹ˆ <code>dfs</code> è¿‡ç¨‹ä¸­è®¿é—®åˆ°æ‰€æœ‰ç»“ç‚¹å’Œè¾¹ä¼šç»„æˆä¸€ä¸ªæ ‘å½¢æ€ï¼Œç§°ä¹‹ä¸º<strong>äº¤é”™æ ‘</strong> ã€‚</p><p>ä½†æ˜¯è¿™æ ·åœ¨ä¸€èˆ¬æ— å‘å›¾ä¸Šä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜å—ï¼Ÿè€ƒè™‘ä¸€ä¸ªè¿™æ ·çš„ç¯</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="1.png" alt=""></p><p>ä¸€å¼€å§‹ä» $x$ å‡ºå‘æ‰¾åˆ° $y$ ï¼Œ$x,y$ å‡å˜ä¸ºåŒ¹é…ç‚¹ã€‚ä¹‹åè·³è¿‡ $y$ å› ä¸º $y$ å·²ç»è¢«åŒ¹é…ã€‚ä¹‹åæ¥åˆ° $z$ ã€‚å‘ç°å¯¹äº $z$ è€Œè¨€ï¼Œ$z$ æ‰¾ $x$ ï¼Œ$x$ æ‰¾é…å¶ $y$ï¼Œ$y$ å‘ç°è‡ªå·±çš„ä¸´è¾¹ä¸­ $z$ è¿˜æ²¡è¢«åŒ¹é…ï¼Œäºæ˜¯å°±åŒ¹é… $z$ ã€‚å‘ç°è¿™æ ·æœ€åä¼šä½¿å¾— $z$ æ—¢åŒ¹é…äº† $x$ åˆåŒ¹é…äº† $y$ ã€‚åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå‘ç°åŸå› åœ¨äºè¿™æ˜¯ä¸€ä¸ªå¥‡ç¯ã€‚å¥‡ç¯æ˜¯ä¼šå­˜åœ¨å¯¹äºä¸€æ¡è¾¹çš„ä¸¤ä¸ªä¸´è¾¹åœ¨é»‘ç™½æŸ“è‰²ä¹‹åå‘ˆåŒè‰²ï¼Œè¿™ä¸ç¬¦åˆåŒ¹é…çš„å®šä¹‰ã€‚</p><p>äºæ˜¯â€¦åŒˆç‰™åˆ©å°±æŒ‚åœ¨äº†ä¸€èˆ¬å›¾ä¸Šã€‚</p><h1 id="ä»äºŒåˆ†å›¾åŒ¹é…åˆ°å¸¦èŠ±æ ‘"><a href="#ä»äºŒåˆ†å›¾åŒ¹é…åˆ°å¸¦èŠ±æ ‘" class="headerlink" title="ä»äºŒåˆ†å›¾åŒ¹é…åˆ°å¸¦èŠ±æ ‘"></a>ä»äºŒåˆ†å›¾åŒ¹é…åˆ°å¸¦èŠ±æ ‘</h1><p>è€ƒè™‘äºŒåˆ†å›¾åŒ¹é…ç›´æ¥ç§»æ¤çš„é—®é¢˜å°±åœ¨äºå¥‡ç¯ã€‚é‚£ä¹ˆè€ƒè™‘å¦‚ä½•æ¶ˆé™¤å¥‡ç¯çš„è´¡çŒ®ã€‚äºæ˜¯å°±è¦å¼•å…¥<strong>å¸¦èŠ±æ ‘</strong>è¿™ä¸ªç®—æ³•(è‹±: Blosssom Algorithm)ã€‚</p><p>å¸¦èŠ±æ ‘æœ¬è´¨æ˜¯è€ƒè™‘å¥‡ç¯åŒ¹é…çš„æœ¬è´¨ï¼Œå³å¦‚æœè®©å¥‡ç¯è‡ªå·±å•ç‹¬åŒ¹é…ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚å‘ç°ä¸€ä¸ªé•¿ä¸º $2\cdot k+1$ çš„å¥‡ç¯æ— è®ºä½•æ—¶éƒ½å¯ä»¥è´¡çŒ® $k$ å¯¹åŒ¹é…ï¼Œå¹¶ä¸”ä½™ä¸‹ä¸€ä¸ªæœªç›–ç‚¹ã€‚äºæ˜¯å¸¦èŠ±æ ‘ä¼šè€ƒè™‘ï¼Œåœ¨å¤„ç†å¢å¹¿è·¯æ—¶ç›´æ¥æŠŠå¥‡ç¯ç¼©æˆä¸€ä¸ªç‚¹ï¼Œç§°ä¹‹ä¸º<strong>èŠ±</strong> ã€‚ä¹‹ååœ¨ç¼©å®ŒèŠ±çš„æ–°å›¾ä¸Šç»§ç»­æ‰¾å¢å¹¿è·¯ã€‚</p><p>ç„¶åè¯æ˜çš„è¯â€¦å¤§æ¦‚å°±æ˜¯è€ƒè™‘å¦‚æœåŸå›¾å­˜åœ¨å¢å¹¿è·¯ï¼Œé‚£ä¹ˆæ–°å›¾ä¹Ÿå¿…ç„¶å­˜åœ¨ï¼Œåä¹‹äº¦ç„¶ã€‚å…·ä½“è¯æ˜å’•äº†å’•äº†ã€‚</p><p>â€¦å…¶å®å¸¦èŠ±æ ‘éš¾ç‚¹å°±åªæ˜¯åœ¨å®ç°ä¸Šã€‚è€ƒè™‘ä¸å»æ˜¾ç¤ºåœ°ç¼©ç‚¹ï¼Œè€Œæ˜¯ç”¨å¹¶æŸ¥é›†ç»´æŠ¤æ¯ä¸ªç‚¹åœ¨å“ªä¸€æœµèŠ±é‡Œé¢ã€‚ç„¶åè€ƒè™‘ç”¨ bfs çš„æ–¹å¼å¯¹å½“å‰ç‚¹ $u$ çš„äº¤é”™æ ‘æŸ“è‰²ã€‚è€ƒè™‘å°†ç‚¹æŸ“ä¸º $\alpha$ ç±»å’Œ $\beta$ ç±»ï¼Œé‚£ä¹ˆæœ¬è´¨ä¸Šéœ€è¦è¿›è¡Œå¦‚ä¸‹æµç¨‹ï¼š</p><blockquote><p>-1ã€åˆå§‹ç»“ç‚¹ $u$ ä¸º $\alpha$ ç±»ã€‚</p><p>0ã€å½“å‰ç‚¹å’Œå½“å‰é‚»å±…ç»“ç‚¹åœ¨åŒä¸€æœµèŠ±é‡Œï¼Œç›´æ¥ <code>continue</code> ã€‚</p><p>1ã€å½“å‰ç‚¹ä¸º $\alpha$ ç±»ï¼Œå½“å‰é‚»å±…ç»“ç‚¹ä¸º $\beta$ ç±»ï¼Œç›´æ¥ <code>continue</code> ã€‚</p><p>2ã€å½“å‰ç‚¹ä¸º $\alpha $ ç±»ï¼Œå½“å‰é‚»å±…ç»“ç‚¹æœªè¢«æŸ“è‰²ï¼š</p><p>è€ƒè™‘å¦‚æœé‚»å±…ç»“ç‚¹æ˜¯åŒ¹é…ç‚¹ï¼Œé‚£ä¹ˆå°†é‚»å±…ç»“ç‚¹çš„é…å¶åŠ å…¥é˜Ÿåˆ—ï¼ŒåŒæ—¶å°†é‚»å±…ç»“ç‚¹æŸ“ä¸º $\alpha$ ç±»ï¼›å¦‚æœé‚»å±…ç»“ç‚¹æ˜¯æœªç›–ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥å°†ä» $u$ å¼€å§‹çš„è¿™ä¸€æ®µå¢å¹¿è·¯å–åä¹‹åï¼ŒåŒ¹é…æ•° $+1$ï¼Œå¹¶å°†é‚»å±…ç»“ç‚¹æŸ“ä¸º $\beta$ ç±»ä¹‹åè·³å‡ºã€‚</p><p>3ã€å½“å‰ç‚¹ä¸º $\alpha$ ç±»ï¼Œå½“å‰é‚»å±…ç»“ç‚¹ä¹Ÿä¸º $\alpha$ ç±»ï¼š</p><p>è€ƒè™‘è¿™æ—¶å°±æ‰¾åˆ°äº†ä¸€ä¸ª $u,v$ éƒ½åœ¨çš„å¥‡ç¯ã€‚è€ƒè™‘é¦–å…ˆä¸ºäº†ç¼©æ‰è¿™ä¸ªå¥‡ç¯ï¼Œéœ€è¦æ‰¾åˆ°å®ƒä»¬åœ¨<strong>äº¤é”™æ ‘ä¸Šçš„ lca</strong>ã€‚é‚£ä¹ˆäºæ­¤å°±éœ€è¦è®°å½•æ¯ä¸ªç‚¹åœ¨äº¤é”™æ ‘ä¸Šçš„å‰é©±ç»“ç‚¹(çˆ¶èŠ‚ç‚¹) $fa_x$ã€‚ ä¹‹åè€ƒè™‘ï¼Œç”±äºè¿™ä¸ªå¥‡ç¯ä¸Šçš„æ¯ä¸€ä¸ªç‚¹éƒ½å¯ä»¥å½“åšå”¯ä¸€è¢«å‰©ä¸‹çš„é‚£ä¸ªæœªç›–ç‚¹å»ä¸ç¯å¤–çš„ç‚¹åŒ¹é…ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†ç¯ä¸Šæ‰€æœ‰çš„ $\beta$ ç±»ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚åŒæ—¶ç”±äºè¿™ä¸ªç¯å¯ä»¥è‡ªç”±åŒ¹é…ï¼Œæ‰€ä»¥ç¯ä¸Šç›¸é‚»çš„ç‚¹åº”è¯¥æ˜¯å½¼æ­¤çš„ $fa$ ã€‚äºæ˜¯è¿™ä¸ªæ“ä½œå°±å¯ä»¥çœ‹ä½œæ˜¯åœ¨<strong>å¼€èŠ±(blossom)</strong>ã€‚</p></blockquote><p>ç„¶åå®ç°æ–¹é¢â€¦ä¼¼ä¹å°±è¿™ä¹ˆå¤šç»†èŠ‚äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Blossom_Tree&#123;</span><br><span class="line">    <span class="keyword">int</span> ans ;</span><br><span class="line">    <span class="keyword">int</span> num ;</span><br><span class="line">    <span class="keyword">int</span> h, t ;</span><br><span class="line">    <span class="keyword">int</span> q[N] ;</span><br><span class="line">    <span class="keyword">int</span> fa[N] ;</span><br><span class="line">    <span class="keyword">int</span> dfn[N] ;</span><br><span class="line">    <span class="keyword">int</span> pre[N] ;</span><br><span class="line">    <span class="keyword">int</span> clr[N] ;</span><br><span class="line">    <span class="keyword">int</span> match[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            fa[i] = i, match[i] = clr[i] = pre[i] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == fa[x]) <span class="keyword">return</span> x ;</span><br><span class="line">        <span class="keyword">return</span> fa[x] = find(fa[x]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        ++ num ;</span><br><span class="line">        x = find(x) ;</span><br><span class="line">        y = find(y) ; <span class="keyword">int</span> z ;</span><br><span class="line">        <span class="keyword">while</span> (dfn[x] != num)&#123;</span><br><span class="line">            dfn[x] = num ;</span><br><span class="line">            z = find(pre[match[x]]) ;</span><br><span class="line">            x = z ; <span class="keyword">if</span> (y) swap(x, y) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">blossom</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span></span>&#123;<span class="comment">//z=lca(x, y)</span></span><br><span class="line"><span class="comment">//        cout &lt;&lt; x &lt;&lt; " " &lt;&lt; y &lt;&lt; " " &lt;&lt; z &lt;&lt; '\n' ;</span></span><br><span class="line">        <span class="keyword">while</span> (find(x) != z)&#123;</span><br><span class="line">            pre[x] = y ;</span><br><span class="line">            y = match[x] ;</span><br><span class="line">            fa[x] = fa[y] = z ;<span class="comment">//2</span></span><br><span class="line">            <span class="keyword">if</span> (clr[y] &gt; <span class="number">1</span>)</span><br><span class="line">                clr[y] = <span class="number">1</span>, q[++ t] = y ;</span><br><span class="line">            x = pre[match[x]] ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">do_match</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        h = <span class="number">1</span>, t = <span class="number">0</span> ;</span><br><span class="line">        q[++ t] = x ; clr[x] = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            fa[i] = i, clr[i] = pre[i] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= t)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = q[h ++] ;</span><br><span class="line"><span class="comment">//            cout &lt;&lt; x &lt;&lt; " " &lt;&lt; h &lt;&lt; " " &lt;&lt; t &lt;&lt; " " &lt;&lt; head[x] &lt;&lt; " &amp;\n" ;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = head[x] ; k ; k = next(k))&#123;</span><br><span class="line">                <span class="keyword">if</span> (clr[to(k)] &gt; <span class="number">1</span>) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (find(x) == find(to(k))) <span class="keyword">continue</span> ;</span><br><span class="line">                <span class="keyword">if</span> (!clr[to(k)])&#123;</span><br><span class="line">                    clr[to(k)] = <span class="number">2</span> ;</span><br><span class="line">                    pre[to(k)] = x ;</span><br><span class="line">                    <span class="keyword">if</span> (!match[to(k)])&#123;</span><br><span class="line">                        <span class="keyword">int</span> z = to(k), y ;</span><br><span class="line">                        <span class="keyword">while</span> (z)&#123;</span><br><span class="line">                           y = match[pre[z]] ;<span class="comment">//1</span></span><br><span class="line">                           match[pre[z]] = z ;</span><br><span class="line">                           match[z] = pre[z] ; z = y ;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">                    &#125;</span><br><span class="line">                    clr[match[to(k)]] = <span class="number">1</span> ;</span><br><span class="line">                    q[++ t] = match[to(k)] ;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">int</span> z = lca(x, to(k)) ;</span><br><span class="line">                    blossom(x, to(k), z) ;</span><br><span class="line">                    blossom(to(k), x, z) ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            puts("xxxx") ;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> x, y ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">            x = qr(), y = qr(), add_e(x, y), add_e(y, x) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (!match[i]) ans += do_match(i) ;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; debug(match, <span class="number">1</span>, n) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Blossom_Tree ;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘å› ä¸ºæœ¬è´¨ä¸Šæ˜¯åœ¨ $u$ çš„åŒ¹é…è¿‡ç¨‹ä¸­ç¼©ç‚¹ï¼ŒæŠ½è±¡å‡ºæ¨¡å‹æ¥å°±æ˜¯åœ¨äº¤é”™æ ‘ä¸Šç¼©èŠ±andå¼€èŠ±ï¼Œäºæ˜¯è¿™ä¸ªç®—æ³•è¢«å«åšã€Œå¸¦èŠ±æ ‘ğŸŒ¼ğŸŒ²ã€ã€‚</p><h1 id="ä»å¸¦èŠ±æ ‘åˆ°å¼ƒç–—"><a href="#ä»å¸¦èŠ±æ ‘åˆ°å¼ƒç–—" class="headerlink" title="ä»å¸¦èŠ±æ ‘åˆ°å¼ƒç–—"></a>ä»å¸¦èŠ±æ ‘åˆ°å¼ƒç–—</h1><p>æ€»ç»“ä¸€ä¸‹ã€‚å¤§æ¦‚å¸¦èŠ±æ ‘çš„æµç¨‹å…¶å®ä¹Ÿä¸éš¾å†™ï¼Œåªæ˜¯æ­£ç¡®æ€§ä¸æ˜¯é‚£ä¹ˆæ˜¾ç„¶ã€‚åŒæ—¶æ³¨æ„åˆ°æ¯æ¬¡ bfs æ—¶ï¼Œä¸€ä¸ªç‚¹æœ€å¤šå…¥é˜Ÿ $O(n)$ æ¬¡ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡æœ€å¤šæœ‰ $O(n)$ ä¸ªä¸åŒçš„ç‚¹è®©å½“å‰ç‚¹åŠ å…¥èŠ±/åŠ å…¥é˜Ÿåˆ—æ¥ç†è§£ã€‚äºæ˜¯å¤æ‚åº¦æ€»å¤æ‚åº¦å°±æ˜¯ $O(n^3)$ ï¼Œä½†äº‹å®ä¸Šæ ¹æœ¬è·‘ä¸æ»¡ã€‚</p><p>ä¸€èˆ¬è€Œè¨€å¯ä»¥æ‹¿ $O(nm)$ å½“ä½œç†è®ºä¸‹ç•Œã€‚å…³äºè¿™ä¸ªç†è®ºä¸‹ç•Œæœ‰ä¸¤ç‚¹ï¼š</p><blockquote><p>1ã€å®ç°ä¸‹ç•Œæ¯”ç†è®ºä¸‹ç•Œè¿˜è¦ä½ä¸å°‘ã€‚</p><p>2ã€ç†è®ºä¸Šè¿™ä¸ªä¸‹ç•Œåº”è¯¥æ˜¯æ¯”è¾ƒæ¾çš„ï¼Œå› ä¸ºä¼šå­˜åœ¨æŸäº›ç‚¹è¿›é˜Ÿå‡ºé˜Ÿè®¸å¤šæ¬¡ï¼Œæ‰€ä»¥ä¸èƒ½å•çº¯åœ°ç”¨å•æ¬¡ bfs å¤æ‚åº¦æ¥åˆ†æã€‚</p></blockquote><p>æ€»ä¹‹â€¦è¿˜æ˜¯ $O(\texttt{èƒ½è¿‡})$ æ¯”è¾ƒåˆ°ä½å§ã€‚</p><p>å¥½ç„å­¦å•Šå¥½ç„å­¦å•Šã€‚</p><h1 id="ä»å¼ƒç–—åˆ°ç›¸ä¿¡éšæœºåŒ–"><a href="#ä»å¼ƒç–—åˆ°ç›¸ä¿¡éšæœºåŒ–" class="headerlink" title="ä»å¼ƒç–—åˆ°ç›¸ä¿¡éšæœºåŒ–"></a>ä»å¼ƒç–—åˆ°ç›¸ä¿¡éšæœºåŒ–</h1><p>æœ¬æ¥æƒ³ç€åœ¨æ´›è°·éšä¾¿å†™ä¸€å‘ï¼Œ$90$ å°± $90$ <del>å’±ä¹Ÿä¸å¸¦æ€‚çš„</del> ã€‚</p><p>ç„¶åå°±â€¦è¿‡æ‰äº†â€¦</p><p>é¡ºä¾¿ä¹Ÿè¿‡æ‰äº† uoj çš„ $52$ ç»„æ•°æ®å’Œ $43+$ ç»„çš„ <code>Extra Task</code> ã€‚</p><p>å¤§æ¦‚å°±æ˜¯è€ƒè™‘éšæœºåŒ¹é…ã€‚éšæœºåŒ¹é…çš„æ€æƒ³å°±æ˜¯ï¼Œä¸æ‰¾ç¯ï¼Œåªæ‰¾é•¿åº¦ä¸ºå¥‡æ•°çš„å¢å¹¿è·¯ã€‚è¿™æ ·åšç›¸å½“äºå¼ºåˆ¶æ–­ç¯ä¸ºé“¾ï¼Œæ­£ç¡®æ€§éš¾ä»¥ä¿è¯ã€‚ä½†æ˜¯è€ƒè™‘å¦‚æœå¤šåšå‡ æ¬¡ï¼Œé”™è¯¯ç‡å°±ä¼šå¤§å¤§ä¸‹é™ã€‚äºæ˜¯è€ƒè™‘å¤šåšå‡ æ¬¡è¿™æ ·çš„åŒ¹é…ã€‚æ³¨æ„åˆ°è¿™æ ·åšå¾ˆå®¹æ˜“è¢«å¡æ‰ï¼Œåªéœ€è¦å¤šå‡ ä¸ªå¥‡ç¯é¡ºä¾¿æ„é€ ä¸€ä¸‹åŠ è¾¹é¡ºåºå°±å¯ä»¥äº†ã€‚æ‰€ä»¥å°±å¯ä»¥æ¯æ¬¡èµ°çš„æ—¶å€™å°†è¾¹è¡¨éšä¸€ä¸‹å³å¯ã€‚</p><p>ç„¶åâ€¦ç”¨ <code>rand()</code> å¾ˆå®¹æ˜“è¢«å¡æ‰ï¼Œå› ä¸ºå€¼åŸŸå¾ˆå°ï¼Œè€Œè¾¹æ•°æ¯” $32768$ å¤§å¾—å¤šã€‚æ‰€ä»¥ç”¨ <code>mt19937</code> å°±å¯ä»¥äº†ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä»¥ä¸‹ä»£ç ä¸ºäº†ä¿è¯æ­£ç¡®ï¼Œå¡äº†æ—¶ï¼Œå¤§æ¦‚æ˜¯å¡äº† $0.85s$ å·¦å³ã€‚ä½†æ˜¯ååˆ†æœ‰è¶£çš„æ˜¯â€¦æ´›è°·çš„æ•°æ®åœ¨ $0.0005s=0.5ms$ çš„å¡æ—¶èŒƒå›´ä¹‹å†…éƒ½èƒ½è¿‡æ‰â€¦è¿™â€¦å’±ä¹Ÿä¸çŸ¥é“è¯¥è¯´ä»€ä¹ˆå¥½ã€‚</p><p>upd: éšæœºåŒ¹é…ä¼¼ä¹æ˜¯æ— æ•Œäº†ã€‚åœ¨ <code>uoj</code> è¯•äº†ä¸€å‘å¡æ—¶ $0.005s=5ms$ çš„æƒ…å†µï¼Œä¾æ—§æ— å‹åŠ›è¿‡æ‰äº†æ‰€æœ‰ $hack$ æ•°æ®ã€‚</p><p>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼šé¢˜æ˜¯ä¼—ç”Ÿä¸€èˆ¬é¢˜ï¼Œæ°´æ˜¯å¤©ä¸‹ä¸€æ ·æ°´ã€‚<del>éšæœºåŒ¹é… txdy!!!!</del></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> vis[N] ;</span><br><span class="line"><span class="keyword">int</span> match[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">clock_t</span> st ;</span><br><span class="line"></span><br><span class="line">mt19937 g_f ;</span><br><span class="line"></span><br><span class="line"><span class="function">il db <span class="title">now_time</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">double</span>)(clock() - st) / CLOCKS_PER_SEC ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">do_match</span><span class="params">(<span class="keyword">int</span> x, mt19937 g_f)</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">' '</span> ;</span><br><span class="line">    shuffle(E[x].begin(), E[x].end(), g_f) ; vis[x] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])</span><br><span class="line">        <span class="keyword">if</span> (!match[y])</span><br><span class="line">            <span class="keyword">return</span> vis[y] = <span class="number">1</span>, match[y] = x, match[x] = y, <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> y : E[x])&#123;</span><br><span class="line">        <span class="keyword">int</span> z = match[y] ;</span><br><span class="line">        <span class="keyword">if</span> (vis[z]) <span class="keyword">continue</span> ;</span><br><span class="line">        match[x] = y, match[y] = x, match[z] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">if</span> (do_match(z, g_f)) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        match[y] = z, match[z] = y, match[x] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    random_device seed ;</span><br><span class="line">    <span class="function">mt19937 <span class="title">g_f</span><span class="params">(seed())</span> </span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; <span class="keyword">int</span> x, y, z ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        x = qr(), y = qr(), add_e(x, y) ; st = clock() ;</span><br><span class="line">    <span class="keyword">while</span> (now_time() &lt; <span class="number">0.85</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (!match[i])</span><br><span class="line">                fill(vis + <span class="number">1</span>, vis + n + <span class="number">1</span>, <span class="number">0</span>), ans += do_match(i, g_f), <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    <span class="keyword">return</span> debug(match, <span class="number">1</span>, n), <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ¥å‘ç°â€¦uojå¡æ—¶å¡åˆ° $0.8ms$ ä¹Ÿæ˜¯èƒ½è¿‡çš„ã€‚è¿™å¤§æ¦‚å°±æ˜¯çœ‹è„¸äº†å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­¦äº†ä¸€å‘å¸¦èŠ±æ ‘ï¼Œæ„Ÿè§‰å¾ˆé«˜å¦™ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åé¡ºä¾¿å¤ä¹ äº†ä¸€ä¸‹äºŒåˆ†å›¾åŒ¹é…andå­¦äº†ä¸€ä¸‹éšæœºåŒ¹é…ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ¼ğŸŒ²ï¼šBlossom Tree.&lt;/p&gt;
    
    </summary>
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="å¸¦èŠ±æ ‘" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%B8%A6%E8%8A%B1%E6%A0%91/"/>
    
    
      <category term="æ€ç»´é¢˜/éšæœºåŒ–" scheme="https://www.orchidany.cn/tags/%E6%80%9D%E7%BB%B4%E9%A2%98-%E9%9A%8F%E6%9C%BA%E5%8C%96/"/>
    
      <category term="å›¾è®º/äºŒåˆ†å›¾" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="å›¾è®º/åŒ¹é…/å¸¦èŠ±æ ‘" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D-%E5%B8%A6%E8%8A%B1%E6%A0%91/"/>
    
      <category term="å›¾è®º/åŒ¹é…" scheme="https://www.orchidany.cn/tags/%E5%9B%BE%E8%AE%BA-%E5%8C%B9%E9%85%8D/"/>
    
  </entry>
  
  <entry>
    <title>ã€å¤ä¹ ã€‘æ¦‚ç‡æœŸæœ›åšé¢˜ç¬”è®°</title>
    <link href="https://www.orchidany.cn/2020/05/06/%E6%9C%9F%E6%9C%9B/"/>
    <id>https://www.orchidany.cn/2020/05/06/æœŸæœ›/</id>
    <published>2020-05-06T09:26:20.000Z</published>
    <updated>2020-05-09T07:24:42.878Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>èƒ¡åšå…«åšäº†ä¸€ç‚¹ç®€å•çš„æœŸæœ›é¢˜ï¼Œç®—æ˜¯ç»ƒç»ƒæ‰‹æ„Ÿå§ã€‚</p><p>ä¸€å…±æ˜¯ $15$ é“é¢˜ã€‚</p><a id="more"></a><h1 id="ä¸å¤ªéœ€è¦æŠ€å·§çš„ä¾‹é¢˜"><a href="#ä¸å¤ªéœ€è¦æŠ€å·§çš„ä¾‹é¢˜" class="headerlink" title="ä¸å¤ªéœ€è¦æŠ€å·§çš„ä¾‹é¢˜"></a>ä¸å¤ªéœ€è¦æŠ€å·§çš„ä¾‹é¢˜</h1><h2 id="Luogu3802-å°é­”å¥³å¸•çª"><a href="#Luogu3802-å°é­”å¥³å¸•çª" class="headerlink" title="Luogu3802 å°é­”å¥³å¸•çª"></a><a href="https://www.luogu.org/problem/P3802" target="_blank" rel="noopener">Luogu3802 å°é­”å¥³å¸•çª</a></h2><p>è¿™ä¸œè¥¿æˆ‘ç¡¬æ¨æ¨å‡ºæ¥ä¸€ä¸ªï¼š</p><script type="math/tex; mode=display">\dfrac{\left(\begin{array}{c}{\mathrm{S}-6} \\ {1}\end{array}\right) \cdot 7 ! \cdot \prod_{\mathrm{i}=1}^{7} \mathrm{a}_{\mathrm{i}} \cdot(\mathrm{S}-7) !}{\mathrm{S} !}</script><p>çš„ä¸œè¥¿ã€‚æ„Ÿè§‰è¿˜å¯ä»¥ï¼Ÿç„¶åå…¶å®å°±æ˜¯ä¸€ç§æ€æƒ³ï¼Ÿæ­¤æ—¶æ€»æ–¹æ¡ˆæ•°$\rm S$è¿™ä¸œè¥¿ä¸åº”è¯¥é™¤ä»¥æŸäº›å¥‡æ€ªçš„é˜¶ä¹˜ï¼Œæˆ–è€…è¯´ï¼Œä¸éœ€è¦ï¼Œå› ä¸ºæ ·æœ¬ç©ºé—´å¯ä»¥ç†è§£ä¸ºå…ˆå‘ç”Ÿäº†$A$å’Œå‘ç”Ÿäº†$B$è™½ç„¶å±€é¢ä¸€æ ·ä½†æ˜¯æ¦‚ç‡ç‹¬ç«‹ï¼ˆå¤§æ¦‚</p><h2 id="Luogu5489-LnOI2019-è„¸æ»šé”®ç›˜"><a href="#Luogu5489-LnOI2019-è„¸æ»šé”®ç›˜" class="headerlink" title="Luogu5489 [LnOI2019]è„¸æ»šé”®ç›˜"></a><a href="https://www.luogu.org/problem/P5498" target="_blank" rel="noopener">Luogu5489 [LnOI2019]è„¸æ»šé”®ç›˜</a></h2><p>è¿™é¢˜å†™è¿‡é¢˜è§£ï¼Œç°åœ¨å¤ä¹ ä¸€éã€‚å¤§æ¦‚å°±æ˜¯è€ƒè™‘ç»´æŠ¤ä¸€ä¸ªå‰ç¼€å’Œï¼Œæ„é€ æ•°åˆ—</p><script type="math/tex; mode=display">\rm F_i=F_{i-1}\cdot base_i+base_i</script><p>ç„¶åæˆ‘ä»¬å‘ç°å®ƒçš„çº§æ•°å¾ˆç¾å¦™ï¼š</p><script type="math/tex; mode=display">{\sum_{i=1}^{n}F_i=base_1+base_2\cdots+base_n+base_1base_2+base_2base_3\cdots+\prod_{i=1}^{n}base_i}</script><p>æ­£å¥½å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ç­”æ¡ˆã€‚</p><p>ä½†æ­¤æ—¶ç›´æ¥å‰ç¼€å’Œä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå¤šä½™çš„å®é™…ä¸Šæ˜¯$a_0\cdots a_n$é‚£ä¸€å †é¡¹ï¼Œæ‰€ä»¥éœ€è¦åƒå“ˆå¸Œä¸€æ ·å·¦åŠè¾¹ä¹˜ä¸Š</p><script type="math/tex; mode=display">\prod_{i=1}^{r}base_i+\prod_{i=1}^{r-1}base_i+\cdots +\prod_{i=1}^{l}base_i</script><h2 id="Luogu1297-å›½å®¶é›†è®­é˜Ÿ-å•é€‰é”™ä½"><a href="#Luogu1297-å›½å®¶é›†è®­é˜Ÿ-å•é€‰é”™ä½" class="headerlink" title="Luogu1297 [å›½å®¶é›†è®­é˜Ÿ]å•é€‰é”™ä½"></a><a href="https://www.luogu.org/problem/P1297" target="_blank" rel="noopener">Luogu1297 [å›½å®¶é›†è®­é˜Ÿ]å•é€‰é”™ä½</a></h2><p>ç„¶åå…¶å®ï¼Œ$\rm E_S=\mathbb{E}(1)+\mathbb{E}(2)+\mathbb{E}(3)\cdots$ </p><p>è§‚å¯Ÿ $ \mathbb{E}(i)$ï¼Œå®é™…ä¸Šåªä¸ $ base_i,base_{i+1}$ æœ‰å…³ï¼Œé‚£ä¹ˆæ¯ä¸€é¡¹çš„è´¡çŒ®å°±æ˜¯ $\dfrac{1}{\max(base_i,base_{i+1})}$ã€‚åŠ èµ·æ¥å³å¯ã€‚</p><h2 id="Luogu3924-åº·å¨œçš„çº¿æ®µæ ‘"><a href="#Luogu3924-åº·å¨œçš„çº¿æ®µæ ‘" class="headerlink" title="Luogu3924 åº·å¨œçš„çº¿æ®µæ ‘"></a><a href="https://www.luogu.org/problem/P3924#submit" target="_blank" rel="noopener">Luogu3924 åº·å¨œçš„çº¿æ®µæ ‘</a></h2><blockquote><p>æ¯æ¬¡åœ¨çº¿æ®µæ ‘åŒºé—´åŠ æ“ä½œåšå®Œåï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ç­‰æ¦‚ç‡çš„é€‰æ‹©ä¸€ä¸ªå­èŠ‚ç‚¹è¿›å…¥ï¼Œç›´åˆ°è¿›å…¥å¶å­ç»“ç‚¹ä¸ºæ­¢ï¼Œå°†ä¸€è·¯ç»è¿‡çš„èŠ‚ç‚¹æƒå€¼ç´¯åŠ ï¼Œæœ€åèƒ½å¾—åˆ°çš„æœŸæœ›å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>æ­¤å¤„çš„åŒºé—´åŠ æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segment_Tree</span>&#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson (o&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson (o&lt;&lt;1|1)</span></span><br><span class="line"> <span class="keyword">int</span> sumv[N&lt;&lt;<span class="number">2</span>],minv[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"> <span class="keyword">inline</span> <span class="keyword">void</span> pushu\Pr(<span class="keyword">int</span> o)&#123;sumv[o]=sumv[lson]+sumv[rson];&#125;</span><br><span class="line"> <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(l==r)&#123;sumv[o]=a[l];<span class="keyword">return</span>;&#125;</span><br><span class="line">     <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">     build(lson,l,mid);build(rson,mid+<span class="number">1</span>,r);</span><br><span class="line">     pushu\Pr(o);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> o,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> q,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(l==r)&#123;sumv[o]+=v;<span class="keyword">return</span>;&#125;</span><br><span class="line">     <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">     <span class="keyword">if</span>(q&lt;=mid)change(lson,l,mid,q,v);</span><br><span class="line">     <span class="keyword">else</span> change(rson,mid+<span class="number">1</span>,r,q,v);</span><br><span class="line">     pushu\Pr(o);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;T; </span><br><span class="line"><span class="comment">//åŒºé—´åŠ </span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=r;i++)T.change(<span class="number">1</span>,<span class="number">1</span>,n,i,addv);</span><br></pre></td></tr></table></figure><p>$1\leq n,m\leq 10^6$ ã€‚</p></blockquote><p>æ ¹æ®çº¿æ€§æ€§æ˜¾ç„¶å¯ä»¥çŸ¥é“ç»´æŠ¤çš„å°±æ˜¯</p><script type="math/tex; mode=display">\sum_{i=1}^{n}\dfrac{val_i}{2^{depth_i}}</script><p>å…¶ä¸­æ ¹èŠ‚ç‚¹çš„ $depth$ é»˜è®¤ä¸º $0$ ã€‚è€ƒè™‘å…ˆæŠŠè¿™ä¸ªå¼å­é€šåˆ†ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">\sum_{i=1}^{n}\dfrac{val_i\cdot 2^{maxL-depth_i}}{2^{maxL}}=\dfrac{1}{2^{maxL}}\sum_{i=1}^{n}val_i\cdot 2^{maxL-depth_i}</script><p>ç„¶åè€ƒè™‘ï¼Œå¦‚æœæ˜¯åŒºé—´ä¿®æ”¹ï¼Œé‚£ä¹ˆæœ¬è´¨ä¸Šåªéœ€è¦æ±‚å‡ºåŒºé—´å†…æ‰€æœ‰ç‚¹çš„çº¿æ®µæ ‘ä¸Šå­æ ‘å†…ç³»æ•° $2^{maxL-depth_i}$ çš„å’Œã€‚è¿™ä¸€éƒ¨åˆ†å¯ä»¥ç›´æ¥é¢„å¤„ç†å¾—åˆ°ã€‚å¹¶ä¸”è€ƒè™‘åªæœ‰åŒºé—´åŠ çš„æ“ä½œï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦çœŸæ­£åŠ¨æ€åœ°å»ç»´æŠ¤ã€‚ç›´æ¥ç»´æŠ¤ä¸€ä¸ªå…¨å±€ $ans$ å³å¯ã€‚</p><p>äºæ˜¯æœ€åå¤æ‚åº¦çº¿æ€§ã€‚</p><h1 id="è€ƒå¯ŸæœŸæœ›çº¿æ€§æ€§çš„é¢˜ç›®"><a href="#è€ƒå¯ŸæœŸæœ›çº¿æ€§æ€§çš„é¢˜ç›®" class="headerlink" title="è€ƒå¯ŸæœŸæœ›çº¿æ€§æ€§çš„é¢˜ç›®"></a>è€ƒå¯ŸæœŸæœ›çº¿æ€§æ€§çš„é¢˜ç›®</h1><h2 id="ZROI-1142-çŸ³å­"><a href="#ZROI-1142-çŸ³å­" class="headerlink" title="[ZROI 1142]çŸ³å­"></a>[ZROI 1142]çŸ³å­</h2><blockquote><p>å° D æ­£åœ¨ç©å–çŸ³å­æ¸¸æˆã€‚ å° D å…±æœ‰ $n$ å †çŸ³å­ï¼Œä¾æ¬¡ç¼–å·ä¸º $1, 2, Â· Â· Â· , n$ï¼Œå…¶ä¸­ç¬¬ $i$ å †æœ‰ $a_i$ é¢—çŸ³å­ã€‚ å° D æ¯æ¬¡ä¼šç­‰æ¦‚ç‡éšæœºé€‰æ‹©ä¸€é¢—çŸ³å­ï¼Œå¹¶å–å®Œå®ƒæ‰€åœ¨çš„é‚£ä¸€å †çŸ³å­ã€‚ å° D æƒ³è¦çŸ¥é“ï¼Œç¬¬ $1$ å †çŸ³å­è¢«å–èµ°çš„æ—¶é—´çš„æœŸæœ›ã€‚</p><p>$n=10^6$ã€‚</p></blockquote><p>æ ¹æ®æœŸæœ›çš„çº¿æ€§æ€§ï¼Œå¯ä»¥çŸ¥é“å¯ä»¥åˆ†åˆ«ç®—æ¯å †çŸ³å­åœ¨ç¬¬ $1$ å †ä¹‹å‰è¢«å–å®Œçš„æ¦‚ç‡ã€‚æ‰€ä»¥å°±æ˜¯</p><script type="math/tex; mode=display">\mathbb{E}(t)=P_{2}+P_{3}+\cdots+P_{n}+1</script><p>äºæ˜¯ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N ; <span class="keyword">int</span> i ; ans = <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) <span class="built_in">cin</span> &gt;&gt; base[i] ; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">2</span> ; i &lt;= N ; ++ i) </span><br><span class="line">ans += (<span class="keyword">double</span>)base[i] / (<span class="keyword">double</span>)(base[i] + base[<span class="number">1</span>]) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%.9lf"</span>, ans) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BZOJ3036-ç»¿è±†è›™çš„å½’å®¿"><a href="#BZOJ3036-ç»¿è±†è›™çš„å½’å®¿" class="headerlink" title="[BZOJ3036]ç»¿è±†è›™çš„å½’å®¿"></a>[BZOJ3036]ç»¿è±†è›™çš„å½’å®¿</h2><blockquote><p>ç»™å‡º $n$ ä¸ªç‚¹ $m$ æ¡è¾¹çš„æœ‰å‘æ— ç¯å›¾ï¼Œèµ·ç‚¹ä¸º $1$ï¼Œç»ˆç‚¹ä¸º $n$ï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªé•¿åº¦ï¼Œå¹¶ä¸”ä»èµ·ç‚¹å‡ºå‘èƒ½å¤Ÿåˆ°è¾¾æ‰€æœ‰çš„ç‚¹ï¼Œæ‰€æœ‰çš„ç‚¹ä¹Ÿéƒ½èƒ½å¤Ÿåˆ°è¾¾ç»ˆç‚¹ã€‚</p><p>ç»¿è±†è›™ä»èµ·ç‚¹å‡ºå‘ï¼Œèµ°å‘ç»ˆç‚¹ã€‚ åˆ°è¾¾æ¯ä¸€ä¸ªé¡¶ç‚¹æ—¶ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æœ‰ $k$ æ¡å‡ºè¾¹ï¼Œç»¿è±†è›™å¯ä»¥é€‰æ‹©ä»»æ„ä¸€æ¡è¾¹ç¦»å¼€è¯¥ç‚¹ï¼Œå¹¶ä¸”èµ°å‘æ¯æ¡è¾¹çš„æ¦‚ç‡ä¸º $\dfrac{1}{k}$ ã€‚ç°åœ¨ç»¿è±†è›™æƒ³çŸ¥é“ï¼Œä»èµ·ç‚¹èµ°åˆ°ç»ˆç‚¹çš„æ‰€ç»è¿‡çš„è·¯å¾„æ€»é•¿åº¦æœŸæœ›æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><p>å‘ç°è·¯å¾„å¯ä»¥æ‹†åˆ†ï¼Œäºæ˜¯æ ¹æ®æœŸæœ›çš„çº¿æ€§æ€§æœ‰</p><script type="math/tex; mode=display">\mathbb{E}(L)=\sum_{e=(u,v)}\mathbb{E}(e) = \sum_{e=(u,v)}\Pr(e)\cdot val(e)</script><p>äºæ˜¯ <code>dfs</code> ä¸€éå³å¯ã€‚</p><h2 id="CF280C-Game-On-Tree"><a href="#CF280C-Game-On-Tree" class="headerlink" title="CF280C Game On Tree"></a>CF280C Game On Tree</h2><blockquote><p>ç»™å‡ºä¸€æ£µæ ‘ï¼Œæ¯æ¬¡éšæœºç­‰æ¦‚ç‡é€‰æ‹©ä¸€æœªæŸ“é»‘çš„ç‚¹ï¼Œå°†å®ƒåŠå…¶å­æ ‘æŸ“é»‘ã€‚é—®æœŸæœ›å¤šå°‘æ¬¡æ“ä½œå¯ä»¥å°†æ ‘å…¨éƒ¨æŸ“é»‘ã€‚</p><p>$1\leq n\leq 10^5$ .</p></blockquote><p>è‰ï¼Œæˆ‘å±…ç„¶èƒ½æŠŠè¿™é¢˜ç»™ç§’æ‰ï¼Œå¤ªå¯æ€•äº†ã€‚</p><p>è€ƒè™‘é¦–å…ˆæ˜¯æœŸæœ›çš„çº¿æ€§å˜›ï¼Œäºæ˜¯å¯ä»¥çŸ¥é“ $\mathbb{E}(T)$ è¡¨ç¤ºæŠŠæ ‘ $T$ å…¨éƒ¨æŸ“é»‘çš„æœŸæœ›æ¬¡æ•°ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“æœ‰</p><script type="math/tex; mode=display">\mathbb{E}(T)=\sum_{u\in T} \mathbb{E}(u)</script><p>å…¶ä¸­ $u$ æ˜¯é‚£ä¹ˆè€ƒè™‘å¦‚æœæƒ³è¦æŸ“é»‘ä¸€æ£µä»¥ $u$ ä¸ºæ ¹çš„å­æ ‘ï¼Œå¯ä»¥é‡‡ç”¨çš„ç­–ç•¥æ˜¯æŠŠå®ƒåˆ°æ ¹çš„è·¯å¾„ä¸Šä»»æ„ä¸€ç‚¹æŸ“é»‘ï¼Œä½†æ˜¯åªæœ‰åœ¨æŸ“é»‘ä»–è‡ªå·±çš„æ—¶å€™æ‰ä¼šå¯¹ç­”æ¡ˆäº§ç”Ÿè´¡çŒ®ã€‚æ‰€ä»¥ä¸éš¾çŸ¥é“</p><script type="math/tex; mode=display">\mathbb{E}(u)=\dfrac{1}{depth_u}</script><h1 id="è€ƒå¯Ÿè½¬ç§»é€’æ¨æ€æƒ³çš„æœŸæœ›é¢˜ç›®"><a href="#è€ƒå¯Ÿè½¬ç§»é€’æ¨æ€æƒ³çš„æœŸæœ›é¢˜ç›®" class="headerlink" title="è€ƒå¯Ÿè½¬ç§»é€’æ¨æ€æƒ³çš„æœŸæœ›é¢˜ç›®"></a>è€ƒå¯Ÿè½¬ç§»é€’æ¨æ€æƒ³çš„æœŸæœ›é¢˜ç›®</h1><h2 id="NOI2005-èªèªä¸å¯å¯"><a href="#NOI2005-èªèªä¸å¯å¯" class="headerlink" title="[NOI2005]èªèªä¸å¯å¯"></a>[NOI2005]èªèªä¸å¯å¯</h2><blockquote><p>ç»™å®šä¸€å¼  $n,m$ çš„æ— å‘å›¾ã€‚ä¸¤ä¸ªäººä¸€å¼€å§‹åˆ†åˆ«åœ¨ç‚¹ $A,B$ã€‚æ¯æ¬¡ $A$ å…ˆèµ°ï¼Œ$B$ åèµ°ï¼Œ$A$ æ¯æ¬¡ä¼šé€‰æ‹©ä¸€ä¸ªç¦» $B$ æœ€è¿‘ä¸”ç¼–å·æœ€å°çš„ç‚¹èµ° $1\sim2$ æ­¥ï¼Œ$B$ éšæœºæ¸¸èµ°(ä¹Ÿå¯åœåœ¨åŸåœ°ï¼Œæ¦‚ç‡å¹³æ‘Š)ï¼Œæ±‚æœŸæœ›å¤šå°‘æ­¥ $A$ å¯ä»¥ä¸ $B$  ç›¸é‡ã€‚</p><p>$1 \leq N, E \leq 1000$ã€‚</p></blockquote><p>emmm è¦æ˜¯åŒ–å½’å­é—®é¢˜çš„è¯ï¼Œä¸€å¼€å§‹è§‰å¾—åº”è¯¥ç®—å‡ºåœ¨æ¯ä¸ªç‚¹ç›¸é‡çš„æœŸæœ›æ­¥æ•°ï¼Œä½†æƒ³äº†æƒ³è§‰å¾—è¿™ä¸ªå¹¶ä¸å¯åšâ€¦</p><p>äºæ˜¯è€ƒè™‘æ›´æš´åŠ›ä¸€ç‚¹åŒ–å½’å­é—®é¢˜ï¼š $f_{u,v}$ è¡¨ç¤º $A$ åœ¨ $u$ï¼Œ$B$ åœ¨ $v$ æ—¶ä¸¤è€…ç›¸é‡çš„æœŸæœ›æ­¥æ•°ã€‚é‚£ä¹ˆè€ƒè™‘è½¬ç§»ï¼š</p><p>1ã€$u=v$ ï¼Œ$f_{u,v}=0$ ã€‚</p><p>2ã€$dis(u,v)=1$ï¼Œ$f_{u,v}=1$ ï¼ˆå› ä¸º $A$ å…ˆèµ°ï¼‰ã€‚</p><p>3ã€$dis(u,v)&gt;1$ï¼Œ$f_{u,v}=\dfrac{\sum{f_{uâ€™,vâ€™}}}{\deg(v)+1}$ ï¼Œå…¶ä¸­ $uâ€™$ æ˜¯ $u$ èµ°ä¸¤æ­¥å¯ä»¥åˆ°è¾¾çš„ç¦» $v$ æœ€è¿‘çš„ä¸€ä¸ªç‚¹ï¼Œ$v$ æ˜¯éšä¾¿ä¸€ä¸ªç‚¹ã€‚</p><p>ç„¶åå°±å¯ä»¥è®°æœäº†ã€‚æˆ‘å…¶å®å¾ˆè¿·æƒ‘ä¸ºä»€ä¹ˆå…¨å‘˜æœ€çŸ­è·¯çš„é¢˜è¦å‡º $1e3$ â€¦é™¤äº†å¼ºè¡Œä¸°å¯Œä»£ç éš¾åº¦ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰å—â€¦</p><p>æ³¨æ„å®ç°çš„ä¸€ç‚¹å°ç»†èŠ‚ã€‚å¦‚æœ $x$ èµ°ä¸¤æ­¥å°±å¯ä»¥èµ°åˆ° $y$ï¼Œæ­¤æ—¶åº”è¯¥ç›´æ¥ <code>return 1.0</code> ï¼Œå› ä¸º $B$ æ ¹æœ¬æ²¡æœ‰èµ°çš„æœºä¼šã€‚</p><h2 id="LuoguP1365-OSU-Easy-Version"><a href="#LuoguP1365-OSU-Easy-Version" class="headerlink" title="[LuoguP1365]OSU!(Easy Version)"></a>[LuoguP1365]OSU!(Easy Version)</h2><blockquote><p>ç»™å®šä¸€ä¸ªåºåˆ—ï¼ŒæŸäº›ä½ç½®æ˜¯ $0$ï¼ŒæŸäº›ä½ç½®æ˜¯ $1$ ï¼ŒæŸäº›ä½ç½®åˆ†åˆ«æœ‰ $50\%$ çš„æ¦‚ç‡å˜æˆ $0$ æˆ–è€… $1$ ã€‚æ±‚æå¤§è¿ç»­çº¯ $1$ æ®µçš„é•¿åº¦çš„å¹³æ–¹ä¹‹å’Œçš„æœŸæœ›ã€‚</p><p>$1\leq n\leq 10^6$ ã€‚</p></blockquote><p>è€ƒè™‘åˆ†åˆ«è®° $f_i,g_i$ è¡¨ç¤ºæ€»æœŸæœ›/å½“å‰æ®µçš„æœŸæœ›ã€‚é‚£ä¹ˆå¯ä»¥åˆ†ç±»è®¨è®º $i$ çš„ç±»å‹ï¼š</p><p>1ã€$a_i=1,g_i=g_{i-1}+1,f_{i}=f_{i-1}+2\cdot g_{i-1}+1$ ã€‚</p><p>2ã€$a_i=0,g_i=0,f_{i}=f_{i-1}$ ã€‚</p><p>3ã€$a_i=?,g_{i}=g_{i-1}+0.5,f_{i}=f_{i-1}+g_{i-1}+0.5$ ã€‚</p><p>è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æ³¨æ„ä¸€ä¸ªç‚¹å³å¯ï¼Œæ ¹æ®æœŸæœ›çš„çº¿æ€§æ€§ï¼Œå¦‚æœæŒ‰ç…§ã€Œå‰ $i$ ä¸ªã€ä½œä¸ºåˆ’åˆ†é˜¶æ®µçš„ä¾æ®ï¼Œéœ€è¦æŠŠä¸€ä¸ªæé•¿è¿ç»­ $1$ æ®µçš„è´¡çŒ®æ‘Šåˆ°æ¯ä¸ªå…ƒç´ ä¸Šé¢ï¼Œæ‘Šçš„æ–¹æ³•å°±æ˜¯å¹³æ–¹å’Œå…¬å¼ã€‚</p><h2 id="BZOJ4318-OSU-Hard-Version"><a href="#BZOJ4318-OSU-Hard-Version" class="headerlink" title="[BZOJ4318]OSU!(Hard Version)"></a>[BZOJ4318]OSU!(Hard Version)</h2><blockquote><p>æˆ‘ä»¬å¯ä»¥æŠŠosuçš„è§„åˆ™ç®€åŒ–ä¸æ”¹ç¼–æˆä»¥ä¸‹çš„æ ·å­:</p><p>ä¸€å…±æœ‰ $n$ æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œåªæœ‰æˆåŠŸä¸å¤±è´¥ä¹‹åˆ†ï¼ŒæˆåŠŸå¯¹åº”1ï¼Œå¤±è´¥å¯¹åº”0ï¼Œ$n$ æ¬¡æ“ä½œå¯¹åº”ä¸ºé•¿åº¦ä¸º $n$ çš„<code>01</code> ä¸²ã€‚åœ¨è¿™ä¸ªä¸²ä¸­è¿ç»­çš„ $X$ ä¸ª 1 å¯ä»¥è´¡çŒ® $X^3$ çš„åˆ†æ•°ï¼Œè¿™ $X$ ä¸ª $1$ ä¸èƒ½è¢«å…¶ä»–è¿ç»­çš„ $1$ æ‰€åŒ…å«ï¼ˆä¹Ÿå°±æ˜¯æé•¿çš„ä¸€ä¸²1ï¼‰</p><p>ç°åœ¨ç»™å‡º $n$ï¼Œä»¥åŠæ¯ä¸ªæ“ä½œçš„æˆåŠŸç‡ï¼Œè¯·ä½ è¾“å‡ºæœŸæœ›åˆ†æ•°ã€‚</p><p>$1\leq n\leq 10^6$ ã€‚</p></blockquote><p>è·Ÿä¸Šä¸€é¢˜ååˆ†æ¥è¿‘çš„æ€è·¯ã€‚ä½†æ˜¯è€ƒè™‘ç«‹æ–¹å’Œå…¬å¼ $(x+1)^3=x^3+3x^2+3x+1$ ï¼Œç”±äº $\mathbb{E}^2(x)\neq \mathbb{E}(x^2)$ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ‹¿çº¿æ€§æ€§æ‹†ã€‚äºæ˜¯è€ƒè™‘åˆ†åˆ«ç»´æŠ¤æé•¿æ®µçš„å¹³æ–¹å’Œå’Œé•¿åº¦å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line">g[i] = (g[i - <span class="number">1</span>] + <span class="number">1</span>) * base[i], </span><br><span class="line">p[i] = (p[i - <span class="number">1</span>] + <span class="number">2</span> * g[i - <span class="number">1</span>] + <span class="number">1</span>) * base[i],</span><br><span class="line">f[i] = f[i - <span class="number">1</span>] + base[i] *  (<span class="number">3</span> * p[i - <span class="number">1</span>] + <span class="number">3</span> * g[i - <span class="number">1</span>] + <span class="number">1</span>) ;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="Luogu4550-æ”¶é›†é‚®ç¥¨"><a href="#Luogu4550-æ”¶é›†é‚®ç¥¨" class="headerlink" title="[Luogu4550]æ”¶é›†é‚®ç¥¨"></a>[Luogu4550]æ”¶é›†é‚®ç¥¨</h2><blockquote><p>æœ‰ $n$ ç§ä¸åŒçš„é‚®ç¥¨ï¼Œçš®çš®æƒ³æ”¶é›†æ‰€æœ‰ç§ç±»çš„é‚®ç¥¨ã€‚å”¯ä¸€çš„æ”¶é›†æ–¹æ³•æ˜¯åˆ°åŒå­¦å‡¡å‡¡é‚£é‡Œè´­ä¹°ï¼Œæ¯æ¬¡åªèƒ½ä¹°ä¸€å¼ ï¼Œå¹¶ä¸”ä¹°åˆ°çš„é‚®ç¥¨ç©¶ç«Ÿæ˜¯ $n$ ç§é‚®ç¥¨ä¸­çš„å“ªä¸€ç§æ˜¯ç­‰æ¦‚ç‡çš„ï¼Œæ¦‚ç‡å‡ä¸º $\dfrac{1}{n}$ã€‚ä½†æ˜¯ç”±äºå‡¡å‡¡ä¹Ÿå¾ˆå–œæ¬¢é‚®ç¥¨ï¼Œæ‰€ä»¥çš®çš®è´­ä¹°ç¬¬ $k$ å¼ é‚®ç¥¨éœ€è¦æ”¯ä»˜ $k$ å…ƒé’±ã€‚</p><p>ç°åœ¨çš®çš®æ‰‹ä¸­æ²¡æœ‰é‚®ç¥¨ï¼Œçš®çš®æƒ³çŸ¥é“è‡ªå·±å¾—åˆ°æ‰€æœ‰ç§ç±»çš„é‚®ç¥¨éœ€è¦èŠ±è´¹çš„é’±æ•°ç›®çš„æœŸæœ›ã€‚</p><p>$1\leq n\leq 10^6$ ã€‚</p></blockquote><p>é¦–å…ˆè€ƒè™‘ä¸€ä¸ªç®€åŒ–ç‰ˆé—®é¢˜ï¼š</p><blockquote><p>æ¯æ¬¡éšæœºä¸€ä¸ª$[1,n]$çš„æ•´æ•°ï¼Œé—®æœŸæœ›å‡ æ¬¡èƒ½å‡‘å‡ºæ‰€æœ‰æ•° </p></blockquote><p>è€ƒè™‘æœŸæœ›çš„çº¿æ€§æ€§ï¼Œå°±æ˜¯ $\mathbb{E}=\sum \mathbb{E}(i)$ï¼Œå…¶ä¸­ $\mathbb{E}$ ä¸ºæ‰€æ±‚ï¼Œ$\mathbb{E}(i)$ ä¸ºåœ¨å·²ç»å–å‡º $i-1$ ä¸ªæ•°å­—æ—¶ï¼Œå–åˆ°ç¬¬ $i$ ä¸ªæ•°å­—çš„æœŸæœ›æ¬¡æ•°ã€‚æ ¹æ®ä¹‹å‰æ•´ç†è¿‡çš„å†…å®¹ï¼Œâ€œå‘ç”Ÿæ¦‚ç‡ä¸º $p$ çš„äº‹ä»¶ï¼Œåœ¨æœŸæœ› $\dfrac{1}{p}$ æ¬¡ä¹‹åä¼šå‘ç”Ÿâ€ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\Pr(i)& =\dfrac{n-(i-1)}{n} \\\mathbb{E}(i)& =\dfrac{1}{\Pr(i)}=\dfrac{n}{n-i+1}\end{aligned}</script><p>ç„¶åæŠŠä»–ä»¬åŠ èµ·æ¥å°±æ˜¯</p><script type="math/tex; mode=display">\mathbb{E}(X)=\sum\dfrac{n}{n-i+1}=\sum\dfrac{n}{i}</script><p>æ€è·¯æ˜¯è‡ªç„¶çš„ã€‚ç„¶åè€ƒè™‘æœ¬é¢˜ï¼Œéœ€è¦ç»™æ¯æ¬¡æ“ä½œé™„åŠ ä¸€ä¸ªæƒå€¼ã€‚æ‰€ä»¥æœ¬è´¨ä¸Šæˆ‘ä»¬å¯ä»¥åˆ†å¼€è®¡ç®—ï¼Œ$g_i$è¡¨ç¤ºå·²ç»å–å‡º $i-1$ ä¸ªæ•°å­—æ—¶ï¼Œå–åˆ°ç¬¬ $i$ ä¸ªæ•°å­—çš„æœŸæœ›æ­¥æ•°ï¼Œ$ f_i$è¡¨ç¤ºæœŸæœ›æ­¥æ•°çš„<code>cost</code>ã€‚</p><p>è€ƒè™‘å¦‚ä½•è®¡ç®— $f_i$ã€‚å‡è®¾ä¹‹å‰æ‹¿æ•°è¿›è¡Œäº† $p$ æ¬¡æ“ä½œï¼Œè¿™ä¸€æ¬¡æ‹¿ $i$ éœ€è¦ $q$ æ¬¡æ“ä½œï¼Œé‚£ä¹ˆè¿™ $q$ æ¬¡æ“ä½œçš„ $\rm \sum cost$ å°±æ˜¯</p><script type="math/tex; mode=display">p\cdot q+q^2=(p+q)\cdot q</script><p>è¿™ä¸ªåŸç†éœ€è¦ç¼–ä¸€ä¸‹ã€‚è€ƒè™‘å‰ä¸€åŠæ˜¯ä¹‹å‰æ‹¿æ•°æ¬¡æ•°ä¸å½“å‰æ‹¿æ•°æ¬¡æ•°çš„ä¹˜ç§¯ï¼Œå¯ä»¥çŸ¥é“æ­¤æ—¶çš„ä»£ä»·è‡³å°‘æ˜¯è¿™äº›ï¼›åä¸€åŠåœ¨ä¸è€ƒè™‘å‰é¢æ‹¿æ•°çš„è´¡çŒ®åï¼Œå¯ä»¥è€ƒè™‘æœŸæœ›çš„æ„ä¹‰ï¼Œ$q$ æ—¢æ˜¯æœŸæœ›æ¬¡æ•°ï¼Œä¹Ÿæ˜¯å¹³å‡ä»£ä»·ï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“å½“å‰çš„ä»£ä»·åº”è¯¥æ˜¯ $q^2$ ã€‚</p><p>ç„¶åå°±é€’æ¨ä¸€ä¸‹å³å¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i)&#123;</span><br><span class="line">n = <span class="number">1.0</span> * N / (N - i + <span class="number">1</span>), </span><br><span class="line">g[i] = g[i - <span class="number">1</span>] + n, f[i] = f[i - <span class="number">1</span>] + g[i] * n ;</span><br><span class="line"> &#125; </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%.2f"</span>, f[N])  ;</span><br></pre></td></tr></table></figure><h2 id="SHOI2014-æ¦‚ç‡å……ç”µå™¨"><a href="#SHOI2014-æ¦‚ç‡å……ç”µå™¨" class="headerlink" title="*[SHOI2014]æ¦‚ç‡å……ç”µå™¨"></a>*[SHOI2014]æ¦‚ç‡å……ç”µå™¨</h2><blockquote><p>SHOI æ¦‚ç‡å……ç”µå™¨ç”± $n-1$ æ¡å¯¼çº¿è¿é€šäº† $n$ ä¸ªå……ç”µå…ƒä»¶ã€‚è¿›è¡Œå……ç”µæ—¶ï¼Œæ¯æ¡å¯¼çº¿æ˜¯å¦å¯ä»¥å¯¼ç”µä»¥æ¦‚ç‡å†³å®š(æ¯æ¡è¾¹æœ‰ä¸€ä¸ªé€šç”µæ¦‚ç‡)ï¼Œæ¯ä¸€ä¸ªå……ç”µå…ƒä»¶è‡ªèº«æ˜¯å¦ç›´æ¥è¿›è¡Œå……ç”µä¹Ÿç”±æ¦‚ç‡å†³å®š(æ¯ä¸ªç‚¹ä¹Ÿæœ‰ä¸€ä¸ªé€šç”µæ¦‚ç‡)ã€‚éšåç”µèƒ½å¯ä»¥ä»ç›´æ¥å……ç”µçš„å…ƒä»¶ç»è¿‡é€šç”µçš„å¯¼çº¿ä½¿å¾—å…¶ä»–å……ç”µå…ƒä»¶è¿›è¡Œé—´æ¥å……ç”µã€‚</p><p>ä½ çªç„¶æƒ³çŸ¥é“ï¼Œè¿›å…¥å……ç”µçŠ¶æ€çš„å…ƒä»¶ä¸ªæ•°çš„æœŸæœ›æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>$1\leq n\leq 5\cdot 10^5$ã€‚</p></blockquote><p>æ¯”è¾ƒæœ‰éš¾åº¦çš„é¢˜ç›®ã€‚</p><p>æ ¹æ®æœŸæœ›çš„çº¿æ€§æ€§ï¼Œå¯ä»¥çŸ¥é“è¿™é¢˜åªéœ€è¦æ±‚å‡ºæ¯ä¸ªç‚¹è¢«ç‚¹äº®çš„æ¦‚ç‡å³å¯ã€‚è€ƒè™‘è®¾ $f_u$ è¡¨ç¤º $u$ çš„å­æ ‘å¯¹ $u$ çš„è´¡çŒ®ï¼Œ$g_u$ è¡¨ç¤º $u$ çœŸæ­£çš„è´¡çŒ®ã€‚ä¸éš¾çŸ¥é“ $f_u\leq g_u$ ã€‚</p><p>é‚£ä¹ˆè€ƒè™‘åˆ†åˆ«æ±‚è¿™ä¸¤éƒ¨åˆ†ã€‚é¦–å…ˆå¸¸è§„æ ‘å½¢ $dp$ æ±‚å‡º $f_{root}=g_{root}$  æ¥ï¼Œè½¬ç§»å¤§æ¦‚æ˜¯è€ƒè™‘ä¾æ¬¡æŠŠå­æ ‘åˆå¹¶è¿›æ¥ï¼š</p><script type="math/tex; mode=display">f_{u}=(1-f_u)\cdot f_v\cdot e[u,v]</script><p>ç„¶åè€ƒè™‘å¦‚ä½•å°†è´¡çŒ® $down$ ä¸‹å»ã€‚é‚£ä¹ˆè€ƒè™‘è®¾ $h_u$ è¡¨ç¤ºåªè€ƒè™‘ç¥–å…ˆçš„è´¡çŒ®æ—¶ï¼Œ$u$ äº®çš„æ¦‚ç‡ã€‚ä¸éš¾çŸ¥é“ $g_u=f_u+h_u$ ã€‚é‚£ä¹ˆè€ƒè™‘ $h$ æ€ä¹ˆæ±‚ã€‚å‘ç°ä¸€èˆ¬è¿™ç§ down å½¢æ€çš„ dp éƒ½è¦å‡å»å½“å‰å­æ ‘çš„è´¡çŒ®ã€‚æ‰€ä»¥å¯¹äº $h_v$ è€Œè¨€ï¼Œæœ‰å¦‚ä¸‹è½¬ç§»ï¼š</p><script type="math/tex; mode=display">h_v=\dfrac{(g_u-f_v\cdot e[u,v])\cdot (1-f_v)\cdot e[u,v]}{1-f_v\cdot e[u,v]}</script><p>è€ƒè™‘åˆ†å­ä¸Šæ˜¯çˆ¶äº²ä¼ åˆ°å„¿å­çš„æ¦‚ç‡ï¼Œ$h_v$ æ˜¯ä»çˆ¶äº²å¤„å¯¼ç”µçš„æ¦‚ç‡ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“å¦‚æœæƒ³è¦çˆ¶äº²ä¼ åˆ°å„¿å­ï¼Œå¿…é¡»è¦ä½¿ä¹‹äº’æ–¥ï¼Œå³éœ€è¦è®© $h_v\times \Pr(\texttt{ä¸é€šè¿‡å„¿å­ä¼ åˆ°çˆ¶äº²})=\Pr(\texttt{çˆ¶äº²ä¼ åˆ°å„¿å­})$ ï¼Œè¿™æ˜¯åˆ†æ¯çš„æ¥ç”±ã€‚</p><p>è€ƒè™‘å¦‚æœæœ¬èº«ä¸èƒ½ã€Œä¸é€šè¿‡å„¿å­ä¼ ç»™çˆ¶äº²ã€ï¼Œé‚£ä¹ˆçˆ¶äº²çš„å°±ä¸èƒ½ä¼ ç»™å„¿å­ï¼Œæ­¤æ—¶ $h_v=0$ï¼Œéœ€è¦ç‰¹åˆ¤ã€‚</p><p>å¥½ç»•å•Šå¥½ç»•å•Šâ€¦ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">dfs0</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">f[u][<span class="number">0</span>] = base[u] ; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))&#123;</span><br><span class="line"><span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ; </span><br><span class="line">dfs0(to(k), u), f[u][<span class="number">0</span>] += (<span class="number">1</span> - f[u][<span class="number">0</span>]) * val(k) * f[to(k)][<span class="number">0</span>] ; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = head[u] ; k ; k = next(k))&#123;</span><br><span class="line"><span class="keyword">if</span> (to(k) == fa) <span class="keyword">continue</span> ;</span><br><span class="line"><span class="keyword">double</span> p = f[to(k)][<span class="number">0</span>] * val(k) ; </span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">fabs</span>(<span class="number">1</span> - p) &lt;= eps) &#123;dfs1(to(k), u) ; <span class="keyword">continue</span> ;&#125;</span><br><span class="line"><span class="keyword">double</span> q = f[u][<span class="number">0</span>] + f[u][<span class="number">1</span>] - f[to(k)][<span class="number">0</span>] * val(k) ; </span><br><span class="line">f[to(k)][<span class="number">1</span>] = (<span class="number">1</span> - f[to(k)][<span class="number">0</span>]) * q / (<span class="number">1</span> - p) * val(k) ; </span><br><span class="line">dfs1(to(k), u) ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; N ; </span><br><span class="line"><span class="keyword">double</span> o ; <span class="keyword">int</span> i, u, v, w ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt; N ; ++ i) </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;u, &amp;v, &amp;w), o = w * <span class="number">0.01</span>, add(u, v, o) ;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;w), base[i] = w * <span class="number">0.01</span> ;</span><br><span class="line">dfs0(<span class="number">1</span>, <span class="number">0</span>), dfs1(<span class="number">1</span>, <span class="number">0</span>) ; </span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span> ; i &lt;= N ; ++ i) </span><br><span class="line">ans += (f[i][<span class="number">0</span>] + f[i][<span class="number">1</span>]) ;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">printf</span>(<span class="string">"%.6lf\n"</span>, ans) ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è½¬ç§»æ—¶æœ‰åæ•ˆæ€§çš„é¢˜ç›®"><a href="#è½¬ç§»æ—¶æœ‰åæ•ˆæ€§çš„é¢˜ç›®" class="headerlink" title="è½¬ç§»æ—¶æœ‰åæ•ˆæ€§çš„é¢˜ç›®"></a>è½¬ç§»æ—¶æœ‰åæ•ˆæ€§çš„é¢˜ç›®</h1><h2 id="HNOI2013-æ¸¸èµ°"><a href="#HNOI2013-æ¸¸èµ°" class="headerlink" title="[HNOI2013]æ¸¸èµ°"></a>[HNOI2013]æ¸¸èµ°</h2><blockquote><p>ä¸€ä¸ªæ— å‘è¿é€šå›¾ï¼Œé¡¶ç‚¹ä» $1$ ç¼–å·åˆ° $n$ ï¼Œè¾¹ä» $1$ ç¼–å·åˆ° $m$ã€‚</p><p>å°Zåœ¨è¯¥å›¾ä¸Šè¿›è¡Œéšæœºæ¸¸èµ°ï¼Œåˆå§‹æ—¶å°Zåœ¨ $1$ å·é¡¶ç‚¹ï¼Œæ¯ä¸€æ­¥å°Zä»¥ç›¸ç­‰çš„æ¦‚ç‡éšæœºé€‰æ‹©å½“å‰é¡¶ç‚¹çš„æŸæ¡è¾¹ï¼Œæ²¿ç€è¿™æ¡è¾¹èµ°åˆ°ä¸‹ä¸€ä¸ªé¡¶ç‚¹ï¼Œè·å¾—ç­‰äºè¿™æ¡è¾¹çš„ç¼–å·çš„åˆ†æ•°ã€‚å½“å°Zåˆ°è¾¾ $n$ å·é¡¶ç‚¹æ—¶æ¸¸èµ°ç»“æŸï¼Œæ€»åˆ†ä¸ºæ‰€æœ‰è·å¾—çš„åˆ†æ•°ä¹‹å’Œã€‚</p><p>ç°åœ¨ï¼Œè¯·ä½ å¯¹è¿™ $m$ æ¡è¾¹è¿›è¡Œç¼–å·ï¼Œä½¿å¾—å°Zè·å¾—çš„æ€»åˆ†çš„æœŸæœ›å€¼æœ€å°ã€‚</p><p>$n\leq 500,1\leq m\leq 1.2\times 10^5$ ã€‚</p></blockquote><p>é¦–å…ˆå¯ä»¥è´ªå¿ƒåœ°çŸ¥é“æœŸæœ›èµ°è¿‡æ¬¡æ•°è¶Šå¤šçš„è¾¹ï¼Œè‡ªç„¶å¸Œæœ›ä»–ç¼–å·è¶Šå°ã€‚</p><p>è€ƒè™‘ç”±ç‚¹æ¨è¾¹ã€‚å³è®¾ $f_i$ è¡¨ç¤º $i$ è¿™ä¸ªç‚¹ç»è¿‡çš„æ¬¡æ•°ã€‚é‚£ä¹ˆå¯ä»¥çŸ¥é“æœ‰</p><script type="math/tex; mode=display">f_{i}=[i=1]+\sum_{(i,j)\in\mathbb E} f_j\times \dfrac{1}{\deg_j}</script><p>äºæ˜¯å¯ä»¥é«˜æ–¯æ¶ˆå…ƒæ±‚å‡ºæ¯ä¸ª $f_i$ ã€‚ä¹‹åè€ƒè™‘ä¸€æ¡è¾¹ $(u,v)$ çš„æœŸæœ›ç»è¿‡æ¬¡æ•°å°±æ˜¯</p><script type="math/tex; mode=display">\dfrac{f_u}{\deg_u}+\dfrac{f_v}{\deg_v}</script><p>æ³¨æ„ä»¥ä¸Šæ‰€æœ‰çš„æ“ä½œéƒ½ä¸åŒ…æ‹¬ $n$ å·ç‚¹ï¼Œå› ä¸ºåˆ° $n$ å·ç‚¹å°±ä¸ä¼šå†èµ°äº†ã€‚</p><h2 id="CF24D-Broken-Robot"><a href="#CF24D-Broken-Robot" class="headerlink" title="CF24D Broken Robot"></a>CF24D Broken Robot</h2><blockquote><p>$n$ è¡Œ $m$ åˆ—çš„çŸ©é˜µï¼Œä¸€å¼€å§‹åœ¨ç‚¹ $(x,y)$ï¼Œæ¯æ¬¡ç­‰æ¦‚ç‡å‘å·¦ï¼Œå³ï¼Œä¸‹èµ°æˆ–åŸåœ°ä¸åŠ¨ï¼Œä½†ä¸èƒ½èµ°å‡ºå»ï¼Œé—®èµ°åˆ°æœ€åä¸€è¡ŒæœŸæœ›çš„æ­¥æ•°ã€‚</p><p>æ³¨æ„ï¼Œ$(1,1)$ æ˜¯æœ¨æ¿çš„å·¦ä¸Šè§’ï¼Œ$(n,m)$ æ˜¯æœ¨æ¿çš„å³ä¸‹è§’ã€‚</p></blockquote><p>é¦–å…ˆæ˜¯å€’æ¨çš„æ€æƒ³ï¼Œä» $(x,y)$ èµ°åˆ°æœ€åä¸€è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ä¸å¥½æè¿°ï¼Œå¯ä»¥è½¬åŒ–ä¸ºä»æœ€åä¸€è¡Œèµ°åˆ° $(x,y)$ ã€‚</p><p>è€ƒè™‘è½¬ç§»</p><script type="math/tex; mode=display">f_{i,j}=\begin{cases}\frac{1}{3}(f_{i+1,j}+f_{i,j+1}+f_{i,j})&\left(j=1\right)\\\frac{1}{3}(f_{i+1,j}+f_{i,j-1}+f_{i,j})&\left(j=m\right)\\\frac{1}{4}(f_{i+1,j}+f_{i,j-1}+f_{i,j+1}+f_{i,j})&\mathrm{Otherwise}\end{cases}</script><p>å‘ç°å…·æœ‰åæ•ˆæ€§ï¼Œäºæ˜¯è€ƒè™‘æ¶ˆå…ƒã€‚ä¸ªäººè®¤ä¸ºè‡³å°‘æœ‰å¦‚ä¸‹å‡ æ¡£éƒ¨åˆ†åˆ†ï¼š</p><h3 id="40-pts-max-n-m-leq-25"><a href="#40-pts-max-n-m-leq-25" class="headerlink" title="40 pts $\max\{n,m\}\leq 25$"></a>40 pts $\max\{n,m\}\leq 25$</h3><p>è¿™ä¸ªå°±å¯ä»¥æŠŠ $n \times m$ ä¸ªå…ƒç´ æ”¾åœ¨ä¸€èµ·æ¶ˆå…ƒï¼Œå¤æ‚åº¦æ˜¯ $(n^3\cdot m^3)$ çš„ã€‚</p><h3 id="70-pts-max-n-m-leq-100"><a href="#70-pts-max-n-m-leq-100" class="headerlink" title="70 pts $\max\{n,m\}\leq 100$"></a>70 pts $\max\{n,m\}\leq 100$</h3><p>å‘ç°æ¯ä¸€è¡Œå’Œå…¶ä»–è¡Œä¹‹é—´çš„å…³ç³»åªæœ‰ $f_{i+1,j}$ ï¼Œé‚£ä¹ˆä¸éš¾æƒ³åˆ°å€’åºæšä¸¾æ¯ä¸€è¡Œï¼Œå¯¹è¿™ä¸€è¡Œå†…çš„å…ƒç´ è¿›è¡Œæ¶ˆå…ƒï¼Œæ­¤æ—¶ $f_{i+1}$ çš„æ‰€æœ‰å…ƒç´ å‡å·²çŸ¥ã€‚å¤æ‚åº¦æ˜¯ $O(n\cdot m^3)$ çš„ã€‚</p><h3 id="85-pts-max-n-m-leq-500"><a href="#85-pts-max-n-m-leq-500" class="headerlink" title="85 pts $\max\{n,m\}\leq 500$"></a>85 pts $\max\{n,m\}\leq 500$</h3><p>å‘ç°å¯¹äºè¦æ¶ˆå…ƒçš„çŸ©é˜µï¼Œå¯¹äºæ¯ä¸€è¡Œåªæœ‰ $i,i-1,i+1,n+1$ å››ä¸ªåˆ—çš„ä½ç½®æ˜¯æœ‰å…ƒç´ çš„ï¼Œæ‰€ä»¥æ¯æ¬¡å¯¹äºä¸€è¡Œè€Œè¨€ï¼Œå¯ä»¥åªè¿›è¡Œ $O(1)$ æ¬¡æ¶ˆå…ƒã€‚è¿™æ ·å°±æ˜¯ $O(n\cdot m^2)$ çš„äº†ã€‚ </p><h3 id="100-pts-max-n-m-leq-3000"><a href="#100-pts-max-n-m-leq-3000" class="headerlink" title="100 pts $\max\{n,m\}\leq 3000$"></a>100 pts $\max\{n,m\}\leq 3000$</h3><p>å‘ç°ä¸æ­¢æ¨ªå‘æœ‰æ€§è´¨ï¼Œçºµå‘åŒæ ·æœ‰æ€§è´¨ã€‚å‘ç°å¯¹äºæ¯ä¸€åˆ—ï¼Œè‡³å¤šä¼šæœ‰ $3$ ä¸ªå…ƒç´ ã€‚è¿™æ ·çºµå‘ä¹Ÿæ˜¯ $O(1)$ çš„äº†ã€‚äºæ˜¯æ€»å¤æ‚åº¦ $O(n\cdot m)$ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">db ans[N] ;</span><br><span class="line">db f[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gauss</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n) f[i][i + <span class="number">1</span>] /= f[i][i] ;</span><br><span class="line">        f[i][n + <span class="number">1</span>] /= f[i][i] ; f[i][i] = <span class="number">1.0</span> ;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n) f[i + <span class="number">1</span>][i + <span class="number">1</span>] -= f[i + <span class="number">1</span>][i] * f[i][i + <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; n) f[i + <span class="number">1</span>][n + <span class="number">1</span>] -= f[i + <span class="number">1</span>][i] * f[i][n + <span class="number">1</span>] ;</span><br><span class="line">        f[i + <span class="number">1</span>][i] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[n] = f[n][n + <span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        ans[i] = f[i][n + <span class="number">1</span>], ans[i] -= ans[i + <span class="number">1</span>] * f[i][i + <span class="number">1</span>] ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> x, y ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; x &gt;&gt; y ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span> ; i &gt;= x ; -- i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j == <span class="number">1</span> &amp;&amp; j == m)&#123;</span><br><span class="line">                f[j][m + <span class="number">1</span>] = <span class="number">1.0</span> + ans[j] * <span class="number">1.0</span> / <span class="number">2.0</span> ;</span><br><span class="line">                f[j][j] = <span class="number">1.0</span> / <span class="number">2.0</span> ; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">1</span>)&#123;</span><br><span class="line">                f[j][m + <span class="number">1</span>] = <span class="number">1.0</span> + ans[j] * <span class="number">1.0</span> / <span class="number">3.0</span> ;</span><br><span class="line">                f[j][j] = <span class="number">2.0</span> / <span class="number">3.0</span>, f[j][j + <span class="number">1</span>] = - <span class="number">1.0</span> / <span class="number">3.0</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (j == m)&#123;</span><br><span class="line">                f[j][m + <span class="number">1</span>] = <span class="number">1.0</span> + ans[j] * <span class="number">1.0</span> / <span class="number">3.0</span> ;</span><br><span class="line">                f[j][j] = <span class="number">2.0</span> / <span class="number">3.0</span>, f[j][j - <span class="number">1</span>] = - <span class="number">1.0</span> / <span class="number">3.0</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                f[j][j] = <span class="number">3.0</span> / <span class="number">4.0</span> ;</span><br><span class="line">                f[j][j - <span class="number">1</span>] = - <span class="number">1.0</span> / <span class="number">4.0</span> ;</span><br><span class="line">                f[j][j + <span class="number">1</span>] = - <span class="number">1.0</span> / <span class="number">4.0</span> ;</span><br><span class="line">                f[j][m + <span class="number">1</span>] = <span class="number">1.0</span> + ans[j] * <span class="number">1.0</span> / <span class="number">4.0</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        gauss(m) ; <span class="comment">//debug(ans, 1, m) ;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            f[j][j] = f[j][j - <span class="number">1</span>] = f[j][j + <span class="number">1</span>] = f[j][m + <span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.8lf\n"</span>, ans[y]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HNOI2011-XORå’Œè·¯å¾„"><a href="#HNOI2011-XORå’Œè·¯å¾„" class="headerlink" title="[HNOI2011]XORå’Œè·¯å¾„"></a>[HNOI2011]XORå’Œè·¯å¾„</h2><blockquote><p>ç»™å®šä¸€ä¸ªæ— å‘è¿é€šå›¾ï¼Œå…¶èŠ‚ç‚¹ç¼–å·ä¸º $1$ åˆ° $N$ï¼Œå…¶è¾¹çš„æƒå€¼ä¸ºéè´Ÿæ•´æ•°ã€‚è¯•æ±‚å‡ºä¸€æ¡ä» $1$ å·èŠ‚ç‚¹åˆ° $N$ å·èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä½¿å¾—è¯¥è·¯å¾„ä¸Šç»è¿‡çš„è¾¹çš„æƒå€¼çš„ â€œXORå’Œâ€æœ€å¤§ã€‚è¯¥è·¯å¾„å¯ä»¥é‡å¤ç»è¿‡æŸäº›èŠ‚ç‚¹æˆ–è¾¹ï¼Œå½“ä¸€æ¡è¾¹åœ¨è·¯å¾„ä¸­å‡ºç°å¤šæ¬¡æ—¶ï¼Œå…¶æƒå€¼åœ¨è®¡ç®—â€œXOR å’Œâ€æ—¶ä¹Ÿè¦è¢«é‡å¤è®¡ç®—ç›¸åº”å¤šçš„æ¬¡æ•°ã€‚</p><p>ç›´æ¥æ±‚è§£ä¸Šè¿°é—®é¢˜æ¯”è¾ƒå›°éš¾ï¼Œäºæ˜¯ä½ å†³å®šä½¿ç”¨éå®Œç¾ç®—æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œä» $1$ å·èŠ‚ç‚¹å¼€å§‹ï¼Œä»¥ç›¸ç­‰çš„æ¦‚ç‡ï¼Œéšæœºé€‰æ‹©ä¸å½“å‰èŠ‚ç‚¹ç›¸å…³è”çš„æŸæ¡è¾¹ï¼Œå¹¶æ²¿è¿™æ¡è¾¹èµ°åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°èµ°åˆ° $N$ å·èŠ‚ç‚¹ä¸ºæ­¢ï¼Œä¾¿å¾—åˆ°ä¸€æ¡ä» $1$ å·èŠ‚ç‚¹åˆ° $N$ å·èŠ‚ç‚¹çš„è·¯å¾„ã€‚æ˜¾ç„¶å¾—åˆ°æ¯æ¡è¿™æ ·çš„è·¯å¾„çš„æ¦‚ç‡æ˜¯ä¸åŒçš„å¹¶ä¸”æ¯æ¡è¿™æ ·çš„è·¯å¾„çš„â€œXOR å’Œâ€ä¹Ÿä¸ä¸€æ ·ã€‚ç°åœ¨è¯·ä½ æ±‚å‡ºè¯¥ç®—æ³•å¾—åˆ°çš„è·¯å¾„çš„â€œXOR å’Œâ€çš„æœŸæœ›å€¼ã€‚</p><p>$2â‰¤Nâ‰¤100,1\leq Mâ‰¤10000$ ã€‚</p></blockquote><p><del>é‚£å¿…ç„¶æ˜¯è¦å…ˆçŒœä¸€æ³¢æœŸæœ›å¯¹xorè¿ç®—ä¹Ÿå…·æœ‰çº¿æ€§æ€§ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ã€‚</del></p><p>æ„Ÿè§‰å¯èƒ½æ˜¯éœ€è¦è®°ä½çš„ä¸€ä¸ª $trick$ ï¼Œä½è¿ç®—æ—¶ä½ä¸ä½ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ†åˆ«å¯¹æ¯ä¸€ä½è®¡ç®—ã€‚é‚£ä¹ˆå¯¹æ¯ä¸€ä½è®¡ç®—å°±å¯ä»¥ç›´æ¥æŒ‰ $0/1$ åˆ†ç±»è®¨è®ºæ¥è½¬ç§»ã€‚</p><p>å…·ä½“çš„ï¼Œè¿˜æ˜¯è€ƒè™‘å€’æ¨ã€‚ä¸ªäººæ„Ÿè§‰è¿™æ˜¯å› ä¸ºæœ€åˆçš„å†³ç­–å¯èƒ½å»¶ä¼¸å‡ºè®¸å¤šä¸åŒçš„å†³ç­–ï¼Œå¯¼è‡´å¾ˆéš¾å¯¹è¿™ä¸ªè¿‡ç¨‹è¿›è¡Œç»Ÿè®¡ã€‚ä½†æ˜¯å¦‚æœå€’æ¨çš„è¯ï¼Œå°±ç›¸å½“äºä»ä¸€ä¸ªå·²çŸ¥ç»“æœå‡ºå‘èµ°å‘å¦ä¸€ç«¯çš„å·²çŸ¥å¼€å§‹ã€‚æ‰€ä»¥ä¼šç›¸å¯¹å®¹æ˜“ä¸€ç‚¹ï¼Ÿ</p><p>äºæ˜¯è€ƒè™‘è®¾çŠ¶æ€ $f_x$ è¡¨ç¤ºå½“å‰äºŒè¿›åˆ¶ä½ä¸‹ï¼Œ ä» $x$ èµ°åˆ° $n$ è¿™ä¸€ä½çš„æœŸæœ›ï¼Œä¹Ÿå°±å¯ä»¥ç­‰ä»·äºè¿™ä¸€ä½ä¸º $1$ çš„æ¦‚ç‡ã€‚äºæ˜¯æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{u}=\frac{1}{\deg_u}\left(\sum_{(u,v,w)\in \mathbf{E},w=0} f_v+\sum_{(u,v,w)\in \mathbf{E},w=1}(1-f_v)\right)</script><p>ç„¶åå°±å¯ä»¥æ¶ˆå…ƒäº†ï¼Œå¤æ‚åº¦ $O(n^3\log V)$ ã€‚æ³¨æ„è‡ªç¯åªç»Ÿè®¡ä¸€æ¬¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> maxv ;</span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"><span class="keyword">int</span> deg[N] ;</span><br><span class="line"></span><br><span class="line">db res ;</span><br><span class="line">db ans[N] ;</span><br><span class="line">db f[N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gauss</span><span class="params">(<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= L ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">int</span> r = i ; db t ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (f[r][i] &lt; f[j][i]) swap(f[r], f[j]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = L + <span class="number">1</span> ; j &gt;= i ; -- j) f[r][j] /= f[r][i] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = L + <span class="number">1</span> ; k &gt;= i ; -- k)</span><br><span class="line">                f[j][k] -= f[j][i] * f[r][k] ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[L] = f[L][L + <span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L - <span class="number">1</span> ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        ans[i] = f[i][L + <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            ans[i] -= ans[j] * f[i][j] ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ; <span class="keyword">int</span> u, v, w ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        u = qr(), v = qr() ;</span><br><span class="line">        w = qr() ; chkmax(maxv, w) ;</span><br><span class="line">        add_e(u, v, w) ; <span class="keyword">if</span> (u != v) add_e(v, u, w) ;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    debug(deg, 1, n) ; cout &lt;&lt; cnt &lt;&lt; '\n' ;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> v = <span class="number">1</span> ; v &lt;= maxv ; v &lt;&lt;= <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n + <span class="number">1</span> ; ++ j)</span><br><span class="line">                f[i][j] = <span class="number">0.0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; n ; ++ i)&#123;</span><br><span class="line">            f[i][i] = deg[i] ; <span class="keyword">int</span> xs = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = head[i] ; k ; k = next(k))&#123;</span><br><span class="line">                <span class="keyword">if</span> (!(val(k) &amp; v)) f[i][to(k)] -= <span class="number">1.0</span> ;</span><br><span class="line">                <span class="keyword">else</span> f[i][to(k)] += <span class="number">1.0</span>, xs += <span class="number">1</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">            f[i][n + <span class="number">1</span>] = <span class="number">1.0</span> * xs ;</span><br><span class="line">        &#125;</span><br><span class="line">        f[n][n] = <span class="number">1.0</span> ;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        for (int i = 1 ; i &lt;= n + 1 ; ++ i)</span></span><br><span class="line"><span class="comment">            for (int j = 1 ; j &lt;= n + 1 ; ++ j)</span></span><br><span class="line"><span class="comment">                cout &lt;&lt; f[i][j] &lt;&lt; " \n"[j == n + 1] ;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        gauss(n) ; res += ans[<span class="number">1</span>] * v ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.3lf\n"</span>, res) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;èƒ¡åšå…«åšäº†ä¸€ç‚¹ç®€å•çš„æœŸæœ›é¢˜ï¼Œç®—æ˜¯ç»ƒç»ƒæ‰‹æ„Ÿå§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å…±æ˜¯ $15$ é“é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="å¥½å¤šå¥½å¤šç»†èŠ‚" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="æ•°å­¦/æ¦‚ç‡,æœŸæœ›" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E6%A6%82%E7%8E%87-%E6%9C%9F%E6%9C%9B/"/>
    
      <category term="æ•°å­¦/é«˜æ–¯æ¶ˆå…ƒ" scheme="https://www.orchidany.cn/tags/%E6%95%B0%E5%AD%A6-%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83/"/>
    
      <category term="æŠ€å·§/æŒ‰ä½æ“ä½œ" scheme="https://www.orchidany.cn/tags/%E6%8A%80%E5%B7%A7-%E6%8C%89%E4%BD%8D%E6%93%8D%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>ã€æ¢ç©¶å‘ã€‘ç”¨å‘½åˆ†ææ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°(PGF)</title>
    <link href="https://www.orchidany.cn/2020/05/03/%E6%A6%82%E7%8E%87%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0%E5%85%A5%E9%97%A8/"/>
    <id>https://www.orchidany.cn/2020/05/03/æ¦‚ç‡ç”Ÿæˆå‡½æ•°å…¥é—¨/</id>
    <published>2020-05-03T10:48:19.000Z</published>
    <updated>2020-05-31T10:56:25.511Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>å¤§æ¦‚æ˜¯æœ€è¿‘çš„ç ”ç©¶æˆæœå§ï¼Ÿ</p><p>ã€Œå­¦ä¸ä¼šçš„ç”Ÿæˆå‡½æ•°ã€+ã€Œå­¦ä¸ä¼šçš„æ¦‚ç‡è®ºã€= <code>?</code></p><p>ç®—æ˜¯æ¯”è¾ƒè¯¦ç»†åœ°ç ”ç©¶äº†ä¸€ä¸‹è¿™éƒ¨åˆ†å†…å®¹å§ã€‚ä¸ªäººè®¤ä¸ºæ˜¯å…¨ç½‘èƒ½æ‰¾åˆ°æœ€è¯¦ç»†çš„æŒ‡å—äº† qwqã€‚</p><a id="more"></a><h1 id="æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°"><a href="#æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°" class="headerlink" title="æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°"></a>æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°</h1><p>è™½ç„¶æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯æ™®é€šå‹ç”Ÿæˆå‡½æ•°ï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªå¯¹åº”å…³ç³»ã€‚</p><p>å³ï¼Œå¦‚æœå¯¹äºæŸä¸ªç¦»æ•£å‹éšæœºå˜é‡ $X\in\mathbb Z$ ï¼Œå­˜åœ¨æ•°åˆ— $\{a_n\}$ æ»¡è¶³ $\Pr(X=i)=a_i$ ï¼Œé‚£ä¹ˆç¦»æ•£å‹éšæœºå˜é‡ $X$ çš„ <strong>æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°$(\mathbf{PGF})$</strong> ä¸º</p><script type="math/tex; mode=display">\mathscr{F}(z)=\sum_{i=0}^{\infty} \Pr(X=i) z^i</script><p>é‚£ä¹ˆé¦–å…ˆæœ‰</p><script type="math/tex; mode=display">\mathscr{F}(1)=\sum_{i=0}^{\infty}[z^i]\mathscr{F}(z)=1</script><p>åŒæ—¶æ ¹æ®æœŸæœ›çš„å®šä¹‰</p><script type="math/tex; mode=display">E(X)=\sum_{i=0}^{\infty}i\Pr(X=i)</script><p>å¯ä»¥çŸ¥é“æœŸæœ›å°±æ˜¯ $\mathscr{F}$ çš„ä¸€é˜¶å¯¼æ•°ç³»æ•°å’Œï¼Œå³</p><script type="math/tex; mode=display">E(X)=\sum_{i=0}^{\infty}[z^i]\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(z)</script><p>é‚£ä¹ˆåŒæ—¶æ ¹æ®æ–¹å·®çš„å®šä¹‰ä»¥åŠæœŸæœ›çš„çº¿æ€§æ€§å¯ä»¥å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\mathsf{Var}(X)=E\left((X-E(X))^{2}\right)=E\left(X^{2}-2\cdot X \cdot E(X)+E(X)^{2}\right)=E\left(X^{2}\right)-E(X)^{2}</script><p>ä»è€Œæœ‰ </p><script type="math/tex; mode=display">\mathsf{Var}(X)=\sum_{i=0}^{\infty}[z^i]\left(\dfrac{\mathrm{d^2}}{\mathrm{d} z^2}\mathscr{F}(z)+\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(z)-\left(\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(z)\right)^2\right)</script><p>æ˜¯å› ä¸º</p><script type="math/tex; mode=display">E(X^2)=\sum_{i=0}^{\infty}i^2\cdot \Pr(X=i)=\sum_{i=0}^{\infty}i\cdot (i-1)\cdot \Pr(X=i)+\sum_{i=0}^{\infty}i\cdot \Pr(X=i)</script><p>å¯ä»¥çŸ¥é“å‰é¢ä¸€é¡¹æ˜¯äºŒé˜¶å¯¼ï¼Œåé¢ä¸€é¡¹æ˜¯ä¸€é˜¶å¯¼ã€‚</p><p>ç„¶åâ€¦ç„¶åå°±å¯ä»¥åšé¢˜äº†(å€’)ã€‚</p><h1 id="2013-Multi-University-Training-Contest-5-Dice"><a href="#2013-Multi-University-Training-Contest-5-Dice" class="headerlink" title="[2013 Multi-University Training Contest 5] Dice"></a>[2013 Multi-University Training Contest 5] Dice</h1><blockquote><p>ä¸€ä¸ª $m$ é¢çš„å…¬å¹³éª°å­ï¼Œæ±‚:</p><p>1ã€æœ€å $n$ æ¬¡ç»“æœç›¸åŒå°±ç»“æŸçš„æœŸæœ›æ¬¡æ•°ã€‚</p><p>2ã€æ±‚æœ€å $n$ æ¬¡ç»“æœå…¨ä¸åŒå°±ç»“æŸçš„æœŸæœ›æ¬¡æ•°ã€‚</p><p>ä¿è¯ $n,m \leq 10^6$ï¼Œä¸”å¯¹ç¬¬äºŒé—® $n \leq m$ ã€‚</p></blockquote><h2 id="æœ´ç´ åšæ³•"><a href="#æœ´ç´ åšæ³•" class="headerlink" title="æœ´ç´ åšæ³•"></a>æœ´ç´ åšæ³•</h2><p>å³ç”¨ dp æ¥åšã€‚</p><h3 id="ç¬¬ä¸€é—®"><a href="#ç¬¬ä¸€é—®" class="headerlink" title="ç¬¬ä¸€é—®"></a>ç¬¬ä¸€é—®</h3><p>è®¾ $f_i$ è¡¨ç¤ºæœ€å $i$ æ¬¡ç›¸åŒï¼ŒæœŸæœ›è¿˜è¦å¤šå°‘æ¬¡ç»“æŸã€‚é‚£ä¹ˆ $f_n=0$ ï¼Œæ±‚çš„å°±æ˜¯ $f_0$ ã€‚é‚£ä¹ˆå¯ä»¥çŸ¥é“æœ‰è½¬ç§»</p><script type="math/tex; mode=display">f_{i}=\dfrac{1}{m}f_{i+1}+\frac{m-1}{m}f_1+1</script><p>å‘ç°å¹¶ä¸å¥½ç›´æ¥åšï¼Œè€ƒè™‘å·®åˆ†å¾—åˆ°</p><script type="math/tex; mode=display">f_{i}-f_{i+1}=(m-1)f_i-(m-1)f_{1}-m=m(\frac{m-1}{m}f_i-\frac{m-1}{m}f_1-1)=m(f_{i-1}-f_i)</script><p>å¹¶ä¸”ç”± $f_0=f_1+1$ å¯ä»¥çŸ¥é“ $f_n-f_{n+1}=m^n$ï¼Œäºæ˜¯æœ€åç­”æ¡ˆå°±æ˜¯ $1+\sum_{i=1}^{n-1}m^i$ ã€‚</p><h3 id="ç¬¬äºŒé—®"><a href="#ç¬¬äºŒé—®" class="headerlink" title="ç¬¬äºŒé—®"></a>ç¬¬äºŒé—®</h3><p>è®¾ $g_i$ è¡¨ç¤ºæœ€å $i$ æ¬¡å‡ä¸ç›¸åŒï¼ŒæœŸæœ›è¿˜è¦å¤šå°‘æ¬¡ç»“æŸã€‚é‚£ä¹ˆ $g_n=0$ï¼Œæ±‚ $g_0$ ã€‚è€ƒè™‘</p><script type="math/tex; mode=display">g_i=\frac{m-i}{m} g_{i+1}+\frac{1}{m}\cdot \boldsymbol{\sum_{j=1}^i g_j}+1</script><p>(æ³¨æ„åŠ ç²—çš„éƒ¨åˆ†ï¼Œè‡ªå·±ä¸€å¼€å§‹å› ä¸ºä¸ç»†å¿ƒæ¨æŒ‚äº†â€¦)</p><p>é‚£ä¹ˆè¿˜æ˜¯å·®åˆ†</p><script type="math/tex; mode=display">\begin{aligned}g_{i-1}-g_i&=-\frac{i-1}{m}g_i+\frac{1}{m}\cdot \boldsymbol{\sum_{j=1}^{i-1} g_j}+1\\&=-\frac{(i-1)(m-i)}{m^2}g_{i+1}-\left(\frac{i-1}{m^2}-\frac{m}{m^2}\right)\cdot\sum _{j=1}^ig_j-\frac{m}{m^2}g_i-\frac{i-1}{m}+1\\&=-\frac{(i-1)(m-i)}{m^2}g_{i+1}-\left(\frac{i-1}{m^2}-\frac{m}{m^2}\right)\cdot\sum _{j=1}^ig_j-\frac{m}{m^2}\left(\frac{m-i}{m} g_{i+1}+\frac{1}{m}\cdot \sum_{j=1}^i g_j+1\right)-\frac{i-1}{m}+1\\&=-\frac{(i-1)(m-i)+(m-i)}{m^2}g_{i+1}+\left(\frac{m-i+1-1}{m^2}\right)\cdot\sum _{j=1}^ig_j+\frac{m-(i-1)-1}{m}\\&=-\frac{i\cdot (m-i)}{m^2}g_{i+1}+\frac{m-i}{m^2}\cdot\sum _{j=1}^ig_j+\frac{m-i}{m}\\&=\left(\frac{m-i}{m}\right)\left(-\frac{i}{m}g_{i+1}+\frac{1}{m}\cdot \sum_{j=1}^{i} g_j+1\right)\\&=\frac{m-i}{m}(g_{i}-g_{i+1})\end{aligned}</script><p><del>ä¸ä¼šå‘Šè¯‰ä½ ä¸­é€”æ¨å²”åŒ¹äº†å¥½å‡ æ¬¡</del></p><p>ç„¶åå°±ç±»ä¼¼ä¸Šé¢é‚£ä¸ª case äº†ï¼Œä¹Ÿæ˜¯å¯ä»¥çº¿æ€§åšçš„ã€‚</p><h2 id="PGF-åšæ³•"><a href="#PGF-åšæ³•" class="headerlink" title="PGF åšæ³•"></a>PGF åšæ³•</h2><h3 id="ç¬¬ä¸€é—®-1"><a href="#ç¬¬ä¸€é—®-1" class="headerlink" title="ç¬¬ä¸€é—®"></a>ç¬¬ä¸€é—®</h3><p>å³è€ƒè™‘å¥—è·¯è®¾ PGFï¼Œè®¾ $f_i$ è¡¨ç¤ºæ°å¥½åœ¨æ‰”ç¬¬ $i$ æ¬¡ç»“æŸæ—¶çš„æ¦‚ç‡ï¼Œ$g_i$ è¡¨ç¤ºæ‰”äº†ç¬¬ $i$ æ¬¡ä»æ²¡ç»“æŸçš„æ¦‚ç‡ã€‚è€ƒè™‘å¯¹è¿™ä¸¤ä¸ªä¸œè¥¿å»ºç«‹ PGFï¼Œåˆ†åˆ«ä¸º $\mathscr{F,G}$ï¼Œ é‚£ä¹ˆæœ‰æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathscr F(z)+\mathscr G(z)&=z\cdot \mathscr G(z)+1 \qquad(1)\\\mathscr G(z)\cdot \left(\frac{1}{m}z\right)^n&=\sum_{i=1}^n \mathscr{F}(z)\cdot \left(\frac{1}{m}z\right)^{n-i} \qquad(2)\end{aligned}</script><p>ç¬¬ä¸€ä¸ªæ–¹ç¨‹å¯ä»¥çœ‹åšæ˜¯åºŸè¯ï¼Œå°±æ˜¯å¤šæ‰”äº†ä¸€æ¬¡ä¹‹åï¼Œè¦ä¹ˆç»“æŸè¦ä¹ˆä¸ç»“æŸï¼Œ$\mathscr G$ å³ç§»ä¸€ä½å¯ä»¥çœ‹ä½œæ˜¯ $g_{i-1}$ ã€‚</p><p>ç¬¬äºŒä¸ªæ–¹ç¨‹çš„æ„æ€æ˜¯åœ¨ç°åœ¨çš„ä¸²åé¢æ¥ä¸€ä¸ªåˆæ³•ï¼Œä¹Ÿå°±æ˜¯ $n$ ä½éƒ½ç›¸åŒçš„ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ç­‰å¼å·¦è¾¹çš„å«ä¹‰æ˜¯ã€Œä¸€å®šå¯ä»¥ç»“æŸã€ï¼›ç­‰å¼å³è¾¹åˆ™æ˜¯è€ƒè™‘å¯èƒ½ä¼šå­˜åœ¨æ²¡æœ‰åŠ æ»¡ $n$ ä¸ªå°±ç»“æŸçš„æƒ…å†µã€‚ä¸ªäººçš„ç†è§£æ˜¯ï¼Œä¸ºäº†ä¿è¯ç­‰å¼ä¸¤è¾¹æ˜¯åœ¨è®¨è®ºç›¸åŒçš„æƒ…å†µï¼Œæ‰€ä»¥ä»ç„¶éœ€è¦æŠŠåé¢çš„ $n-i$ æ¬¡æ“ä½œç®—è¿›æ¥ï¼Œå¯ä»¥çŸ¥é“è¿™æ ·æ˜¯ä¸å½±å“å‰é¢æ°å¥½å–å®Œäº†çš„é‚£äº›æƒ…å†µã€‚äºæ˜¯æ ¹æ®è¿™ä¸ªä¸œè¥¿ä¾æ—§å¯ä»¥è§£å‡ºæ¥å’Œåšæ³•ä¸€ç›¸åŒçš„ç»“æœæ¥ã€‚</p><h3 id="ç¬¬äºŒé—®-1"><a href="#ç¬¬äºŒé—®-1" class="headerlink" title="ç¬¬äºŒé—®"></a>ç¬¬äºŒé—®</h3><p>å®šä¹‰ä¾æ—§ä¸å˜ã€‚è€ƒè™‘æ–¹ç¨‹å¤§æ¦‚æ˜¯</p><script type="math/tex; mode=display">\tag{1}\mathscr F(z)+\mathscr G(z)=z\cdot \mathscr G(z)+1</script><p>å’Œ </p><script type="math/tex; mode=display">\tag{2}\mathscr{G}(z)\cdot \left(\frac{1}{m}z\right)^n\cdot \dfrac{m!}{(n-m)!}=\sum_{i=1}^n \mathscr{F}(z)\cdot \left(\frac{1}{m}z\right)^{n-i} \cdot \dfrac{(m-i)!}{(m-i-(n-i))!}</script><p>ç„¶åå°±æš´åŠ›è§£å°±å¥½äº†ã€‚</p><h1 id="CTSC2006-æ­Œå”±ç‹å›½"><a href="#CTSC2006-æ­Œå”±ç‹å›½" class="headerlink" title="[CTSC2006] æ­Œå”±ç‹å›½"></a>[CTSC2006] æ­Œå”±ç‹å›½</h1><blockquote><p>ç®€åŒ–ç‰ˆé¢˜é¢ï¼š</p><p>ç»™å®šä¸€ä¸ªé•¿ä¸º $n$ çš„ç”± $1\sim m$ ç»„æˆçš„åºåˆ— $A$ï¼ŒåŒæ—¶æ¯æ¬¡æ·ä¸€é¢—å‡åŒ€çš„ $m$ é¢éª°å­ï¼Œæ±‚æœŸæœ›æ·å¤šå°‘æ¬¡éª°å­æ‰å¯ä»¥ä½¿å¾—åºåˆ—ä¸­å­˜åœ¨ä¸€ä¸ªè¿ç»­çš„å­ä¸²å’Œ $A$ ç›¸åŒã€‚</p><p>$1\leq n,m\leq 10^6$ ã€‚</p></blockquote><p>è€ƒè™‘å’Œä¸Šé¢˜å·®ä¸å¤šçš„ PGF åšæ³•ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\mathscr F(z)+\mathscr G(z)&=z\cdot \mathscr G(z)+1 \\\mathscr G(z)\cdot \left(\frac{1}{m}z\right)^n&=\sum_{i=1}^n \mathscr{F}(z)\cdot \left(\frac{1}{m}z\right)^{n-i}\cdot \mathscr{\zeta}(i)\end{aligned}</script><p>å…¶ä¸­ $\zeta(i)=\texttt{ã€Œ A[1â€¦i] æ˜¯å¦æ˜¯ A[1â€¦n] çš„ Borderã€}$ ã€‚ è¿˜æ˜¯æ¯”è¾ƒæ˜¾ç„¶çš„ï¼Œå› ä¸ºå¦‚æœæ˜¯æ‹¼åˆ°ç¬¬ $i$ ä½å°±å¯ä»¥åœæ­¢ï¼Œé‚£ä¹ˆ $A[1â€¦i]$ å¿…ç„¶æ˜¯ä¸ª $\sf border$ ã€‚</p><p>æœ€åå¯ä»¥ç›´æ¥æ¨å‡ºæ¥</p><script type="math/tex; mode=display">\dfrac{\mathrm d}{\mathrm{d}z}\mathscr{F}'(1)=\sum_{i=1}^n \zeta(i)\cdot m^{i}</script><h1 id="SDOI2017-ç¡¬å¸æ¸¸æˆ"><a href="#SDOI2017-ç¡¬å¸æ¸¸æˆ" class="headerlink" title="[SDOI2017] ç¡¬å¸æ¸¸æˆ"></a>[SDOI2017] ç¡¬å¸æ¸¸æˆ</h1><blockquote><p>ç»™å®š $n$ ä¸ªé•¿ä¸º $m$ çš„ç”± $0/1$ ç»„æˆçš„åºåˆ— $A_i$ï¼ŒåŒæ—¶æ¯æ¬¡æ·ä¸€é¢—å‡åŒ€çš„åŒé¢éª°å­ï¼Œæ±‚æœŸæœ›æ·å¤šå°‘æ¬¡éª°å­æ‰å¯ä»¥ä½¿å¾—åºåˆ—ä¸­å­˜åœ¨ä¸€ä¸ªè¿ç»­çš„å­ä¸²åœ¨ $A_1\sim A_n$ ä¸­å‡ºç°ã€‚</p><p>$n,m\leq 300$.</p></blockquote><p>è€ƒè™‘ä¸²ä¸ä¸²ä¹‹é—´å¯ä»¥æ¥å›åŒ¹é…ï¼Œäºæ˜¯å¯¹æ¯ä¸ªä¸²éƒ½å®šä¹‰ä¸€ä¸ª $\mathscr{F}_i(z)$ è¡¨ç¤ºé¦–æ¬¡å‡ºç°çš„æ˜¯ç¬¬ $i$ ä¸ªä¸²ï¼Œä¸”å½“å‰éšæœºé•¿åº¦ä¸º $j$ çš„æ¦‚ç‡ï¼Œç„¶åå•ç‹¬å®šä¹‰ä¸€ä¸ª $\mathscr{G}(z)$ è¡¨ç¤ºæ¸¸æˆç»“æŸï¼Œé‚£ä¹ˆæœ‰</p><script type="math/tex; mode=display">\sum_{i=1}^n\mathscr{F}_i(z)+\mathscr{G}(z)=\mathscr{G}(z)\cdot z+1</script><p>åŒæ—¶å®šä¹‰ $match(i,j)_k=[~A_i[1â€¦k]=A_{j}[kâ€¦m]~]$ ï¼Œé‚£ä¹ˆæœ‰å¯¹äºæ¯ä¸ª $i$ çš„ä¸€ç»„æ–¹ç¨‹æšä¸¾åœ¨æœ€åæ‹¼ä¸Šä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼š</p><script type="math/tex; mode=display">\mathscr{G}(z)\cdot \Pr(A_i[1...n])\cdot x^m=\sum_{j=1}^n \mathscr{F}_j(z)\sum_{k=1}^m match(i,j)_k\cdot \Pr(A_i[k+1...m])\cdot x^{m-k}</script><p>ä¸éš¾çŸ¥é“æ„æ€æ˜¯ $A_j$ å’Œ $A_i$ å¯ä»¥æ”¾åœ¨ä¸€èµ·åŒ¹é…ï¼Œæšä¸¾ $i$ æŸä¸ªåŒæ—¶æ˜¯ $A_j$ åç¼€çš„å‰ç¼€è¿›è¡Œé…å¯¹ã€‚</p><p>é‚£ä¹ˆè€ƒè™‘è¦æ±‚çš„å°±æ˜¯ $\mathscr{F}_1(1),\mathscr{F}_2(1),\mathscr{F}_3(1),\cdots$ ã€‚å‘ç°å¯ä»¥ç”±æ–¹ç¨‹ $(2)$ å¾—åˆ° $n$ ä¸ªå…³ç³»ï¼ŒåŒæ—¶å› ä¸ºå¹¶æ²¡æœ‰è¦æ±‚æœŸæœ›æ‰€ä»¥ $(1)$ å¼æ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚ä½†æ˜¯å¯ä»¥å‘ç°ï¼Œæ ¹æ®æ¦‚ç‡çš„è§„èŒƒæ€§å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\sum \mathscr{F}_i(1)=1</script><p>äºæ˜¯å°±æœ‰ $n+1$ ç»„å…³ç³»ï¼ŒåŒæ—¶æœ‰åŒ…å« $\mathscr{G}(1)$ åœ¨å†…çš„ $n+1$ ä¸ªæœªçŸ¥å…ƒï¼Œå°±å¯ä»¥æ„‰å¿«åœ°é«˜æ¶ˆäº†ã€‚</p><h1 id="ZJOI2013-æŠ›ç¡¬å¸"><a href="#ZJOI2013-æŠ›ç¡¬å¸" class="headerlink" title="[ZJOI2013] æŠ›ç¡¬å¸"></a>[ZJOI2013] æŠ›ç¡¬å¸</h1><blockquote><p>æœ‰ä¸€æšç¡¬å¸ï¼ŒæŠ›å‡ºæ­£é¢ <code>H</code> çš„æ¦‚ç‡ä¸º $\frac{a}{b}$ï¼ŒæŠ›å‡ºåé¢ <code>T</code> çš„æ¦‚ç‡ä¸º $1-\frac{a}{b}$ã€‚ç°åœ¨ T å°æœ‹å‹å¼€å§‹ç©ä¸¢ç¡¬å¸çš„æ¸¸æˆï¼Œå¹¶ä¸”æŠŠæ¯æ¬¡æŠ›å‡ºçš„ç»“æœè®°å½•ä¸‹æ¥ï¼Œæ­£é¢è®°ä¸º <code>H</code>ï¼Œåé¢è®°ä¸º <code>T</code>ï¼Œäºæ˜¯å¥¹å¾—åˆ°äº†ä¸€ä¸ªæŠ›ç¡¬å¸åºåˆ— <code>HTHHT</code>â€¦ã€‚</p><p>å¥¹çªç„¶æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æŠ›å‡ºæ­£é¢å’Œåé¢æ¦‚ç‡éƒ½æ˜¯ $\frac{1}{2}$ çš„æƒ…å†µä¸‹ï¼Œè¦ä½¿å¾—æŠ›å‡ºçš„åºåˆ—å‡ºç°åªåŒ…å« <code>H</code> å’Œ <code>T</code> ç›®æ ‡åºåˆ—ï¼ŒæœŸæœ›è¦æŠ›å¤šå°‘æ¬¡ã€‚</p><p>è¿™ä¹ˆç®€å•çš„é¢˜ç›®å¥¹å½“ç„¶æ˜¯ä¸€çœ¼ç§’ã€‚äºæ˜¯å¥¹åœ¨è§£å†³äº†è¿™ä¸ªå¼±åŒ–å¾ˆå¤šçš„é—®é¢˜ä»¥åï¼Œå¼€å§‹æ€è€ƒå¯¹äºä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŠ›å‡ºæ­£åé¢çš„æ¦‚ç‡ä¸ä¸€å®šç›¸åŒï¼Œä¸”æŠ›å‡ºçš„ç›®æ ‡åºåˆ—ä¸ä¸€å®šä¸º <code>HT</code> æ—¶éœ€è¦çš„æœŸæœ›æ­¥æ•°ã€‚ç„¶è€Œç»è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„è‹¦æ€å†¥æƒ³ä»ç„¶æ— æœï¼Œäºæ˜¯å¥¹å¼€å§‹æ±‚åŠ©äºä½ ã€‚</p><p>ç®€åŒ–ç‰ˆé¢˜é¢ï¼š</p><blockquote><p>ç»™å‡ºä¸€ä¸ªä¸¤é¢çš„å‡åŒ€éª°å­ï¼Œæ­£é¢å’Œåé¢çš„æ¦‚ç‡åˆ†åˆ«æ˜¯ $\frac{a}{b}$ å’Œ $1-\frac{a}{b}$ ã€‚å¹¶ç»™å‡ºä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ $01$ åºåˆ— $A$ ã€‚</p><p>åŒæ—¶æœ‰ä¸€ä¸ªä¸€å¼€å§‹ä¸ºç©ºçš„åºåˆ—ã€‚æ¯æ¬¡æ·éª°å­ï¼Œå¦‚æœæ˜¯åé¢ï¼Œå°±åœ¨å½“å‰åºåˆ—æœ«å°¾å†™ä¸€ä¸ª $1$ ï¼Œå¦åˆ™å†™ä¸€ä¸ª $0$ ï¼Œå¦‚æœå‘ç°æ­¤æ—¶åºåˆ—ä¸­æ°å¥½æœ‰ä¸€ä¸ªè¿ç»­å­ä¸²æ˜¯ $A$ åˆ™åœæ­¢ã€‚æ±‚æœŸæœ›å¤šå°‘æ¬¡æ‰ä¼šåœæ­¢æ“ä½œã€‚</p></blockquote><p>æˆ‘è®¤ä¸ºåˆç†çš„æ•°æ®èŒƒå›´ï¼š$1\leq n\leq 10^6$ï¼Œæ¦‚ç‡å¯¹ $998244353$ å–æ¨¡ã€‚</p><p>ZJOI2013 çš„æ•°æ®èŒƒå›´ï¼š$1\leq n\leq 10^3$ è¾“å‡ºç¡®åˆ‡æ¦‚ç‡å¹¶ä¿ç•™<strong>æ—¢çº¦åˆ†æ•°å½¢å¼</strong> ã€‚</p></blockquote><p>å…¨ç½‘ä¼¼ä¹æ²¡äººç”¨ PGF åšï¼Œè¿™å°±å¾ˆçˆ½ã€‚æœ‰ç§ä¸­äº†å¤´å½©çš„æ„Ÿè§‰â€¦ä½†æ˜¯å…¶å®å†™è¿™é¢˜çš„æ—¶å€™æˆ‘æ˜¯ååˆ†å´©æºƒçš„â€¦</p><p>ä» 5.3 æ™šä¸Š 8:30 å·¦å³ä¸€ç›´å†™ï¼Œå†™åˆ° 10:00 PM å·¦å³å‘ç°æœ‰åœ°æ–¹å†™é”™äº†ï¼Œä½†æ˜¯ç”±äºè¦å›å®¿èˆäº†æ‰€ä»¥è¢«è¿«ç»ˆæ­¢ã€‚ç¬¬äºŒå¤©æ—©ä¸Šæ¥äº†åˆå¼€å§‹å†™ï¼Œå†™ç€å†™ç€å‘ç°è¿˜è¦å†™ä¸€æ³¢é«˜ç²¾ gcd å’Œé«˜ç²¾é™¤ï¼Œäºæ˜¯å°±æŠŠæ—©ä¸Šçš„è¯¾ç»™ç¿˜äº†ã€‚å†™å®Œäº†å‘ç°æ…¢çš„ä¸€åŒ¹ï¼Œåªèƒ½æœ‰ $50pts$ï¼Œç„¶åå†³å®šå»å­¦ä¸€å­¦å‹ä½ã€‚å‘ç°å‹ä½ä¹Ÿä¸éš¾ï¼Œç„¶åå†³å®šå‹ $4$ ä½ï¼›å†™ç€å†™ç€åˆå‘ç°å‹ $8$ ä½ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œç„¶åæ”¹æ¥æ”¹å»æ”¹æˆäº† $90pts$ ï¼Œå‘ç°æœ€å¤§çš„ç‚¹æ¯”æ—¶é™æ…¢ä¸€å€â€¦äºæ˜¯å°±å»æ‰’è‡ªå·±çš„ FFT æ¿å­ï¼Œæ‹¼æ‹¼å‡‘å‡‘ä¹‹åå‘ç°ç”±äºå¯èƒ½ä¼šçˆ†ç²¾åº¦æ‰€ä»¥ä¸èƒ½å‹ 8 ä½ï¼Œåªèƒ½å‹ $4$ ä½ï¼Œç»“æœæ›´æ…¢äº†ã€‚ç„¶åå†³å®šæ”¹æˆ NTTï¼Œç»“æœå‘ç° NTT è¦å¯¹ç¥å¿…æ•°å–æ¨¡å¯¼è‡´å‹ä¸¤ä½å¯èƒ½éƒ½æœ‰é—®é¢˜ï¼Œç„¶åå°±è‡ªé—­äº†ï¼Œå†³å®šæ”¾å¼ƒå¤šé¡¹å¼ç§‘æŠ€å»ä¼˜åŒ–è‡ªå·±çš„å‹ä½é«˜ç²¾ã€‚å‘ç°æœ‰äº›åœ°æ–¹ä¼¼ä¹åˆå¹¶åŒç±»é¡¹ä¹‹åä¼šå¾ˆå¿«ï¼ŒåŸæ¥ä¹˜ $O(n)$ æ¬¡æ”¹å®Œåªéœ€è¦ä¹˜ $O(1)$ æ¬¡ï¼Œç„¶åå·¦æ”¹å³æ”¹ç»ˆäºå¡è¿‡äº†æ´›è°·ä¸Šçš„1sæ—¶é™â€¦</p><p>æœŸé—´ä¸€åº¦æ€€ç–‘è‡ªå·±ç®—æ³•çš„æ­£ç¡®æ€§ï¼Œä½†æ˜¯æƒ³äº†æƒ³ä¹Ÿæ²¡ä»€ä¹ˆæ›´é è°±çš„åšæ³•äº†ï¼Œåªä¸è¿‡è¿™ä¸ªå†™æ³•æ˜¯ $L^2\log V$ çš„ï¼Œ$L^2$ å¤§æ¦‚ä¹Ÿå°±æ˜¯ $10^6$ çš„èŒƒå›´ï¼Œåªæ˜¯è¿™ä¸ª $\log V$ â€¦ä»–ç¡®å®æœ‰ç‚¹æ¯’ç˜¤ã€‚å› ä¸ºæœ€å¤§å¯ä»¥åˆ° $V=10^{16000}$ å·¦å³ï¼Œæ‰€ä»¥é«˜ç²¾åº¦é™¤æ³•äºŒåˆ†èµ·æ¥å°±ååˆ†çˆ†ç‚¸â€¦å¤§æ¦‚æé™æ˜¯ $5\cdot 10^9$ çš„è¿ç®—é‡ã€‚ä¸è¿‡â€¦å¥½åœ¨æœ€åæ˜¯è¿‡äº†ï¼Œè™½ç„¶æœ‰ç‚¹å¡æ—¶ã€‚</p><p>ç®—äº†ä¸€ä¸‹ä¼¼ä¹ FFT çš„å¤æ‚åº¦æ›´å¯¹ä¸€ç‚¹ï¼Œ$L\log L\log V$ å¤§æ¦‚æ˜¯ $10^7\sim 10^8$ å·¦å³çš„è¿ç®—é‡ã€‚ä½†æ˜¯è‡ªå·±çš„ FFT æ°´å¹³å®åœ¨å¤ªå·®â€¦äºæ˜¯å°±è¿˜æ˜¯å¤šé¡¹å¼ä¹˜æ³•äº†ã€‚å¯èƒ½ä»€ä¹ˆæ—¶å€™å¿ƒæƒ…å¥½å°±ä¼šè¡¥ä¸€ä¸‹è¿™ä¸ªé”…ï¼Ÿ</p><p>ä»¥ä¸‹æ˜¯æ­£æ–‡ï¼Œå°±ç›´æ¥æŠŠå‘åœ¨è°·ä¸Šçš„é¢˜è§£ç³Šä¸Šæ¥äº†ï¼š</p><hr><p>è€ƒè™‘è®¾ $f_i$ è¡¨ç¤ºæ‰”äº† $i$ æ¬¡éª°å­ä¹‹åæ°å¥½åœæ­¢çš„æ¦‚ç‡ï¼Œ$g_i$ è¡¨ç¤ºæ‰”äº† $i$ æ¬¡éª°å­ä¹‹åä»æœªç»“æŸçš„æ¦‚ç‡ã€‚åŒæ—¶è€ƒè™‘å¯¹è¿™ä¸¤ä¸ªä¸œè¥¿å»ºç«‹ PGFï¼Œåˆ†åˆ«ä¸º $\mathscr{F,G}$ï¼Œ é‚£ä¹ˆæœ‰æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">\tag{1}\mathscr F(z)+\mathscr G(z)=z\cdot \mathscr G(z)+1 \\</script><p>å…¶æ„ä¹‰æ˜¯ï¼Œæ‰”äº†ä¸€æ¬¡ä¹‹åï¼Œè¦ä¹ˆç»“æŸè¦ä¹ˆä¸ç»“æŸï¼Œ$\mathscr G$ å³ç§»ä¸€ä½å¯ä»¥çœ‹ä½œæ˜¯ $g_{i-1}$ ã€‚åŒæ—¶è¿˜æœ‰</p><script type="math/tex; mode=display">\tag{2}\mathscr G(z)\cdot \Pr(A[1...n])=\sum_{i=1}^n \mathscr{F}(z)\cdot \Pr(A[i+1...n])\cdot \zeta(i)</script><p>å…¶æ„ä¹‰æ˜¯ï¼Œè€ƒè™‘åœ¨ç°åœ¨çš„ä¸²åé¢æ¥ä¸€ä¸ªå¯ä»¥è®©è¿™ä¸ªè¿‡ç¨‹ç›´æ¥ç»“æŸçš„ä¸²ï¼Œä¹Ÿå°±æ˜¯æ¥ä¸€ä¸ª $A$ï¼Œ$\Pr(s[1â€¦n])$ è¡¨ç¤ºä¸² $s$ å‡ºç°çš„æ¦‚ç‡ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ç­‰å¼å·¦è¾¹çš„å«ä¹‰æ˜¯ã€Œä¸€å®šå¯ä»¥ç»“æŸã€ï¼›ç­‰å¼å³è¾¹åˆ™æ˜¯è€ƒè™‘å¯èƒ½ä¼šå­˜åœ¨æ²¡æœ‰åŠ æ»¡ $n$ ä¸ªã€åªåŠ äº†å‰ $i$ ä¸ªå­—ç¬¦å°±ç»“æŸçš„æƒ…å†µï¼Œå¤šä¹˜ä¸€ä¸ª $\Pr(A[i+1â€¦n])$ æœ¬èº«æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåªæ˜¯ä¸ºäº†æ„é€ å‡ºç­‰å¼ï¼Œå¯ä»¥ç†è§£ä¸ºä¸¤è¾¹éƒ½é’¦å®šæ‰”äº† $n$ æ¬¡â€”â€”å‘ç°è¿™ç§æƒ…å†µè¦æ˜¯æƒ³è¦å‡ºç°ï¼Œå°±å¿…é¡»æ»¡è¶³ $A[1â€¦i]$ æ˜¯ $A$ çš„ä¸€ä¸ª $\sf border$ ï¼Œæ‰€ä»¥ $\zeta(i)=[A[1â€¦i]\in\mathbf{Border}]$ .</p><p>ä¹‹åè€ƒè™‘å¦‚ä½•æ¶ˆå…ƒã€‚é¦–å…ˆå¯¹ $(1)$ å¼æ±‚å¯¼å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(z)+\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{G}(z)=\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{G}(z)\cdot z+\mathscr{G}(z)\cdot 1</script><p>ä¹Ÿå°±æ˜¯å¯ä»¥çŸ¥é“ </p><script type="math/tex; mode=display">\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(z)=\mathscr{G}(z)</script><p>åŒæ—¶å¯¹äº $(2)$ å¼ï¼Œå°† $z=1$ ä»£å…¥å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\mathscr{G}(1)\cdot \Pr(A[1...n]) =\sum_{i=1}^n\mathscr{F}(1)\cdot \zeta(i)\cdot \Pr(A[i+1...n])</script><p>å› ä¸º $\mathscr{F}(1)=1$ ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\mathscr{G}(1)=\dfrac{\sum_{i=1}^n \zeta(i)\cdot \Pr(A[i+1...n])}{\Pr(A[1...n])}</script><p>ç„¶åæ ¹æ®</p><script type="math/tex; mode=display">E(X)=\dfrac{\mathrm{d}}{\mathrm{d} z}\mathscr{F}(1)</script><p>å‘ç°è¿™é¢˜å°±åšå®Œäº†ã€‚å¤æ‚åº¦çº¿æ€§ã€‚</p><p>ä½†æ˜¯æ³¨æ„æœ¬é¢˜è¦æ±‚ä»¥æ—¢çº¦åˆ†æ•°çš„å½¢å¼ä¿ç•™ç²¾ç¡®å€¼ã€‚å› ä¸ºæˆ‘å¥½ä¹…å¥½ä¹…æ²¡å†™è¿‡é«˜ç²¾åº¦äº†ï¼Œäºæ˜¯å°±æƒ³å€Ÿæ­¤æœºä¼šå°è£…ä¸€ä¸ªæ¨¡æ¿ã€‚ç„¶åâ€¦ç„¶åå°±å†™äº†å¿« $7h+$ã€‚æ³¨æ„åˆ°ç”±äºè¦æ±‚æ—¢çº¦åˆ†æ•°ï¼Œæ‰€ä»¥è¦å†™é«˜ç²¾åº¦gcdï¼Œå†™æ³•å¯ä»¥å€Ÿé‰´ <code>[SDOI2009]Super GCD</code> ï¼ŒåŒæ—¶è¿˜è¦å†™é«˜ç²¾é™¤é«˜ç²¾ï¼Œä¸ªäººæ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ³•ï¼Œäºæ˜¯å°±å†™çš„äºŒåˆ†ï¼Œå¤æ‚åº¦å¤§æ¦‚æ˜¯ $L^2\log V$ çš„æ ·å­ã€‚</p><p>ç„¶åå¤æ‚åº¦ä¼¼ä¹æ˜¯ $n\cdot L^2\log V$ ï¼Œå¹¶ä¸å¯ä»¥è¿‡ï¼Œäºæ˜¯è€ƒè™‘å‰ªæ+å¡å¸¸ï¼š</p><p>0ã€â€¦é«˜ç²¾åº¦å‹ä½æ˜¯å¿…è¦çš„å§ï¼Ÿè¿™è¾¹æˆ‘é€‰æ‹©å‹ $8$ ä½ï¼Œå› ä¸ºå‘ç° $10^3\cdot 10^{16}$ æ°å¥½å¡åˆ°äº† <code>long long</code> çš„ä¸Šç•Œã€‚</p><p>1ã€å‘ç°äºŒåˆ†æ—¶å·¦å³è¾¹ç•Œå¯ä»¥ç¼©çŸ­å¾ˆå¤šï¼Œå³ $l,r$ éƒ½è‡³å¤šå’Œ $V / \gcd$ çš„é•¿åº¦ç›¸å·® $1$ ï¼Œæ‰€ä»¥å¯ä»¥ç”¨è¿™ä¸ªæ¥ç¡®å®šè¾¹ç•Œã€‚äº²æµ‹å¯ä»¥å¿«å¤§æ¦‚ $6$ å€å·¦å³(ä½†æ˜¯è¿˜æ˜¯ Tï¼Œæé™æ•°æ®å¤§æ¦‚è¦è·‘ $4s+$) ã€‚</p><p>2ã€å‘ç°è®¡ç®—ç­”æ¡ˆæ—¶ï¼Œå±•å¼€åå­˜åœ¨å¾ˆå¤šå…¬å› å¼ã€‚äºæ˜¯å¯ä»¥æå–å…¬å› å¼ä¹‹åå†è®¡ç®—ã€‚äº²æµ‹å¯ä»¥å¿« $4$ å€å·¦å³ã€‚</p><p>ç„¶åâ€¦å¤§æ¦‚å°±è¿‡äº†ã€‚ä¸­é—´å†™äº†å¾ˆä¹…çš„åŸå› åœ¨äºï¼Œæˆ‘æœ¬æ¥æƒ³å°è¯• FFTï¼Œåæ¥å‘ç°è‡ªå·±æ²¡æœ‰å°è£…å¥½çš„ FFTâ€¦å›§â€¦å†™äº†åŠå¤©å‘ç°è‡ªå·± FFT çš„å¸¸æ•°è¿˜ä¸å¦‚å‹ä½å¿«â€¦ç„¶åå°±æ²¡æœ‰ç„¶åäº†ã€‚</p><hr><p>ä»¥ä¸Šéƒ½æ˜¯æ— èŠçš„å¥—è·¯é¢˜ï¼Œè¿˜æ˜¯ä¸‹é¢çš„é¢˜æ¯”è¾ƒæœ‰è¶£</p><h1 id="è¶£é¢˜-ä¸€ä¸ªæœ‰è¶£çš„æ¦‚ç‡å°é—®é¢˜-Â·-æ”¹"><a href="#è¶£é¢˜-ä¸€ä¸ªæœ‰è¶£çš„æ¦‚ç‡å°é—®é¢˜-Â·-æ”¹" class="headerlink" title="[è¶£é¢˜]ä¸€ä¸ªæœ‰è¶£çš„æ¦‚ç‡å°é—®é¢˜ Â· æ”¹"></a>[è¶£é¢˜]ä¸€ä¸ªæœ‰è¶£çš„æ¦‚ç‡å°é—®é¢˜ Â· æ”¹</h1><p>é¢˜ç›®æ¥æºæ˜¯<a href="http://roosephu.github.io/2017/12/31/condexp/" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼Œä¸æœ¬é¢˜ç•¥æœ‰å‡ºå…¥ï¼š</p><blockquote><p>ä¸€ä¸ª $n$ é¢çš„éª°å­ï¼Œæ¯ä¸€é¢æ ‡å· $1$ åˆ° $n$ ã€‚æœ‰ä¸ªåˆå§‹ä¸º $0$ çš„è®¡æ•°å™¨ï¼Œæ¯æ¬¡æ‰”éª°å­ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ï¼š</p><p>1ã€æ‰”å‡ºäº†å¥‡æ•°ï¼šé‚£ä¹ˆè®¡æ•°å™¨æ¸…é›¶ã€‚</p><p>2ã€æ‰”å‡ºäº†å¶æ•°ï¼šè®¡æ•°å™¨åŠ  $1$ ã€‚</p><p>3ã€æ‰”å‡ºäº† $n$ï¼šæ¸¸æˆç»“æŸã€‚</p><p>é—®ç»“æŸæ—¶è®¡æ•°å™¨ä¸Šæ˜¾ç¤ºçš„æ•°å€¼çš„æœŸæœ›ã€‚ </p><p>ä¿è¯ $n$ æ˜¯å¶æ•°ã€‚</p></blockquote><p>è€ƒè™‘å¦‚æœæŒ‰ç…§å¥—è·¯è®¾ $f_i$ è¡¨ç¤ºæ‰”åˆ° $i$ ç»“æŸçš„æ¦‚ç‡ï¼Œ$g_i$ è¡¨ç¤ºæ‰”åˆ° $i$ æ²¡æœ‰ç»“æŸçš„æ¦‚ç‡ï¼Œä¼šå­˜åœ¨é—®é¢˜ã€‚å› ä¸ºæ ¹æ®é¢˜è®¾ï¼Œä¼šé‡å¤åˆ°è¾¾æŸä¸ªæƒå€¼ $v$ å¾ˆå¤šå¾ˆå¤šæ¬¡ï¼Œæ‰€ä»¥è®¾æ¦‚ç‡æ˜¯ä¸å¦¥çš„ã€‚</p><p>è€ƒè™‘ PGF çš„ä¸€ä¸ªç¿»ç‰ˆï¼Œå¯¹ç€æœŸæœ›å»ºç«‹ç”Ÿæˆå‡½æ•°(ä½ å¯ä»¥å«ä»– EGFã€é›¾ã€‘ï¼Œè™½ç„¶æœ¬è´¨ä¸Šå°±æ˜¯å¯¹ PGF æ±‚äº†ä¸€ä¸ªä¸€é˜¶å¯¼æ•°)ï¼šè®¾ $f_i$ è¡¨ç¤ºæ‰”åˆ° $i$ ç»“æŸçš„<strong>æœŸæœ›æ¬¡æ•°</strong>ï¼Œ$g_i$ è¡¨ç¤ºæ‰”åˆ° $i$ æ²¡æœ‰ç»“æŸçš„<strong>æœŸæœ›æ¬¡æ•°</strong>ï¼Œå¯¹è¿™ä¸¤ä¸ªä¸œè¥¿å»ºç«‹æ™®é€šå‹ç”Ÿæˆå‡½æ•°å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\mathscr{F}(z)+\mathscr{G}(z)=\left(\mathscr{G}(z)\cdot \dfrac{z}{2}+1\right)+\frac{1}{2}\cdot \mathscr{G}(1)</script><p>å…¶ä¸­å·¦è¾¹çš„æ„æ€å½“ç„¶æ˜¯ï¼Œè¦ä¹ˆç»“æŸè¦ä¹ˆä¸ç»“æŸï¼Œæ¢ä¸ªæ„æ€å°±æ˜¯ã€Œåˆ°è¾¾ $i$ çš„æœŸæœ›æ€»æ¬¡æ•°ã€ï¼Œå³è¾¹ç¬¬ä¸€é¡¹æ˜¯æœ‰ $\dfrac{1}{2}$ çš„æ¦‚ç‡ä» $z$ è½¬ç§»è¿‡æ¥ï¼Œæœ‰ $\dfrac{1}{2}$ çš„æ¦‚ç‡åˆ°è¾¾ $0$ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ‰ç­‰å¼ã€ŒåŸæ¥åˆ°è¾¾æ‰€æœ‰ $i$ çš„æœŸæœ›æ¬¡æ•°ã€=ã€Œç°åœ¨è¿™ä¸€æ­¥åˆ°è¾¾ $0$ çš„æœŸæœ›æ¬¡æ•°ã€ã€‚</p><p>åŒæ—¶ä¹Ÿä¼šæœ‰</p><script type="math/tex; mode=display">\mathscr{F}(z)=\frac{x}{n}\cdot \mathscr{G}(z)</script><p>å³æ°å¥½æ‰”åˆ° $n$ çš„è½¬ç§»ï¼Œæ ¹æ®é¢˜è®¾åº”è¯¥å…ˆ $+1$ ï¼Œå†ç»“æŸã€‚</p><p>æ„Ÿè§‰è¿˜æ˜¯æ¯”å‰é¢çš„é¢˜æœ‰è¶£çš„ï¼Ÿ</p><h1 id="æ¥æºä¿å¯†çš„æ¯”èµ›-1A-Probability"><a href="#æ¥æºä¿å¯†çš„æ¯”èµ›-1A-Probability" class="headerlink" title="[æ¥æºä¿å¯†çš„æ¯”èµ› 1A] Probability"></a>[æ¥æºä¿å¯†çš„æ¯”èµ› 1A] Probability</h1><blockquote><p>æœ‰ä¸€ä¸ªéšæœºå˜é‡ $z$, åˆå§‹ $z=0$.</p><p>æ‰§è¡Œ $n$ æ¬¡æ“ä½œ: æ¯æ¬¡æ“ä½œæ˜¯ä» $0$ åˆ° $k$ ä¸­ä»¥ $p_t$ çš„æ¦‚ç‡é€‰æ‹©ä¸€ä¸ªæ•´æ•° $t$ï¼Œå¹¶ä»¤ $z:=z+t$ ã€‚</p><p>æ±‚ $\min(z,x)$ çš„æœŸæœ›. ç­”æ¡ˆæ¨¡ $998244353$. </p><p>$k\leq 100,n\leq 10^9,x\leq \min\{10^7,\frac{5\times 10^7}{k}\}$ ã€‚</p></blockquote><p>è®¾é€‰æ‹©æ•´æ•°çš„æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°ä¸º $P(y)=\sum_{i=0}^kp_i$ ï¼Œé‚£ä¹ˆå–äº† $n$ æ¬¡ä¹‹åçš„æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°å°±æ˜¯ $Q(y)=P^n(y)$ ã€‚</p><p>é‚£ä¹ˆä¸éš¾çŸ¥é“ç­”æ¡ˆä¸º</p><script type="math/tex; mode=display">\sum_{i=0}^{n\times k} [y^i]Q\cdot \min(x,i)=\sum_{i=0}^{x-1} [y^i]Q\cdot i + \left(1-\sum_{i=0}^{x-1} [y^i]Q\right)\cdot x</script><p>å‘ƒâ€¦è™½ç„¶æ²¡å­¦è¿‡ PGF åˆ°åº•æ€ä¹ˆåŒ–ï¼Œä½†æ˜¯æ¦‚ç‡ä¸Šæ±‚ $z$ è¡¥é›†å°±æ˜¯ $1-z$ è¿˜æ˜¯æ¯”è¾ƒ xxs çš„ç»“è®ºå§â€¦</p><p>ç„¶åç°åœ¨é—®é¢˜å°±é›†ä¸­åœ¨æ€ä¹ˆæ±‚ $P^n(y)$ çš„å‰ $k$ é¡¹äº†ã€‚å‘ç°å¯ä»¥æš´åŠ›å¤šé¡¹å¼å¿«é€Ÿå¹‚ï¼Œä»¥è·å¾— $40\sim 60$ å·¦å³çš„æˆç»©ã€‚</p><p>ç„¶åæ˜¯ç¥å¥‡çš„å¤šé¡¹å¼æŠ€å·§â€¦å¤§æ¦‚æ˜¯è€ƒè™‘å¯¹äº $P^{n+1}(y)$ æ±‚å¯¼æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><script type="math/tex; mode=display">\left(P^{n+1}(y)\right)^{\prime}=(n+1) P^{n}(y) P^{\prime}(y)\\\left(P^{n+1}(y)\right)^{\prime}=\left(P^{n}(y)\right)^{\prime} P(y)+P^{n}(y) P^{\prime}(y)</script><p>ç¬¬ä¸€ä¸ªå°±æ˜¯é“¾å¼æ³•åˆ™ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯æ‹†å‡ºä¸€ä¸ª $P(y)$ æ¥å†ç”¨æ±‚å¯¼çš„ä¹˜æ³•è¿ç®—æ³•åˆ™ã€‚</p><p>è€ƒè™‘è”ç«‹ä¹‹å</p><script type="math/tex; mode=display">nP^n(y)(P(y))'=(P^n(y))'P(y)</script><p>ç„¶åè€ƒè™‘ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå·²çŸ¥äº† $P^n(y)$ çš„å‰å‡ é¡¹ç³»æ•°ï¼Œæ±‚å‡ºåé¢çš„ç³»æ•°ã€‚è€ƒè™‘ä¸€ä¸ªè¿™æ ·çš„æ€è·¯ï¼šæ¯æ¬¡å…ˆæ±‚å‡º $(P^n(y))â€™$ çš„ç¬¬ $d$ é¡¹ï¼Œç„¶åç§¯åˆ†å‡º $P^n(y)$ çš„ç¬¬ $d+1$ é¡¹ã€‚å‘ç°æ¯ä¸ª $[y^d]P^n(y)$ åªä¼šå¯¹ $y^d\sim y^{d+k}$ è¿™äº›äº§ç”Ÿè´¡çŒ®ï¼Œæ‰€ä»¥è€ƒè™‘æšä¸¾åˆ°ä¸€ä¸ª $d$ çš„æ—¶å€™å‘ååˆ·è¡¨ï¼›è€ƒè™‘è¿™æ ·æ±‚å‡ºçš„æ˜¯ $(P^n(y))â€™P(y)$ ï¼Œç›´æ¥æ¨¡æ‹Ÿå¤šé¡¹å¼é™¤æ³•å³å¯å¾—åˆ° $(P^n(y))â€™$ ï¼Œè¿™æ ·åšä¹Ÿæ˜¯å•æ¬¡ $O(k)$ çš„ã€‚</p><p>å¯¹äºå¤šé¡¹å¼é™¤æ³•è¿™éƒ¨åˆ†ï¼Œå¯ä»¥è€ƒè™‘å¯¹äºæ¯ä¸ª $[y^d] (P^n(y))â€™P(y)$ éƒ½æ˜¯è¿™ä¹ˆè®¡ç®—å¾—åˆ°çš„ï¼š</p><script type="math/tex; mode=display">\sum_{p=0}^k [y^p] P(y)\times [y^{d-p}] (P^n(y))'</script><p>ç„¶åå°±å‡å»æ‰€æœ‰çš„ $p&gt;0$ çš„é‚£äº›ç»“æœï¼Œæœ€åä¹˜ä¸Šä¸€ä¸ª $[x^0]P(y)$ çš„é€†å…ƒå³å¯ã€‚</p><p>é¡ºä¾¿å¤ä¹ ä¸€ä¸‹çº¿æ€§æ±‚é€†å…ƒï¼š</p><p>è€ƒè™‘æ¨¡æ•°æ˜¯ $m$ï¼Œé‚£ä¹ˆè®¾ $m=p\cdot x+r$ï¼Œå¯ä»¥å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\begin{aligned}p\cdot x+r&\equiv 0\pmod m\\p\cdot r ^{-1}+x^{-1}&\equiv 0 \pmod m\\x^{-1}&\equiv -\lfloor\frac{m}{x}\rfloor\cdot (m\bmod x)^{-1}\pmod m\end{aligned}</script><h1 id="æ¥æºä¿å¯†çš„æ¯”èµ›-Barrel"><a href="#æ¥æºä¿å¯†çš„æ¯”èµ›-Barrel" class="headerlink" title="[æ¥æºä¿å¯†çš„æ¯”èµ› ?] Barrel"></a>[æ¥æºä¿å¯†çš„æ¯”èµ› ?] Barrel</h1><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="Barrel.png" alt=""><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="Barrel2.png" alt=""><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="Barrel3.png" alt=""><br><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="Parrel4.png" alt=""></p><p>è¯»é¢˜è®©äººååˆ†è¿·æƒ‘â€¦æ³¨æ„è¿™é¢˜é‡Œé¢ $c_{i,j}$ æ˜¯ç»™å®šçš„ï¼Œåªä¸è¿‡å› ä¸ºæ ·ä¾‹é‡Œé¢æ°å¥½æ˜¯æ²¡æœ‰è¿™éƒ¨åˆ†è¾“å…¥è€Œå·²â€¦â€¦</p><hr><p>å…‰æ˜¯è¯»é¢˜å°±ä¼šè®©äººååˆ†è¿·æƒ‘çš„é¢˜â€¦</p><p>å› ä¸ºä¸ç¬¦å·å†²çªäº†ï¼Œäºæ˜¯å†³å®šæŠŠé¢˜é¢ä¸­çš„ $z$ æ”¹æˆ $c$ ï¼Œ$z$ ç»´æŒåŸæ¥çš„å½¢å¼å¹‚çº§æ•°å®šä¹‰ä¸å˜ã€‚</p><p>è€ƒè™‘æ·±åˆ»åœ°æŒ–æ˜é¢˜ç›®æ€§è´¨ï¼šå¯¹äºæ¯ä¸ªæ¡¶ï¼Œæ‰€æœ‰å¹´ä»½ä½“ç§¯çš„é…’çš„ä½“ç§¯æ€»å’Œæ˜¯ $1$ ã€‚æ‰€ä»¥å¦‚æœè®¾ç¬¬ $i$ ä¸ªæ¡¶é‡Œå¹´ä»½ä¸º $j$ çš„é…’ä½“ç§¯ä¸º $V_{i,j}$ ï¼Œå¯ä»¥å‘ç°æœ¬é¢˜è¦æ±‚</p><blockquote><p>ç¬¬ $n$ ä¸ªæ¡¶å†…å–ä¸€å¾®å…ƒé…’çš„å•ä»·æœŸæœ›/æ–¹å·®ï¼Œ</p></blockquote><p>å®é™…ä¸Šå°±æ˜¯åœ¨æ±‚</p><blockquote><p><strong>ç¬¬ $n$ ä¸ªæ¡¶æœ‰ $V_{n,j}$ çš„æ¦‚ç‡å˜æˆç¬¬ $j$ å¹´çš„é…’ï¼Œæ±‚ç¬¬ $n$ æ¡¶é…’çš„æœŸæœ›ä»·å€¼ã€‚</strong></p></blockquote><p>è€ƒè™‘å…ˆç®—è¿™ä¸ªæ¦‚ç‡ã€‚</p><p>è€ƒè™‘ä¸€ä¸ªçªç ´ç‚¹ï¼Œå‘ç°æ¯æ¬¡ç»™å‡ºå»çš„ä¸€å®šæ˜¯å‡åŒ€çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦è€ƒè™‘ç»™å‡ºå»çš„å¦‚ä½•åˆ†é…ã€‚æ¢è¨€ä¹‹å¦‚æœè¿™ä¸€å›åˆç»™è¿›æ¥çš„æ€»ä½“ç§¯(ä¸çœ‹å¹´ä»½)æ˜¯ $V$ ï¼Œé‚£ä¹ˆç»™å‡ºå»çš„å¿…ç„¶æ˜¯ $1-V$ å¹¶ä¸”æ˜¯å‡åŒ€çš„ã€‚</p><p>æ ¹æ®ä¸Šä¸€ç‚¹ï¼Œç†åº”æƒ³åˆ°ï¼Œ$1$ å·é…’æ¡¶å°±æ˜¯çªç ´å£ï¼Œå› ä¸º $1$ å·æ¡¶è¿›æ¥çš„åªä¼šæ˜¯ $f$ ã€‚äºæ˜¯è€ƒè™‘è®¾æ¯ä¸ªæ¡¶å†…æ¯ä¸€è½®æ–°å€’å…¥çš„ä½“ç§¯ä¸º $m_i$ï¼Œé‚£ä¹ˆä¼šæœ‰</p><script type="math/tex; mode=display">m_i=\begin{cases}f&\mathrm{if}~(i=1)\\\sum_{j=1}^{i-1}c_{i,j}&\mathrm{otherwise}\end{cases}</script><p>äºæ˜¯è€ƒè™‘è®¾ $f_{i,j}$ è¡¨ç¤ºç¬¬ $i$ ä¸ªæ¡¶å†…å˜æˆç¬¬ $j$ å¹´é…’çš„æ¦‚ç‡ï¼Œå¯¹æ¯ä¸€ä¸ª $i$ å»ºç«‹æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•° $\mathscr F_i(z)$ ï¼Œé‚£ä¹ˆä¼šæœ‰</p><script type="math/tex; mode=display">\mathscr F_{i}(z)=\mathscr F_{i}(z)\cdot z\cdot (1-m_i)+\sum_{j=1}^i m_j\mathscr{F}_j(z)</script><p>è¿™ä¸ªå¼å­æœ¬è´¨ä¸Šæ¨¡æ‹Ÿäº†å–é…’ã€å€’é…’è¿™ä¸ªè¿‡ç¨‹ã€‚</p><p>è€ƒè™‘è®¡ç®—ç­”æ¡ˆï¼Œæ ¹æ®ä¸Šæ–‡å¯ä»¥çŸ¥é“</p><script type="math/tex; mode=display">\mathsf{Var}(X)=E(X^2)-E^2(X)</script><p>è€ƒè™‘åé¢ä¸€é¡¹æœ¬è´¨ä¸Šæ˜¯</p><script type="math/tex; mode=display">\left(\sum_{i=0}^{+\infty} i\cdot c^i\cdot [z^i]\mathscr{F}_{n}(z)\right)^2</script><p>ç„¶åå‘ç°â€¦å¦‚æœå°†ä¸å®šå…ƒ $z$ èµ‹å€¼æˆ $c$ ï¼Œé‚£ä¹ˆä¸Šå¼å°±æ˜¯</p><script type="math/tex; mode=display">\left(c\cdot \frac{\mathrm{d}}{\mathrm{d}z}\mathscr{F}_n(c)\right)^2</script><p>åŒç†ç¬¬ä¸€é¡¹å°±æ˜¯</p><script type="math/tex; mode=display">\sum_{i=0}^{+\infty} i\cdot c^{2}\cdot [z^{2\cdot i}]\mathscr{F}_{n}(z^2)</script><p>ç­‰ä»·äº</p><script type="math/tex; mode=display">c^4\cdot \frac{\mathrm{d^2}}{\mathrm{d}z^2}\mathscr{F}_n(c^2)+c^2\cdot \frac{\mathrm{d}}{\mathrm{d}z}\mathscr{F}_n(c^2)</script><p>å…¶ä¸­ååŠéƒ¨åˆ†ä¸ºäº†è¡¥å…¨ç³»æ•°ã€‚</p><p>ç„¶åå°±å¯ä»¥ç›´æ¥åšäº†ï¼Œç”¨ä¸€äº›æ±‚å¯¼æŠ€å·§ç»´æŠ¤ </p><script type="math/tex; mode=display">\mathscr{F}_{i}(z), \mathscr{F}_{i}^{\prime}(z), \mathscr{F}_{i}\left(z^{2}\right), \mathscr{F}_{i}^{\prime}\left(z^{2}\right), \mathscr{F}_{i}^{\prime \prime}\left(z^{2}\right)</script><p>çš„å€¼å³å¯ã€‚å¤æ‚åº¦ $n^2$ ã€‚</p><h1 id="ä»£ç åˆé›†"><a href="#ä»£ç åˆé›†" class="headerlink" title="ä»£ç åˆé›†"></a>ä»£ç åˆé›†</h1><p>å¤§æ¦‚æ˜¯ä¸Šé¢çš„é¢˜å†™äº†ä»£ç å°±ä¼šä¸¢åˆ°è¿™é‡Œä¸€ä»½ï¼Œçœ‹å¿ƒæƒ…ä¿ç•™å®Œæ•´ç‰ˆè¿˜æ˜¯å±€éƒ¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hdu4652 Dice</span></span><br><span class="line"><span class="comment">//author: Orchidany</span></span><br><span class="line"><span class="keyword">int</span> q ;</span><br><span class="line">db ans ;</span><br><span class="line">db res ;</span><br><span class="line"><span class="keyword">int</span> k, m, n ;</span><br><span class="line"></span><br><span class="line"><span class="function">db <span class="title">expow</span><span class="params">(db x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    db ret = <span class="number">1.0</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = <span class="number">1.0</span> * ret * x ;</span><br><span class="line">        x = <span class="number">1.0</span> * x * x ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">cin</span> &gt;&gt; q)&#123;</span><br><span class="line">        <span class="keyword">while</span> (q --)&#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; k &gt;&gt; m &gt;&gt; n ; </span><br><span class="line">            <span class="keyword">if</span> (!k)&#123;</span><br><span class="line">                <span class="keyword">if</span> (m &lt;= <span class="number">1</span>) ans = <span class="number">1.0</span> * n ;</span><br><span class="line">                <span class="keyword">else</span> ans = (expow(m, n) - <span class="number">1.0</span>) / (<span class="number">1.0</span> * (m - <span class="number">1.0</span>)) ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res = <span class="number">1</span> ; ans = <span class="number">0.0</span> ;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">                    res *= <span class="number">1.0</span> * m / (m - i + <span class="number">1</span>), ans += res ;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%.10lf\n"</span>, ans) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CTSC2006 æ­Œå”±ç‹å›½</span></span><br><span class="line"><span class="comment">//author: Orchidany</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> T, n, m ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            ret = <span class="number">1l</span>l * ret * x % P ;</span><br><span class="line">        x = <span class="number">1l</span>l * x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; T ;</span><br><span class="line">    <span class="keyword">while</span> (T --)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; m ; <span class="keyword">int</span> j = <span class="number">0</span> ; ans = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">            base[i] = qr(), f[i] = <span class="number">0</span> ; f[<span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">            <span class="keyword">while</span> (j &amp;&amp; base[j + <span class="number">1</span>] != base[i]) j = f[j] ;</span><br><span class="line">            <span class="keyword">if</span> (base[j + <span class="number">1</span>] == base[i]) ++ j ; f[i] = j ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (m) add(ans, expow(n, m), P), m = f[m] ;</span><br><span class="line">        <span class="keyword">if</span> (ans &lt; <span class="number">10</span>) <span class="built_in">printf</span>(<span class="string">"000"</span>) ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ans &lt; <span class="number">100</span>) <span class="built_in">printf</span>(<span class="string">"00"</span>) ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ans &lt; <span class="number">1000</span>) <span class="built_in">printf</span>(<span class="string">"0"</span>) ; <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ZJOI2013 æŠ›ç¡¬å¸</span></span><br><span class="line"><span class="comment">//author : Orchidany</span></span><br><span class="line"><span class="keyword">const</span> ll Base = <span class="number">100000000</span> ;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_L</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">if</span> (!x) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (x) ret ++, x /= <span class="number">10</span> ;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Big_Num</span>&#123;</span></span><br><span class="line">    ll v[<span class="number">2051</span>] ;</span><br><span class="line">    <span class="keyword">bool</span> mk ; <span class="keyword">int</span> len, lent ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">        len = <span class="number">0</span>, mk = <span class="number">0</span>, <span class="built_in">memset</span>(v, <span class="number">0</span>, <span class="keyword">sizeof</span>(v)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">out_put</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mk &amp;&amp; !(len &lt;= <span class="number">1</span> &amp;&amp; !v[<span class="number">1</span>])) <span class="built_in">putchar</span>(<span class="string">'-'</span>) ;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = len ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line"><span class="keyword">if</span> (i == len)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld"</span>, v[i]) ;</span><br><span class="line"><span class="keyword">continue</span> ;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= <span class="number">8</span> - get_L(v[i]) ; ++ j) <span class="built_in">putchar</span>(<span class="string">'0'</span>) ;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld"</span>, v[i]) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//puts("") ;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_v</span><span class="params">(T x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) mk = <span class="number">1</span>, x = -x ;</span><br><span class="line">        <span class="keyword">while</span> (x) v[++ len] = x % Base, x /= Base ;</span><br><span class="line">lent = (len - <span class="number">1</span>) * <span class="number">8</span> + get_L(x) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set_v</span><span class="params">(<span class="keyword">char</span> *x, <span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> p = <span class="number">0</span> ; reset() ;</span><br><span class="line">        <span class="keyword">if</span> (x[<span class="number">1</span>] == <span class="string">'-'</span>) ++ p, mk = <span class="number">1</span> ;</span><br><span class="line">        len = (L - p) / <span class="number">8</span> + (((L - p) % <span class="number">8</span>) &gt; <span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = L, k = len ; i &gt;= p + <span class="number">1</span> ; i -= <span class="number">8</span>, -- k)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = min(i - p, <span class="number">8</span>) ; j &gt;= <span class="number">1</span> ; -- j)</span><br><span class="line">                v[k] = v[k] * <span class="number">10l</span>l + (x[i - j + <span class="number">1</span>] - <span class="string">'0'</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">reverse(v + <span class="number">1</span>, v + len + <span class="number">1</span>) ;  lent = L - p ;</span><br><span class="line">    &#125;</span><br><span class="line">    Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> ~ (Big_Num A)&#123;</span><br><span class="line">        A.mk ^= <span class="number">1</span> ; <span class="keyword">return</span> A ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> ^ (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.len != B.len) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= A.len ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (A.v[i] != B.v[i]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B) ;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &gt; (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B) ;</span><br><span class="line">    Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> + (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B) ;</span><br><span class="line">    Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> - (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B) ;</span><br><span class="line">    il <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.len &lt; B.len) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (A.len &gt; B.len) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = A.len ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (A.v[i] &lt; B.v[i]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (A.v[i] &gt; B.v[i]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    il <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &gt; (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.len &lt; B.len) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (A.len &gt; B.len) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = A.len ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (A.v[i] &gt; B.v[i]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (A.v[i] &lt; B.v[i]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    il <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &lt;= (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.len &lt; B.len) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (A.len &gt; B.len) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = A.len ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (A.v[i] &lt; B.v[i]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (A.v[i] &gt; B.v[i]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    il <span class="keyword">bool</span> <span class="keyword">friend</span> <span class="keyword">operator</span> &gt;= (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        <span class="keyword">if</span> (A.len &lt; B.len) <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (A.len &gt; B.len) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = A.len ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (A.v[i] &gt; B.v[i]) <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (A.v[i] &lt; B.v[i]) <span class="keyword">return</span> <span class="number">0</span> ; <span class="keyword">return</span> <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> - (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        Big_Num res ; res.reset() ;</span><br><span class="line">        Big_Num p, q, t ; p = A, q = B ;</span><br><span class="line">        <span class="keyword">if</span> (p.lent &lt; q.lent) &#123; <span class="keyword">return</span> (~ (q - p)) ; &#125;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= p.len ; ++ i) res.v[i] = p.v[i] - q.v[i] ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= p.len ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (res.v[i] &lt; <span class="number">0</span>) res.v[i + <span class="number">1</span>] --, res.v[i] += Base ;</span><br><span class="line">        res.len = p.len ; res.v[<span class="number">0</span>] = <span class="number">-1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = res.len + <span class="number">20</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (res.v[i]) &#123; res.len = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">        <span class="keyword">if</span> (!res.len) res.len ++ ;</span><br><span class="line"><span class="keyword">if</span> (res.v[res.len] &lt; <span class="number">0</span>)</span><br><span class="line">            res.mk = <span class="number">1</span>, res.len --, res.v[res.len] = Base - res.v[res.len] ;</span><br><span class="line">        res.lent = (res.len - <span class="number">1</span>) * <span class="number">8</span> + get_L(res.v[res.len]) ;</span><br><span class="line">        <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> + (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        Big_Num res ;</span><br><span class="line">        res.reset() ; Big_Num p, q ;</span><br><span class="line">        <span class="keyword">if</span> (A.len &gt; B.len)</span><br><span class="line">            p = A, q = B ; <span class="keyword">else</span> p = B, q = A ;</span><br><span class="line">        <span class="keyword">if</span> (p.mk &amp;&amp; q.mk) res.mk = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.mk &amp;&amp; !q.mk) &#123; p.mk = <span class="number">0</span> ; <span class="keyword">return</span> (q - p) ; &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!p.mk &amp;&amp; q.mk) &#123; q.mk = <span class="number">0</span> ; <span class="keyword">return</span>(p - q) ; &#125;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= p.len ; ++ i) res.v[i] = p.v[i] + q.v[i] ;</span><br><span class="line">        res.len = p.len ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= p.len + <span class="number">1</span> ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (res.v[i] &gt;= Base)</span><br><span class="line">                res.v[i + <span class="number">1</span>] += res.v[i] / Base, res.v[i] %= Base ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = res.len + <span class="number">10</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (res.v[i]) &#123; res.len = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">        res.lent = (res.len - <span class="number">1</span>) * <span class="number">8</span> + get_L(res.v[res.len]) ;</span><br><span class="line"><span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Big_Num <span class="keyword">friend</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> Big_Num &amp; A, <span class="keyword">const</span> Big_Num &amp; B)&#123;</span><br><span class="line">        Big_Num res ; res.reset() ; res.len = A.len + B.len ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= A.len ; ++ i)</span><br><span class="line">            <span class="keyword">for</span> (rg <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= B.len ; ++ j)</span><br><span class="line">                res.v[i + j - <span class="number">1</span>] += A.v[i] * B.v[j] ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= res.len + <span class="number">10</span> ; ++ i)</span><br><span class="line">            res.v[i + <span class="number">1</span>] += res.v[i] / Base, res.v[i] %= Base ;</span><br><span class="line">        res.v[<span class="number">0</span>] = <span class="number">-1</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = res.len + <span class="number">10</span> ; i &gt;= <span class="number">0</span> ; -- i)</span><br><span class="line">            <span class="keyword">if</span> (res.v[i]) &#123; res.len = i ; <span class="keyword">break</span> ; &#125;</span><br><span class="line">        <span class="keyword">if</span> (!res.len) res.len ++ ;</span><br><span class="line">        res.lent = (res.len - <span class="number">1</span>) * <span class="number">8</span> + get_L(res.v[res.len]) ; <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">div2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = len ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">            v[i - <span class="number">1</span>] += (v[i] % <span class="number">2l</span>l) * Base, v[i] &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        v[<span class="number">0</span>] &gt;&gt;= <span class="number">1</span> ; <span class="keyword">while</span>(v[len] == <span class="number">0</span>) len -- ;</span><br><span class="line">        lent = (len - <span class="number">1</span>) * <span class="number">8</span> + get_L(v[len]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">mul2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= len ; ++ i) &#123;</span><br><span class="line">            v[i] = v[i] * <span class="number">2</span> + r, r = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">if</span>(v[i] &gt;= Base) &#123;</span><br><span class="line">                r = v[i] / Base, v[i] %= Base ;</span><br><span class="line">                <span class="keyword">if</span> (i == len) len ++ ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        lent = (len - <span class="number">1</span>) * <span class="number">8</span> + get_L(v[len]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Big_Num <span class="keyword">friend</span> <span class="title">gcd</span><span class="params">(Big_Num A, Big_Num B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt2 = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span>(!(A ^ B))&#123;</span><br><span class="line">            <span class="keyword">if</span> (A &lt; B) swap(A, B) ;</span><br><span class="line">            <span class="keyword">bool</span> a = A.v[<span class="number">1</span>] &amp; <span class="number">1</span>, b = B.v[<span class="number">1</span>] &amp; <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">if</span> (!a &amp;&amp; !b) A.div2(), B.div2(), ++ cnt2 ;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!b) B.div2() ; <span class="keyword">else</span> <span class="keyword">if</span> (!a) A.div2() ; <span class="keyword">else</span> A = A - B ;</span><br><span class="line">        &#125;</span><br><span class="line">        Big_Num tmp, pmt ;</span><br><span class="line">        tmp.set_v(<span class="number">2</span>), pmt.set_v(<span class="number">1</span>) ;</span><br><span class="line"><span class="keyword">while</span> (cnt2)&#123;</span><br><span class="line"><span class="keyword">if</span> (cnt2 &amp; <span class="number">1</span>)</span><br><span class="line">pmt = pmt * tmp ;</span><br><span class="line">tmp = tmp * tmp ; cnt2 &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">return</span> (A = A * pmt) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ;</span><br><span class="line">Big_Num g, t ;</span><br><span class="line">Big_Num l, r, mid, ans ;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Frac</span>&#123;</span></span><br><span class="line">    Big_Num fz, fm ;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">        fz.reset() ;</span><br><span class="line">        fm.reset() ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Big_Num t = fz ; fz = fm, fm = t ;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function">il <span class="keyword">void</span> <span class="title">div</span><span class="params">()</span></span>&#123;</span><br><span class="line">        g = gcd(fz, fm) ; r.reset() ;</span><br><span class="line"><span class="keyword">int</span> lnr = fz.len - g.len ; l.reset() ; l.len = lnr  ;</span><br><span class="line">l.v[l.len] = <span class="number">1</span> ; r.len = lnr + <span class="number">1</span> ; r.v[r.len] = <span class="number">90000000</span> ;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">            mid = (l + r) ; mid.div2() ;</span><br><span class="line">            <span class="keyword">if</span> (mid * g &gt;= fz) ans = mid, r = mid - t ; <span class="keyword">else</span> l = mid + t ;</span><br><span class="line">        &#125;</span><br><span class="line">        fz = ans ; l.reset() ;</span><br><span class="line">lnr = fm.len - g.len ; l.reset() ; l.len = lnr ;</span><br><span class="line">l.v[l.len] = <span class="number">1</span> ; r.len = lnr + <span class="number">1</span> ; r.v[r.len] = <span class="number">90000000</span> ;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r)&#123;</span><br><span class="line">            mid = (l + r) ; mid.div2() ;</span><br><span class="line">            <span class="keyword">if</span> (mid * g &gt;= fm) ans = mid, r = mid - t ; <span class="keyword">else</span> l = mid + t ;</span><br><span class="line">        &#125;</span><br><span class="line">        fm = ans ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">out_put</span><span class="params">()</span></span>&#123;</span><br><span class="line">        fz.out_put() ;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">'/'</span>) ;</span><br><span class="line">        fm.out_put() ; <span class="built_in">puts</span>(<span class="string">""</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">set_v</span><span class="params">(T son, T mum)</span></span>&#123;</span><br><span class="line">        fz.set_v(son), fm.set_v(mum) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function">il <span class="keyword">void</span> <span class="title">set_v</span><span class="params">(<span class="keyword">char</span> *son, <span class="keyword">int</span> Lson, <span class="keyword">char</span> *mum, <span class="keyword">int</span> Lmum)</span></span>&#123;</span><br><span class="line">        fz.set_v(son, Lson) ; fm.set_v(mum, Lmum) ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Frac <span class="keyword">friend</span> <span class="keyword">operator</span> + (Frac A, Frac B)&#123;</span><br><span class="line">        Frac res ; res.reset() ;</span><br><span class="line">        <span class="keyword">if</span> (!A.fz.len &amp;&amp; !A.fm.len) <span class="keyword">return</span> B ;</span><br><span class="line">        <span class="keyword">if</span> (!B.fz.len &amp;&amp; !B.fm.len) <span class="keyword">return</span> A ;</span><br><span class="line">        <span class="keyword">if</span> (!(A.fm ^ B.fm))&#123;</span><br><span class="line">            Big_Num p = A.fm, q = B.fm, o, s, t ;</span><br><span class="line">            o = p * q ; s = q * A.fz ; t = p * B.fz ;</span><br><span class="line">            A.fm = o ; B.fm = o ; A.fz = s ; B.fz = t ;</span><br><span class="line">        &#125;</span><br><span class="line">        res.fm = A.fm ; res.fz = A.fz + B.fz ; <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Frac <span class="keyword">friend</span> <span class="keyword">operator</span> - (Frac A, Frac B)&#123;</span><br><span class="line">        Frac res ; res.reset() ;</span><br><span class="line">        <span class="keyword">if</span> (!(A.fm ^ B.fm))&#123;</span><br><span class="line">            Big_Num p = A.fm, q = B.fm, o, s, t ;</span><br><span class="line">            o = p * q ; s = q * A.fz ; t = p * B.fz ;</span><br><span class="line">            A.fm = o ; B.fm = o ; A.fz = s ; B.fz = t ;</span><br><span class="line">        &#125;</span><br><span class="line">        res.fm = A.fm ; res.fz = A.fz - B.fz ; <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Frac <span class="keyword">friend</span> <span class="keyword">operator</span> * (<span class="keyword">const</span> Frac &amp; A, <span class="keyword">const</span> Frac &amp; B)&#123;</span><br><span class="line">        Frac res ; res.reset() ;</span><br><span class="line">        res.fm = A.fm * B.fm ;</span><br><span class="line">        res.fz = A.fz * B.fz ;</span><br><span class="line">        <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Frac <span class="keyword">friend</span> <span class="keyword">operator</span> ^ (<span class="keyword">const</span> Frac &amp; A, <span class="keyword">const</span> Frac &amp; B)&#123;</span><br><span class="line">        Frac res ; res.reset() ;</span><br><span class="line">        res.fz = A.fz * B.fz ; res.fm = A.fm ; <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">    il Frac <span class="keyword">friend</span> <span class="keyword">operator</span> &amp; (<span class="keyword">const</span> Frac &amp; A, <span class="keyword">const</span> Frac &amp; B)&#123;</span><br><span class="line">        Frac res ; res.reset() ;</span><br><span class="line">        res.fm = A.fm * B.fm ; res.fz = A.fz ; <span class="keyword">return</span> res ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; r1, r2, r3, r0 ;</span><br><span class="line"><span class="comment">/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[N] ;</span><br><span class="line"><span class="keyword">int</span> A, B ;</span><br><span class="line">Frac res ;</span><br><span class="line"><span class="keyword">char</span> S[N] ;</span><br><span class="line">Frac Rp[N] ;</span><br><span class="line">Frac Pr[N] ;</span><br><span class="line"><span class="keyword">int</span> base[N] ;</span><br><span class="line"><span class="keyword">int</span> T, n, m ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; A &gt;&gt; B ;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; (S + <span class="number">1</span>) ;</span><br><span class="line">r0.set_v(<span class="number">1</span>, B) ;</span><br><span class="line">    r1.set_v(A, <span class="number">1</span>) ;</span><br><span class="line">Rp[<span class="number">0</span>].set_v(<span class="number">1</span>, <span class="number">1</span>) ;</span><br><span class="line">r2.set_v(B - A, <span class="number">1</span>) ;</span><br><span class="line">    m = <span class="built_in">strlen</span>(S + <span class="number">1</span>), Pr[m].set_v(<span class="number">1</span>, <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)</span><br><span class="line">        base[i] = (<span class="keyword">bool</span>)(S[i] == <span class="string">'H'</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (rg <span class="keyword">int</span> j = m ; j &gt;= <span class="number">1</span> ; -- j)</span><br><span class="line">        Pr[j - <span class="number">1</span>] = Pr[j] ^ (base[j] ? r1 : r2) ;</span><br><span class="line">    <span class="keyword">for</span> (rg <span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j) Rp[j] = Rp[j - <span class="number">1</span>] &amp; r0 ;</span><br><span class="line">    <span class="keyword">for</span> (rg <span class="keyword">int</span> i = <span class="number">2</span>, j = <span class="number">0</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">while</span> (j &amp;&amp; base[j + <span class="number">1</span>] != base[i]) j = f[j] ;</span><br><span class="line">        <span class="keyword">if</span> (base[j + <span class="number">1</span>] == base[i]) ++ j ; f[i] = j ;</span><br><span class="line">    &#125;</span><br><span class="line">    t.reset() ; t.set_v(<span class="number">1</span>) ;</span><br><span class="line">    r3 = Pr[<span class="number">0</span>] * Rp[m] ; r3.reverse() ; <span class="keyword">int</span> k = m ;</span><br><span class="line">    <span class="keyword">while</span> (m) res = res + Pr[m] * Rp[k - m] , m = f[m] ;</span><br><span class="line">res = res * r3 ; res.div() ; res.out_put() ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[æ¥æºä¿å¯†çš„æ¯”èµ› 1A] Probability</span></span><br><span class="line"><span class="comment">//author : Orchidany</span></span><br><span class="line"><span class="keyword">int</span> sum ;</span><br><span class="line"><span class="keyword">int</span> res ;</span><br><span class="line"><span class="keyword">int</span> ans ;</span><br><span class="line"><span class="keyword">int</span> base ;</span><br><span class="line"><span class="keyword">int</span> F[M] ;</span><br><span class="line"><span class="keyword">int</span> f[M] ;</span><br><span class="line"><span class="keyword">int</span> G[N] ;</span><br><span class="line"><span class="keyword">int</span> g[N] ;</span><br><span class="line"><span class="keyword">int</span> tmp[N] ;</span><br><span class="line"><span class="keyword">int</span> inv[N] ;</span><br><span class="line"><span class="keyword">int</span> n, k, x ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (b)&#123;</span><br><span class="line">        <span class="keyword">if</span> (b &amp; <span class="number">1</span>)</span><br><span class="line">            ret = (ll)ret * a % P ;</span><br><span class="line">        a = (ll)a * a % P ; b &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k &gt;&gt; x ; inv[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        F[i] = qr(), add(sum, <span class="number">1l</span>l * F[i]) ;</span><br><span class="line">    sum = expow(sum, P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        F[i] = <span class="number">1l</span>l * F[i] * sum % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= k ; ++ i)</span><br><span class="line">        f[i] = <span class="number">1l</span>l * n * F[i + <span class="number">1</span>] % P * (i + <span class="number">1</span>) % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= x ; ++ i)</span><br><span class="line">        inv[i] = (<span class="number">-1l</span>l * inv[P % i] * (P / i) % P) + P;</span><br><span class="line">    base = expow(F[<span class="number">0</span>], P - <span class="number">2</span>) ; G[<span class="number">0</span>] = expow(F[<span class="number">0</span>], n) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; x ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; i + j &lt; x &amp;&amp; j &lt;= k ; ++ j)</span><br><span class="line">            add(tmp[i + j], <span class="number">1l</span>l * f[j] * G[i] % P) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; i - j &gt;= <span class="number">0</span> &amp;&amp; j &lt;= k ; ++ j)</span><br><span class="line">            dec(tmp[i], <span class="number">1l</span>l * g[i - j] * F[j] % P) ;</span><br><span class="line">        g[i] = <span class="number">1l</span>l * base * tmp[i] % P ;</span><br><span class="line">        G[i + <span class="number">1</span>] = <span class="number">1l</span>l * g[i] * inv[i + <span class="number">1</span>] % P ;</span><br><span class="line">        add(ans, <span class="number">1l</span>l * i * G[i] % P) ; dec(res, G[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    res += <span class="number">1</span> ; add(ans, <span class="number">1l</span>l * res * x % P) ; <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span> ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[SDOI2017] ç¡¬å¸æ¸¸æˆ</span></span><br><span class="line"><span class="comment">//long double ç¡®å®å¾ˆæ…¢</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Base = <span class="number">233</span> ;</span><br><span class="line"></span><br><span class="line">ldb val[N] ;</span><br><span class="line"><span class="keyword">int</span> pos[N] ;</span><br><span class="line">ldb ans[N] ;</span><br><span class="line">ldb f[N][N] ;</span><br><span class="line"><span class="keyword">char</span> s[N][N] ;</span><br><span class="line"><span class="keyword">int</span> _hs[N][N] ;</span><br><span class="line"><span class="keyword">bool</span> match[N][N][N] ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> decn(_hs[t][r], <span class="number">1l</span>l * _hs[t][l - <span class="number">1</span>] * pos[r - l + <span class="number">1</span>] % P) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gauss</span><span class="params">(<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= L ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">int</span> r = i ; db t ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (f[r][i] &lt; f[j][i]) swap(f[r], f[j]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = L + <span class="number">1</span> ; j &gt;= i ; -- j) f[r][j] /= f[r][i] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = L + <span class="number">1</span> ; k &gt;= i ; -- k)</span><br><span class="line">                f[j][k] -= f[j][i] * f[r][k] ;</span><br><span class="line">    &#125;</span><br><span class="line">    ans[L] = f[L][L + <span class="number">1</span>] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = L - <span class="number">1</span> ; i &gt;= <span class="number">1</span> ; -- i)&#123;</span><br><span class="line">        ans[i] = f[i][L + <span class="number">1</span>] ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt;= L ; ++ j)</span><br><span class="line">            ans[i] -= ans[j] * f[i][j] ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m ;</span><br><span class="line">    pos[<span class="number">0</span>] = val[<span class="number">0</span>] = <span class="number">1.0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">cin</span> &gt;&gt; (s[i] + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= m ; ++ i)&#123;</span><br><span class="line">        val[i] = val[i - <span class="number">1</span>] * <span class="number">2.0</span> ;</span><br><span class="line">        pos[i] = <span class="number">1l</span>l * pos[i - <span class="number">1</span>] * Base % P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= m ; ++ j)</span><br><span class="line">            _hs[i][j] = ((ll)_hs[i][j - <span class="number">1</span>] * Base % P + s[i][j]) % P ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span> ; k &lt;= m ; ++ k)</span><br><span class="line">                match[i][j][k] = (<span class="keyword">bool</span>)(ask(i, <span class="number">1</span>, k) == ask(j, m - k + <span class="number">1</span>, m)) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= n ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span> ; k &lt;= m ; ++ k)</span><br><span class="line">                f[i][j] += (db)match[i][j][k] * val[k] ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) f[n + <span class="number">1</span>][i] = <span class="number">1.0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) f[i][n + <span class="number">1</span>] = - <span class="number">1.0</span> ; f[n + <span class="number">1</span>][n + <span class="number">2</span>] = <span class="number">1.0</span> ;</span><br><span class="line">    gauss(n + <span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.7Lf\n"</span>, ans[i]) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„â€¦å°±å…ˆé¸½ç€å§ï¼Œæ„Ÿè§‰é™¤äº†å¤ä¹ é«˜æ¶ˆä¹‹å¤–ä¹Ÿæ²¡å•¥å¥½å†™çš„äº†ã€‚</p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>è¿™æ–‡ç« çœŸæ˜¯è«åå…¶å¦™çš„å†™äº†å¥½å‡ å¤©ï¼Œå¯èƒ½æ˜¯é¢˜ç›®é’›æ¯’ç˜¤äº†å¯¼è‡´ç»å¸¸å‡ºç°æ€ç»´æ‰çº¿çš„å±€é¢â€¦</p><p>å…¶ä¸­æ¯”è¾ƒå¤šé¢˜ç›®çš„éƒ½æ˜¯æ¨æ‡‹é¾™å‰è¾ˆè®ºæ–‡é‡Œçš„ï¼Œè‡ªå·±å­¦ä¹ äº†ä¸€ä¸‹ï¼Œé¡ºä¾¿åŠ ä¸Šäº†ä¸€äº›è‡ªå·±çš„å¿ƒå¾—ã€‚</p><p>è¿™å¯èƒ½å°±æ˜¯â€¦æ‰§å¿µå§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤§æ¦‚æ˜¯æœ€è¿‘çš„ç ”ç©¶æˆæœå§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ã€Œå­¦ä¸ä¼šçš„ç”Ÿæˆå‡½æ•°ã€+ã€Œå­¦ä¸ä¼šçš„æ¦‚ç‡è®ºã€= &lt;code&gt;?&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç®—æ˜¯æ¯”è¾ƒè¯¦ç»†åœ°ç ”ç©¶äº†ä¸€ä¸‹è¿™éƒ¨åˆ†å†…å®¹å§ã€‚ä¸ªäººè®¤ä¸ºæ˜¯å…¨ç½‘èƒ½æ‰¾åˆ°æœ€è¯¦ç»†çš„æŒ‡å—äº† qwqã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="ç”Ÿæˆå‡½æ•°" scheme="https://www.orchidany.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/"/>
    
    
      <category term="å¥½å¤šå¥½å¤šç»†èŠ‚" scheme="https://www.orchidany.cn/tags/%E5%A5%BD%E5%A4%9A%E5%A5%BD%E5%A4%9A%E7%BB%86%E8%8A%82/"/>
    
      <category term="å¾®åˆ†æ–¹ç¨‹" scheme="https://www.orchidany.cn/tags/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/"/>
    
      <category term="ç»„åˆè®¡æ•°/æ¦‚ç‡å‹ç”Ÿæˆå‡½æ•°(PGF)" scheme="https://www.orchidany.cn/tags/%E7%BB%84%E5%90%88%E8%AE%A1%E6%95%B0-%E6%A6%82%E7%8E%87%E5%9E%8B%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0-PGF/"/>
    
  </entry>
  
  <entry>
    <title>ã€UR#3ã€‘é“¾å¼ååº”</title>
    <link href="https://www.orchidany.cn/2020/05/02/UR50%E9%93%BE%E5%BC%8F%E5%8F%8D%E5%BA%94/"/>
    <id>https://www.orchidany.cn/2020/05/02/UR50é“¾å¼ååº”/</id>
    <published>2020-05-02T13:08:39.000Z</published>
    <updated>2020-05-09T07:25:38.590Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>ä¸€é“è¯»é¢˜å°±å¾ˆéº»çƒ¦çš„é¢˜ç›®ï¼Œä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆçš„é¢˜é¢ï¼š</p><blockquote><p>ç»™å®š $n$ å’Œé›†åˆ $\mathbb{A}$ï¼Œå¯¹äº $i=1..n$ æ±‚å¤šå°‘ $i$ ä¸ªèŠ‚ç‚¹æœ‰æ ‡å·çš„å¤šå‰æ ‘æ»¡è¶³ï¼š</p><p>1ã€çˆ¶äº²èŠ‚ç‚¹çš„æ ‡å·å¤§äºå­èŠ‚ç‚¹ã€‚</p><p>2ã€ä¸€ä¸ªç‚¹å¦‚æœæœ‰å„¿å­ï¼Œåˆ™æœ‰ä¸¤ä¸ªæ— åºçš„ $Î±$ å‹å„¿å­ï¼Œæœ‰ $c$ ä¸ªæ— åºçš„ $Î²$ å‹å„¿å­ï¼Œå…¶ä¸­$câˆˆ\mathbb{A}$ã€‚</p><p>3ã€å¦‚æœä¸€ä¸ªç‚¹æ˜¯æ ¹èŠ‚ç‚¹æˆ– $Î±$ å‹å„¿å­ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æœ‰å„¿å­æˆ–è€…æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ï¼›å¦‚æœä¸€ä¸ªç‚¹æ˜¯ $Î²$ å‹å„¿å­ï¼Œé‚£ä¹ˆå®ƒåªèƒ½æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ã€‚</p><p>$1\leq n\leq 2\cdot 10^5$ ã€‚</p></blockquote><a id="more"></a><p>è€ƒè™‘æš´åŠ› $dp$ ï¼Œè®¾çŠ¶æ€ $f_i$ è¡¨ç¤ºä»¥ $i$ ä¸ºæ ¹æ—¶æ ‘çš„æ•°é‡ã€‚é‚£ä¹ˆæœ‰</p><script type="math/tex; mode=display">f_{i}=\sum_{j}\sum_{k}\binom{i-1}{j}\cdot\binom{i-j-1}{k}\cdot f_j\cdot f_k\cdot [(i-j-k-1)\in \mathbb{A}]</script><p>ä½†æ˜¯æ³¨æ„åˆ°ç”±äº $\alpha$ å‹å„¿å­æ˜¯æ— åºçš„ï¼Œæ‰€ä»¥åº”è¯¥ä¹˜ä¸€ä¸ª $\frac{1}{2}$ çš„å¸¸æ•°ã€‚äºæ˜¯å°±å¯ä»¥è·å¾—ä¸€ä¸ª $40$ åˆ†çš„ $O(n^3)$ åšæ³•ã€‚</p><p>æ³¨æ„åˆ°å¯ä»¥æŠŠ $j$ å’Œ $k$ åˆ†ç¦»ï¼Œå˜æˆ</p><script type="math/tex; mode=display">f_{i}=\frac{1}{2}\cdot \sum_{j}\binom{i-1}{j}\cdot f_j\cdot\sum_{k}\binom{i-j-1}{k}\cdot f_k\cdot [(i-j-k-1)\in \mathbb{A}]</script><p>å±•å¼€ä¸¤ä¸ªäºŒé¡¹ç³»æ•°</p><script type="math/tex; mode=display">\begin{aligned}f_{i}&=\frac{1}{2}\cdot \sum_{j}\frac{(i-1)!}{j!\cdot (i-j-1)!}\cdot f_j\cdot\sum_{k}\frac{(i-j-1)!}{k!\cdot (i-j-k-1)!}\cdot f_k\cdot [(i-j-k-1)\in \mathbb{A}]\\&=\frac{1}{2}\cdot (i-1)!\cdot \sum_{j}\frac{f_j}{j!}\cdot\sum_{k}\frac{f_k}{k!}\cdot \frac{[(i-j-k-1)\in \mathbb{A}]}{(i-j-k-1)!}\\\end{aligned}</script><p>å› ä¸ºæ¯æ¬¡æœ¬è´¨ä¸Šåªå…³å¿ƒ $i-1-(j+k)$ æ˜¯å¦æ˜¯ $\mathbb A$ ä¸­çš„å…ƒç´ ï¼Œæ‰€ä»¥å³é€šè¿‡ç»´æŠ¤ä¸€ä¸ª $g$ </p><script type="math/tex; mode=display">g_i= \sum_{j+k=i}\dfrac{f_j}{j!}\cdot \dfrac{f_{k}}{k!}</script><p>ç„¶åè½¬ç§»å°±å¯ä»¥</p><script type="math/tex; mode=display">f_{i}=\frac{1}{2}\cdot (i-1)!\cdot \sum_{p}{g_p\cdot \frac{[(i-p-1)\in \mathbb{A}]}{(i-p-1)!}}</script><p>è¿™æ ·å°±æ˜¯ $O(n^2)$ çš„äº†ã€‚å¯ä»¥å–œæ $60pts$ ã€‚</p><p>è€ƒè™‘æ”¾åˆ°åŒä¸€ä¸ªå¼å­é‡Œè§‚å¯Ÿï¼š</p><script type="math/tex; mode=display">f_{i}=\frac{1}{2}\cdot (i-1)!\cdot \sum_{p\leqslant i-1}\sum_{j+k=p}\dfrac{f_j}{j!}\cdot \dfrac{f_{k}}{k!}{\cdot \frac{[(i-p-1)\in \mathbb{A}]}{(i-p-1)!}}</script><p>é‚£ä¹ˆå¦‚æœè®¾ $\mathbf{F}_i=\dfrac{f_i}{i!},\mathbf{P}_i=\dfrac{[i\in \mathbb{A}]}{i!}$ï¼Œå¯ä»¥å‘ç°åŸå¼å°±æ˜¯ä¸€ä¸ªå·ç§¯çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">2\cdot i\cdot \mathbf{F}_i=\sum_{2\leqslant j+k\leqslant i-1} \mathbf{F}_j\cdot \mathbf{F}_k\cdot \mathbf{P}_{i-j-k-1}</script><p>æ­¤æ—¶æœ‰ä¸¤ç§ä¸åŒçš„åšæ³•ï¼š</p><h2 id="ç‰›é¡¿è¿­ä»£"><a href="#ç‰›é¡¿è¿­ä»£" class="headerlink" title="ç‰›é¡¿è¿­ä»£"></a>ç‰›é¡¿è¿­ä»£</h2><p>å³å‘ç°æœ¬è´¨ä¸Šæ˜¯åœ¨è§£ä¸€ä¸ªè¿™æ ·çš„å¾®åˆ†æ–¹ç¨‹</p><script type="math/tex; mode=display">\frac{\mathrm{d}}{\mathrm{d} x}\mathbf{F}=\frac{1}{2}\cdot \mathbf{F}^2\mathbf{P}+1</script><p>ç„¶åè¿­å°±å®Œäº†ã€‚å¤æ‚åº¦ $O(n\log n)$ ä½†æ˜¯å¸¸æ•°â€¦æœ‰ç‚¹å¯æ€•ã€‚</p><h2 id="æŠ€å·§åˆ†æ²»"><a href="#æŠ€å·§åˆ†æ²»" class="headerlink" title="æŠ€å·§åˆ†æ²»"></a>æŠ€å·§åˆ†æ²»</h2><p>è¿™å¼å­çœ‹ä¸Šå»å°±â€¦ååˆ†çš„åˆ†æ²» FFTï¼Ÿä½†æ˜¯æ³¨æ„åˆ°è¿™æ˜¯äºŒå·ç§¯çš„å½¢å¼ã€‚è€ƒè™‘æœ€ç®€å•çš„åˆ†æ²» FFT æ˜¯å•å·ç§¯ï¼Œè¿›è¡Œçš„æ“ä½œå¯ä»¥çœ‹ä½œæ˜¯æ—¶é—´è½´ä¸Šçš„äºŒè¿›åˆ¶æ‹†åˆ†ï¼Œå³æ¯æ¬¡ç”¨å·²ç»å¾—åˆ°å®é™…ç»“æœçš„ $f_{l,l+1\cdots mid}$ å»æ›´æ–° $f_{mid+1,mid+2\cdots r}$ ã€‚è€ƒè™‘äºŒå·ç§¯çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šä¸å•å·ç§¯ç›¸åŒï¼Œ ä½†éœ€è¦åˆ†ç±»è®¨è®ºï¼š</p><p>1ã€$l=1$ æ—¶ã€‚</p><p>æ­¤æ—¶å°±æ˜¯ $\mathbf{F}_{1â€¦mid}^2$ å’Œ $\mathbf{P}_{0â€¦r-l+1}$ å·åœ¨ä¸€èµ·ã€‚æ³¨æ„ $\mathbf{F}$ ä¸­æ ¹æ®ç»„åˆæ„ä¹‰ä¸èƒ½å–ç¬¬ $0$ é¡¹ã€‚</p><p>2ã€$l&gt;1$ æ—¶ã€‚</p><p>å‘ç°æ­¤æ—¶ç”±äºåˆ†æ²»äº†ä¹‹åï¼Œè¦ä¿è¯å¤æ‚åº¦ï¼Œä¼¼ä¹ä¼šå‡ºç°éœ€è¦ç”¨åˆ° $i&gt;mid$ çš„ $f_i$ çš„æƒ…å†µâ€”â€”ä½†æ ¹æ®åˆ†æ²»ç­–ç•¥ï¼Œæ­¤æ—¶ä¸€å®šæœ‰ $2\cdot l&gt;r$ ï¼Œä¹Ÿå°±æ˜¯ $\forall i\in[l,mid]\cap\mathbb{Z_+}$ ï¼Œ$i&gt;r-l-1\Longrightarrow r-i<l-1$ ã€‚é‚£ä¹ˆå°±ä»£è¡¨ç€éœ€è¦çš„å…ƒç´ éƒ½å·²ç» $l$ ä¹‹å‰è¢«æ±‚å‡ºäº†å‡†ç¡®å€¼ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸éœ€è¦è€ƒè™‘ $i>mid$ çš„é‚£äº›è½¬ç§»ç‚¹ã€‚æ‰€ä»¥æ­¤æ—¶å°±ç›´æ¥æ‹¿ $\mathbf{F}_{1â€¦r-l}$ å·ä¸Š $\mathbf{F}_{lâ€¦mid}$ å’Œ $\mathbf{P}_{1..r-l}$ å³å¯ã€‚æ³¨æ„åˆ°æ­¤æ—¶æœ‰åˆ«äº $l=1$ ï¼Œå¯¹äºä¸¤æ£µå­æ ‘çš„ä¸åŒå½¢æ€æœ¬è´¨æ²¡æœ‰ç®—é‡ã€‚æ‰€ä»¥ä¸ºäº†å¤„ç†æ–¹ä¾¿å¯ä»¥åœ¨æ­¤æ—¶ä¹˜ä¸€ä¸ª $2$ ã€‚</p><p>äºæ˜¯è¿™ç§åˆ†æ²»æ–¹å¼å°±æ¯”å…¶ä»–æœ´ç´ çš„åˆ†æ²»å¤šä¸€ä¸ªæ¯”è¾ƒä¼˜çš„å¸¸æ•°ã€‚ç°åœ¨è·‘åˆ°äº†<a href="http://uoj.ac/problem/50/statistics" target="_blank" rel="noopener">uojæ¦œ</a>çš„ç¬¬ä¸€é¡µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> n ;</span><br><span class="line">ll f[N] ;</span><br><span class="line">ll g[N] ;</span><br><span class="line">ll fac[N] ;</span><br><span class="line">ll inv[N] ;</span><br><span class="line">ll base[N] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Inv_2 = <span class="number">499122177</span> ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">expow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">while</span> (y)&#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">            res = (ll)res * x % P ;</span><br><span class="line">        x = (ll)x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre_do</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = inv[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (ll i = <span class="number">1</span> ; i &lt;= n + <span class="number">1</span> ; ++ i)</span><br><span class="line">        fac[i] = fac[i - <span class="number">1</span>] * i % P ;</span><br><span class="line">    inv[n + <span class="number">1</span>] = expow(fac[n + <span class="number">1</span>], P - <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (ll i = n ; i &gt;= <span class="number">1</span> ; -- i)</span><br><span class="line">        inv[i] = inv[i + <span class="number">1</span>] * (i + <span class="number">1l</span>l) % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">comb</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (ll)fac[x] * inv[y] % P * inv[x - y] % P ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">subtask1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= i - <span class="number">1</span> ; ++ j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, o ; k &lt;= i - j - <span class="number">1</span> ; ++ k)</span><br><span class="line">                <span class="keyword">if</span> (base[i - j - k - <span class="number">1</span>])&#123;</span><br><span class="line">                    o = comb(i - <span class="number">1</span>, j) ;</span><br><span class="line">                    o = <span class="number">1l</span>l * o * comb(i - j - <span class="number">1</span>, k) % P ;</span><br><span class="line">                    add(f[i], <span class="number">1l</span>l * o * f[j] % P * f[k] % P) ;</span><br><span class="line">                &#125;</span><br><span class="line">        f[i] = <span class="number">1l</span>l * f[i] * Inv_2 % P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[i]) ; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">subtask2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span> ; g[<span class="number">1</span>] = <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> ; i &lt;= n ; ++ i)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= i - <span class="number">1</span> ; ++ j)</span><br><span class="line">            <span class="keyword">if</span> (base[i - j - <span class="number">1</span>])</span><br><span class="line">                add(f[i], <span class="number">1l</span>l * g[j] * inv[i - j - <span class="number">1</span>] % P) ;</span><br><span class="line">        f[i] = <span class="number">1l</span>l * f[i] * Inv_2 % P * fac[i - <span class="number">1</span>] % P ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= i - <span class="number">1</span> ; ++ j)</span><br><span class="line">            add(g[i], <span class="number">1l</span>l * f[i - j] * f[j] % P * inv[i - j] % P * inv[j] % P) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i) <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[i]) ; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> Poly&#123;</span><br><span class="line">    <span class="keyword">int</span> k, d ;</span><br><span class="line">    <span class="keyword">int</span> rev[N] ;</span><br><span class="line">    ll g[<span class="number">20</span>][N] ;</span><br><span class="line">    <span class="function">il ll <span class="title">expow</span><span class="params">(ll x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        ll ret = <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">while</span> (y)&#123;</span><br><span class="line">            <span class="keyword">if</span> (y &amp; <span class="number">1</span>)</span><br><span class="line">                ret = ret * x % P ;</span><br><span class="line">            x = x * x % P ; y &gt;&gt;= <span class="number">1</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pre_rt</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">20</span> ; ++ i)&#123;</span><br><span class="line">            ll* r = g[i], ut ; r[<span class="number">0</span>] = <span class="number">1</span> ;</span><br><span class="line">            ut = r[<span class="number">1</span>] = expow(<span class="number">3</span>, <span class="number">998244352</span> / (<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>))) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> ; j &lt; (<span class="number">1</span> &lt;&lt; i) ; ++ j) r[j] = r[j - <span class="number">1</span>] * ut % P ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(T *f, <span class="keyword">int</span> L, <span class="keyword">bool</span> mk)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i)</span><br><span class="line">            <span class="keyword">if</span> (rev[i] &lt; i) swap(f[i], f[rev[i]]) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; L ; i &lt;&lt;= <span class="number">1</span>, ++ l)&#123;</span><br><span class="line">            ll *r = g[l], o = i &lt;&lt; <span class="number">1</span>, rt, irt ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; L ; j += o)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = j ; k &lt; i + j ; ++ k)&#123;</span><br><span class="line">                    rt = f[k], irt = f[k + i] * r[k - j] % P ;</span><br><span class="line">                    f[k] = addn(rt, irt), f[k + i] = decn(rt, irt) ;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!mk) <span class="keyword">return</span> ;</span><br><span class="line">        reverse(f + <span class="number">1</span>, f + L) ;</span><br><span class="line">        <span class="keyword">int</span> o = expow(L, P - <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; L ; ++ i) (f[i] *= o) %= P ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getlen</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        d = <span class="number">1</span>, k = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">while</span> (d &lt;= x) d &lt;&lt;= <span class="number">1</span>, ++ k ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++ i)</span><br><span class="line">            rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (k - <span class="number">1</span>)) ;</span><br><span class="line">    &#125;</span><br><span class="line">    ll tl[N] ;</span><br><span class="line">    ll tr[N] ;</span><br><span class="line">    ll tmid[N] ;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r)&#123;</span><br><span class="line">            <span class="keyword">if</span> (l == <span class="number">1</span>) f[<span class="number">1</span>] = <span class="number">1</span> ;</span><br><span class="line">            <span class="keyword">else</span> f[l] = expow(<span class="number">2</span> * l, P - <span class="number">2</span>) * f[l] % P ;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> len = r - l + <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span> ;</span><br><span class="line">        <span class="keyword">int</span> len1 = mid - l + <span class="number">1</span> ;</span><br><span class="line">        cdq(l, mid) ; getlen(len * <span class="number">2</span>) ;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(tl, base, <span class="keyword">sizeof</span>(ll) * len) ;</span><br><span class="line">            <span class="built_in">memcpy</span>(tr + <span class="number">1</span>, f + l, <span class="keyword">sizeof</span>(ll) * len1) ;</span><br><span class="line">            <span class="built_in">memset</span>(tl + len, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len + <span class="number">1</span>)) ;</span><br><span class="line">            <span class="built_in">memset</span>(tr + len1 + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len1 + <span class="number">1</span>)) ;</span><br><span class="line">            tr[<span class="number">0</span>] = <span class="number">0</span> ; NTT(tl, d, <span class="number">0</span>) ; NTT(tr, d, <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++ i)</span><br><span class="line">                (tl[i] *= tr[i] % P * tr[i] % P) %= P ;</span><br><span class="line">            NTT(tl, d, <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span> ; i &lt;= r ; ++ i) add(f[i], tl[i - l]) ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(tl, base, <span class="keyword">sizeof</span>(ll) * len) ;</span><br><span class="line">            <span class="built_in">memcpy</span>(tr + <span class="number">1</span>, f + l, <span class="keyword">sizeof</span>(ll) * len1) ;</span><br><span class="line">            <span class="built_in">memcpy</span>(tmid + <span class="number">1</span>, f + <span class="number">1</span>, <span class="keyword">sizeof</span>(ll) * len) ;</span><br><span class="line">            <span class="built_in">memset</span>(tl + len, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len + <span class="number">1</span>)) ;</span><br><span class="line">            <span class="built_in">memset</span>(tr + len1 + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len1 + <span class="number">1</span>)) ;</span><br><span class="line">            <span class="built_in">memset</span>(tmid + len + <span class="number">1</span>, <span class="number">0</span>, <span class="keyword">sizeof</span>(ll) * (d - len + <span class="number">1</span>)) ;</span><br><span class="line">            tmid[<span class="number">0</span>] = tr[<span class="number">0</span>] = <span class="number">0</span> ; NTT(tl, d, <span class="number">0</span>) ; NTT(tmid, d, <span class="number">0</span>) ; NTT(tr, d, <span class="number">0</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; d ; ++ i)</span><br><span class="line">                (tl[i] *= tmid[i] % P * tr[i] % P) %= P ;</span><br><span class="line">            NTT(tl, d, <span class="number">1</span>) ;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = mid + <span class="number">1</span> ; i &lt;= r ; ++ i)</span><br><span class="line">                add(f[i], <span class="number">2l</span>l * tl[i - l] % P) ;</span><br><span class="line">        &#125;</span><br><span class="line">        cdq(mid + <span class="number">1</span>, r) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%1lld"</span>, &amp;base[i]) ; pre_do() ;</span><br><span class="line">    Poly :: pre_rt() ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; n ; ++ i)</span><br><span class="line">        base[i] = base[i] * inv[i] % P ;  <span class="comment">//debug(base, 0, n - 1) ;</span></span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span> ; Poly :: cdq(<span class="number">1</span>, n) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n ; ++ i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, f[i] * fac[i] % P) ; <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€é“è¯»é¢˜å°±å¾ˆéº»çƒ¦çš„é¢˜ç›®ï¼Œä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆçš„é¢˜é¢ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç»™å®š $n$ å’Œé›†åˆ $\mathbb{A}$ï¼Œå¯¹äº $i=1..n$ æ±‚å¤šå°‘ $i$ ä¸ªèŠ‚ç‚¹æœ‰æ ‡å·çš„å¤šå‰æ ‘æ»¡è¶³ï¼š&lt;/p&gt;
&lt;p&gt;1ã€çˆ¶äº²èŠ‚ç‚¹çš„æ ‡å·å¤§äºå­èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;2ã€ä¸€ä¸ªç‚¹å¦‚æœæœ‰å„¿å­ï¼Œåˆ™æœ‰ä¸¤ä¸ªæ— åºçš„ $Î±$ å‹å„¿å­ï¼Œæœ‰ $c$ ä¸ªæ— åºçš„ $Î²$ å‹å„¿å­ï¼Œå…¶ä¸­$câˆˆ\mathbb{A}$ã€‚&lt;/p&gt;
&lt;p&gt;3ã€å¦‚æœä¸€ä¸ªç‚¹æ˜¯æ ¹èŠ‚ç‚¹æˆ– $Î±$ å‹å„¿å­ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æœ‰å„¿å­æˆ–è€…æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ï¼›å¦‚æœä¸€ä¸ªç‚¹æ˜¯ $Î²$ å‹å„¿å­ï¼Œé‚£ä¹ˆå®ƒåªèƒ½æ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;$1\leq n\leq 2\cdot 10^5$ ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="é¢˜è§£" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/"/>
    
      <category term="uoj" scheme="https://www.orchidany.cn/categories/%E9%A2%98%E8%A7%A3/uoj/"/>
    
    
      <category term="å¾®åˆ†æ–¹ç¨‹" scheme="https://www.orchidany.cn/tags/%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/"/>
    
      <category term="å¤šé¡¹å¼çš„åº”ç”¨/åˆ†æ²»FFT" scheme="https://www.orchidany.cn/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8-%E5%88%86%E6%B2%BBFFT/"/>
    
  </entry>
  
</feed>
